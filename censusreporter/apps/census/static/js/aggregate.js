!function(){function i(i,r,n,o){Object.defineProperty(i,r,{get:n,set:o,enumerable:!0,configurable:!0})}function r(i){return i&&i.__esModule?i.default:i}var n,o,s,a,l,u,h,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},p={},f={},d=c.parcelRequire94c2;null==d&&((d=function(i){if(i in p)return p[i].exports;if(i in f){var r=f[i];delete f[i];var n={id:i,exports:{}};return p[i]=n,r.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(i,r){f[i]=r},c.parcelRequire94c2=d);var m=d.register;m("17UQw",function(r,n){i(r.exports,"init",function(){return f}),i(r.exports,"forward",function(){return m}),i(r.exports,"inverse",function(){return g}),i(r.exports,"names",function(){return y}),i(r.exports,"default",function(){return _});var o=d("fMWdI"),s=d("8RvLG"),a=d("98Kl2"),l=d("e0xlY"),u=d("bIdMf"),h=d("biMLT"),c=d("ciDuR"),p=d("fKwbA");function f(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&((0,o.default).init.apply(this),this.forward=o.default.forward,this.inverse=o.default.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),r=i/(2-i),n=r;this.cgb[0]=r*(2+r*(-2/3+r*(-2+r*(116/45+r*(26/45+-2854/675*r))))),this.cbg[0]=r*(-2+r*(2/3+r*(4/3+r*(-82/45+r*(32/45+4642/4725*r))))),n*=r,this.cgb[1]=n*(7/3+r*(-1.6+r*(-227/45+r*(2704/315+2323/945*r)))),this.cbg[1]=n*(5/3+r*(-16/15+r*(-13/9+r*(904/315+-1522/945*r)))),n*=r,this.cgb[2]=n*(56/15+r*(-136/35+r*(-1262/105+73814/2835*r))),this.cbg[2]=n*(-26/15+r*(34/21+r*(1.6+-12686/2835*r))),n*=r,this.cgb[3]=n*(4279/630+r*(-332/35+-399572/14175*r)),this.cbg[3]=n*(1237/630+r*(-2.4+-24832/14175*r)),n*=r,this.cgb[4]=n*(4174/315+-144838/6237*r),this.cbg[4]=n*(-734/315+109598/31185*r),n*=r,this.cgb[5]=601676/22275*n,this.cbg[5]=444337/155925*n,n=Math.pow(r,2),this.Qn=this.k0/(1+r)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=r*(-.5+r*(2/3+r*(-37/96+r*(1/360+r*(81/512+-96199/604800*r))))),this.gtu[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+7891/37800*r))))),this.utg[1]=n*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+1118711/3870720*r)))),this.gtu[1]=n*(13/48+r*(-.6+r*(557/1440+r*(281/630+-1983433/1935360*r)))),n*=r,this.utg[2]=n*(-17/480+r*(37/840+r*(209/4480+-5569/90720*r))),this.gtu[2]=n*(61/240+r*(-103/140+r*(15061/26880+167603/181440*r))),n*=r,this.utg[3]=n*(-4397/161280+r*(11/504+830251/7257600*r)),this.gtu[3]=n*(49561/161280+r*(-179/168+6601661/7257600*r)),n*=r,this.utg[4]=n*(-4583/161280+108847/3991680*r),this.gtu[4]=n*(34729/80640+-3418889/1995840*r),n*=r,this.utg[5]=-0x13b12f5/0x26115000*n,this.gtu[5]=.6650675310896665*n;var s=(0,u.default)(this.cbg,this.lat0);this.Zb=-this.Qn*(s+(0,h.default)(this.gtu,2*s))}function m(i){var r,n,o=(0,p.default)(i.x-this.long0),s=i.y,h=Math.sin(s=(0,u.default)(this.cbg,s)),f=Math.cos(s),d=Math.sin(o),m=Math.cos(o);s=Math.atan2(h,m*f),o=Math.atan2(d*f,(0,a.default)(h,f*m)),o=(0,l.default)(Math.tan(o));var g=(0,c.default)(this.gtu,2*s,2*o);return s+=g[0],2.623395162778>=Math.abs(o+=g[1])?(r=this.a*(this.Qn*o)+this.x0,n=this.a*(this.Qn*s+this.Zb)+this.y0):(r=1/0,n=1/0),i.x=r,i.y=n,i}function g(i){var r,n,o=(i.x-this.x0)*(1/this.a),l=(i.y-this.y0)*(1/this.a);if(l=(l-this.Zb)/this.Qn,2.623395162778>=Math.abs(o/=this.Qn)){var h=(0,c.default)(this.utg,2*l,2*o);l+=h[0],o+=h[1],o=Math.atan((0,s.default)(o));var f=Math.sin(l),d=Math.cos(l),m=Math.sin(o),g=Math.cos(o);l=Math.atan2(f*g,(0,a.default)(m,g*d)),o=Math.atan2(m,g*d),r=(0,p.default)(o+this.long0),n=(0,u.default)(this.cgb,l)}else r=1/0,n=1/0;return i.x=r,i.y=n,i}var y=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"],_={init:f,forward:m,inverse:g,names:y}}),m("fMWdI",function(r,n){i(r.exports,"default",function(){return c});var o=d("ej898"),s=d("emueP"),a=d("kUbYC"),l=d("fKwbA"),u=d("2tD7m"),h=d("9MBM4"),c={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=(0,o.default)(this.es),this.ml0=(0,s.default)(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(i){var r,n,o=i.x,a=i.y,h=(0,l.default)(o-this.long0),c=Math.sin(a),p=Math.cos(a);if(this.es){var f=p*h,d=Math.pow(f,2),m=this.ep2*Math.pow(p,2),g=Math.pow(m,2),y=Math.pow(Math.abs(p)>u.EPSLN?Math.tan(a):0,2),_=Math.pow(y,2);f/=Math.sqrt(1-this.es*Math.pow(c,2));var v=(0,s.default)(a,c,p,this.en);r=this.a*(this.k0*f*(1+d/6*(1-y+m+d/20*(5-18*y+_+14*m-58*y*m+d/42*(61+179*_-_*y-479*y)))))+this.x0,n=this.a*(this.k0*(v-this.ml0+c*h*f/2*(1+d/12*(5-y+9*m+4*g+d/30*(61+_-58*y+270*m-330*y*m+d/56*(1385+543*_-_*y-3111*y))))))+this.y0}else{var x=p*Math.sin(h);if(Math.abs(Math.abs(x)-1)<u.EPSLN)return 93;if(r=.5*this.a*this.k0*Math.log((1+x)/(1-x))+this.x0,(x=Math.abs(n=p*Math.cos(h)/Math.sqrt(1-Math.pow(x,2))))>=1){if(x-1>u.EPSLN)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return i.x=r,i.y=n,i},inverse:function(i){var r,n,o,s,c=(i.x-this.x0)*(1/this.a),p=(i.y-this.y0)*(1/this.a);if(this.es){if(r=this.ml0+p/this.k0,Math.abs(n=(0,a.default)(r,this.es,this.en))<u.HALF_PI){var f=Math.sin(n),d=Math.cos(n),m=Math.abs(d)>u.EPSLN?Math.tan(n):0,g=this.ep2*Math.pow(d,2),y=Math.pow(g,2),_=Math.pow(m,2),v=Math.pow(_,2),x=c*Math.sqrt(r=1-this.es*Math.pow(f,2))/this.k0,b=Math.pow(x,2);r*=m,o=n-r*b/(1-this.es)*.5*(1-b/12*(5+3*_-9*g*_+g-4*y-b/30*(61+90*_-252*g*_+45*v+46*g-b/56*(1385+3633*_+4095*v+1574*v*_)))),s=(0,l.default)(this.long0+x*(1-b/6*(1+2*_+g-b/20*(5+28*_+24*v+8*g*_+6*g-b/42*(61+662*_+1320*v+720*v*_))))/d)}else o=u.HALF_PI*(0,h.default)(p),s=0}else{var w=Math.exp(c/this.k0),E=.5*(w-1/w),I=Math.cos(this.lat0+p/this.k0);o=Math.asin(r=Math.sqrt((1-Math.pow(I,2))/(1+Math.pow(E,2)))),p<0&&(o=-o),s=0===E&&0===I?0:(0,l.default)(Math.atan2(E,I)+this.long0)}return i.x=s,i.y=o,i},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]}}),m("ej898",function(r,n){i(r.exports,"default",function(){return o});function o(i){var r=[];r[0]=1-i*(.25+i*(.046875+i*(.01953125+.01068115234375*i))),r[1]=i*(.75-i*(.046875+i*(.01953125+.01068115234375*i)));var n=i*i;return r[2]=n*(.46875-i*(.013020833333333334+.007120768229166667*i)),n*=i,r[3]=n*(.3645833333333333-.005696614583333333*i),r[4]=n*i*.3076171875,r}}),m("emueP",function(r,n){i(r.exports,"default",function(){return o});function o(i,r,n,o){return n*=r,r*=r,o[0]*i-n*(o[1]+r*(o[2]+r*(o[3]+r*o[4])))}}),m("kUbYC",function(r,n){i(r.exports,"default",function(){return a});var o=d("emueP"),s=d("2tD7m");function a(i,r,n){for(var a=1/(1-r),l=i,u=20;u;--u){var h=Math.sin(l),c=1-r*h*h;if(c=((0,o.default)(l,h,Math.cos(l),n)-i)*(c*Math.sqrt(c))*a,l-=c,Math.abs(c)<s.EPSLN)break}return l}}),m("2tD7m",function(r,n){i(r.exports,"PJD_3PARAM",function(){return o}),i(r.exports,"PJD_7PARAM",function(){return s}),i(r.exports,"PJD_GRIDSHIFT",function(){return a}),i(r.exports,"PJD_WGS84",function(){return l}),i(r.exports,"PJD_NODATUM",function(){return u}),i(r.exports,"SRS_WGS84_SEMIMAJOR",function(){return h}),i(r.exports,"SRS_WGS84_SEMIMINOR",function(){return c}),i(r.exports,"SRS_WGS84_ESQUARED",function(){return p}),i(r.exports,"SEC_TO_RAD",function(){return f}),i(r.exports,"HALF_PI",function(){return d}),i(r.exports,"SIXTH",function(){return m}),i(r.exports,"RA4",function(){return g}),i(r.exports,"RA6",function(){return y}),i(r.exports,"EPSLN",function(){return _}),i(r.exports,"D2R",function(){return v}),i(r.exports,"R2D",function(){return x}),i(r.exports,"FORTPI",function(){return b}),i(r.exports,"TWO_PI",function(){return w}),i(r.exports,"SPI",function(){return E});var o=1,s=2,a=3,l=4,u=5,h=6378137,c=6356752.314,p=.0066943799901413165,f=484813681109536e-20,d=Math.PI/2,m=.16666666666666666,g=.04722222222222222,y=.022156084656084655,_=1e-10,v=.017453292519943295,x=57.29577951308232,b=Math.PI/4,w=2*Math.PI,E=3.14159265359}),m("fKwbA",function(r,n){i(r.exports,"default",function(){return a});var o=d("2tD7m"),s=d("9MBM4");function a(i){return Math.abs(i)<=o.SPI?i:i-(0,s.default)(i)*o.TWO_PI}}),m("9MBM4",function(r,n){i(r.exports,"default",function(){return o});function o(i){return i<0?-1:1}}),m("8RvLG",function(r,n){i(r.exports,"default",function(){return o});function o(i){var r=Math.exp(i);return(r-1/r)/2}}),m("98Kl2",function(r,n){i(r.exports,"default",function(){return o});function o(i,r){var n=Math.max(i=Math.abs(i),r=Math.abs(r)),o=Math.min(i,r)/(n||1);return n*Math.sqrt(1+Math.pow(o,2))}}),m("e0xlY",function(r,n){i(r.exports,"default",function(){return a});var o=d("98Kl2"),s=d("7JQnL");function a(i){var r=Math.abs(i);return r=(0,s.default)(r*(1+r/((0,o.default)(1,r)+1))),i<0?-r:r}}),m("7JQnL",function(r,n){i(r.exports,"default",function(){return o});function o(i){var r=1+i,n=r-1;return 0===n?i:i*Math.log(r)/n}}),m("bIdMf",function(r,n){i(r.exports,"default",function(){return o});function o(i,r){for(var n,o=2*Math.cos(2*r),s=i.length-1,a=i[s],l=0;--s>=0;)n=-l+o*a+i[s],l=a,a=n;return r+n*Math.sin(2*r)}}),m("biMLT",function(r,n){i(r.exports,"default",function(){return o});function o(i,r){for(var n,o=2*Math.cos(r),s=i.length-1,a=i[s],l=0;--s>=0;)n=-l+o*a+i[s],l=a,a=n;return Math.sin(r)*n}}),m("ciDuR",function(r,n){i(r.exports,"default",function(){return a});var o=d("8RvLG"),s=d("8Njhw");function a(i,r,n){for(var a,l,u=Math.sin(r),h=Math.cos(r),c=(0,o.default)(n),p=(0,s.default)(n),f=2*h*p,d=-2*u*c,m=i.length-1,g=i[m],y=0,_=0,v=0;--m>=0;)a=_,l=y,g=-a+f*(_=g)-d*(y=v)+i[m],v=-l+d*_+f*y;return[(f=u*p)*g-(d=h*c)*v,f*v+d*g]}}),m("8Njhw",function(r,n){i(r.exports,"default",function(){return o});function o(i){var r=Math.exp(i);return(r+1/r)/2}}),m("kAlZb",function(r,n){i(r.exports,"ssfn_",function(){return c}),i(r.exports,"init",function(){return p}),i(r.exports,"forward",function(){return f}),i(r.exports,"inverse",function(){return m}),i(r.exports,"names",function(){return g}),i(r.exports,"default",function(){return y});var o=d("2tD7m"),s=d("9MBM4"),a=d("4brs7"),l=d("dXS7W"),u=d("lUD03"),h=d("fKwbA");function c(i,r,n){return r*=n,Math.tan(.5*(o.HALF_PI+i))*Math.pow((1-r)/(1+r),.5*n)}function p(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.EPSLN&&(this.k0=.5*(1+(0,s.default)(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=o.EPSLN&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.EPSLN&&(this.k0=.5*this.cons*(0,a.default)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/(0,l.default)(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=(0,a.default)(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-o.HALF_PI,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function f(i){var r,n,s,a,u,c,p=i.x,f=i.y,d=Math.sin(f),m=Math.cos(f),g=(0,h.default)(p-this.long0);if(Math.abs(Math.abs(p-this.long0)-Math.PI)<=o.EPSLN&&Math.abs(f+this.lat0)<=o.EPSLN)return i.x=NaN,i.y=NaN,i;if(this.sphere)r=2*this.k0/(1+this.sinlat0*d+this.coslat0*m*Math.cos(g)),i.x=this.a*r*m*Math.sin(g)+this.x0,i.y=this.a*r*(this.coslat0*d-this.sinlat0*m*Math.cos(g))+this.y0;else{if(a=Math.cos(n=2*Math.atan(this.ssfn_(f,d,this.e))-o.HALF_PI),s=Math.sin(n),Math.abs(this.coslat0)<=o.EPSLN)return u=(0,l.default)(this.e,f*this.con,this.con*d),c=2*this.a*this.k0*u/this.cons,i.x=this.x0+c*Math.sin(p-this.long0),i.y=this.y0-this.con*c*Math.cos(p-this.long0),i;Math.abs(this.sinlat0)<o.EPSLN?(r=2*this.a*this.k0/(1+a*Math.cos(g)),i.y=r*s):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*a*Math.cos(g))),i.y=r*(this.cosX0*s-this.sinX0*a*Math.cos(g))+this.y0),i.x=r*a*Math.sin(g)+this.x0}return i}function m(i){i.x-=this.x0,i.y-=this.y0;var r,n,s,a,l,c=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var p=2*Math.atan(c/(2*this.a*this.k0));return r=this.long0,n=this.lat0,c<=o.EPSLN||(n=Math.asin(Math.cos(p)*this.sinlat0+i.y*Math.sin(p)*this.coslat0/c),r=Math.abs(this.coslat0)<o.EPSLN?this.lat0>0?(0,h.default)(this.long0+Math.atan2(i.x,-1*i.y)):(0,h.default)(this.long0+Math.atan2(i.x,i.y)):(0,h.default)(this.long0+Math.atan2(i.x*Math.sin(p),c*this.coslat0*Math.cos(p)-i.y*this.sinlat0*Math.sin(p)))),i.x=r,i.y=n,i}if(Math.abs(this.coslat0)<=o.EPSLN){if(c<=o.EPSLN)return n=this.lat0,r=this.long0,i.x=r,i.y=n,i;i.x*=this.con,i.y*=this.con,s=c*this.cons/(2*this.a*this.k0),n=this.con*(0,u.default)(this.e,s),r=this.con*(0,h.default)(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else a=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,c<=o.EPSLN?l=this.X0:(l=Math.asin(Math.cos(a)*this.sinX0+i.y*Math.sin(a)*this.cosX0/c),r=(0,h.default)(this.long0+Math.atan2(i.x*Math.sin(a),c*this.cosX0*Math.cos(a)-i.y*this.sinX0*Math.sin(a)))),n=-1*(0,u.default)(this.e,Math.tan(.5*(o.HALF_PI+l)));return i.x=r,i.y=n,i}var g=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],y={init:p,forward:f,inverse:m,names:g,ssfn_:c}}),m("4brs7",function(r,n){i(r.exports,"default",function(){return o});function o(i,r,n){var o=i*r;return n/Math.sqrt(1-o*o)}}),m("dXS7W",function(r,n){i(r.exports,"default",function(){return s});var o=d("2tD7m");function s(i,r,n){var s=i*n;return s=Math.pow((1-s)/(1+s),.5*i),Math.tan(.5*(o.HALF_PI-r))/s}}),m("lUD03",function(r,n){i(r.exports,"default",function(){return s});var o=d("2tD7m");function s(i,r){for(var n,s,a=.5*i,l=o.HALF_PI-2*Math.atan(r),u=0;u<=15;u++)if(n=i*Math.sin(l),s=o.HALF_PI-2*Math.atan(r*Math.pow((1-n)/(1+n),a))-l,l+=s,1e-10>=Math.abs(s))return l;return -9999}}),m("4hir7",function(r,n){i(r.exports,"S_POLE",function(){return l}),i(r.exports,"N_POLE",function(){return u}),i(r.exports,"EQUIT",function(){return h}),i(r.exports,"OBLIQ",function(){return c}),i(r.exports,"init",function(){return p}),i(r.exports,"forward",function(){return f}),i(r.exports,"inverse",function(){return m}),i(r.exports,"names",function(){return g}),i(r.exports,"default",function(){return y});var o=d("2tD7m"),s=d("3UUgM"),a=d("fKwbA"),l=1,u=2,h=3,c=4;function p(){var i,r,n,a,l=Math.abs(this.lat0);if(Math.abs(l-o.HALF_PI)<o.EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(l)<o.EPSLN?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=(0,s.default)(this.e,1),this.mmf=.5/(1-this.es),this.apa=(i=this.es,(n=[])[0]=.3333333333333333*i,r=i*i,n[0]+=.17222222222222222*r,n[1]=.06388888888888888*r,r*=i,n[0]+=.10257936507936508*r,n[1]+=.0664021164021164*r,n[2]=.016415012942191543*r,n),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),a=Math.sin(this.lat0),this.sinb1=(0,s.default)(this.e,a)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*a*a)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function f(i){var r,n,l,u,h,c,p,f,d,m,g=i.x,y=i.y;if(g=(0,a.default)(g-this.long0),this.sphere){if(h=Math.sin(y),m=Math.cos(y),l=Math.cos(g),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+m*l:1+this.sinph0*h+this.cosph0*m*l)<=o.EPSLN)return null;r=(n=Math.sqrt(2/n))*m*Math.sin(g),n*=this.mode===this.EQUIT?h:this.cosph0*h-this.sinph0*m*l}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),Math.abs(y+this.lat0)<o.EPSLN)return null;n=o.FORTPI-.5*y,r=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(g),n*=l}}else{switch(p=0,f=0,d=0,l=Math.cos(g),u=Math.sin(g),h=Math.sin(y),c=(0,s.default)(this.e,h),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sqrt(1-(p=c/this.qp)*p)),this.mode){case this.OBLIQ:d=1+this.sinb1*p+this.cosb1*f*l;break;case this.EQUIT:d=1+f*l;break;case this.N_POLE:d=o.HALF_PI+y,c=this.qp-c;break;case this.S_POLE:d=y-o.HALF_PI,c=this.qp+c}if(Math.abs(d)<o.EPSLN)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),n=this.mode===this.OBLIQ?this.ymf*d*(this.cosb1*p-this.sinb1*f*l):(d=Math.sqrt(2/(1+f*l)))*p*this.ymf,r=this.xmf*d*f*u;break;case this.N_POLE:case this.S_POLE:c>=0?(r=(d=Math.sqrt(c))*u,n=l*(this.mode===this.S_POLE?d:-d)):r=n=0}}return i.x=this.a*r+this.x0,i.y=this.a*n+this.y0,i}function m(i){i.x-=this.x0,i.y-=this.y0;var r,n,s,l=i.x/this.a,u=i.y/this.a;if(this.sphere){var h,c,p,f,d,m,g,y,_=0,v=0;if((c=.5*(y=Math.sqrt(l*l+u*u)))>1)return null;switch(c=2*Math.asin(c),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(v=Math.sin(c),_=Math.cos(c)),this.mode){case this.EQUIT:c=Math.abs(y)<=o.EPSLN?0:Math.asin(u*v/y),l*=v,u=_*y;break;case this.OBLIQ:c=Math.abs(y)<=o.EPSLN?this.lat0:Math.asin(_*this.sinph0+u*v*this.cosph0/y),l*=v*this.cosph0,u=(_-Math.sin(c)*this.sinph0)*y;break;case this.N_POLE:u=-u,c=o.HALF_PI-c;break;case this.S_POLE:c-=o.HALF_PI}h=0===u&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(l,u)}else{if(g=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,u*=this.dd,(m=Math.sqrt(l*l+u*u))<o.EPSLN)return i.x=this.long0,i.y=this.lat0,i;p=Math.cos(f=2*Math.asin(.5*m/this.rq)),l*=f=Math.sin(f),this.mode===this.OBLIQ?(g=p*this.sinb1+u*f*this.cosb1/m,d=this.qp*g,u=m*this.cosb1*p-u*this.sinb1*f):(g=u*f/m,d=this.qp*g,u=m*p)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),!(d=l*l+u*u))return i.x=this.long0,i.y=this.lat0,i;g=1-d/this.qp,this.mode===this.S_POLE&&(g=-g)}h=Math.atan2(l,u),r=Math.asin(g),n=this.apa,s=r+r,c=r+n[0]*Math.sin(s)+n[1]*Math.sin(s+s)+n[2]*Math.sin(s+s+s)}return i.x=(0,a.default)(this.long0+h),i.y=c,i}var g=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],y={init:p,forward:f,inverse:m,names:g,S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4}}),m("3UUgM",function(r,n){i(r.exports,"default",function(){return o});function o(i,r){var n;return i>1e-7?(n=i*r,(1-i*i)*(r/(1-n*n)-.5/i*Math.log((1-n)/(1+n)))):2*r}}),m("4esCO",function(r,n){i(r.exports,"init",function(){return h}),i(r.exports,"forward",function(){return c}),i(r.exports,"inverse",function(){return p}),i(r.exports,"phi1z",function(){return f}),i(r.exports,"names",function(){return m}),i(r.exports,"default",function(){return g});var o=d("4brs7"),s=d("3UUgM"),a=d("fKwbA"),l=d("eWZoB"),u=d("2tD7m");function h(){Math.abs(this.lat1+this.lat2)<u.EPSLN||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=(0,o.default)(this.e3,this.sin_po,this.cos_po),this.qs1=(0,s.default)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=(0,o.default)(this.e3,this.sin_po,this.cos_po),this.qs2=(0,s.default)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=(0,s.default)(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>u.EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function c(i){var r=i.x,n=i.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var o=(0,s.default)(this.e3,this.sin_phi,this.cos_phi),l=this.a*Math.sqrt(this.c-this.ns0*o)/this.ns0,u=this.ns0*(0,a.default)(r-this.long0),h=l*Math.sin(u)+this.x0,c=this.rh-l*Math.cos(u)+this.y0;return i.x=h,i.y=c,i}function p(i){var r,n,o,s,l,u;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(r=Math.sqrt(i.x*i.x+i.y*i.y),o=1):(r=-Math.sqrt(i.x*i.x+i.y*i.y),o=-1),s=0,0!==r&&(s=Math.atan2(o*i.x,o*i.y)),o=r*this.ns0/this.a,this.sphere?u=Math.asin((this.c-o*o)/(2*this.ns0)):(n=(this.c-o*o)/this.ns0,u=this.phi1z(this.e3,n)),l=(0,a.default)(s/this.ns0+this.long0),i.x=l,i.y=u,i}function f(i,r){var n,o,s,a,h,c=(0,l.default)(.5*r);if(i<u.EPSLN)return c;for(var p=i*i,f=1;f<=25;f++)if(n=Math.sin(c),o=Math.cos(c),c+=h=.5*(a=1-(s=i*n)*s)*a/o*(r/(1-p)-n/a+.5/i*Math.log((1-s)/(1+s))),1e-7>=Math.abs(h))return c;return null}var m=["Albers_Conic_Equal_Area","Albers","aea"],g={init:h,forward:c,inverse:p,names:m,phi1z:f}}),m("eWZoB",function(r,n){i(r.exports,"default",function(){return o});function o(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}}),m("bShNf",function(r,n){i(r.exports,"iterations",function(){return s}),i(r.exports,"init",function(){return a}),i(r.exports,"forward",function(){return l}),i(r.exports,"inverse",function(){return u}),i(r.exports,"names",function(){return h}),i(r.exports,"default",function(){return c});var o=d("2tD7m"),s=1;function a(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function l(i){var r,n,s,a=i.x,l=i.y-this.lat0,u=a-this.long0,h=l/o.SEC_TO_RAD*1e-5,c=1,p=0;for(r=1;r<=10;r++)c*=h,p+=this.A[r]*c;var f=p,d=1,m=0,g=0,y=0;for(r=1;r<=6;r++)n=d*f-m*u,s=m*f+d*u,d=n,m=s,g=g+this.B_re[r]*d-this.B_im[r]*m,y=y+this.B_im[r]*d+this.B_re[r]*m;return i.x=y*this.a+this.x0,i.y=g*this.a+this.y0,i}function u(i){var r=i.x,n=i.y,s=r-this.x0,a=(n-this.y0)/this.a,l=s/this.a,u=1,h=0,c=0,p=0;for(d=1;d<=6;d++)m=u*a-h*l,g=h*a+u*l,u=m,h=g,c=c+this.C_re[d]*u-this.C_im[d]*h,p=p+this.C_im[d]*u+this.C_re[d]*h;for(var f=0;f<this.iterations;f++){var d,m,g,y,_,v=c,x=p,b=a,w=l;for(d=2;d<=6;d++)y=v*c-x*p,_=x*c+v*p,v=y,x=_,b+=(d-1)*(this.B_re[d]*v-this.B_im[d]*x),w+=(d-1)*(this.B_im[d]*v+this.B_re[d]*x);v=1,x=0;var E=this.B_re[1],I=this.B_im[1];for(d=2;d<=6;d++)y=v*c-x*p,_=x*c+v*p,v=y,x=_,E+=d*(this.B_re[d]*v-this.B_im[d]*x),I+=d*(this.B_im[d]*v+this.B_re[d]*x);var S=E*E+I*I;c=(b*E+w*I)/S,p=(w*E-b*I)/S}var M=c,T=p,C=1,P=0;for(d=1;d<=9;d++)C*=M,P+=this.D[d]*C;var A=this.lat0+P*o.SEC_TO_RAD*1e5,L=this.long0+T;return i.x=L,i.y=A,i}var h=["New_Zealand_Map_Grid","nzmg"],c={init:a,forward:l,inverse:u,names:h}});var g={};n=function(i){var r,n,o=function(i){var r=i.length;if(r%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=i.indexOf("=");-1===n&&(n=r);var o=n===r?0:4-n%4;return[n,o]}(i),s=o[0],a=o[1],l=new v((s+a)*3/4-a),u=0,h=a>0?s-4:s;for(n=0;n<h;n+=4)r=_[i.charCodeAt(n)]<<18|_[i.charCodeAt(n+1)]<<12|_[i.charCodeAt(n+2)]<<6|_[i.charCodeAt(n+3)],l[u++]=r>>16&255,l[u++]=r>>8&255,l[u++]=255&r;return 2===a&&(r=_[i.charCodeAt(n)]<<2|_[i.charCodeAt(n+1)]>>4,l[u++]=255&r),1===a&&(r=_[i.charCodeAt(n)]<<10|_[i.charCodeAt(n+1)]<<4|_[i.charCodeAt(n+2)]>>2,l[u++]=r>>8&255,l[u++]=255&r),l},o=function(i){for(var r,n=i.length,o=n%3,s=[],a=0,l=n-o;a<l;a+=16383)s.push(function(i,r,n){for(var o,s=[],a=r;a<n;a+=3)s.push(y[(o=(i[a]<<16&0xff0000)+(i[a+1]<<8&65280)+(255&i[a+2]))>>18&63]+y[o>>12&63]+y[o>>6&63]+y[63&o]);return s.join("")}(i,a,a+16383>l?l:a+16383));return 1===o?s.push(y[(r=i[n-1])>>2]+y[r<<4&63]+"=="):2===o&&s.push(y[(r=(i[n-2]<<8)+i[n-1])>>10]+y[r>>4&63]+y[r<<2&63]+"="),s.join("")};for(var y=[],_=[],v="undefined"!=typeof Uint8Array?Uint8Array:Array,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=0,w=x.length;b<w;++b)y[b]=x[b],_[x.charCodeAt(b)]=b;_["-".charCodeAt(0)]=62,_["_".charCodeAt(0)]=63,s=function(i,r,n,o,s){var a,l,u=8*s-o-1,h=(1<<u)-1,c=h>>1,p=-7,f=n?s-1:0,d=n?-1:1,m=i[r+f];for(f+=d,a=m&(1<<-p)-1,m>>=-p,p+=u;p>0;a=256*a+i[r+f],f+=d,p-=8);for(l=a&(1<<-p)-1,a>>=-p,p+=o;p>0;l=256*l+i[r+f],f+=d,p-=8);if(0===a)a=1-c;else{if(a===h)return l?NaN:1/0*(m?-1:1);l+=Math.pow(2,o),a-=c}return(m?-1:1)*l*Math.pow(2,a-o)},a=function(i,r,n,o,s,a){var l,u,h,c=8*a-s-1,p=(1<<c)-1,f=p>>1,d=5960464477539062e-23*(23===s),m=o?0:a-1,g=o?1:-1,y=+(r<0||0===r&&1/r<0);for(isNaN(r=Math.abs(r))||r===1/0?(u=+!!isNaN(r),l=p):(l=Math.floor(Math.log(r)/Math.LN2),r*(h=Math.pow(2,-l))<1&&(l--,h*=2),l+f>=1?r+=d/h:r+=d*Math.pow(2,1-f),r*h>=2&&(l++,h/=2),l+f>=p?(u=0,l=p):l+f>=1?(u=(r*h-1)*Math.pow(2,s),l+=f):(u=r*Math.pow(2,f-1)*Math.pow(2,s),l=0));s>=8;i[n+m]=255&u,m+=g,u/=256,s-=8);for(l=l<<s|u,c+=s;c>0;i[n+m]=255&l,m+=g,l/=256,c-=8);i[n+m-g]|=128*y};let E="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function I(i){if(i>0x7fffffff)throw RangeError('The value "'+i+'" is invalid for option "size"');let r=new Uint8Array(i);return Object.setPrototypeOf(r,S.prototype),r}function S(i,r,n){if("number"==typeof i){if("string"==typeof r)throw TypeError('The "string" argument must be of type string. Received type number');return C(i)}return M(i,r,n)}function M(i,r,n){if("string"==typeof i)return function(i,r){if(("string"!=typeof r||""===r)&&(r="utf8"),!S.isEncoding(r))throw TypeError("Unknown encoding: "+r);let n=0|k(i,r),o=I(n),s=o.write(i,r);return s!==n&&(o=o.slice(0,s)),o}(i,r);if(ArrayBuffer.isView(i))return function(i){if(te(i,Uint8Array)){let r=new Uint8Array(i);return A(r.buffer,r.byteOffset,r.byteLength)}return P(i)}(i);if(null==i)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(te(i,ArrayBuffer)||i&&te(i.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(te(i,SharedArrayBuffer)||i&&te(i.buffer,SharedArrayBuffer)))return A(i,r,n);if("number"==typeof i)throw TypeError('The "value" argument must not be of type number. Received type number');let o=i.valueOf&&i.valueOf();if(null!=o&&o!==i)return S.from(o,r,n);let s=function(i){var r;if(S.isBuffer(i)){let r=0|L(i.length),n=I(r);return 0===n.length||i.copy(n,0,0,r),n}return void 0!==i.length?"number"!=typeof i.length||(r=i.length)!=r?I(0):P(i):"Buffer"===i.type&&Array.isArray(i.data)?P(i.data):void 0}(i);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof i[Symbol.toPrimitive])return S.from(i[Symbol.toPrimitive]("string"),r,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}function T(i){if("number"!=typeof i)throw TypeError('"size" argument must be of type number');if(i<0)throw RangeError('The value "'+i+'" is invalid for option "size"')}function C(i){return T(i),I(i<0?0:0|L(i))}function P(i){let r=i.length<0?0:0|L(i.length),n=I(r);for(let o=0;o<r;o+=1)n[o]=255&i[o];return n}function A(i,r,n){let o;if(r<0||i.byteLength<r)throw RangeError('"offset" is outside of buffer bounds');if(i.byteLength<r+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(o=void 0===r&&void 0===n?new Uint8Array(i):void 0===n?new Uint8Array(i,r):new Uint8Array(i,r,n),S.prototype),o}function L(i){if(i>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|i}function k(i,r){if(S.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||te(i,ArrayBuffer))return i.byteLength;if("string"!=typeof i)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);let n=i.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===n)return 0;let s=!1;for(;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return J(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Q(i).length;default:if(s)return o?-1:J(i).length;r=(""+r).toLowerCase(),s=!0}}function R(i,r,n){let s=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(r>>>=0)))return"";for(i||(i="utf8");;)switch(i){case"hex":return function(i,r,n){let o=i.length;(!r||r<0)&&(r=0),(!n||n<0||n>o)&&(n=o);let s="";for(let o=r;o<n;++o)s+=ti[i[o]];return s}(this,r,n);case"utf8":case"utf-8":return z(this,r,n);case"ascii":return function(i,r,n){let o="";n=Math.min(i.length,n);for(let s=r;s<n;++s)o+=String.fromCharCode(127&i[s]);return o}(this,r,n);case"latin1":case"binary":return function(i,r,n){let o="";n=Math.min(i.length,n);for(let s=r;s<n;++s)o+=String.fromCharCode(i[s]);return o}(this,r,n);case"base64":var a,l;return a=r,l=n,0===a&&l===this.length?o(this):o(this.slice(a,l));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(i,r,n){let o=i.slice(r,n),s="";for(let i=0;i<o.length-1;i+=2)s+=String.fromCharCode(o[i]+256*o[i+1]);return s}(this,r,n);default:if(s)throw TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),s=!0}}function D(i,r,n){let o=i[r];i[r]=i[n],i[n]=o}function N(i,r,n,o,s){var a;if(0===i.length)return -1;if("string"==typeof n?(o=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(a=n*=1)!=a&&(n=s?0:i.length-1),n<0&&(n=i.length+n),n>=i.length){if(s)return -1;n=i.length-1}else if(n<0){if(!s)return -1;n=0}if("string"==typeof r&&(r=S.from(r,o)),S.isBuffer(r))return 0===r.length?-1:O(i,r,n,o,s);if("number"==typeof r)return(r&=255,"function"==typeof Uint8Array.prototype.indexOf)?s?Uint8Array.prototype.indexOf.call(i,r,n):Uint8Array.prototype.lastIndexOf.call(i,r,n):O(i,[r],n,o,s);throw TypeError("val must be string, number or Buffer")}function O(i,r,n,o,s){let a,l=1,u=i.length,h=r.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(i.length<2||r.length<2)return -1;l=2,u/=2,h/=2,n/=2}function c(i,r){return 1===l?i[r]:i.readUInt16BE(r*l)}if(s){let o=-1;for(a=n;a<u;a++)if(c(i,a)===c(r,-1===o?0:a-o)){if(-1===o&&(o=a),a-o+1===h)return o*l}else -1!==o&&(a-=a-o),o=-1}else for(n+h>u&&(n=u-h),a=n;a>=0;a--){let n=!0;for(let o=0;o<h;o++)if(c(i,a+o)!==c(r,o)){n=!1;break}if(n)return a}return -1}function z(i,r,n){n=Math.min(i.length,n);let o=[],s=r;for(;s<n;){let r=i[s],a=null,l=r>239?4:r>223?3:r>191?2:1;if(s+l<=n){let n,o,u,h;switch(l){case 1:r<128&&(a=r);break;case 2:(192&(n=i[s+1]))==128&&(h=(31&r)<<6|63&n)>127&&(a=h);break;case 3:n=i[s+1],o=i[s+2],(192&n)==128&&(192&o)==128&&(h=(15&r)<<12|(63&n)<<6|63&o)>2047&&(h<55296||h>57343)&&(a=h);break;case 4:n=i[s+1],o=i[s+2],u=i[s+3],(192&n)==128&&(192&o)==128&&(192&u)==128&&(h=(15&r)<<18|(63&n)<<12|(63&o)<<6|63&u)>65535&&h<1114112&&(a=h)}}null===a?(a=65533,l=1):a>65535&&(a-=65536,o.push(a>>>10&1023|55296),a=56320|1023&a),o.push(a),s+=l}return function(i){let r=i.length;if(r<=4096)return String.fromCharCode.apply(String,i);let n="",o=0;for(;o<r;)n+=String.fromCharCode.apply(String,i.slice(o,o+=4096));return n}(o)}function F(i,r,n){if(i%1!=0||i<0)throw RangeError("offset is not uint");if(i+r>n)throw RangeError("Trying to access beyond buffer length")}function B(i,r,n,o,s,a){if(!S.isBuffer(i))throw TypeError('"buffer" argument must be a Buffer instance');if(r>s||r<a)throw RangeError('"value" argument is out of bounds');if(n+o>i.length)throw RangeError("Index out of range")}function U(i,r,n,o,s){W(r,o,s,i,n,7);let a=Number(r&BigInt(0xffffffff));i[n++]=a,a>>=8,i[n++]=a,a>>=8,i[n++]=a,a>>=8,i[n++]=a;let l=Number(r>>BigInt(32)&BigInt(0xffffffff));return i[n++]=l,l>>=8,i[n++]=l,l>>=8,i[n++]=l,l>>=8,i[n++]=l,n}function G(i,r,n,o,s){W(r,o,s,i,n,7);let a=Number(r&BigInt(0xffffffff));i[n+7]=a,a>>=8,i[n+6]=a,a>>=8,i[n+5]=a,a>>=8,i[n+4]=a;let l=Number(r>>BigInt(32)&BigInt(0xffffffff));return i[n+3]=l,l>>=8,i[n+2]=l,l>>=8,i[n+1]=l,l>>=8,i[n]=l,n+8}function V(i,r,n,o,s,a){if(n+o>i.length||n<0)throw RangeError("Index out of range")}function q(i,r,n,o,s){return r*=1,n>>>=0,s||V(i,r,n,4,34028234663852886e22,-34028234663852886e22),a(i,r,n,o,23,4),n+4}function j(i,r,n,o,s){return r*=1,n>>>=0,s||V(i,r,n,8,17976931348623157e292,-17976931348623157e292),a(i,r,n,o,52,8),n+8}S.TYPED_ARRAY_SUPPORT=function(){try{let i=new Uint8Array(1),r={foo:function(){return 42}};return Object.setPrototypeOf(r,Uint8Array.prototype),Object.setPrototypeOf(i,r),42===i.foo()}catch(i){return!1}}(),S.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(S.prototype,"parent",{enumerable:!0,get:function(){if(S.isBuffer(this))return this.buffer}}),Object.defineProperty(S.prototype,"offset",{enumerable:!0,get:function(){if(S.isBuffer(this))return this.byteOffset}}),S.poolSize=8192,S.from=function(i,r,n){return M(i,r,n)},Object.setPrototypeOf(S.prototype,Uint8Array.prototype),Object.setPrototypeOf(S,Uint8Array),S.alloc=function(i,r,n){return(T(i),i<=0)?I(i):void 0!==r?"string"==typeof n?I(i).fill(r,n):I(i).fill(r):I(i)},S.allocUnsafe=function(i){return C(i)},S.allocUnsafeSlow=function(i){return C(i)},S.isBuffer=function(i){return null!=i&&!0===i._isBuffer&&i!==S.prototype},S.compare=function(i,r){if(te(i,Uint8Array)&&(i=S.from(i,i.offset,i.byteLength)),te(r,Uint8Array)&&(r=S.from(r,r.offset,r.byteLength)),!S.isBuffer(i)||!S.isBuffer(r))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===r)return 0;let n=i.length,o=r.length;for(let s=0,a=Math.min(n,o);s<a;++s)if(i[s]!==r[s]){n=i[s],o=r[s];break}return n<o?-1:+(o<n)},S.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.concat=function(i,r){let n;if(!Array.isArray(i))throw TypeError('"list" argument must be an Array of Buffers');if(0===i.length)return S.alloc(0);if(void 0===r)for(n=0,r=0;n<i.length;++n)r+=i[n].length;let o=S.allocUnsafe(r),s=0;for(n=0;n<i.length;++n){let r=i[n];if(te(r,Uint8Array))s+r.length>o.length?(S.isBuffer(r)||(r=S.from(r)),r.copy(o,s)):Uint8Array.prototype.set.call(o,r,s);else if(S.isBuffer(r))r.copy(o,s);else throw TypeError('"list" argument must be an Array of Buffers');s+=r.length}return o},S.byteLength=k,S.prototype._isBuffer=!0,S.prototype.swap16=function(){let i=this.length;if(i%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<i;r+=2)D(this,r,r+1);return this},S.prototype.swap32=function(){let i=this.length;if(i%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<i;r+=4)D(this,r,r+3),D(this,r+1,r+2);return this},S.prototype.swap64=function(){let i=this.length;if(i%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<i;r+=8)D(this,r,r+7),D(this,r+1,r+6),D(this,r+2,r+5),D(this,r+3,r+4);return this},S.prototype.toString=function(){let i=this.length;return 0===i?"":0==arguments.length?z(this,0,i):R.apply(this,arguments)},S.prototype.toLocaleString=S.prototype.toString,S.prototype.equals=function(i){if(!S.isBuffer(i))throw TypeError("Argument must be a Buffer");return this===i||0===S.compare(this,i)},S.prototype.inspect=function(){let i="";return i=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(i+=" ... "),"<Buffer "+i+">"},E&&(S.prototype[E]=S.prototype.inspect),S.prototype.compare=function(i,r,n,o,s){if(te(i,Uint8Array)&&(i=S.from(i,i.offset,i.byteLength)),!S.isBuffer(i))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(void 0===r&&(r=0),void 0===n&&(n=i?i.length:0),void 0===o&&(o=0),void 0===s&&(s=this.length),r<0||n>i.length||o<0||s>this.length)throw RangeError("out of range index");if(o>=s&&r>=n)return 0;if(o>=s)return -1;if(r>=n)return 1;if(r>>>=0,n>>>=0,o>>>=0,s>>>=0,this===i)return 0;let a=s-o,l=n-r,u=Math.min(a,l),h=this.slice(o,s),c=i.slice(r,n);for(let i=0;i<u;++i)if(h[i]!==c[i]){a=h[i],l=c[i];break}return a<l?-1:+(l<a)},S.prototype.includes=function(i,r,n){return -1!==this.indexOf(i,r,n)},S.prototype.indexOf=function(i,r,n){return N(this,i,r,n,!0)},S.prototype.lastIndexOf=function(i,r,n){return N(this,i,r,n,!1)},S.prototype.write=function(i,r,n,o){var s,a,l,u,h,c,p,f;if(void 0===r)o="utf8",n=this.length,r=0;else if(void 0===n&&"string"==typeof r)o=r,n=this.length,r=0;else if(isFinite(r))r>>>=0,isFinite(n)?(n>>>=0,void 0===o&&(o="utf8")):(o=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-r;if((void 0===n||n>d)&&(n=d),i.length>0&&(n<0||r<0)||r>this.length)throw RangeError("Attempt to write outside buffer bounds");o||(o="utf8");let m=!1;for(;;)switch(o){case"hex":return function(i,r,n,o){let s;n=Number(n)||0;let a=i.length-n;o?(o=Number(o))>a&&(o=a):o=a;let l=r.length;for(o>l/2&&(o=l/2),s=0;s<o;++s){let o=parseInt(r.substr(2*s,2),16);if(o!=o)break;i[n+s]=o}return s}(this,i,r,n);case"utf8":case"utf-8":return s=r,a=n,tt(J(i,this.length-s),this,s,a);case"ascii":case"latin1":case"binary":return l=r,u=n,tt(function(i){let r=[];for(let n=0;n<i.length;++n)r.push(255&i.charCodeAt(n));return r}(i),this,l,u);case"base64":return h=r,c=n,tt(Q(i),this,h,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p=r,f=n,tt(function(i,r){let n,o;let s=[];for(let a=0;a<i.length&&!((r-=2)<0);++a)o=(n=i.charCodeAt(a))>>8,s.push(n%256),s.push(o);return s}(i,this.length-p),this,p,f);default:if(m)throw TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),m=!0}},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},S.prototype.slice=function(i,r){let n=this.length;i=~~i,r=void 0===r?n:~~r,i<0?(i+=n)<0&&(i=0):i>n&&(i=n),r<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<i&&(r=i);let o=this.subarray(i,r);return Object.setPrototypeOf(o,S.prototype),o},S.prototype.readUintLE=S.prototype.readUIntLE=function(i,r,n){i>>>=0,r>>>=0,n||F(i,r,this.length);let o=this[i],s=1,a=0;for(;++a<r&&(s*=256);)o+=this[i+a]*s;return o},S.prototype.readUintBE=S.prototype.readUIntBE=function(i,r,n){i>>>=0,r>>>=0,n||F(i,r,this.length);let o=this[i+--r],s=1;for(;r>0&&(s*=256);)o+=this[i+--r]*s;return o},S.prototype.readUint8=S.prototype.readUInt8=function(i,r){return i>>>=0,r||F(i,1,this.length),this[i]},S.prototype.readUint16LE=S.prototype.readUInt16LE=function(i,r){return i>>>=0,r||F(i,2,this.length),this[i]|this[i+1]<<8},S.prototype.readUint16BE=S.prototype.readUInt16BE=function(i,r){return i>>>=0,r||F(i,2,this.length),this[i]<<8|this[i+1]},S.prototype.readUint32LE=S.prototype.readUInt32LE=function(i,r){return i>>>=0,r||F(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+0x1000000*this[i+3]},S.prototype.readUint32BE=S.prototype.readUInt32BE=function(i,r){return i>>>=0,r||F(i,4,this.length),0x1000000*this[i]+(this[i+1]<<16|this[i+2]<<8|this[i+3])},S.prototype.readBigUInt64LE=tr(function(i){H(i>>>=0,"offset");let r=this[i],n=this[i+7];(void 0===r||void 0===n)&&Y(i,this.length-8);let o=r+256*this[++i]+65536*this[++i]+0x1000000*this[++i],s=this[++i]+256*this[++i]+65536*this[++i]+0x1000000*n;return BigInt(o)+(BigInt(s)<<BigInt(32))}),S.prototype.readBigUInt64BE=tr(function(i){H(i>>>=0,"offset");let r=this[i],n=this[i+7];(void 0===r||void 0===n)&&Y(i,this.length-8);let o=0x1000000*r+65536*this[++i]+256*this[++i]+this[++i],s=0x1000000*this[++i]+65536*this[++i]+256*this[++i]+n;return(BigInt(o)<<BigInt(32))+BigInt(s)}),S.prototype.readIntLE=function(i,r,n){i>>>=0,r>>>=0,n||F(i,r,this.length);let o=this[i],s=1,a=0;for(;++a<r&&(s*=256);)o+=this[i+a]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*r)),o},S.prototype.readIntBE=function(i,r,n){i>>>=0,r>>>=0,n||F(i,r,this.length);let o=r,s=1,a=this[i+--o];for(;o>0&&(s*=256);)a+=this[i+--o]*s;return a>=(s*=128)&&(a-=Math.pow(2,8*r)),a},S.prototype.readInt8=function(i,r){return(i>>>=0,r||F(i,1,this.length),128&this[i])?-((255-this[i]+1)*1):this[i]},S.prototype.readInt16LE=function(i,r){i>>>=0,r||F(i,2,this.length);let n=this[i]|this[i+1]<<8;return 32768&n?0xffff0000|n:n},S.prototype.readInt16BE=function(i,r){i>>>=0,r||F(i,2,this.length);let n=this[i+1]|this[i]<<8;return 32768&n?0xffff0000|n:n},S.prototype.readInt32LE=function(i,r){return i>>>=0,r||F(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},S.prototype.readInt32BE=function(i,r){return i>>>=0,r||F(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},S.prototype.readBigInt64LE=tr(function(i){H(i>>>=0,"offset");let r=this[i],n=this[i+7];return(void 0===r||void 0===n)&&Y(i,this.length-8),(BigInt(this[i+4]+256*this[i+5]+65536*this[i+6]+(n<<24))<<BigInt(32))+BigInt(r+256*this[++i]+65536*this[++i]+0x1000000*this[++i])}),S.prototype.readBigInt64BE=tr(function(i){H(i>>>=0,"offset");let r=this[i],n=this[i+7];return(void 0===r||void 0===n)&&Y(i,this.length-8),(BigInt((r<<24)+65536*this[++i]+256*this[++i]+this[++i])<<BigInt(32))+BigInt(0x1000000*this[++i]+65536*this[++i]+256*this[++i]+n)}),S.prototype.readFloatLE=function(i,r){return i>>>=0,r||F(i,4,this.length),s(this,i,!0,23,4)},S.prototype.readFloatBE=function(i,r){return i>>>=0,r||F(i,4,this.length),s(this,i,!1,23,4)},S.prototype.readDoubleLE=function(i,r){return i>>>=0,r||F(i,8,this.length),s(this,i,!0,52,8)},S.prototype.readDoubleBE=function(i,r){return i>>>=0,r||F(i,8,this.length),s(this,i,!1,52,8)},S.prototype.writeUintLE=S.prototype.writeUIntLE=function(i,r,n,o){if(i*=1,r>>>=0,n>>>=0,!o){let o=Math.pow(2,8*n)-1;B(this,i,r,n,o,0)}let s=1,a=0;for(this[r]=255&i;++a<n&&(s*=256);)this[r+a]=i/s&255;return r+n},S.prototype.writeUintBE=S.prototype.writeUIntBE=function(i,r,n,o){if(i*=1,r>>>=0,n>>>=0,!o){let o=Math.pow(2,8*n)-1;B(this,i,r,n,o,0)}let s=n-1,a=1;for(this[r+s]=255&i;--s>=0&&(a*=256);)this[r+s]=i/a&255;return r+n},S.prototype.writeUint8=S.prototype.writeUInt8=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,1,255,0),this[r]=255&i,r+1},S.prototype.writeUint16LE=S.prototype.writeUInt16LE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,2,65535,0),this[r]=255&i,this[r+1]=i>>>8,r+2},S.prototype.writeUint16BE=S.prototype.writeUInt16BE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,2,65535,0),this[r]=i>>>8,this[r+1]=255&i,r+2},S.prototype.writeUint32LE=S.prototype.writeUInt32LE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,4,0xffffffff,0),this[r+3]=i>>>24,this[r+2]=i>>>16,this[r+1]=i>>>8,this[r]=255&i,r+4},S.prototype.writeUint32BE=S.prototype.writeUInt32BE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,4,0xffffffff,0),this[r]=i>>>24,this[r+1]=i>>>16,this[r+2]=i>>>8,this[r+3]=255&i,r+4},S.prototype.writeBigUInt64LE=tr(function(i,r=0){return U(this,i,r,BigInt(0),BigInt("0xffffffffffffffff"))}),S.prototype.writeBigUInt64BE=tr(function(i,r=0){return G(this,i,r,BigInt(0),BigInt("0xffffffffffffffff"))}),S.prototype.writeIntLE=function(i,r,n,o){if(i*=1,r>>>=0,!o){let o=Math.pow(2,8*n-1);B(this,i,r,n,o-1,-o)}let s=0,a=1,l=0;for(this[r]=255&i;++s<n&&(a*=256);)i<0&&0===l&&0!==this[r+s-1]&&(l=1),this[r+s]=(i/a>>0)-l&255;return r+n},S.prototype.writeIntBE=function(i,r,n,o){if(i*=1,r>>>=0,!o){let o=Math.pow(2,8*n-1);B(this,i,r,n,o-1,-o)}let s=n-1,a=1,l=0;for(this[r+s]=255&i;--s>=0&&(a*=256);)i<0&&0===l&&0!==this[r+s+1]&&(l=1),this[r+s]=(i/a>>0)-l&255;return r+n},S.prototype.writeInt8=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,1,127,-128),i<0&&(i=255+i+1),this[r]=255&i,r+1},S.prototype.writeInt16LE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,2,32767,-32768),this[r]=255&i,this[r+1]=i>>>8,r+2},S.prototype.writeInt16BE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,2,32767,-32768),this[r]=i>>>8,this[r+1]=255&i,r+2},S.prototype.writeInt32LE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,4,0x7fffffff,-0x80000000),this[r]=255&i,this[r+1]=i>>>8,this[r+2]=i>>>16,this[r+3]=i>>>24,r+4},S.prototype.writeInt32BE=function(i,r,n){return i*=1,r>>>=0,n||B(this,i,r,4,0x7fffffff,-0x80000000),i<0&&(i=0xffffffff+i+1),this[r]=i>>>24,this[r+1]=i>>>16,this[r+2]=i>>>8,this[r+3]=255&i,r+4},S.prototype.writeBigInt64LE=tr(function(i,r=0){return U(this,i,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),S.prototype.writeBigInt64BE=tr(function(i,r=0){return G(this,i,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),S.prototype.writeFloatLE=function(i,r,n){return q(this,i,r,!0,n)},S.prototype.writeFloatBE=function(i,r,n){return q(this,i,r,!1,n)},S.prototype.writeDoubleLE=function(i,r,n){return j(this,i,r,!0,n)},S.prototype.writeDoubleBE=function(i,r,n){return j(this,i,r,!1,n)},S.prototype.copy=function(i,r,n,o){if(!S.isBuffer(i))throw TypeError("argument should be a Buffer");if(n||(n=0),o||0===o||(o=this.length),r>=i.length&&(r=i.length),r||(r=0),o>0&&o<n&&(o=n),o===n||0===i.length||0===this.length)return 0;if(r<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(o<0)throw RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),i.length-r<o-n&&(o=i.length-r+n);let s=o-n;return this===i&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(r,n,o):Uint8Array.prototype.set.call(i,this.subarray(n,o),r),s},S.prototype.fill=function(i,r,n,o){let s;if("string"==typeof i){if("string"==typeof r?(o=r,r=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw TypeError("encoding must be a string");if("string"==typeof o&&!S.isEncoding(o))throw TypeError("Unknown encoding: "+o);if(1===i.length){let r=i.charCodeAt(0);("utf8"===o&&r<128||"latin1"===o)&&(i=r)}}else"number"==typeof i?i&=255:"boolean"==typeof i&&(i=Number(i));if(r<0||this.length<r||this.length<n)throw RangeError("Out of range index");if(n<=r)return this;if(r>>>=0,n=void 0===n?this.length:n>>>0,i||(i=0),"number"==typeof i)for(s=r;s<n;++s)this[s]=i;else{let a=S.isBuffer(i)?i:S.from(i,o),l=a.length;if(0===l)throw TypeError('The value "'+i+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%l]}return this};let Z={};function X(i,r,n){Z[i]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:r.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}function $(i){let r="",n=i.length,o=+("-"===i[0]);for(;n>=o+4;n-=3)r=`_${i.slice(n-3,n)}${r}`;return`${i.slice(0,n)}${r}`}function W(i,r,n,o,s,a){if(i>n||i<r){let o;let s="bigint"==typeof r?"n":"";throw o=a>3?0===r||r===BigInt(0)?`>= 0${s} and < 2${s} ** ${(a+1)*8}${s}`:`>= -(2${s} ** ${(a+1)*8-1}${s}) and < 2 ** ${(a+1)*8-1}${s}`:`>= ${r}${s} and <= ${n}${s}`,new Z.ERR_OUT_OF_RANGE("value",o,i)}H(s,"offset"),(void 0===o[s]||void 0===o[s+a])&&Y(s,o.length-(a+1))}function H(i,r){if("number"!=typeof i)throw new Z.ERR_INVALID_ARG_TYPE(r,"number",i)}function Y(i,r,n){if(Math.floor(i)!==i)throw H(i,n),new Z.ERR_OUT_OF_RANGE(n||"offset","an integer",i);if(r<0)throw new Z.ERR_BUFFER_OUT_OF_BOUNDS;throw new Z.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${r}`,i)}X("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),X("ERR_INVALID_ARG_TYPE",function(i,r){return`The "${i}" argument must be of type number. Received type ${typeof r}`},TypeError),X("ERR_OUT_OF_RANGE",function(i,r,n){let o=`The value of "${i}" is out of range.`,s=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?s=$(String(n)):"bigint"==typeof n&&(s=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(s=$(s)),s+="n"),o+=` It must be ${r}. Received ${s}`},RangeError);let K=/[^+/0-9A-Za-z-_]/g;function J(i,r){let n;r=r||1/0;let o=i.length,s=null,a=[];for(let l=0;l<o;++l){if((n=i.charCodeAt(l))>55295&&n<57344){if(!s){if(n>56319||l+1===o){(r-=3)>-1&&a.push(239,191,189);continue}s=n;continue}if(n<56320){(r-=3)>-1&&a.push(239,191,189),s=n;continue}n=(s-55296<<10|n-56320)+65536}else s&&(r-=3)>-1&&a.push(239,191,189);if(s=null,n<128){if((r-=1)<0)break;a.push(n)}else if(n<2048){if((r-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((r-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((r-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return a}function Q(i){return n(function(i){if((i=(i=i.split("=")[0]).trim().replace(K,"")).length<2)return"";for(;i.length%4!=0;)i+="=";return i}(i))}function tt(i,r,n,o){let s;for(s=0;s<o&&!(s+n>=r.length)&&!(s>=i.length);++s)r[s+n]=i[s];return s}function te(i,r){return i instanceof r||null!=i&&null!=i.constructor&&null!=i.constructor.name&&i.constructor.name===r.name}let ti=function(){let i="0123456789abcdef",r=Array(256);for(let n=0;n<16;++n){let o=16*n;for(let s=0;s<16;++s)r[o+s]=i[n]+i[s]}return r}();function tr(i){return"undefined"==typeof BigInt?tn:i}function tn(){throw Error("BigInt not supported")}var to={},ts=to={};function ta(){throw Error("setTimeout has not been defined")}function tl(){throw Error("clearTimeout has not been defined")}function tu(i){if(l===setTimeout)return setTimeout(i,0);if((l===ta||!l)&&setTimeout)return l=setTimeout,setTimeout(i,0);try{return l(i,0)}catch(r){try{return l.call(null,i,0)}catch(r){return l.call(this,i,0)}}}!function(){try{l="function"==typeof setTimeout?setTimeout:ta}catch(i){l=ta}try{u="function"==typeof clearTimeout?clearTimeout:tl}catch(i){u=tl}}();var th=[],tc=!1,tp=-1;function tf(){tc&&h&&(tc=!1,h.length?th=h.concat(th):tp=-1,th.length&&td())}function td(){if(!tc){var i=tu(tf);tc=!0;for(var r=th.length;r;){for(h=th,th=[];++tp<r;)h&&h[tp].run();tp=-1,r=th.length}h=null,tc=!1,function(i){if(u===clearTimeout)return clearTimeout(i);if((u===tl||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(i);try{u(i)}catch(r){try{return u.call(null,i)}catch(r){return u.call(this,i)}}}(i)}}function tm(i,r){this.fun=i,this.array=r}function tg(){}function ty(i){return new t_(i instanceof Uint8Array?i:new Uint8Array(i))}function t_(i){this._array=i}function tv(i){return("function"==typeof fetch?function(i){return fetch(i).then(function(i){return i.body&&i.body.getReader?i.body.getReader():i.arrayBuffer().then(ty)})}:function(i){return new Promise(function(r,n){var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onload=function(){r(ty(o.response))},o.onerror=n,o.ontimeout=n,o.open("GET",i,!0),o.send()})})(i)}function tx(i){return"function"==typeof i.read?i:i.getReader()}ts.nextTick=function(i){var r=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];th.push(new tm(i,r)),1!==th.length||tc||tu(td)},tm.prototype.run=function(){this.fun.apply(null,this.array)},ts.title="browser",ts.browser=!0,ts.env={},ts.argv=[],ts.version="",ts.versions={},ts.on=tg,ts.addListener=tg,ts.once=tg,ts.off=tg,ts.removeListener=tg,ts.removeAllListeners=tg,ts.emit=tg,ts.prependListener=tg,ts.prependOnceListener=tg,ts.listeners=function(i){return[]},ts.binding=function(i){throw Error("process.binding is not supported")},ts.cwd=function(){return"/"},ts.chdir=function(i){throw Error("process.chdir is not supported")},ts.umask=function(){return 0},g=(function i(r,n,o){function s(l,u){if(!n[l]){if(!r[l]){var h=void 0;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var c=Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[l]={exports:{}};r[l][0].call(p.exports,function(i){return s(r[l][1][i]||i)},p,p.exports,i,r,n,o)}return n[l].exports}for(var a=void 0,l=0;l<o.length;l++)s(o[l]);return s})({1:[function(i,r,n){var o=i("./utils"),s=i("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(i){for(var r,n,s,l,u,h,c,p=[],f=0,d=i.length,m=d,g="string"!==o.getTypeOf(i);f<i.length;)m=d-f,g?(r=i[f++],n=f<d?i[f++]:0,s=f<d?i[f++]:0):(r=i.charCodeAt(f++),n=f<d?i.charCodeAt(f++):0,s=f<d?i.charCodeAt(f++):0),l=r>>2,u=(3&r)<<4|n>>4,h=m>1?(15&n)<<2|s>>6:64,c=m>2?63&s:64,p.push(a.charAt(l)+a.charAt(u)+a.charAt(h)+a.charAt(c));return p.join("")},n.decode=function(i){var r,n,o,l,u,h,c,p,f=0,d=0,m="data:";if(i.substr(0,m.length)===m)throw Error("Invalid base64 input, it looks like a data url.");var g=3*(i=i.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(i.charAt(i.length-1)===a.charAt(64)&&g--,i.charAt(i.length-2)===a.charAt(64)&&g--,g%1!=0)throw Error("Invalid base64 input, bad content length.");for(p=s.uint8array?new Uint8Array(0|g):Array(0|g);f<i.length;)l=a.indexOf(i.charAt(f++)),u=a.indexOf(i.charAt(f++)),h=a.indexOf(i.charAt(f++)),c=a.indexOf(i.charAt(f++)),r=l<<2|u>>4,n=(15&u)<<4|h>>2,o=(3&h)<<6|c,p[d++]=r,64!==h&&(p[d++]=n),64!==c&&(p[d++]=o);return p}},{"./support":30,"./utils":32}],2:[function(i,r,n){var o=i("./external"),s=i("./stream/DataWorker"),a=i("./stream/Crc32Probe"),l=i("./stream/DataLengthProbe");function u(i,r,n,o,s){this.compressedSize=i,this.uncompressedSize=r,this.crc32=n,this.compression=o,this.compressedContent=s}u.prototype={getContentWorker:function(){var i=new s(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),r=this;return i.on("end",function(){if(this.streamInfo.data_length!==r.uncompressedSize)throw Error("Bug : uncompressed data size mismatch")}),i},getCompressedWorker:function(){return new s(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(i,r,n){return i.pipe(new a).pipe(new l("uncompressedSize")).pipe(r.compressWorker(n)).pipe(new l("compressedSize")).withStreamInfo("compression",r)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,r,n){var o=i("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},n.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,r,n){var o=i("./utils"),s=function(){for(var i,r=[],n=0;n<256;n++){i=n;for(var o=0;o<8;o++)i=1&i?0xedb88320^i>>>1:i>>>1;r[n]=i}return r}();r.exports=function(i,r){return void 0!==i&&i.length?"string"!==o.getTypeOf(i)?function(i,r,n,o){var a=0+n;i^=-1;for(var l=0;l<a;l++)i=i>>>8^s[(i^r[l])&255];return -1^i}(0|r,i,i.length,0):function(i,r,n,o){var a=0+n;i^=-1;for(var l=0;l<a;l++)i=i>>>8^s[(i^r.charCodeAt(l))&255];return -1^i}(0|r,i,i.length,0):0}},{"./utils":32}],5:[function(i,r,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(i,r,n){var o=null;o="undefined"!=typeof Promise?Promise:i("lie"),r.exports={Promise:o}},{lie:37}],7:[function(i,r,n){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=i("pako"),a=i("./utils"),l=i("./stream/GenericWorker"),u=o?"uint8array":"array";function h(i,r){l.call(this,"FlateWorker/"+i),this._pako=null,this._pakoAction=i,this._pakoOptions=r,this.meta={}}n.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(i){this.meta=i.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(u,i.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var i=this;this._pako.onData=function(r){i.push({data:r,meta:i.meta})}},n.compressWorker=function(i){return new h("Deflate",i)},n.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,r,n){var o=i("../utils"),s=i("../stream/GenericWorker"),a=i("../utf8"),l=i("../crc32"),u=i("../signature"),h=function(i,r){var n,o="";for(n=0;n<r;n++)o+=String.fromCharCode(255&i),i>>>=8;return o},c=function(i,r){var n=i;return i||(n=r?16893:33204),(65535&n)<<16},p=function(i,r,n,s,p,f){var d,m,g=i.file,y=i.compression,_=f!==a.utf8encode,v=o.transformTo("string",f(g.name)),x=o.transformTo("string",a.utf8encode(g.name)),b=g.comment,w=o.transformTo("string",f(b)),E=o.transformTo("string",a.utf8encode(b)),I=x.length!==g.name.length,S=E.length!==b.length,M="",T="",C="",P=g.dir,A=g.date,L={crc32:0,compressedSize:0,uncompressedSize:0};(!r||n)&&(L.crc32=i.crc32,L.compressedSize=i.compressedSize,L.uncompressedSize=i.uncompressedSize);var k=0;r&&(k|=8),!_&&(I||S)&&(k|=2048);var R=0,D=0;(P&&(R|=16),"UNIX"===p)?(D=798,R|=c(g.unixPermissions,P)):(D=20,R|=63&(g.dosPermissions||0)),d=(A.getUTCHours()<<6|A.getUTCMinutes())<<5|A.getUTCSeconds()/2,m=(A.getUTCFullYear()-1980<<4|A.getUTCMonth()+1)<<5|A.getUTCDate(),I&&(T=h(1,1)+h(l(v),4)+x,M+="up"+h(T.length,2)+T),S&&(C=h(1,1)+h(l(w),4)+E,M+="uc"+h(C.length,2)+C);var N="";return N+="\n\0",N+=h(k,2),N+=y.magic,N+=h(d,2),N+=h(m,2),N+=h(L.crc32,4),N+=h(L.compressedSize,4),N+=h(L.uncompressedSize,4),N+=h(v.length,2),N+=h(M.length,2),{fileRecord:u.LOCAL_FILE_HEADER+N+v+M,dirRecord:u.CENTRAL_FILE_HEADER+h(D,2)+N+h(w.length,2)+"\0\0\0\0"+h(R,4)+h(s,4)+v+M+w}},f=function(i,r,n,s,a){var l=o.transformTo("string",a(s));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+h(i,2)+h(i,2)+h(r,4)+h(n,4)+h(l.length,2)+l};function d(i,r,n,o){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=r,this.zipPlatform=n,this.encodeFileName=o,this.streamFiles=i,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,s),d.prototype.push=function(i){var r=i.meta.percent||0,n=this.entriesCount,o=this._sources.length;this.accumulate?this.contentBuffer.push(i):(this.bytesWritten+=i.data.length,s.prototype.push.call(this,{data:i.data,meta:{currentFile:this.currentFile,percent:n?(r+100*(n-o-1))/n:100}}))},d.prototype.openedSource=function(i){this.currentSourceOffset=this.bytesWritten,this.currentFile=i.file.name;var r=this.streamFiles&&!i.file.dir;if(r){var n=p(i,r,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(i){this.accumulate=!1;var r,n=this.streamFiles&&!i.file.dir,o=p(i,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(o.dirRecord),n){this.push({data:(r=i,u.DATA_DESCRIPTOR+h(r.crc32,4)+h(r.compressedSize,4)+h(r.uncompressedSize,4)),meta:{percent:100}})}else for(this.push({data:o.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var i=this.bytesWritten,r=0;r<this.dirRecords.length;r++)this.push({data:this.dirRecords[r],meta:{percent:100}});var n=this.bytesWritten-i,o=f(this.dirRecords.length,n,i,this.zipComment,this.encodeFileName);this.push({data:o,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(i){this._sources.push(i);var r=this;return i.on("data",function(i){r.processChunk(i)}),i.on("end",function(){r.closedSource(r.previous.streamInfo),r._sources.length?r.prepareNextSource():r.end()}),i.on("error",function(i){r.error(i)}),this},d.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(i){var r=this._sources;if(!s.prototype.error.call(this,i))return!1;for(var n=0;n<r.length;n++)try{r[n].error(i)}catch(i){}return!0},d.prototype.lock=function(){s.prototype.lock.call(this);for(var i=this._sources,r=0;r<i.length;r++)i[r].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,r,n){var o=i("../compressions"),s=i("./ZipFileWorker"),a=function(i,r){var n=i||r,s=o[n];if(!s)throw Error(n+" is not a valid compression method !");return s};n.generateWorker=function(i,r,n){var o=new s(r.streamFiles,n,r.platform,r.encodeFileName),l=0;try{i.forEach(function(i,n){l++;var s=a(n.options.compression,r.compression),u=n.options.compressionOptions||r.compressionOptions||{},h=n.dir,c=n.date;n._compressWorker(s,u).withStreamInfo("file",{name:i,dir:h,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(o)}),o.entriesCount=l}catch(i){o.error(i)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,r,n){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new o;for(var r in this)"function"!=typeof this[r]&&(i[r]=this[r]);return i}}o.prototype=i("./object"),o.prototype.loadAsync=i("./load"),o.support=i("./support"),o.defaults=i("./defaults"),o.version="3.10.1",o.loadAsync=function(i,r){return new o().loadAsync(i,r)},o.external=i("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,r,n){var o=i("./utils"),s=i("./external"),a=i("./utf8"),l=i("./zipEntries"),u=i("./stream/Crc32Probe"),h=i("./nodejsUtils");r.exports=function(i,r){var n=this;return(r=o.extend(r||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(i))?s.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",i,!0,r.optimizedBinaryString,r.base64).then(function(i){var n=new l(r);return n.load(i),n}).then(function(i){var n=[s.Promise.resolve(i)],o=i.files;if(r.checkCRC32)for(var a=0;a<o.length;a++)n.push(function(i){return new s.Promise(function(r,n){var o=i.decompressed.getContentWorker().pipe(new u);o.on("error",function(i){n(i)}).on("end",function(){o.streamInfo.crc32!==i.decompressed.crc32?n(Error("Corrupted zip : CRC32 mismatch")):r()}).resume()})}(o[a]));return s.Promise.all(n)}).then(function(i){for(var s=i.shift(),a=s.files,l=0;l<a.length;l++){var u=a[l],h=u.fileNameStr,c=o.resolve(u.fileNameStr);n.file(c,u.decompressed,{binary:!0,optimizedBinaryString:!0,date:u.date,dir:u.dir,comment:u.fileCommentStr.length?u.fileCommentStr:null,unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions,createFolders:r.createFolders}),u.dir||(n.file(c).unsafeOriginalName=h)}return s.zipComment.length&&(n.comment=s.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,r,n){var o=i("../utils"),s=i("../stream/GenericWorker");function a(i,r){s.call(this,"Nodejs stream input adapter for "+i),this._upstreamEnded=!1,this._bindStream(r)}o.inherits(a,s),a.prototype._bindStream=function(i){var r=this;this._stream=i,i.pause(),i.on("data",function(i){r.push({data:i,meta:{percent:0}})}).on("error",function(i){r.isPaused?this.generatedError=i:r.error(i)}).on("end",function(){r.isPaused?r._upstreamEnded=!0:r.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,r,n){var o=i("readable-stream").Readable;function s(i,r,n){o.call(this,r),this._helper=i;var s=this;i.on("data",function(i,r){s.push(i)||s._helper.pause(),n&&n(r)}).on("error",function(i){s.emit("error",i)}).on("end",function(){s.push(null)})}i("../utils").inherits(s,o),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(i,r,n){r.exports={isNode:!0,newBufferFrom:function(i,r){if(S.from&&S.from!==Uint8Array.from)return S.from(i,r);if("number"==typeof i)throw Error('The "data" argument must not be a number');return new S(i,r)},allocBuffer:function(i){if(S.alloc)return S.alloc(i);var r=new S(i);return r.fill(0),r},isBuffer:function(i){return S.isBuffer(i)},isStream:function(i){return i&&"function"==typeof i.on&&"function"==typeof i.pause&&"function"==typeof i.resume}}},{}],15:[function(i,r,n){var o=i("./utf8"),s=i("./utils"),a=i("./stream/GenericWorker"),l=i("./stream/StreamHelper"),u=i("./defaults"),h=i("./compressedObject"),c=i("./zipObject"),p=i("./generate"),f=i("./nodejsUtils"),d=i("./nodejs/NodejsStreamInputAdapter"),m=function(i,r,n){var o,l=s.getTypeOf(r),p=s.extend(n||{},u);p.date=p.date||new Date,null!==p.compression&&(p.compression=p.compression.toUpperCase()),"string"==typeof p.unixPermissions&&(p.unixPermissions=parseInt(p.unixPermissions,8)),p.unixPermissions&&16384&p.unixPermissions&&(p.dir=!0),p.dosPermissions&&16&p.dosPermissions&&(p.dir=!0),p.dir&&(i=y(i)),p.createFolders&&(o=g(i))&&_.call(this,o,!0);var m="string"===l&&!1===p.binary&&!1===p.base64;n&&void 0!==n.binary||(p.binary=!m),(r instanceof h&&0===r.uncompressedSize||p.dir||!r||0===r.length)&&(p.base64=!1,p.binary=!0,r="",p.compression="STORE",l="string");var v=null;v=r instanceof h||r instanceof a?r:f.isNode&&f.isStream(r)?new d(i,r):s.prepareContent(i,r,p.binary,p.optimizedBinaryString,p.base64);var x=new c(i,v,p);this.files[i]=x},g=function(i){"/"===i.slice(-1)&&(i=i.substring(0,i.length-1));var r=i.lastIndexOf("/");return r>0?i.substring(0,r):""},y=function(i){return"/"!==i.slice(-1)&&(i+="/"),i},_=function(i,r){return r=void 0!==r?r:u.createFolders,i=y(i),this.files[i]||m.call(this,i,null,{dir:!0,createFolders:r}),this.files[i]};function v(i){return"[object RegExp]"===Object.prototype.toString.call(i)}r.exports={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(i){var r,n,o;for(r in this.files)o=this.files[r],(n=r.slice(this.root.length,r.length))&&r.slice(0,this.root.length)===this.root&&i(n,o)},filter:function(i){var r=[];return this.forEach(function(n,o){i(n,o)&&r.push(o)}),r},file:function(i,r,n){if(1==arguments.length){if(v(i)){var o=i;return this.filter(function(i,r){return!r.dir&&o.test(i)})}var s=this.files[this.root+i];return s&&!s.dir?s:null}return i=this.root+i,m.call(this,i,r,n),this},folder:function(i){if(!i)return this;if(v(i))return this.filter(function(r,n){return n.dir&&i.test(r)});var r=this.root+i,n=_.call(this,r),o=this.clone();return o.root=n.name,o},remove:function(i){i=this.root+i;var r=this.files[i];if(r||("/"!==i.slice(-1)&&(i+="/"),r=this.files[i]),r&&!r.dir)delete this.files[i];else for(var n=this.filter(function(r,n){return n.name.slice(0,i.length)===i}),o=0;o<n.length;o++)delete this.files[n[o].name];return this},generate:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(i){var r,n={};try{if((n=s.extend(i||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw Error("No output type specified.");s.checkSupport(n.type),("darwin"===n.platform||"freebsd"===n.platform||"linux"===n.platform||"sunos"===n.platform)&&(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var u=n.comment||this.comment||"";r=p.generateWorker(this,n,u)}catch(i){(r=new a("error")).error(i)}return new l(r,n.type||"string",n.mimeType)},generateAsync:function(i,r){return this.generateInternalStream(i).accumulate(r)},generateNodeStream:function(i,r){return(i=i||{}).type||(i.type="nodebuffer"),this.generateInternalStream(i).toNodejsStream(r)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,r,n){r.exports=i("stream")},{stream:void 0}],17:[function(i,r,n){var o=i("./DataReader");function s(i){o.call(this,i);for(var r=0;r<this.data.length;r++)i[r]=255&i[r]}i("../utils").inherits(s,o),s.prototype.byteAt=function(i){return this.data[this.zero+i]},s.prototype.lastIndexOfSignature=function(i){for(var r=i.charCodeAt(0),n=i.charCodeAt(1),o=i.charCodeAt(2),s=i.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===r&&this.data[a+1]===n&&this.data[a+2]===o&&this.data[a+3]===s)return a-this.zero;return -1},s.prototype.readAndCheckSignature=function(i){var r=i.charCodeAt(0),n=i.charCodeAt(1),o=i.charCodeAt(2),s=i.charCodeAt(3),a=this.readData(4);return r===a[0]&&n===a[1]&&o===a[2]&&s===a[3]},s.prototype.readData=function(i){if(this.checkOffset(i),0===i)return[];var r=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,r},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(i,r,n){var o=i("../utils");function s(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var r,n=0;for(this.checkOffset(i),r=this.index+i-1;r>=this.index;r--)n=(n<<8)+this.byteAt(r);return this.index+=i,n},readString:function(i){return o.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC((i>>25&127)+1980,(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},r.exports=s},{"../utils":32}],19:[function(i,r,n){var o=i("./Uint8ArrayReader");function s(i){o.call(this,i)}i("../utils").inherits(s,o),s.prototype.readData=function(i){this.checkOffset(i);var r=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,r},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,r,n){var o=i("./DataReader");function s(i){o.call(this,i)}i("../utils").inherits(s,o),s.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},s.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},s.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},s.prototype.readData=function(i){this.checkOffset(i);var r=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,r},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(i,r,n){var o=i("./ArrayReader");function s(i){o.call(this,i)}i("../utils").inherits(s,o),s.prototype.readData=function(i){if(this.checkOffset(i),0===i)return new Uint8Array(0);var r=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,r},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(i,r,n){var o=i("../utils"),s=i("../support"),a=i("./ArrayReader"),l=i("./StringReader"),u=i("./NodeBufferReader"),h=i("./Uint8ArrayReader");r.exports=function(i){var r=o.getTypeOf(i);return(o.checkSupport(r),"string"!==r||s.uint8array)?"nodebuffer"===r?new u(i):s.uint8array?new h(o.transformTo("uint8array",i)):new a(o.transformTo("array",i)):new l(i)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,r,n){n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,r,n){var o=i("./GenericWorker"),s=i("../utils");function a(i){o.call(this,"ConvertWorker to "+i),this.destType=i}s.inherits(a,o),a.prototype.processChunk=function(i){this.push({data:s.transformTo(this.destType,i.data),meta:i.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(i,r,n){var o=i("./GenericWorker"),s=i("../crc32");function a(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(a,o),a.prototype.processChunk=function(i){this.streamInfo.crc32=s(i.data,this.streamInfo.crc32||0),this.push(i)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,r,n){var o=i("../utils"),s=i("./GenericWorker");function a(i){s.call(this,"DataLengthProbe for "+i),this.propName=i,this.withStreamInfo(i,0)}o.inherits(a,s),a.prototype.processChunk=function(i){if(i){var r=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=r+i.data.length}s.prototype.processChunk.call(this,i)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(i,r,n){var o=i("../utils"),s=i("./GenericWorker");function a(i){s.call(this,"DataWorker");var r=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(i){r.dataIsReady=!0,r.data=i,r.max=i&&i.length||0,r.type=o.getTypeOf(i),r.isPaused||r._tickAndRepeat()},function(i){r.error(i)})}o.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var i=null,r=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":i=this.data.substring(this.index,r);break;case"uint8array":i=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":i=this.data.slice(this.index,r)}return this.index=r,this.push({data:i,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(i,r,n){function o(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,r){return this._listeners[i].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,r){if(this._listeners[i])for(var n=0;n<this._listeners[i].length;n++)this._listeners[i][n].call(this,r)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var r=this;return i.on("data",function(i){r.processChunk(i)}),i.on("end",function(){r.end()}),i.on("error",function(i){r.error(i)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var i=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,r){return this.extraStreamInfo[i]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},r.exports=o},{}],29:[function(i,r,n){var o=i("../utils"),s=i("./ConvertWorker"),a=i("./GenericWorker"),l=i("../base64"),u=i("../support"),h=i("../external"),c=null;if(u.nodestream)try{c=i("../nodejs/NodejsStreamOutputAdapter")}catch(i){}function p(i,r,n){var l=r;switch(r){case"blob":case"arraybuffer":l="uint8array";break;case"base64":l="string"}try{this._internalType=l,this._outputType=r,this._mimeType=n,o.checkSupport(l),this._worker=i.pipe(new s(l)),i.lock()}catch(i){this._worker=new a("error"),this._worker.error(i)}}p.prototype={accumulate:function(i){var r;return r=this,new h.Promise(function(n,s){var a=[],u=r._internalType,h=r._outputType,c=r._mimeType;r.on("data",function(r,n){a.push(r),i&&i(n)}).on("error",function(i){a=[],s(i)}).on("end",function(){try{var i=function(i,r,n){switch(i){case"blob":return o.newBlob(o.transformTo("arraybuffer",r),n);case"base64":return l.encode(r);default:return o.transformTo(i,r)}}(h,function(i,r){var n,o=0,s=null,a=0;for(n=0;n<r.length;n++)a+=r[n].length;switch(i){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(n=0,s=new Uint8Array(a);n<r.length;n++)s.set(r[n],o),o+=r[n].length;return s;case"nodebuffer":return S.concat(r);default:throw Error("concat : unsupported type '"+i+"'")}}(u,a),c);n(i)}catch(i){s(i)}a=[]}).resume()})},on:function(i,r){var n=this;return"data"===i?this._worker.on(i,function(i){r.call(n,i.data,i.meta)}):this._worker.on(i,function(){o.delay(r,arguments,n)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(i){if(o.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},i)}},r.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,r,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=!0,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var o=new ArrayBuffer(0);try{n.blob=0===new Blob([o],{type:"application/zip"}).size}catch(i){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(o),n.blob=0===s.getBlob("application/zip").size}catch(i){n.blob=!1}}}try{n.nodestream=!!i("readable-stream").Readable}catch(i){n.nodestream=!1}},{"readable-stream":16}],31:[function(i,r,n){for(var o=i("./utils"),s=i("./support"),a=i("./nodejsUtils"),l=i("./stream/GenericWorker"),u=Array(256),h=0;h<256;h++)u[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;u[254]=u[254]=1;var c=function(i){var r,n,o,a,l,u=i.length,h=0;for(a=0;a<u;a++)(64512&(n=i.charCodeAt(a)))==55296&&a+1<u&&(64512&(o=i.charCodeAt(a+1)))==56320&&(n=65536+(n-55296<<10)+(o-56320),a++),h+=n<128?1:n<2048?2:n<65536?3:4;for(l=0,r=s.uint8array?new Uint8Array(h):Array(h),a=0;l<h;a++)(64512&(n=i.charCodeAt(a)))==55296&&a+1<u&&(64512&(o=i.charCodeAt(a+1)))==56320&&(n=65536+(n-55296<<10)+(o-56320),a++),n<128?r[l++]=n:(n<2048?r[l++]=192|n>>>6:(n<65536?r[l++]=224|n>>>12:(r[l++]=240|n>>>18,r[l++]=128|n>>>12&63),r[l++]=128|n>>>6&63),r[l++]=128|63&n);return r},p=function(i,r){var n;for((r=r||i.length)>i.length&&(r=i.length),n=r-1;n>=0&&(192&i[n])==128;)n--;return n<0||0===n?r:n+u[i[n]]>r?n:r},f=function(i){var r,n,s,a,l=i.length,h=Array(2*l);for(n=0,r=0;r<l;){if((s=i[r++])<128){h[n++]=s;continue}if((a=u[s])>4){h[n++]=65533,r+=a-1;continue}for(s&=2===a?31:3===a?15:7;a>1&&r<l;)s=s<<6|63&i[r++],a--;if(a>1){h[n++]=65533;continue}s<65536?h[n++]=s:(s-=65536,h[n++]=55296|s>>10&1023,h[n++]=56320|1023&s)}return h.length!==n&&(h.subarray?h=h.subarray(0,n):h.length=n),o.applyFromCharCode(h)};function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function m(){l.call(this,"utf-8 encode")}n.utf8encode=function(i){return s.nodebuffer?a.newBufferFrom(i,"utf-8"):c(i)},n.utf8decode=function(i){return s.nodebuffer?o.transformTo("nodebuffer",i).toString("utf-8"):f(i=o.transformTo(s.uint8array?"uint8array":"array",i))},o.inherits(d,l),d.prototype.processChunk=function(i){var r=o.transformTo(s.uint8array?"uint8array":"array",i.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var a=r;(r=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),r.set(a,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var l=p(r),u=r;l!==r.length&&(s.uint8array?(u=r.subarray(0,l),this.leftOver=r.subarray(l,r.length)):(u=r.slice(0,l),this.leftOver=r.slice(l,r.length))),this.push({data:n.utf8decode(u),meta:i.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=d,o.inherits(m,l),m.prototype.processChunk=function(i){this.push({data:n.utf8encode(i.data),meta:i.meta})},n.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,r,n){var o=i("./support"),s=i("./base64"),a=i("./nodejsUtils"),l=i("./external");function u(i){return i}function h(i,r){for(var n=0;n<i.length;++n)r[n]=255&i.charCodeAt(n);return r}i("setimmediate"),n.newBlob=function(i,r){n.checkSupport("blob");try{return new Blob([i],{type:r})}catch(n){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(i),o.getBlob(r)}catch(i){throw Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(i,r,n){var o=[],s=0,a=i.length;if(a<=n)return String.fromCharCode.apply(null,i);for(;s<a;)"array"===r||"nodebuffer"===r?o.push(String.fromCharCode.apply(null,i.slice(s,Math.min(s+n,a)))):o.push(String.fromCharCode.apply(null,i.subarray(s,Math.min(s+n,a)))),s+=n;return o.join("")},stringifyByChar:function(i){for(var r="",n=0;n<i.length;n++)r+=String.fromCharCode(i[n]);return r},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(i){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(i){return!1}}()}};function p(i){var r=65536,o=n.getTypeOf(i),s=!0;if("uint8array"===o?s=c.applyCanBeUsed.uint8array:"nodebuffer"===o&&(s=c.applyCanBeUsed.nodebuffer),s)for(;r>1;)try{return c.stringifyByChunk(i,o,r)}catch(i){r=Math.floor(r/2)}return c.stringifyByChar(i)}function f(i,r){for(var n=0;n<i.length;n++)r[n]=i[n];return r}n.applyFromCharCode=p;var d={};d.string={string:u,array:function(i){return h(i,Array(i.length))},arraybuffer:function(i){return d.string.uint8array(i).buffer},uint8array:function(i){return h(i,new Uint8Array(i.length))},nodebuffer:function(i){return h(i,a.allocBuffer(i.length))}},d.array={string:p,array:u,arraybuffer:function(i){return new Uint8Array(i).buffer},uint8array:function(i){return new Uint8Array(i)},nodebuffer:function(i){return a.newBufferFrom(i)}},d.arraybuffer={string:function(i){return p(new Uint8Array(i))},array:function(i){return f(new Uint8Array(i),Array(i.byteLength))},arraybuffer:u,uint8array:function(i){return new Uint8Array(i)},nodebuffer:function(i){return a.newBufferFrom(new Uint8Array(i))}},d.uint8array={string:p,array:function(i){return f(i,Array(i.length))},arraybuffer:function(i){return i.buffer},uint8array:u,nodebuffer:function(i){return a.newBufferFrom(i)}},d.nodebuffer={string:p,array:function(i){return f(i,Array(i.length))},arraybuffer:function(i){return d.nodebuffer.uint8array(i).buffer},uint8array:function(i){return f(i,new Uint8Array(i.length))},nodebuffer:u},n.transformTo=function(i,r){return(r||(r=""),i)?(n.checkSupport(i),d[n.getTypeOf(r)][i](r)):r},n.resolve=function(i){for(var r=i.split("/"),n=[],o=0;o<r.length;o++){var s=r[o];"."!==s&&(""!==s||0===o||o===r.length-1)&&(".."===s?n.pop():n.push(s))}return n.join("/")},n.getTypeOf=function(i){return"string"==typeof i?"string":"[object Array]"===Object.prototype.toString.call(i)?"array":o.nodebuffer&&a.isBuffer(i)?"nodebuffer":o.uint8array&&i instanceof Uint8Array?"uint8array":o.arraybuffer&&i instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(i){if(!o[i.toLowerCase()])throw Error(i+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(i){var r,n,o="";for(n=0;n<(i||"").length;n++)o+="\\x"+((r=i.charCodeAt(n))<16?"0":"")+r.toString(16).toUpperCase();return o},n.delay=function(i,r,n){setImmediate(function(){i.apply(n||null,r||[])})},n.inherits=function(i,r){var n=function(){};n.prototype=r.prototype,i.prototype=new n},n.extend=function(){var i,r,n={};for(i=0;i<arguments.length;i++)for(r in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],r)&&void 0===n[r]&&(n[r]=arguments[i][r]);return n},n.prepareContent=function(i,r,a,u,c){return l.Promise.resolve(r).then(function(i){return o.blob&&(i instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(i)))&&"undefined"!=typeof FileReader?new l.Promise(function(r,n){var o=new FileReader;o.onload=function(i){r(i.target.result)},o.onerror=function(i){n(i.target.error)},o.readAsArrayBuffer(i)}):i}).then(function(r){var p,f,d=n.getTypeOf(r);return d?("arraybuffer"===d?r=n.transformTo("uint8array",r):"string"===d&&(c?r=s.decode(r):a&&!0!==u&&(p=r,f=null,f=o.uint8array?new Uint8Array(p.length):Array(p.length),r=h(p,f))),r):l.Promise.reject(Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,r,n){var o=i("./reader/readerFor"),s=i("./utils"),a=i("./signature"),l=i("./zipEntry"),u=i("./support");function h(i){this.files=[],this.loadOptions=i}h.prototype={checkSignature:function(i){if(!this.reader.readAndCheckSignature(i)){this.reader.index-=4;var r=this.reader.readString(4);throw Error("Corrupted zip or bug: unexpected signature ("+s.pretty(r)+", expected "+s.pretty(i)+")")}},isSignature:function(i,r){var n=this.reader.index;this.reader.setIndex(i);var o=this.reader.readString(4);return this.reader.setIndex(n),o===r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var i=this.reader.readData(this.zipCommentLength),r=u.uint8array?"uint8array":"array",n=s.transformTo(r,i);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var i,r,n,o=this.zip64EndOfCentralSize-44;0<o;)i=this.reader.readInt(2),r=this.reader.readInt(4),n=this.reader.readData(r),this.zip64ExtensibleData[i]={id:i,length:r,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var i,r;for(i=0;i<this.files.length;i++)r=this.files[i],this.reader.setIndex(r.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),r.readLocalPart(this.reader),r.handleUTF8(),r.processAttributes()},readCentralDir:function(){var i;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(i=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(i);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var i=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(i<0){if(!this.isSignature(0,a.LOCAL_FILE_HEADER))throw Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");throw Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(i);var r=i;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(i=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(i),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var o=r-n;if(o>0)this.isSignature(r,a.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(o<0)throw Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(i){this.reader=o(i)},load:function(i){this.prepareReader(i),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,r,n){var o=i("./reader/readerFor"),s=i("./utils"),a=i("./compressedObject"),l=i("./crc32"),u=i("./utf8"),h=i("./compressions"),c=i("./support"),p=function(i){for(var r in h)if(Object.prototype.hasOwnProperty.call(h,r)&&h[r].magic===i)return h[r];return null};function f(i,r){this.options=i,this.loadOptions=r}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(i){var r,n;if(i.skip(22),this.fileNameLength=i.readInt(2),n=i.readInt(2),this.fileName=i.readData(this.fileNameLength),i.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(r=p(this.compressionMethod)))throw Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,r,i.readData(this.compressedSize))},readCentralPart:function(i){this.versionMadeBy=i.readInt(2),i.skip(2),this.bitFlag=i.readInt(2),this.compressionMethod=i.readString(2),this.date=i.readDate(),this.crc32=i.readInt(4),this.compressedSize=i.readInt(4),this.uncompressedSize=i.readInt(4);var r=i.readInt(2);if(this.extraFieldsLength=i.readInt(2),this.fileCommentLength=i.readInt(2),this.diskNumberStart=i.readInt(2),this.internalFileAttributes=i.readInt(2),this.externalFileAttributes=i.readInt(4),this.localHeaderOffset=i.readInt(4),this.isEncrypted())throw Error("Encrypted zip are not supported");i.skip(r),this.readExtraFields(i),this.parseZIP64ExtraField(i),this.fileComment=i.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var i=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===i&&(this.dosPermissions=63&this.externalFileAttributes),3===i&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var i=o(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=i.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=i.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=i.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=i.readInt(4))}},readExtraFields:function(i){var r,n,o,s=i.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});i.index+4<s;)r=i.readInt(2),n=i.readInt(2),o=i.readData(n),this.extraFields[r]={id:r,length:n,value:o};i.setIndex(s)},handleUTF8:function(){var i=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var r=this.findExtraFieldUnicodePath();if(null!==r)this.fileNameStr=r;else{var n=s.transformTo(i,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var o=this.findExtraFieldUnicodeComment();if(null!==o)this.fileCommentStr=o;else{var a=s.transformTo(i,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var i=this.extraFields[28789];if(i){var r=o(i.value);return 1!==r.readInt(1)||l(this.fileName)!==r.readInt(4)?null:u.utf8decode(r.readData(i.length-5))}return null},findExtraFieldUnicodeComment:function(){var i=this.extraFields[25461];if(i){var r=o(i.value);return 1!==r.readInt(1)||l(this.fileComment)!==r.readInt(4)?null:u.utf8decode(r.readData(i.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,r,n){var o=i("./stream/StreamHelper"),s=i("./stream/DataWorker"),a=i("./utf8"),l=i("./compressedObject"),u=i("./stream/GenericWorker"),h=function(i,r,n){this.name=i,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=r,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};h.prototype={internalStream:function(i){var r=null,n="string";try{if(!i)throw Error("No output type specified.");n=i.toLowerCase();var s="string"===n||"text"===n;("binarystring"===n||"text"===n)&&(n="string"),r=this._decompressWorker();var l=!this._dataBinary;l&&!s&&(r=r.pipe(new a.Utf8EncodeWorker)),!l&&s&&(r=r.pipe(new a.Utf8DecodeWorker))}catch(i){(r=new u("error")).error(i)}return new o(r,n,"")},async:function(i,r){return this.internalStream(i).accumulate(r)},nodeStream:function(i,r){return this.internalStream(i||"nodebuffer").toNodejsStream(r)},_compressWorker:function(i,r){if(this._data instanceof l&&this._data.compression.magic===i.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new a.Utf8EncodeWorker)),l.createWorkerFrom(n,i,r)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<c.length;f++)h.prototype[c[f]]=p;r.exports=h},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,r,n){(function(i){var n,o,s=i.MutationObserver||i.WebKitMutationObserver;if(s){var a=0,l=new s(p),u=i.document.createTextNode("");l.observe(u,{characterData:!0}),n=function(){u.data=a=++a%2}}else if(i.setImmediate||void 0===i.MessageChannel)n="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var r=i.document.createElement("script");r.onreadystatechange=function(){p(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},i.document.documentElement.appendChild(r)}:function(){setTimeout(p,0)};else{var h=new i.MessageChannel;h.port1.onmessage=p,n=function(){h.port2.postMessage(0)}}var c=[];function p(){o=!0;for(var i,r,n=c.length;n;){for(r=c,c=[],i=-1;++i<n;)r[i]();n=c.length}o=!1}r.exports=function(i){1!==c.push(i)||o||n()}}).call(this,void 0!==c?c:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(i,r,n){var o=i("immediate");function s(){}var a={},l=["REJECTED"],u=["FULFILLED"],h=["PENDING"];function c(i){if("function"!=typeof i)throw TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,i!==s&&m(this,i)}function p(i,r,n){this.promise=i,"function"==typeof r&&(this.onFulfilled=r,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(i,r,n){o(function(){var o;try{o=r(n)}catch(r){return a.reject(i,r)}o===i?a.reject(i,TypeError("Cannot resolve promise with itself")):a.resolve(i,o)})}function d(i){var r=i&&i.then;if(i&&("object"==typeof i||"function"==typeof i)&&"function"==typeof r)return function(){r.apply(i,arguments)}}function m(i,r){var n=!1;function o(r){n||(n=!0,a.reject(i,r))}function s(r){n||(n=!0,a.resolve(i,r))}var l=g(function(){r(s,o)});"error"===l.status&&o(l.value)}function g(i,r){var n={};try{n.value=i(r),n.status="success"}catch(i){n.status="error",n.value=i}return n}r.exports=c,c.prototype.finally=function(i){if("function"!=typeof i)return this;var r=this.constructor;return this.then(function(n){return r.resolve(i()).then(function(){return n})},function(n){return r.resolve(i()).then(function(){throw n})})},c.prototype.catch=function(i){return this.then(null,i)},c.prototype.then=function(i,r){if("function"!=typeof i&&this.state===u||"function"!=typeof r&&this.state===l)return this;var n=new this.constructor(s);return this.state!==h?f(n,this.state===u?i:r,this.outcome):this.queue.push(new p(n,i,r)),n},p.prototype.callFulfilled=function(i){a.resolve(this.promise,i)},p.prototype.otherCallFulfilled=function(i){f(this.promise,this.onFulfilled,i)},p.prototype.callRejected=function(i){a.reject(this.promise,i)},p.prototype.otherCallRejected=function(i){f(this.promise,this.onRejected,i)},a.resolve=function(i,r){var n=g(d,r);if("error"===n.status)return a.reject(i,n.value);var o=n.value;if(o)m(i,o);else{i.state=u,i.outcome=r;for(var s=-1,l=i.queue.length;++s<l;)i.queue[s].callFulfilled(r)}return i},a.reject=function(i,r){i.state=l,i.outcome=r;for(var n=-1,o=i.queue.length;++n<o;)i.queue[n].callRejected(r);return i},c.resolve=function(i){return i instanceof this?i:a.resolve(new this(s),i)},c.reject=function(i){var r=new this(s);return a.reject(r,i)},c.all=function(i){var r=this;if("[object Array]"!==Object.prototype.toString.call(i))return this.reject(TypeError("must be an array"));var n=i.length,o=!1;if(!n)return this.resolve([]);for(var l=Array(n),u=0,h=-1,c=new this(s);++h<n;)(function(i,s){r.resolve(i).then(function(i){l[s]=i,++u!==n||o||(o=!0,a.resolve(c,l))},function(i){o||(o=!0,a.reject(c,i))})})(i[h],h);return c},c.race=function(i){var r=this;if("[object Array]"!==Object.prototype.toString.call(i))return this.reject(TypeError("must be an array"));var n=i.length,o=!1;if(!n)return this.resolve([]);for(var l=-1,u=new this(s);++l<n;)(function(i){r.resolve(i).then(function(i){o||(o=!0,a.resolve(u,i))},function(i){o||(o=!0,a.reject(u,i))})})(i[l]);return u}},{immediate:36}],38:[function(i,r,n){var o=i("./lib/utils/common").assign,s=i("./lib/deflate"),a=i("./lib/inflate"),l=i("./lib/zlib/constants"),u={};o(u,s,a,l),r.exports=u},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,r,n){var o=i("./zlib/deflate"),s=i("./utils/common"),a=i("./utils/strings"),l=i("./zlib/messages"),u=i("./zlib/zstream"),h=Object.prototype.toString;function c(i){if(!(this instanceof c))return new c(i);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},i||{});var r,n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var p=o.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(0!==p)throw Error(l[p]);if(n.header&&o.deflateSetHeader(this.strm,n.header),n.dictionary){if(r="string"==typeof n.dictionary?a.string2buf(n.dictionary):"[object ArrayBuffer]"===h.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,0!==(p=o.deflateSetDictionary(this.strm,r)))throw Error(l[p]);this._dict_set=!0}}function p(i,r){var n=new c(r);if(n.push(i,!0),n.err)throw n.msg||l[n.err];return n.result}c.prototype.push=function(i,r){var n,l,u=this.strm,c=this.options.chunkSize;if(this.ended)return!1;l=r===~~r?r:4*(!0===r),"string"==typeof i?u.input=a.string2buf(i):"[object ArrayBuffer]"===h.call(i)?u.input=new Uint8Array(i):u.input=i,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new s.Buf8(c),u.next_out=0,u.avail_out=c),1!==(n=o.deflate(u,l))&&0!==n)return this.onEnd(n),this.ended=!0,!1;(0===u.avail_out||0===u.avail_in&&(4===l||2===l))&&("string"===this.options.to?this.onData(a.buf2binstring(s.shrinkBuf(u.output,u.next_out))):this.onData(s.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&1!==n)return 4===l?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):(2===l&&(this.onEnd(0),u.avail_out=0),!0)},c.prototype.onData=function(i){this.chunks.push(i)},c.prototype.onEnd=function(i){0===i&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},n.Deflate=c,n.deflate=p,n.deflateRaw=function(i,r){return(r=r||{}).raw=!0,p(i,r)},n.gzip=function(i,r){return(r=r||{}).gzip=!0,p(i,r)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,r,n){var o=i("./zlib/inflate"),s=i("./utils/common"),a=i("./utils/strings"),l=i("./zlib/constants"),u=i("./zlib/messages"),h=i("./zlib/zstream"),c=i("./zlib/gzheader"),p=Object.prototype.toString;function f(i){if(!(this instanceof f))return new f(i);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},i||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(i&&i.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var n=o.inflateInit2(this.strm,r.windowBits);if(n!==l.Z_OK)throw Error(u[n]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function d(i,r){var n=new f(r);if(n.push(i,!0),n.err)throw n.msg||u[n.err];return n.result}f.prototype.push=function(i,r){var n,u,h,c,f,d,m=this.strm,g=this.options.chunkSize,y=this.options.dictionary,_=!1;if(this.ended)return!1;u=r===~~r?r:!0===r?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof i?m.input=a.binstring2buf(i):"[object ArrayBuffer]"===p.call(i)?m.input=new Uint8Array(i):m.input=i,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new s.Buf8(g),m.next_out=0,m.avail_out=g),(n=o.inflate(m,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&y&&(d="string"==typeof y?a.string2buf(y):"[object ArrayBuffer]"===p.call(y)?new Uint8Array(y):y,n=o.inflateSetDictionary(this.strm,d)),n===l.Z_BUF_ERROR&&!0===_&&(n=l.Z_OK,_=!1),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;m.next_out&&(0===m.avail_out||n===l.Z_STREAM_END||0===m.avail_in&&(u===l.Z_FINISH||u===l.Z_SYNC_FLUSH))&&("string"===this.options.to?(h=a.utf8border(m.output,m.next_out),c=m.next_out-h,f=a.buf2string(m.output,h),m.next_out=c,m.avail_out=g-c,c&&s.arraySet(m.output,m.output,h,c,0),this.onData(f)):this.onData(s.shrinkBuf(m.output,m.next_out))),0===m.avail_in&&0===m.avail_out&&(_=!0)}while((m.avail_in>0||0===m.avail_out)&&n!==l.Z_STREAM_END)return(n===l.Z_STREAM_END&&(u=l.Z_FINISH),u===l.Z_FINISH)?(n=o.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):(u===l.Z_SYNC_FLUSH&&(this.onEnd(l.Z_OK),m.avail_out=0),!0)},f.prototype.onData=function(i){this.chunks.push(i)},f.prototype.onEnd=function(i){i===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},n.Inflate=f,n.inflate=d,n.inflateRaw=function(i,r){return(r=r||{}).raw=!0,d(i,r)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,r,n){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(i){for(var r=Array.prototype.slice.call(arguments,1);r.length;){var n=r.shift();if(n){if("object"!=typeof n)throw TypeError(n+"must be non-object");for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o])}}return i},n.shrinkBuf=function(i,r){return i.length===r?i:i.subarray?i.subarray(0,r):(i.length=r,i)};var s={arraySet:function(i,r,n,o,s){if(r.subarray&&i.subarray){i.set(r.subarray(n,n+o),s);return}for(var a=0;a<o;a++)i[s+a]=r[n+a]},flattenChunks:function(i){var r,n,o,s,a,l;for(r=0,o=0,n=i.length;r<n;r++)o+=i[r].length;for(r=0,l=new Uint8Array(o),s=0,n=i.length;r<n;r++)a=i[r],l.set(a,s),s+=a.length;return l}},a={arraySet:function(i,r,n,o,s){for(var a=0;a<o;a++)i[s+a]=r[n+a]},flattenChunks:function(i){return[].concat.apply([],i)}};n.setTyped=function(i){i?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,s)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(o)},{}],42:[function(i,r,n){var o=i("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(i){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(i){a=!1}for(var l=new o.Buf8(256),u=0;u<256;u++)l[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function h(i,r){if(r<65537&&(i.subarray&&a||!i.subarray&&s))return String.fromCharCode.apply(null,o.shrinkBuf(i,r));for(var n="",l=0;l<r;l++)n+=String.fromCharCode(i[l]);return n}l[254]=l[254]=1,n.string2buf=function(i){var r,n,s,a,l,u=i.length,h=0;for(a=0;a<u;a++)(64512&(n=i.charCodeAt(a)))==55296&&a+1<u&&(64512&(s=i.charCodeAt(a+1)))==56320&&(n=65536+(n-55296<<10)+(s-56320),a++),h+=n<128?1:n<2048?2:n<65536?3:4;for(l=0,r=new o.Buf8(h),a=0;l<h;a++)(64512&(n=i.charCodeAt(a)))==55296&&a+1<u&&(64512&(s=i.charCodeAt(a+1)))==56320&&(n=65536+(n-55296<<10)+(s-56320),a++),n<128?r[l++]=n:(n<2048?r[l++]=192|n>>>6:(n<65536?r[l++]=224|n>>>12:(r[l++]=240|n>>>18,r[l++]=128|n>>>12&63),r[l++]=128|n>>>6&63),r[l++]=128|63&n);return r},n.buf2binstring=function(i){return h(i,i.length)},n.binstring2buf=function(i){for(var r=new o.Buf8(i.length),n=0,s=r.length;n<s;n++)r[n]=i.charCodeAt(n);return r},n.buf2string=function(i,r){var n,o,s,a,u=r||i.length,c=Array(2*u);for(o=0,n=0;n<u;){if((s=i[n++])<128){c[o++]=s;continue}if((a=l[s])>4){c[o++]=65533,n+=a-1;continue}for(s&=2===a?31:3===a?15:7;a>1&&n<u;)s=s<<6|63&i[n++],a--;if(a>1){c[o++]=65533;continue}s<65536?c[o++]=s:(s-=65536,c[o++]=55296|s>>10&1023,c[o++]=56320|1023&s)}return h(c,o)},n.utf8border=function(i,r){var n;for((r=r||i.length)>i.length&&(r=i.length),n=r-1;n>=0&&(192&i[n])==128;)n--;return n<0||0===n?r:n+l[i[n]]>r?n:r}},{"./common":41}],43:[function(i,r,n){r.exports=function(i,r,n,o){for(var s=65535&i|0,a=i>>>16&65535|0,l=0;0!==n;){l=n>2e3?2e3:n,n-=l;do a=a+(s=s+r[o++]|0)|0;while(--l)s%=65521,a%=65521}return s|a<<16|0}},{}],44:[function(i,r,n){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,r,n){var o=function(){for(var i,r=[],n=0;n<256;n++){i=n;for(var o=0;o<8;o++)i=1&i?0xedb88320^i>>>1:i>>>1;r[n]=i}return r}();r.exports=function(i,r,n,s){var a=s+n;i^=-1;for(var l=s;l<a;l++)i=i>>>8^o[(i^r[l])&255];return -1^i}},{}],46:[function(i,r,n){var o,s=i("../utils/common"),a=i("./trees"),l=i("./adler32"),u=i("./crc32"),h=i("./messages");function c(i,r){return i.msg=h[r],r}function p(i){return(i<<1)-9*(i>4)}function f(i){for(var r=i.length;--r>=0;)i[r]=0}function d(i){var r=i.state,n=r.pending;n>i.avail_out&&(n=i.avail_out),0!==n&&(s.arraySet(i.output,r.pending_buf,r.pending_out,n,i.next_out),i.next_out+=n,r.pending_out+=n,i.total_out+=n,i.avail_out-=n,r.pending-=n,0===r.pending&&(r.pending_out=0))}function m(i,r){a._tr_flush_block(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,r),i.block_start=i.strstart,d(i.strm)}function g(i,r){i.pending_buf[i.pending++]=r}function y(i,r){i.pending_buf[i.pending++]=r>>>8&255,i.pending_buf[i.pending++]=255&r}function _(i,r){var n,o,s=i.max_chain_length,a=i.strstart,l=i.prev_length,u=i.nice_match,h=i.strstart>i.w_size-262?i.strstart-(i.w_size-262):0,c=i.window,p=i.w_mask,f=i.prev,d=i.strstart+258,m=c[a+l-1],g=c[a+l];i.prev_length>=i.good_match&&(s>>=2),u>i.lookahead&&(u=i.lookahead);do{if(c[(n=r)+l]!==g||c[n+l-1]!==m||c[n]!==c[a]||c[++n]!==c[a+1])continue;a+=2,n++;do;while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d)if(o=258-(d-a),a=d-258,o>l){if(i.match_start=r,l=o,o>=u)break;m=c[a+l-1],g=c[a+l]}}while((r=f[r&p])>h&&0!=--s)return l<=i.lookahead?l:i.lookahead}function v(i){var r,n,o,a,h,c=i.w_size;do{if(a=i.window_size-i.lookahead-i.strstart,i.strstart>=c+(c-262)){s.arraySet(i.window,i.window,c,c,0),i.match_start-=c,i.strstart-=c,i.block_start-=c,r=n=i.hash_size;do o=i.head[--r],i.head[r]=o>=c?o-c:0;while(--n)r=n=c;do o=i.prev[--r],i.prev[r]=o>=c?o-c:0;while(--n)a+=c}if(0===i.strm.avail_in)break;if(n=function(i,r,n,o){var a=i.avail_in;return(a>o&&(a=o),0===a)?0:(i.avail_in-=a,s.arraySet(r,i.input,i.next_in,a,n),1===i.state.wrap?i.adler=l(i.adler,r,a,n):2===i.state.wrap&&(i.adler=u(i.adler,r,a,n)),i.next_in+=a,i.total_in+=a,a)}(i.strm,i.window,i.strstart+i.lookahead,a),i.lookahead+=n,i.lookahead+i.insert>=3)for(h=i.strstart-i.insert,i.ins_h=i.window[h],i.ins_h=(i.ins_h<<i.hash_shift^i.window[h+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[h+3-1])&i.hash_mask,i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++,i.insert--,!(i.lookahead+i.insert<3)););}while(i.lookahead<262&&0!==i.strm.avail_in)}function x(i,r){for(var n,o;;){if(i.lookahead<262){if(v(i),i.lookahead<262&&0===r)return 1;if(0===i.lookahead)break}if(n=0,i.lookahead>=3&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+3-1])&i.hash_mask,n=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),0!==n&&i.strstart-n<=i.w_size-262&&(i.match_length=_(i,n)),i.match_length>=3){if(o=a._tr_tally(i,i.strstart-i.match_start,i.match_length-3),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=3){i.match_length--;do i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+3-1])&i.hash_mask,n=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(0!=--i.match_length)i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask}else o=a._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(o&&(m(i,!1),0===i.strm.avail_out))return 1}return(i.insert=i.strstart<2?i.strstart:2,4===r)?(m(i,!0),0===i.strm.avail_out)?3:4:i.last_lit&&(m(i,!1),0===i.strm.avail_out)?1:2}function b(i,r){for(var n,o,s;;){if(i.lookahead<262){if(v(i),i.lookahead<262&&0===r)return 1;if(0===i.lookahead)break}if(n=0,i.lookahead>=3&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+3-1])&i.hash_mask,n=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=2,0!==n&&i.prev_length<i.max_lazy_match&&i.strstart-n<=i.w_size-262&&(i.match_length=_(i,n),i.match_length<=5&&(1===i.strategy||3===i.match_length&&i.strstart-i.match_start>4096)&&(i.match_length=2)),i.prev_length>=3&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-3,o=a._tr_tally(i,i.strstart-1-i.prev_match,i.prev_length-3),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+3-1])&i.hash_mask,n=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(0!=--i.prev_length)if(i.match_available=0,i.match_length=2,i.strstart++,o&&(m(i,!1),0===i.strm.avail_out))return 1}else if(i.match_available){if((o=a._tr_tally(i,0,i.window[i.strstart-1]))&&m(i,!1),i.strstart++,i.lookahead--,0===i.strm.avail_out)return 1}else i.match_available=1,i.strstart++,i.lookahead--}return(i.match_available&&(o=a._tr_tally(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<2?i.strstart:2,4===r)?(m(i,!0),0===i.strm.avail_out)?3:4:i.last_lit&&(m(i,!1),0===i.strm.avail_out)?1:2}function w(i,r,n,o,s){this.good_length=i,this.max_lazy=r,this.nice_length=n,this.max_chain=o,this.func=s}function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(i){var r;return i&&i.state?(i.total_in=i.total_out=0,i.data_type=2,(r=i.state).pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?42:113,i.adler=+(2!==r.wrap),r.last_flush=0,a._tr_init(r),0):c(i,-2)}function S(i){var r,n=I(i);return 0===n&&((r=i.state).window_size=2*r.w_size,f(r.head),r.max_lazy_match=o[r.level].max_lazy,r.good_match=o[r.level].good_length,r.nice_match=o[r.level].nice_length,r.max_chain_length=o[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),n}function M(i,r,n,o,a,l){if(!i)return -2;var u=1;if(-1===r&&(r=6),o<0?(u=0,o=-o):o>15&&(u=2,o-=16),a<1||a>9||8!==n||o<8||o>15||r<0||r>9||l<0||l>4)return c(i,-2);8===o&&(o=9);var h=new E;return i.state=h,h.strm=i,h.wrap=u,h.gzhead=null,h.w_bits=o,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new s.Buf8(2*h.w_size),h.head=new s.Buf16(h.hash_size),h.prev=new s.Buf16(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new s.Buf8(h.pending_buf_size),h.d_buf=+h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=r,h.strategy=l,h.method=n,S(i)}o=[new w(0,0,0,0,function(i,r){var n=65535;for(65535>i.pending_buf_size-5&&(n=i.pending_buf_size-5);;){if(i.lookahead<=1){if(v(i),0===i.lookahead&&0===r)return 1;if(0===i.lookahead)break}i.strstart+=i.lookahead,i.lookahead=0;var o=i.block_start+n;if((0===i.strstart||i.strstart>=o)&&(i.lookahead=i.strstart-o,i.strstart=o,m(i,!1),0===i.strm.avail_out)||i.strstart-i.block_start>=i.w_size-262&&(m(i,!1),0===i.strm.avail_out))return 1}return(i.insert=0,4===r)?(m(i,!0),0===i.strm.avail_out)?3:4:(i.strstart>i.block_start&&(m(i,!1),i.strm.avail_out),1)}),new w(4,4,8,4,x),new w(4,5,16,8,x),new w(4,6,32,32,x),new w(4,4,16,16,b),new w(8,16,32,32,b),new w(8,16,128,128,b),new w(8,32,128,256,b),new w(32,128,258,1024,b),new w(32,258,258,4096,b)],n.deflateInit=function(i,r){return M(i,r,8,15,8,0)},n.deflateInit2=M,n.deflateReset=S,n.deflateResetKeep=I,n.deflateSetHeader=function(i,r){return i&&i.state&&2===i.state.wrap?(i.state.gzhead=r,0):-2},n.deflate=function(i,r){if(!i||!i.state||r>5||r<0)return i?c(i,-2):-2;if(s=i.state,!i.output||!i.input&&0!==i.avail_in||666===s.status&&4!==r)return c(i,0===i.avail_out?-5:-2);if(s.strm=i,n=s.last_flush,s.last_flush=r,42===s.status){if(2===s.wrap)i.adler=0,g(s,31),g(s,139),g(s,8),s.gzhead?(g(s,+!!s.gzhead.text+2*!!s.gzhead.hcrc+4*!!s.gzhead.extra+8*!!s.gzhead.name+16*!!s.gzhead.comment),g(s,255&s.gzhead.time),g(s,s.gzhead.time>>8&255),g(s,s.gzhead.time>>16&255),g(s,s.gzhead.time>>24&255),g(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),g(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(g(s,255&s.gzhead.extra.length),g(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(i.adler=u(i.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(g(s,0),g(s,0),g(s,0),g(s,0),g(s,0),g(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),g(s,3),s.status=113);else{var n,s,l,h,_=8+(s.w_bits-8<<4)<<8;_|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(_|=32),_+=31-_%31,s.status=113,y(s,_),0!==s.strstart&&(y(s,i.adler>>>16),y(s,65535&i.adler)),i.adler=1}}if(69===s.status){if(s.gzhead.extra){for(l=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),d(i),l=s.pending,s.pending!==s.pending_buf_size));)g(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73}if(73===s.status){if(s.gzhead.name){l=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),d(i),l=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,g(s,h)}while(0!==h)s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),0===h&&(s.gzindex=0,s.status=91)}else s.status=91}if(91===s.status){if(s.gzhead.comment){l=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),d(i),l=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,g(s,h)}while(0!==h)s.gzhead.hcrc&&s.pending>l&&(i.adler=u(i.adler,s.pending_buf,s.pending-l,l)),0===h&&(s.status=103)}else s.status=103}if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&d(i),s.pending+2<=s.pending_buf_size&&(g(s,255&i.adler),g(s,i.adler>>8&255),i.adler=0,s.status=113)):s.status=113),0!==s.pending){if(d(i),0===i.avail_out)return s.last_flush=-1,0}else if(0===i.avail_in&&p(r)<=p(n)&&4!==r)return c(i,-5);if(666===s.status&&0!==i.avail_in)return c(i,-5);if(0!==i.avail_in||0!==s.lookahead||0!==r&&666!==s.status){var x=2===s.strategy?function(i,r){for(var n;;){if(0===i.lookahead&&(v(i),0===i.lookahead)){if(0===r)return 1;break}if(i.match_length=0,n=a._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,n&&(m(i,!1),0===i.strm.avail_out))return 1}return(i.insert=0,4===r)?(m(i,!0),0===i.strm.avail_out)?3:4:i.last_lit&&(m(i,!1),0===i.strm.avail_out)?1:2}(s,r):3===s.strategy?function(i,r){for(var n,o,s,l,u=i.window;;){if(i.lookahead<=258){if(v(i),i.lookahead<=258&&0===r)return 1;if(0===i.lookahead)break}if(i.match_length=0,i.lookahead>=3&&i.strstart>0&&(o=u[s=i.strstart-1])===u[++s]&&o===u[++s]&&o===u[++s]){l=i.strstart+258;do;while(o===u[++s]&&o===u[++s]&&o===u[++s]&&o===u[++s]&&o===u[++s]&&o===u[++s]&&o===u[++s]&&o===u[++s]&&s<l)i.match_length=258-(l-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=3?(n=a._tr_tally(i,1,i.match_length-3),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(n=a._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),n&&(m(i,!1),0===i.strm.avail_out))return 1}return(i.insert=0,4===r)?(m(i,!0),0===i.strm.avail_out)?3:4:i.last_lit&&(m(i,!1),0===i.strm.avail_out)?1:2}(s,r):o[s.level].func(s,r);if((3===x||4===x)&&(s.status=666),1===x||3===x)return 0===i.avail_out&&(s.last_flush=-1),0;if(2===x&&(1===r?a._tr_align(s):5!==r&&(a._tr_stored_block(s,0,0,!1),3===r&&(f(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),d(i),0===i.avail_out))return s.last_flush=-1,0}return 4!==r?0:s.wrap<=0?1:(2===s.wrap?(g(s,255&i.adler),g(s,i.adler>>8&255),g(s,i.adler>>16&255),g(s,i.adler>>24&255),g(s,255&i.total_in),g(s,i.total_in>>8&255),g(s,i.total_in>>16&255),g(s,i.total_in>>24&255)):(y(s,i.adler>>>16),y(s,65535&i.adler)),d(i),s.wrap>0&&(s.wrap=-s.wrap),+(0===s.pending))},n.deflateEnd=function(i){var r;return i&&i.state?42!==(r=i.state.status)&&69!==r&&73!==r&&91!==r&&103!==r&&113!==r&&666!==r?c(i,-2):(i.state=null,113===r?c(i,-3):0):-2},n.deflateSetDictionary=function(i,r){var n,o,a,u,h,c,p,d,m=r.length;if(!i||!i.state||2===(u=(n=i.state).wrap)||1===u&&42!==n.status||n.lookahead)return -2;for(1===u&&(i.adler=l(i.adler,r,m,0)),n.wrap=0,m>=n.w_size&&(0===u&&(f(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new s.Buf8(n.w_size),s.arraySet(d,r,m-n.w_size,n.w_size,0),r=d,m=n.w_size),h=i.avail_in,c=i.next_in,p=i.input,i.avail_in=m,i.next_in=0,i.input=r,v(n);n.lookahead>=3;){o=n.strstart,a=n.lookahead-2;do n.ins_h=(n.ins_h<<n.hash_shift^n.window[o+3-1])&n.hash_mask,n.prev[o&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=o,o++;while(--a)n.strstart=o,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,i.next_in=c,i.input=p,i.avail_in=h,n.wrap=u,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,r,n){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,r,n){r.exports=function(i,r){var n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S,M,T,C;n=i.state,o=i.next_in,T=i.input,s=o+(i.avail_in-5),a=i.next_out,C=i.output,l=a-(r-i.avail_out),u=a+(i.avail_out-257),h=n.dmax,c=n.wsize,p=n.whave,f=n.wnext,d=n.window,m=n.hold,g=n.bits,y=n.lencode,_=n.distcode,v=(1<<n.lenbits)-1,x=(1<<n.distbits)-1;t:do for(g<15&&(m+=T[o++]<<g,g+=8,m+=T[o++]<<g,g+=8),b=y[m&v];;){if(m>>>=w=b>>>24,g-=w,0==(w=b>>>16&255))C[a++]=65535&b;else if(16&w)for(E=65535&b,(w&=15)&&(g<w&&(m+=T[o++]<<g,g+=8),E+=m&(1<<w)-1,m>>>=w,g-=w),g<15&&(m+=T[o++]<<g,g+=8,m+=T[o++]<<g,g+=8),b=_[m&x];;){if(m>>>=w=b>>>24,g-=w,16&(w=b>>>16&255)){if(I=65535&b,g<(w&=15)&&(m+=T[o++]<<g,(g+=8)<w&&(m+=T[o++]<<g,g+=8)),(I+=m&(1<<w)-1)>h){i.msg="invalid distance too far back",n.mode=30;break t}if(m>>>=w,g-=w,I>(w=a-l)){if((w=I-w)>p&&n.sane){i.msg="invalid distance too far back",n.mode=30;break t}if(S=0,M=d,0===f){if(S+=c-w,w<E){E-=w;do C[a++]=d[S++];while(--w)S=a-I,M=C}}else if(f<w){if(S+=c+f-w,(w-=f)<E){E-=w;do C[a++]=d[S++];while(--w)if(S=0,f<E){E-=w=f;do C[a++]=d[S++];while(--w)S=a-I,M=C}}}else if(S+=f-w,w<E){E-=w;do C[a++]=d[S++];while(--w)S=a-I,M=C}for(;E>2;)C[a++]=M[S++],C[a++]=M[S++],C[a++]=M[S++],E-=3;E&&(C[a++]=M[S++],E>1&&(C[a++]=M[S++]))}else{S=a-I;do C[a++]=C[S++],C[a++]=C[S++],C[a++]=C[S++],E-=3;while(E>2)E&&(C[a++]=C[S++],E>1&&(C[a++]=C[S++]))}}else if((64&w)==0){b=_[(65535&b)+(m&(1<<w)-1)];continue}else{i.msg="invalid distance code",n.mode=30;break t}break}else if((64&w)==0){b=y[(65535&b)+(m&(1<<w)-1)];continue}else if(32&w){n.mode=12;break t}else{i.msg="invalid literal/length code",n.mode=30;break t}break}while(o<s&&a<u)o-=E=g>>3,g-=E<<3,m&=(1<<g)-1,i.next_in=o,i.next_out=a,i.avail_in=o<s?5+(s-o):5-(o-s),i.avail_out=a<u?257+(u-a):257-(a-u),n.hold=m,n.bits=g}},{}],49:[function(i,r,n){var o,s,a=i("../utils/common"),l=i("./adler32"),u=i("./crc32"),h=i("./inffast"),c=i("./inftrees");function p(i){return(i>>>24&255)+(i>>>8&65280)+((65280&i)<<8)+((255&i)<<24)}function f(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(i){var r;return i&&i.state?(r=i.state,i.total_in=i.total_out=r.total=0,i.msg="",r.wrap&&(i.adler=1&r.wrap),r.mode=1,r.last=0,r.havedict=0,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new a.Buf32(852),r.distcode=r.distdyn=new a.Buf32(592),r.sane=1,r.back=-1,0):-2}function m(i){var r;return i&&i.state?((r=i.state).wsize=0,r.whave=0,r.wnext=0,d(i)):-2}function g(i,r){var n,o;return i&&i.state?(o=i.state,r<0?(n=0,r=-r):(n=(r>>4)+1,r<48&&(r&=15)),r&&(r<8||r>15))?-2:(null!==o.window&&o.wbits!==r&&(o.window=null),o.wrap=n,o.wbits=r,m(i)):-2}function y(i,r){var n,o;return i?(o=new f,i.state=o,o.window=null,0!==(n=g(i,r))&&(i.state=null),n):-2}var _=!0;function v(i,r,n,o){var s,l=i.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new a.Buf8(l.wsize)),o>=l.wsize?(a.arraySet(l.window,r,n-l.wsize,l.wsize,0),l.wnext=0,l.whave=l.wsize):((s=l.wsize-l.wnext)>o&&(s=o),a.arraySet(l.window,r,n-o,s,l.wnext),(o-=s)?(a.arraySet(l.window,r,n-o,o,0),l.wnext=o,l.whave=l.wsize):(l.wnext+=s,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=s))),0}n.inflateReset=m,n.inflateReset2=g,n.inflateResetKeep=d,n.inflateInit=function(i){return y(i,15)},n.inflateInit2=y,n.inflate=function(i,r){var n,f,d,m,g,y,x,b,w,E,I,S,M,T,C,P,A,L,k,R,D,N,O,z,F=0,B=new a.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!i||!i.state||!i.output||!i.input&&0!==i.avail_in)return -2;12===(n=i.state).mode&&(n.mode=13),g=i.next_out,d=i.output,x=i.avail_out,m=i.next_in,f=i.input,y=i.avail_in,b=n.hold,w=n.bits,E=y,I=x,N=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;w<16;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(2&n.wrap&&35615===b){n.check=0,B[0]=255&b,B[1]=b>>>8&255,n.check=u(n.check,B,2,0),b=0,w=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&b)<<8)+(b>>8))%31){i.msg="incorrect header check",n.mode=30;break}if((15&b)!=8){i.msg="unknown compression method",n.mode=30;break}if(b>>>=4,w-=4,D=(15&b)+8,0===n.wbits)n.wbits=D;else if(D>n.wbits){i.msg="invalid window size",n.mode=30;break}n.dmax=1<<D,i.adler=n.check=1,n.mode=512&b?10:12,b=0,w=0;break;case 2:for(;w<16;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(n.flags=b,(255&n.flags)!=8){i.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){i.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=b>>8&1),512&n.flags&&(B[0]=255&b,B[1]=b>>>8&255,n.check=u(n.check,B,2,0)),b=0,w=0,n.mode=3;case 3:for(;w<32;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.head&&(n.head.time=b),512&n.flags&&(B[0]=255&b,B[1]=b>>>8&255,B[2]=b>>>16&255,B[3]=b>>>24&255,n.check=u(n.check,B,4,0)),b=0,w=0,n.mode=4;case 4:for(;w<16;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.head&&(n.head.xflags=255&b,n.head.os=b>>8),512&n.flags&&(B[0]=255&b,B[1]=b>>>8&255,n.check=u(n.check,B,2,0)),b=0,w=0,n.mode=5;case 5:if(1024&n.flags){for(;w<16;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.length=b,n.head&&(n.head.extra_len=b),512&n.flags&&(B[0]=255&b,B[1]=b>>>8&255,n.check=u(n.check,B,2,0)),b=0,w=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((S=n.length)>y&&(S=y),S&&(n.head&&(D=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),a.arraySet(n.head.extra,f,m,S,D)),512&n.flags&&(n.check=u(n.check,f,S,m)),y-=S,m+=S,n.length-=S),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===y)break e;S=0;do D=f[m+S++],n.head&&D&&n.length<65536&&(n.head.name+=String.fromCharCode(D));while(D&&S<y)if(512&n.flags&&(n.check=u(n.check,f,S,m)),y-=S,m+=S,D)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===y)break e;S=0;do D=f[m+S++],n.head&&D&&n.length<65536&&(n.head.comment+=String.fromCharCode(D));while(D&&S<y)if(512&n.flags&&(n.check=u(n.check,f,S,m)),y-=S,m+=S,D)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;w<16;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(b!==(65535&n.check)){i.msg="header crc mismatch",n.mode=30;break}b=0,w=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),i.adler=n.check=0,n.mode=12;break;case 10:for(;w<32;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}i.adler=n.check=p(b),b=0,w=0,n.mode=11;case 11:if(0===n.havedict)return i.next_out=g,i.avail_out=x,i.next_in=m,i.avail_in=y,n.hold=b,n.bits=w,2;i.adler=n.check=1,n.mode=12;case 12:if(5===r||6===r)break e;case 13:if(n.last){b>>>=7&w,w-=7&w,n.mode=27;break}for(;w<3;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}switch(n.last=1&b,w-=1,3&(b>>>=1)){case 0:n.mode=14;break;case 1:if(function(i){if(_){var r;for(o=new a.Buf32(512),s=new a.Buf32(32),r=0;r<144;)i.lens[r++]=8;for(;r<256;)i.lens[r++]=9;for(;r<280;)i.lens[r++]=7;for(;r<288;)i.lens[r++]=8;for(c(1,i.lens,0,288,o,0,i.work,{bits:9}),r=0;r<32;)i.lens[r++]=5;c(2,i.lens,0,32,s,0,i.work,{bits:5}),_=!1}i.lencode=o,i.lenbits=9,i.distcode=s,i.distbits=5}(n),n.mode=20,6===r){b>>>=2,w-=2;break e}break;case 2:n.mode=17;break;case 3:i.msg="invalid block type",n.mode=30}b>>>=2,w-=2;break;case 14:for(b>>>=7&w,w-=7&w;w<32;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if((65535&b)!=(b>>>16^65535)){i.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&b,b=0,w=0,n.mode=15,6===r)break e;case 15:n.mode=16;case 16:if(S=n.length){if(S>y&&(S=y),S>x&&(S=x),0===S)break e;a.arraySet(d,f,m,S,g),y-=S,m+=S,x-=S,g+=S,n.length-=S;break}n.mode=12;break;case 17:for(;w<14;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(n.nlen=(31&b)+257,b>>>=5,w-=5,n.ndist=(31&b)+1,b>>>=5,w-=5,n.ncode=(15&b)+4,b>>>=4,w-=4,n.nlen>286||n.ndist>30){i.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;w<3;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.lens[U[n.have++]]=7&b,b>>>=3,w-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,O={bits:n.lenbits},N=c(0,n.lens,0,19,n.lencode,0,n.work,O),n.lenbits=O.bits,N){i.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;C=(F=n.lencode[b&(1<<n.lenbits)-1])>>>24,P=F>>>16&255,A=65535&F,!(C<=w);){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(A<16)b>>>=C,w-=C,n.lens[n.have++]=A;else{if(16===A){for(z=C+2;w<z;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(b>>>=C,w-=C,0===n.have){i.msg="invalid bit length repeat",n.mode=30;break}D=n.lens[n.have-1],S=3+(3&b),b>>>=2,w-=2}else if(17===A){for(z=C+3;w<z;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}b>>>=C,w-=C,D=0,S=3+(7&b),b>>>=3,w-=3}else{for(z=C+7;w<z;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}b>>>=C,w-=C,D=0,S=11+(127&b),b>>>=7,w-=7}if(n.have+S>n.nlen+n.ndist){i.msg="invalid bit length repeat",n.mode=30;break}for(;S--;)n.lens[n.have++]=D}}if(30===n.mode)break;if(0===n.lens[256]){i.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,O={bits:n.lenbits},N=c(1,n.lens,0,n.nlen,n.lencode,0,n.work,O),n.lenbits=O.bits,N){i.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,O={bits:n.distbits},N=c(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,O),n.distbits=O.bits,N){i.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===r)break e;case 20:n.mode=21;case 21:if(y>=6&&x>=258){i.next_out=g,i.avail_out=x,i.next_in=m,i.avail_in=y,n.hold=b,n.bits=w,h(i,I),g=i.next_out,d=i.output,x=i.avail_out,m=i.next_in,f=i.input,y=i.avail_in,b=n.hold,w=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;C=(F=n.lencode[b&(1<<n.lenbits)-1])>>>24,P=F>>>16&255,A=65535&F,!(C<=w);){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(P&&(240&P)==0){for(L=C,k=P,R=A;C=(F=n.lencode[R+((b&(1<<L+k)-1)>>L)])>>>24,P=F>>>16&255,A=65535&F,!(L+C<=w);){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}b>>>=L,w-=L,n.back+=L}if(b>>>=C,w-=C,n.back+=C,n.length=A,0===P){n.mode=26;break}if(32&P){n.back=-1,n.mode=12;break}if(64&P){i.msg="invalid literal/length code",n.mode=30;break}n.extra=15&P,n.mode=22;case 22:if(n.extra){for(z=n.extra;w<z;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.length+=b&(1<<n.extra)-1,b>>>=n.extra,w-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;C=(F=n.distcode[b&(1<<n.distbits)-1])>>>24,P=F>>>16&255,A=65535&F,!(C<=w);){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if((240&P)==0){for(L=C,k=P,R=A;C=(F=n.distcode[R+((b&(1<<L+k)-1)>>L)])>>>24,P=F>>>16&255,A=65535&F,!(L+C<=w);){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}b>>>=L,w-=L,n.back+=L}if(b>>>=C,w-=C,n.back+=C,64&P){i.msg="invalid distance code",n.mode=30;break}n.offset=A,n.extra=15&P,n.mode=24;case 24:if(n.extra){for(z=n.extra;w<z;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}n.offset+=b&(1<<n.extra)-1,b>>>=n.extra,w-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){i.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===x)break e;if(S=I-x,n.offset>S){if((S=n.offset-S)>n.whave&&n.sane){i.msg="invalid distance too far back",n.mode=30;break}S>n.wnext?(S-=n.wnext,M=n.wsize-S):M=n.wnext-S,S>n.length&&(S=n.length),T=n.window}else T=d,M=g-n.offset,S=n.length;S>x&&(S=x),x-=S,n.length-=S;do d[g++]=T[M++];while(--S)0===n.length&&(n.mode=21);break;case 26:if(0===x)break e;d[g++]=n.length,x--,n.mode=21;break;case 27:if(n.wrap){for(;w<32;){if(0===y)break e;y--,b|=f[m++]<<w,w+=8}if(I-=x,i.total_out+=I,n.total+=I,I&&(i.adler=n.check=n.flags?u(n.check,d,I,g-I):l(n.check,d,I,g-I)),I=x,(n.flags?b:p(b))!==n.check){i.msg="incorrect data check",n.mode=30;break}b=0,w=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;w<32;){if(0===y)break e;y--,b+=f[m++]<<w,w+=8}if(b!==(0xffffffff&n.total)){i.msg="incorrect length check",n.mode=30;break}b=0,w=0}n.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return -4;default:return -2}return(i.next_out=g,i.avail_out=x,i.next_in=m,i.avail_in=y,n.hold=b,n.bits=w,(n.wsize||I!==i.avail_out&&n.mode<30&&(n.mode<27||4!==r))&&v(i,i.output,i.next_out,I-i.avail_out))?(n.mode=31,-4):(E-=i.avail_in,I-=i.avail_out,i.total_in+=E,i.total_out+=I,n.total+=I,n.wrap&&I&&(i.adler=n.check=n.flags?u(n.check,d,I,i.next_out-I):l(n.check,d,I,i.next_out-I)),i.data_type=n.bits+64*!!n.last+128*(12===n.mode)+256*(20===n.mode||15===n.mode),(0===E&&0===I||4===r)&&0===N&&(N=-5),N)},n.inflateEnd=function(i){if(!i||!i.state)return -2;var r=i.state;return r.window&&(r.window=null),i.state=null,0},n.inflateGetHeader=function(i,r){var n;return i&&i.state&&(2&(n=i.state).wrap)!=0?(n.head=r,r.done=!1,0):-2},n.inflateSetDictionary=function(i,r){var n,o=r.length;return i&&i.state&&(0===(n=i.state).wrap||11===n.mode)?11===n.mode&&l(1,r,o,0)!==n.check?-3:v(i,r,o,o)?(n.mode=31,-4):(n.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,r,n){var o=i("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(i,r,n,h,c,p,f,d){var m,g,y,_,v,x,b,w,E,I=d.bits,S=0,M=0,T=0,C=0,P=0,A=0,L=0,k=0,R=0,D=0,N=null,O=0,z=new o.Buf16(16),F=new o.Buf16(16),B=null,U=0;for(S=0;S<=15;S++)z[S]=0;for(M=0;M<h;M++)z[r[n+M]]++;for(C=15,P=I;C>=1&&0===z[C];C--);if(P>C&&(P=C),0===C)return c[p++]=0x1400000,c[p++]=0x1400000,d.bits=1,0;for(T=1;T<C&&0===z[T];T++);for(P<T&&(P=T),k=1,S=1;S<=15;S++)if(k<<=1,(k-=z[S])<0)return -1;if(k>0&&(0===i||1!==C))return -1;for(S=1,F[1]=0;S<15;S++)F[S+1]=F[S]+z[S];for(M=0;M<h;M++)0!==r[n+M]&&(f[F[r[n+M]]++]=M);if(0===i?(N=B=f,x=19):1===i?(N=s,O-=257,B=a,U-=257,x=256):(N=l,B=u,x=-1),D=0,M=0,S=T,v=p,A=P,L=0,y=-1,_=(R=1<<P)-1,1===i&&R>852||2===i&&R>592)return 1;for(;;){b=S-L,f[M]<x?(w=0,E=f[M]):f[M]>x?(w=B[U+f[M]],E=N[O+f[M]]):(w=96,E=0),m=1<<S-L,T=g=1<<A;do c[v+(D>>L)+(g-=m)]=b<<24|w<<16|E|0;while(0!==g)for(m=1<<S-1;D&m;)m>>=1;if(0!==m?(D&=m-1,D+=m):D=0,M++,0==--z[S]){if(S===C)break;S=r[n+f[M]]}if(S>P&&(D&_)!==y){for(0===L&&(L=P),v+=T,k=1<<(A=S-L);A+L<C&&!((k-=z[A+L])<=0);)A++,k<<=1;if(R+=1<<A,1===i&&R>852||2===i&&R>592)return 1;c[y=D&_]=P<<24|A<<16|v-p|0}}return 0!==D&&(c[v+D]=S-L<<24|4194304),d.bits=P,0}},{"../utils/common":41}],51:[function(i,r,n){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,r,n){var o,s,a,l=i("../utils/common");function u(i){for(var r=i.length;--r>=0;)i[r]=0}var h=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=Array(576);u(d);var m=Array(60);u(m);var g=Array(512);u(g);var y=Array(256);u(y);var _=Array(29);u(_);var v=Array(30);function x(i,r,n,o,s){this.static_tree=i,this.extra_bits=r,this.extra_base=n,this.elems=o,this.max_length=s,this.has_stree=i&&i.length}function b(i,r){this.dyn_tree=i,this.max_code=0,this.stat_desc=r}function w(i){return i<256?g[i]:g[256+(i>>>7)]}function E(i,r){i.pending_buf[i.pending++]=255&r,i.pending_buf[i.pending++]=r>>>8&255}function I(i,r,n){i.bi_valid>16-n?(i.bi_buf|=r<<i.bi_valid&65535,E(i,i.bi_buf),i.bi_buf=r>>16-i.bi_valid,i.bi_valid+=n-16):(i.bi_buf|=r<<i.bi_valid&65535,i.bi_valid+=n)}function S(i,r,n){I(i,n[2*r],n[2*r+1])}function M(i,r){var n=0;do n|=1&i,i>>>=1,n<<=1;while(--r>0)return n>>>1}function T(i,r,n){var o,s,a=Array(16),l=0;for(o=1;o<=15;o++)a[o]=l=l+n[o-1]<<1;for(s=0;s<=r;s++){var u=i[2*s+1];0!==u&&(i[2*s]=M(a[u]++,u))}}function C(i){var r;for(r=0;r<286;r++)i.dyn_ltree[2*r]=0;for(r=0;r<30;r++)i.dyn_dtree[2*r]=0;for(r=0;r<19;r++)i.bl_tree[2*r]=0;i.dyn_ltree[512]=1,i.opt_len=i.static_len=0,i.last_lit=i.matches=0}function P(i){i.bi_valid>8?E(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0}function A(i,r,n,o){var s=2*r,a=2*n;return i[s]<i[a]||i[s]===i[a]&&o[r]<=o[n]}function L(i,r,n){for(var o=i.heap[n],s=n<<1;s<=i.heap_len&&(s<i.heap_len&&A(r,i.heap[s+1],i.heap[s],i.depth)&&s++,!A(r,o,i.heap[s],i.depth));)i.heap[n]=i.heap[s],n=s,s<<=1;i.heap[n]=o}function k(i,r,n){var o,s,a,l,u=0;if(0!==i.last_lit)do o=i.pending_buf[i.d_buf+2*u]<<8|i.pending_buf[i.d_buf+2*u+1],s=i.pending_buf[i.l_buf+u],u++,0===o?S(i,s,r):(S(i,(a=y[s])+256+1,r),0!==(l=h[a])&&I(i,s-=_[a],l),S(i,a=w(--o),n),0!==(l=c[a])&&I(i,o-=v[a],l));while(u<i.last_lit)S(i,256,r)}function R(i,r){var n,o,s,a=r.dyn_tree,l=r.stat_desc.static_tree,u=r.stat_desc.has_stree,h=r.stat_desc.elems,c=-1;for(n=0,i.heap_len=0,i.heap_max=573;n<h;n++)0!==a[2*n]?(i.heap[++i.heap_len]=c=n,i.depth[n]=0):a[2*n+1]=0;for(;i.heap_len<2;)a[2*(s=i.heap[++i.heap_len]=c<2?++c:0)]=1,i.depth[s]=0,i.opt_len--,u&&(i.static_len-=l[2*s+1]);for(r.max_code=c,n=i.heap_len>>1;n>=1;n--)L(i,a,n);s=h;do n=i.heap[1],i.heap[1]=i.heap[i.heap_len--],L(i,a,1),o=i.heap[1],i.heap[--i.heap_max]=n,i.heap[--i.heap_max]=o,a[2*s]=a[2*n]+a[2*o],i.depth[s]=(i.depth[n]>=i.depth[o]?i.depth[n]:i.depth[o])+1,a[2*n+1]=a[2*o+1]=s,i.heap[1]=s++,L(i,a,1);while(i.heap_len>=2)i.heap[--i.heap_max]=i.heap[1],function(i,r){var n,o,s,a,l,u,h=r.dyn_tree,c=r.max_code,p=r.stat_desc.static_tree,f=r.stat_desc.has_stree,d=r.stat_desc.extra_bits,m=r.stat_desc.extra_base,g=r.stat_desc.max_length,y=0;for(a=0;a<=15;a++)i.bl_count[a]=0;for(h[2*i.heap[i.heap_max]+1]=0,n=i.heap_max+1;n<573;n++)(a=h[2*h[2*(o=i.heap[n])+1]+1]+1)>g&&(a=g,y++),h[2*o+1]=a,!(o>c)&&(i.bl_count[a]++,l=0,o>=m&&(l=d[o-m]),u=h[2*o],i.opt_len+=u*(a+l),f&&(i.static_len+=u*(p[2*o+1]+l)));if(0!==y){do{for(a=g-1;0===i.bl_count[a];)a--;i.bl_count[a]--,i.bl_count[a+1]+=2,i.bl_count[g]--,y-=2}while(y>0)for(a=g;0!==a;a--)for(o=i.bl_count[a];0!==o;)!((s=i.heap[--n])>c)&&(h[2*s+1]!==a&&(i.opt_len+=(a-h[2*s+1])*h[2*s],h[2*s+1]=a),o--)}}(i,r),T(a,c,i.bl_count)}function D(i,r,n){var o,s,a=-1,l=r[1],u=0,h=7,c=4;for(0===l&&(h=138,c=3),r[(n+1)*2+1]=65535,o=0;o<=n;o++)s=l,l=r[(o+1)*2+1],++u<h&&s===l||(u<c?i.bl_tree[2*s]+=u:0!==s?(s!==a&&i.bl_tree[2*s]++,i.bl_tree[32]++):u<=10?i.bl_tree[34]++:i.bl_tree[36]++,u=0,a=s,0===l?(h=138,c=3):s===l?(h=6,c=3):(h=7,c=4))}function N(i,r,n){var o,s,a=-1,l=r[1],u=0,h=7,c=4;for(0===l&&(h=138,c=3),o=0;o<=n;o++)if(s=l,l=r[(o+1)*2+1],!(++u<h)||s!==l){if(u<c)do S(i,s,i.bl_tree);while(0!=--u)else 0!==s?(s!==a&&(S(i,s,i.bl_tree),u--),S(i,16,i.bl_tree),I(i,u-3,2)):u<=10?(S(i,17,i.bl_tree),I(i,u-3,3)):(S(i,18,i.bl_tree),I(i,u-11,7));u=0,a=s,0===l?(h=138,c=3):s===l?(h=6,c=3):(h=7,c=4)}}u(v);var O=!1;function z(i,r,n,o){I(i,0+ +!!o,3),P(i),E(i,n),E(i,~n),l.arraySet(i.pending_buf,i.window,r,n,i.pending),i.pending+=n}n._tr_init=function(i){O||(function(){var i,r,n,l,u,f=Array(16);for(l=0,n=0;l<28;l++)for(i=0,_[l]=n;i<1<<h[l];i++)y[n++]=l;for(y[n-1]=l,u=0,l=0;l<16;l++)for(i=0,v[l]=u;i<1<<c[l];i++)g[u++]=l;for(u>>=7;l<30;l++)for(i=0,v[l]=u<<7;i<1<<c[l]-7;i++)g[256+u++]=l;for(r=0;r<=15;r++)f[r]=0;for(i=0;i<=143;)d[2*i+1]=8,i++,f[8]++;for(;i<=255;)d[2*i+1]=9,i++,f[9]++;for(;i<=279;)d[2*i+1]=7,i++,f[7]++;for(;i<=287;)d[2*i+1]=8,i++,f[8]++;for(T(d,287,f),i=0;i<30;i++)m[2*i+1]=5,m[2*i]=M(i,5);o=new x(d,h,257,286,15),s=new x(m,c,0,30,15),a=new x([],p,0,19,7)}(),O=!0),i.l_desc=new b(i.dyn_ltree,o),i.d_desc=new b(i.dyn_dtree,s),i.bl_desc=new b(i.bl_tree,a),i.bi_buf=0,i.bi_valid=0,C(i)},n._tr_stored_block=z,n._tr_flush_block=function(i,r,n,o){var s,a,l=0;i.level>0?(2===i.strm.data_type&&(i.strm.data_type=function(i){var r,n=0xf3ffc07f;for(r=0;r<=31;r++,n>>>=1)if(1&n&&0!==i.dyn_ltree[2*r])return 0;if(0!==i.dyn_ltree[18]||0!==i.dyn_ltree[20]||0!==i.dyn_ltree[26])return 1;for(r=32;r<256;r++)if(0!==i.dyn_ltree[2*r])return 1;return 0}(i)),R(i,i.l_desc),R(i,i.d_desc),l=function(i){var r;for(D(i,i.dyn_ltree,i.l_desc.max_code),D(i,i.dyn_dtree,i.d_desc.max_code),R(i,i.bl_desc),r=18;r>=3&&0===i.bl_tree[2*f[r]+1];r--);return i.opt_len+=3*(r+1)+5+5+4,r}(i),s=i.opt_len+3+7>>>3,(a=i.static_len+3+7>>>3)<=s&&(s=a)):s=a=n+5,n+4<=s&&-1!==r?z(i,r,n,o):4===i.strategy||a===s?(I(i,2+ +!!o,3),k(i,d,m)):(I(i,4+ +!!o,3),function(i,r,n,o){var s;for(I(i,r-257,5),I(i,n-1,5),I(i,o-4,4),s=0;s<o;s++)I(i,i.bl_tree[2*f[s]+1],3);N(i,i.dyn_ltree,r-1),N(i,i.dyn_dtree,n-1)}(i,i.l_desc.max_code+1,i.d_desc.max_code+1,l+1),k(i,i.dyn_ltree,i.dyn_dtree)),C(i),o&&P(i)},n._tr_tally=function(i,r,n){return i.pending_buf[i.d_buf+2*i.last_lit]=r>>>8&255,i.pending_buf[i.d_buf+2*i.last_lit+1]=255&r,i.pending_buf[i.l_buf+i.last_lit]=255&n,i.last_lit++,0===r?i.dyn_ltree[2*n]++:(i.matches++,r--,i.dyn_ltree[(y[n]+256+1)*2]++,i.dyn_dtree[2*w(r)]++),i.last_lit===i.lit_bufsize-1},n._tr_align=function(i){I(i,2,3),S(i,256,d),16===i.bi_valid?(E(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},{"../utils/common":41}],53:[function(i,r,n){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,r,n){(function(i){!function(i,r){if(!i.setImmediate){var n,o,s,a,l,u=1,h={},c=!1,p=i.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(i);f=f&&f.setTimeout?f:i,"[object process]"===({}).toString.call(i.process)?l=function(i){to.nextTick(function(){m(i)})}:function(){if(i.postMessage&&!i.importScripts){var r=!0,n=i.onmessage;return i.onmessage=function(){r=!1},i.postMessage("","*"),i.onmessage=n,r}}()?(n="setImmediate$"+Math.random()+"$",o=function(r){r.source===i&&"string"==typeof r.data&&0===r.data.indexOf(n)&&m(+r.data.slice(n.length))},i.addEventListener?i.addEventListener("message",o,!1):i.attachEvent("onmessage",o),l=function(r){i.postMessage(n+r,"*")}):i.MessageChannel?((s=new MessageChannel).port1.onmessage=function(i){m(i.data)},l=function(i){s.port2.postMessage(i)}):p&&"onreadystatechange"in p.createElement("script")?(a=p.documentElement,l=function(i){var r=p.createElement("script");r.onreadystatechange=function(){m(i),r.onreadystatechange=null,a.removeChild(r),r=null},a.appendChild(r)}):l=function(i){setTimeout(m,0,i)},f.setImmediate=function(i){"function"!=typeof i&&(i=Function(""+i));for(var r=Array(arguments.length-1),n=0;n<r.length;n++)r[n]=arguments[n+1];var o={callback:i,args:r};return h[u]=o,l(u),u++},f.clearImmediate=d}function d(i){delete h[i]}function m(i){if(c)setTimeout(m,0,i);else{var n=h[i];if(n){c=!0;try{!function(i){var n=i.callback,o=i.args;switch(o.length){case 0:n();break;case 1:n(o[0]);break;case 2:n(o[0],o[1]);break;case 3:n(o[0],o[1],o[2]);break;default:n.apply(r,o)}}(n)}finally{d(i),c=!1}}}}}("undefined"==typeof self?void 0===i?this:i:self)}).call(this,void 0!==c?c:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10),t_.prototype.read=function(){var i=this._array;return this._array=null,Promise.resolve(i?{done:!1,value:i}:{done:!0,value:void 0})},t_.prototype.cancel=function(){return this._array=null,Promise.resolve()};var tb=new Uint8Array(0);function tw(i){return"function"==typeof i.slice?i:new tE("function"==typeof i.read?i:i.getReader())}function tE(i){this._source=i,this._array=tb,this._index=0}function tI(i){return!(i=i.trim())||isNaN(i*=1)?null:i}tE.prototype.read=function(){var i=this,r=i._array.subarray(i._index);return i._source.read().then(function(n){return i._array=tb,i._index=0,n.done?r.length>0?{done:!1,value:r}:{done:!0,value:void 0}:{done:!1,value:function(i,r){if(!i.length)return r;if(!r.length)return i;var n=new Uint8Array(i.length+r.length);return n.set(i),n.set(r,i.length),n}(r,n.value)}})},tE.prototype.slice=function(i){if((i|=0)<0)throw Error("invalid length");var r=this,n=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var o=new Uint8Array(i);return o.set(this._array.subarray(this._index)),function s(){return r._source.read().then(function(a){return a.done?(r._array=tb,r._index=0,n>0?o.subarray(0,n):null):n+a.value.length>=i?(r._array=a.value,r._index=i-n,o.set(a.value.subarray(0,i-n),n),o):(o.set(a.value,n),n+=a.value.length,s())})}()},tE.prototype.cancel=function(){return this._source.cancel()};var tS={B:tI,C:function(i){return i.trim()||null},D:function(i){return new Date(+i.substring(0,4),i.substring(4,6)-1,+i.substring(6,8))},F:tI,L:function(i){return!/^[nf]$/i.test(i)&&(!!/^[yt]$/i.test(i)||null)},M:tI,N:tI};function tM(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function tT(i,r,n,o){this._source=i,this._decode=r.decode.bind(r),this._recordLength=n.getUint16(10,!0),this._fields=[];for(var s=0;13!==o.getUint8(s);s+=32){for(var a=0;a<11&&0!==o.getUint8(s+a);++a);this._fields.push({name:this._decode(new Uint8Array(o.buffer,o.byteOffset+s,a)),type:String.fromCharCode(o.getUint8(s+11)),length:o.getUint8(s+16)})}}var tC=tT.prototype;function tP(i){var r,n=40,o=i.getInt32(36,!0),s=Array(o);for(r=0;r<o;++r,n+=16)s[r]=[i.getFloat64(n,!0),i.getFloat64(n+8,!0)];return{type:"MultiPoint",coordinates:s}}function tA(i){return{type:"Point",coordinates:[i.getFloat64(4,!0),i.getFloat64(12,!0)]}}function tL(i){var r,n=44,o=i.getInt32(36,!0),s=i.getInt32(40,!0),a=Array(o),l=Array(s),u=[],h=[];for(r=0;r<o;++r,n+=4)a[r]=i.getInt32(n,!0);for(r=0;r<s;++r,n+=16)l[r]=[i.getFloat64(n,!0),i.getFloat64(n+8,!0)];return a.forEach(function(i,r){var n=l.slice(i,a[r+1]);(function(i){if((r=i.length)<4)return!1;for(var r,n=0,o=i[r-1][1]*i[0][0]-i[r-1][0]*i[0][1];++n<r;)o+=i[n-1][1]*i[n][0]-i[n-1][0]*i[n][1];return o>=0})(n)?u.push([n]):h.push(n)}),h.forEach(function(i){u.some(function(r){if(function(i,r){for(var n,o=-1,s=r.length;++o<s;)if(n=function(i,r){for(var n=r[0],o=r[1],s=-1,a=0,l=i.length,u=l-1;a<l;u=a++){var h=i[a],c=h[0],p=h[1],f=i[u],d=f[0],m=f[1];if(function(i,r,n){var o=n[0]-i[0],s=n[1]-i[1];if(0===o&&0===s)return!0;var a=r[0]-i[0],l=r[1]-i[1];if(0===a&&0===l)return!1;var u=(o*a+s*l)/(a*a+l*l);return!(u<0)&&!(u>1)&&(0===u||1===u||u*a===o&&u*l===s)}(h,f,r))return 0;p>o!=m>o&&n<(d-c)*(o-p)/(m-p)+c&&(s=-s)}return s}(i,r[o]))return n>0;return!1}(r[0],i))return r.push(i),!0})||u.push([i])}),1===u.length?{type:"Polygon",coordinates:u[0]}:{type:"MultiPolygon",coordinates:u}}function tk(i){var r,n=44,o=i.getInt32(36,!0),s=i.getInt32(40,!0),a=Array(o),l=Array(s);for(r=0;r<o;++r,n+=4)a[r]=i.getInt32(n,!0);for(r=0;r<s;++r,n+=16)l[r]=[i.getFloat64(n,!0),i.getFloat64(n+8,!0)];return 1===o?{type:"LineString",coordinates:l}:{type:"MultiLineString",coordinates:a.map(function(i,r){return l.slice(i,a[r+1])})}}function tR(i,r){var n=new Uint8Array(i.length+r.length);return n.set(i,0),n.set(r,i.length),n}tC.read=function(){var i=this,r=1;return i._source.slice(i._recordLength).then(function(n){return n&&26!==n[0]?{done:!1,value:i._fields.reduce(function(o,s){return o[s.name]=tS[s.type](i._decode(n.subarray(r,r+=s.length))),o},{})}:{done:!0,value:void 0}})},tC.cancel=function(){return this._source.cancel()};var tD={0:function(){return null},1:tA,3:tk,5:tL,8:tP,11:tA,13:tk,15:tL,18:tP,21:tA,23:tk,25:tL,28:tP};function tN(i,r){var n=r.getInt32(32,!0);if(!(n in tD))throw Error("unsupported shape type: "+n);this._source=i,this._type=n,this._index=0,this._parse=tD[n],this.bbox=[r.getFloat64(36,!0),r.getFloat64(44,!0),r.getFloat64(52,!0),r.getFloat64(60,!0)]}var tO=tN.prototype;function tz(){}function tF(i,r){this._shp=i,this._dbf=r,this.bbox=i.bbox}tO.read=function(){var i=this;return++i._index,i._source.slice(12).then(function(r){if(null==r)return{done:!0,value:void 0};var n=tM(r);return function o(){var s=2*n.getInt32(4,!1)-4,a=n.getInt32(8,!0);return s<0||a&&a!==i._type?function s(){return i._source.slice(4).then(function(a){return null==a?{done:!0,value:void 0}:(n=tM(r=tR(r.slice(4),a))).getInt32(0,!1)!==i._index?s():o()})}():i._source.slice(s).then(function(n){return{done:!1,value:a?i._parse(tM(tR(r.slice(8),n))):null}})}()})},tO.cancel=function(){return this._source.cancel()};var tB=tF.prototype;tB.read=function(){return Promise.all([this._dbf?this._dbf.read():{value:{}},this._shp.read()]).then(function(i){var r=i[0],n=i[1];return n.done?n:{done:!1,value:{type:"Feature",properties:r.value,geometry:n.value}}})},tB.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(tz)};var tU={},tG=d("2tD7m"),tV={};tV.greenwich=0,tV.lisbon=-9.131906111111,tV.paris=2.337229166667,tV.bogota=-74.080916666667,tV.madrid=-3.687938888889,tV.rome=12.452333333333,tV.bern=7.439583333333,tV.jakarta=106.807719444444,tV.ferro=-17.666666666667,tV.brussels=4.367975,tV.stockholm=18.058277777778,tV.athens=23.7163375,tV.oslo=10.722916666667;var tq={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},tj=/[\s_\-\/\(\)]/g;function tZ(i,r){if(i[r])return i[r];for(var n,o=Object.keys(i),s=r.toLowerCase().replace(tj,""),a=-1;++a<o.length;)if((n=o[a]).toLowerCase().replace(tj,"")===s)return i[n]}function tX(i){var r,n,o,s={},a=i.split("+").map(function(i){return i.trim()}).filter(function(i){return i}).reduce(function(i,r){var n=r.split("=");return n.push(!0),i[n[0].toLowerCase()]=n[1],i},{}),l={proj:"projName",datum:"datumCode",rf:function(i){s.rf=parseFloat(i)},lat_0:function(i){s.lat0=i*tG.D2R},lat_1:function(i){s.lat1=i*tG.D2R},lat_2:function(i){s.lat2=i*tG.D2R},lat_ts:function(i){s.lat_ts=i*tG.D2R},lon_0:function(i){s.long0=i*tG.D2R},lon_1:function(i){s.long1=i*tG.D2R},lon_2:function(i){s.long2=i*tG.D2R},alpha:function(i){s.alpha=parseFloat(i)*tG.D2R},gamma:function(i){s.rectified_grid_angle=parseFloat(i)},lonc:function(i){s.longc=i*tG.D2R},x_0:function(i){s.x0=parseFloat(i)},y_0:function(i){s.y0=parseFloat(i)},k_0:function(i){s.k0=parseFloat(i)},k:function(i){s.k0=parseFloat(i)},a:function(i){s.a=parseFloat(i)},b:function(i){s.b=parseFloat(i)},r_a:function(){s.R_A=!0},zone:function(i){s.zone=parseInt(i,10)},south:function(){s.utmSouth=!0},towgs84:function(i){s.datum_params=i.split(",").map(function(i){return parseFloat(i)})},to_meter:function(i){s.to_meter=parseFloat(i)},units:function(i){s.units=i;var r=tZ(tq,i);r&&(s.to_meter=r.to_meter)},from_greenwich:function(i){s.from_greenwich=i*tG.D2R},pm:function(i){var r=tZ(tV,i);s.from_greenwich=(r||parseFloat(i))*tG.D2R},nadgrids:function(i){"@null"===i?s.datumCode="none":s.nadgrids=i},axis:function(i){var r="ewnsud";3===i.length&&-1!==r.indexOf(i.substr(0,1))&&-1!==r.indexOf(i.substr(1,1))&&-1!==r.indexOf(i.substr(2,1))&&(s.axis=i)},approx:function(){s.approx=!0}};for(r in a)n=a[r],r in l?"function"==typeof(o=l[r])?o(n):s[o]=n:s[r]=n;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s}var t$=/\s/,tW=/[A-Za-z]/,tH=/[A-Za-z84]/,tY=/[,\]]/,tK=/[\d\.E\-\+]/;function tJ(i){if("string"!=typeof i)throw Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function tQ(i,r,n){Array.isArray(r)&&(n.unshift(r),r=null);var o=r?{}:i,s=n.reduce(function(i,r){return t0(r,i),i},o);r&&(i[r]=s)}function t0(i,r){if(!Array.isArray(i)){r[i]=!0;return}var n,o=i.shift();if("PARAMETER"===o&&(o=i.shift()),1===i.length){if(Array.isArray(i[0])){r[o]={},t0(i[0],r[o]);return}r[o]=i[0];return}if(!i.length){r[o]=!0;return}if("TOWGS84"===o){r[o]=i;return}if("AXIS"===o){o in r||(r[o]=[]),r[o].push(i);return}switch(Array.isArray(o)||(r[o]={}),o){case"UNIT":case"PRIMEM":case"VERT_DATUM":r[o]={name:i[0].toLowerCase(),convert:i[1]},3===i.length&&t0(i[2],r[o]);return;case"SPHEROID":case"ELLIPSOID":r[o]={name:i[0],a:i[1],rf:i[2]},4===i.length&&t0(i[3],r[o]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":i[0]=["name",i[0]],tQ(r,o,i);return;default:for(n=-1;++n<i.length;)if(!Array.isArray(i[n]))return t0(i,r[o]);return tQ(r,o,i)}}function t1(i){return .017453292519943295*i}function t2(i){var r=new tJ(i).output(),n=r.shift(),o=r.shift();r.unshift(["name",o]),r.unshift(["type",n]);var s={};return t0(r,s),!function(i){if("GEOGCS"===i.type?i.projName="longlat":"LOCAL_CS"===i.type?(i.projName="identity",i.local=!0):"object"==typeof i.PROJECTION?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var r="",n=0,o=i.AXIS.length;n<o;++n){var s=[i.AXIS[n][0].toLowerCase(),i.AXIS[n][1].toLowerCase()];-1!==s[0].indexOf("north")||("y"===s[0]||"lat"===s[0])&&"north"===s[1]?r+="n":-1!==s[0].indexOf("south")||("y"===s[0]||"lat"===s[0])&&"south"===s[1]?r+="s":-1!==s[0].indexOf("east")||("x"===s[0]||"lon"===s[0])&&"east"===s[1]?r+="e":(-1!==s[0].indexOf("west")||("x"===s[0]||"lon"===s[0])&&"west"===s[1])&&(r+="w")}2===r.length&&(r+="u"),3===r.length&&(i.axis=r)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),"metre"===i.units&&(i.units="meter"),i.UNIT.convert&&("GEOGCS"===i.type?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var a=i.GEOGCS;function l(r){return r*(i.to_meter||1)}"GEOGCS"===i.type&&(a=i),a&&(a.DATUM?i.datumCode=a.DATUM.name.toLowerCase():i.datumCode=a.name.toLowerCase(),"d_"===i.datumCode.slice(0,2)&&(i.datumCode=i.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===i.datumCode||"new_zealand_1949"===i.datumCode)&&(i.datumCode="nzgd49"),("wgs_1984"===i.datumCode||"world_geodetic_system_1984"===i.datumCode)&&("Mercator_Auxiliary_Sphere"===i.PROJECTION&&(i.sphere=!0),i.datumCode="wgs84"),"_ferro"===i.datumCode.slice(-6)&&(i.datumCode=i.datumCode.slice(0,-6)),"_jakarta"===i.datumCode.slice(-8)&&(i.datumCode=i.datumCode.slice(0,-8)),~i.datumCode.indexOf("belge")&&(i.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(i.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===i.ellps.toLowerCase().slice(0,13)&&(i.ellps="intl"),i.a=a.DATUM.SPHEROID.a,i.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(i.datum_params=a.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),"ch1903+"===i.datumCode&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",t1],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",t1],["x0","false_easting",l],["y0","false_northing",l],["long0","central_meridian",t1],["lat0","latitude_of_origin",t1],["lat0","standard_parallel_1",t1],["lat1","standard_parallel_1",t1],["lat2","standard_parallel_2",t1],["azimuth","Azimuth"],["alpha","azimuth",t1],["srsCode","name"]].forEach(function(r){var n,o;return n=r[0],o=r[1],void(!(n in i)&&o in i&&(i[n]=i[o],3===r.length&&(i[n]=r[2](i[n]))))}),!i.long0&&i.longc&&("Albers_Conic_Equal_Area"===i.projName||"Lambert_Azimuthal_Equal_Area"===i.projName)&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&("Stereographic_South_Pole"===i.projName||"Polar Stereographic (variant B)"===i.projName)&&(i.lat0=t1(i.lat1>0?90:-90),i.lat_ts=i.lat1)}(s),s}function t3(i){var r=this;if(2==arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?t3[i]=tX(arguments[1]):t3[i]=t2(arguments[1]):t3[i]=n}else if(1==arguments.length){if(Array.isArray(i))return i.map(function(i){Array.isArray(i)?t3.apply(r,i):t3(i)});if("string"==typeof i){if(i in t3)return t3[i]}else"EPSG"in i?t3["EPSG:"+i.EPSG]=i:"ESRI"in i?t3["ESRI:"+i.ESRI]=i:"IAU2000"in i?t3["IAU2000:"+i.IAU2000]=i:console.log(i);return}}tJ.prototype.readCharicter=function(){var i=this.text[this.place++];if(4!==this.state)for(;t$.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case 1:return this.neutral(i);case 2:return this.keyword(i);case 4:return this.quoted(i);case 5:return this.afterquote(i);case 3:return this.number(i);case -1:return}},tJ.prototype.afterquote=function(i){if('"'===i){this.word+='"',this.state=4;return}if(tY.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw Error("havn't handled \""+i+'" in afterquote yet, index '+this.place)},tJ.prototype.afterItem=function(i){if(","===i){null!==this.word&&this.currentObject.push(this.word),this.word=null,this.state=1;return}if("]"===i){this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),this.currentObject||(this.state=-1);return}},tJ.prototype.number=function(i){if(tK.test(i)){this.word+=i;return}if(tY.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw Error("havn't handled \""+i+'" in number yet, index '+this.place)},tJ.prototype.quoted=function(i){if('"'===i){this.state=5;return}this.word+=i},tJ.prototype.keyword=function(i){if(tH.test(i)){this.word+=i;return}if("["===i){var r=[];r.push(this.word),this.level++,null===this.root?this.root=r:this.currentObject.push(r),this.stack.push(this.currentObject),this.currentObject=r,this.state=1;return}if(tY.test(i)){this.afterItem(i);return}throw Error("havn't handled \""+i+'" in keyword yet, index '+this.place)},tJ.prototype.neutral=function(i){if(tW.test(i)){this.word=i,this.state=2;return}if('"'===i){this.word="",this.state=4;return}if(tK.test(i)){this.word=i,this.state=3;return}if(tY.test(i)){this.afterItem(i);return}throw Error("havn't handled \""+i+'" in neutral yet, index '+this.place)},tJ.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw Error('unable to parse string "'+this.text+'". State is '+this.state)},t3("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t3("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t3("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t3.WGS84=t3["EPSG:4326"],t3["EPSG:3785"]=t3["EPSG:3857"],t3.GOOGLE=t3["EPSG:3857"],t3["EPSG:900913"]=t3["EPSG:3857"],t3["EPSG:102113"]=t3["EPSG:3857"];var t5=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],t4=["3857","900913","3785","102113"],t6=function(i){if("string"!=typeof i)return i;if(i in t3)return t3[i];if(t5.some(function(r){return i.indexOf(r)>-1})){var r=t2(i);if(function(i){var r=tZ(i,"authority");if(r){var n=tZ(r,"epsg");return n&&t4.indexOf(n)>-1}}(r))return t3["EPSG:3857"];var n=function(i){var r=tZ(i,"extension");if(r)return tZ(r,"proj4")}(r);return n?tX(n):r}if("+"===i[0])return tX(i)};function t8(i,r){var n,o;if(i=i||{},!r)return i;for(o in r)void 0!==(n=r[o])&&(i[o]=n);return i}var t9=d("4brs7"),t7=d("fKwbA"),et=d("dXS7W"),ee=d("lUD03"),tG=d("2tD7m");function ei(i){return i}var er=[{init:function(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=(0,t9.default)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(i){var r,n,o=i.x,s=i.y;if(s*tG.R2D>90&&s*tG.R2D<-90&&o*tG.R2D>180&&o*tG.R2D<-180||Math.abs(Math.abs(s)-tG.HALF_PI)<=tG.EPSLN)return null;if(this.sphere)r=this.x0+this.a*this.k0*(0,t7.default)(o-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(tG.FORTPI+.5*s));else{var a=Math.sin(s),l=(0,et.default)(this.e,s,a);r=this.x0+this.a*this.k0*(0,t7.default)(o-this.long0),n=this.y0-this.a*this.k0*Math.log(l)}return i.x=r,i.y=n,i},inverse:function(i){var r,n,o=i.x-this.x0,s=i.y-this.y0;if(this.sphere)n=tG.HALF_PI-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var a=Math.exp(-s/(this.a*this.k0));if(-9999===(n=(0,ee.default)(this.e,a)))return null}return r=(0,t7.default)(this.long0+o/(this.a*this.k0)),i.x=r,i.y=n,i},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:ei,inverse:ei,names:["longlat","identity"]}],en={},eo=[];function es(i,r){var n=eo.length;return i.names?(eo[n]=i,i.names.forEach(function(i){en[i.toLowerCase()]=n}),this):(console.log(r),!0)}var tG=d("2tD7m"),ea={};ea.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},ea.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},ea.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},ea.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},ea.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},ea.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},ea.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},ea.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},ea.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},ea.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},ea.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},ea.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},ea.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},ea.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},ea.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},ea.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},ea.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},ea.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},ea.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},ea.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},ea.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},ea.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},ea.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},ea.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},ea.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},ea.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},ea.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},ea.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},ea.hough={a:6378270,rf:297,ellipseName:"Hough"},ea.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},ea.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},ea.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},ea.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},ea.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},ea.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},ea.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},ea.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},ea.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},ea.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},ea.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},ea.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var el=ea.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ea.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var eu={};eu.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},eu.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},eu.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},eu.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},eu.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},eu.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},eu.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},eu.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},eu.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},eu.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},eu.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},eu.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},eu.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},eu.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},eu.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},eu.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},eu.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var tG=d("2tD7m"),eh=function(i,r,n,o,s,a,l){var u={};return void 0===i||"none"===i?u.datum_type=tG.PJD_NODATUM:u.datum_type=tG.PJD_WGS84,r&&(u.datum_params=r.map(parseFloat),(0!==u.datum_params[0]||0!==u.datum_params[1]||0!==u.datum_params[2])&&(u.datum_type=tG.PJD_3PARAM),u.datum_params.length>3&&(0!==u.datum_params[3]||0!==u.datum_params[4]||0!==u.datum_params[5]||0!==u.datum_params[6])&&(u.datum_type=tG.PJD_7PARAM,u.datum_params[3]*=tG.SEC_TO_RAD,u.datum_params[4]*=tG.SEC_TO_RAD,u.datum_params[5]*=tG.SEC_TO_RAD,u.datum_params[6]=u.datum_params[6]/1e6+1)),l&&(u.datum_type=tG.PJD_GRIDSHIFT,u.grids=l),u.a=n,u.b=o,u.es=s,u.ep2=a,u},ec={};function ep(i){if(0===i.length)return null;var r="@"===i[0];return(r&&(i=i.slice(1)),"null"===i)?{name:"null",mandatory:!r,grid:null,isNull:!0}:{name:i,mandatory:!r,grid:ec[i]||null,isNull:!1}}function ef(i){return i/3600*Math.PI/180}function ed(i,r,n){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(r,n)))}function em(i,r){if(!(this instanceof em))return new em(i);r=r||function(i){if(i)throw i};var n,o,s,a,l,u,h,c,p=t6(i);if("object"!=typeof p){r(i);return}var f=em.projections.get(p.projName);if(!f){r(i);return}if(p.datumCode&&"none"!==p.datumCode){var d=tZ(eu,p.datumCode);d&&(p.datum_params=p.datum_params||(d.towgs84?d.towgs84.split(","):null),p.ellps=d.ellipse,p.datumName=d.datumName?d.datumName:p.datumCode)}p.k0=p.k0||1,p.axis=p.axis||"enu",p.ellps=p.ellps||"wgs84",p.lat1=p.lat1||p.lat0;var m=function(i,r,n,o,s){if(!i){var a=tZ(ea,o);a||(a=el),i=a.a,r=a.b,n=a.rf}return n&&!r&&(r=(1-1/n)*i),(0===n||Math.abs(i-r)<tG.EPSLN)&&(s=!0,r=i),{a:i,b:r,rf:n,sphere:s}}(p.a,p.b,p.rf,p.ellps,p.sphere),g=(n=m.a,o=m.b,m.rf,s=p.R_A,u=((a=n*n)-(l=o*o))/a,h=0,s?(n*=1-u*(tG.SIXTH+u*(tG.RA4+u*tG.RA6)),a=n*n,u=0):h=Math.sqrt(u),{es:u,e:h,ep2:(a-l)/l}),y=void 0===(c=p.nadgrids)?null:c.split(",").map(ep),_=p.datum||eh(p.datumCode,p.datum_params,m.a,m.b,g.es,g.ep2,y);t8(this,p),t8(this,f),this.a=m.a,this.b=m.b,this.rf=m.rf,this.sphere=m.sphere,this.es=g.es,this.e=g.e,this.ep2=g.ep2,this.datum=_,this.init(),r(null,this)}em.projections={start:function(){er.forEach(es)},add:es,get:function(i){if(!i)return!1;var r=i.toLowerCase();if(void 0!==en[r]&&eo[en[r]])return eo[en[r]]}},em.projections.start();var tG=(d("2tD7m"),d("2tD7m"),d("2tD7m"));function eg(i,r,n){var o,s,a,l=i.x,u=i.y,h=i.z?i.z:0;if(u<-tG.HALF_PI&&u>-1.001*tG.HALF_PI)u=-tG.HALF_PI;else if(u>tG.HALF_PI&&u<1.001*tG.HALF_PI)u=tG.HALF_PI;else if(u<-tG.HALF_PI)return{x:-1/0,y:-1/0,z:i.z};else if(u>tG.HALF_PI)return{x:1/0,y:1/0,z:i.z};return l>Math.PI&&(l-=2*Math.PI),s=Math.sin(u),a=Math.cos(u),{x:((o=n/Math.sqrt(1-s*s*r))+h)*a*Math.cos(l),y:(o+h)*a*Math.sin(l),z:(o*(1-r)+h)*s}}function ey(i,r,n,o){var s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b=1e-12*1e-12,w=i.x,E=i.y,I=i.z?i.z:0;if(s=Math.sqrt(w*w+E*E),a=Math.sqrt(w*w+E*E+I*I),s/n<1e-12){if(v=0,a/n<1e-12)return tG.HALF_PI,x=-o,{x:i.x,y:i.y,z:i.z}}else v=Math.atan2(E,w);l=I/a,h=1/Math.sqrt(1-r*(2-r)*(u=s/a)*u),f=u*(1-r)*h,d=l*h,_=0;do _++,p=n/Math.sqrt(1-r*d*d),x=s*f+I*d-p*(1-r*d*d),h=1/Math.sqrt(1-(c=r*p/(p+x))*(2-c)*u*u),m=u*(1-c)*h,y=(g=l*h)*f-m*d,f=m,d=g;while(y*y>b&&_<30)return{x:v,y:Math.atan(g/Math.abs(m)),z:x}}var t7=d("fKwbA");function e_(i){return i===tG.PJD_3PARAM||i===tG.PJD_7PARAM}function ev(i,r,n){if(null===i.grids||0===i.grids.length)return console.log("Grid shift grids not found"),-1;for(var o={x:-n.x,y:n.y},s={x:Number.NaN,y:Number.NaN},a=[],l=0;l<i.grids.length;l++){var u=i.grids[l];if(a.push(u.name),u.isNull){s=o;break}if(u.mandatory,null===u.grid){if(u.mandatory)return console.log("Unable to find mandatory grid '"+u.name+"'"),-1;continue}var h=u.grid.subgrids[0],c=(Math.abs(h.del[1])+Math.abs(h.del[0]))/1e4,p=h.ll[0]-c,f=h.ll[1]-c,d=h.ll[0]+(h.lim[0]-1)*h.del[0]+c,m=h.ll[1]+(h.lim[1]-1)*h.del[1]+c;if(!(f>o.y)&&!(p>o.x)&&!(m<o.y)&&!(d<o.x)&&!isNaN((s=function(i,r,n){var o={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return o;var s={x:i.x,y:i.y};s.x-=n.ll[0],s.y-=n.ll[1],s.x=(0,t7.default)(s.x-Math.PI)+Math.PI;var a=ex(s,n);if(r){if(isNaN(a.x))return o;a.x=s.x-a.x,a.y=s.y-a.y;var l,u,h=9;do{if(isNaN((u=ex(a,n)).x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(u.x+a.x),y:s.y-(u.y+a.y)},a.x+=l.x,a.y+=l.y}while(h--&&Math.abs(l.x)>1e-12&&Math.abs(l.y)>1e-12)if(h<0)return console.log("Inverse grid shift iterator failed to converge."),o;o.x=(0,t7.default)(a.x+n.ll[0]),o.y=a.y+n.ll[1]}else isNaN(a.x)||(o.x=i.x+a.x,o.y=i.y+a.y);return o}(o,r,h)).x))break}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-o.x*tG.R2D+" "+o.y*tG.R2D+" tried: '"+a+"'"),-1):(n.x=-s.x,n.y=s.y,0)}function ex(i,r){var n,o={x:i.x/r.del[0],y:i.y/r.del[1]},s={x:Math.floor(o.x),y:Math.floor(o.y)},a={x:o.x-+s.x,y:o.y-+s.y},l={x:Number.NaN,y:Number.NaN};if(s.x<0||s.x>=r.lim[0]||s.y<0||s.y>=r.lim[1])return l;n=s.y*r.lim[0]+s.x;var u={x:r.cvs[n][0],y:r.cvs[n][1]};n++;var h={x:r.cvs[n][0],y:r.cvs[n][1]};n+=r.lim[0];var c={x:r.cvs[n][0],y:r.cvs[n][1]};n--;var p={x:r.cvs[n][0],y:r.cvs[n][1]},f=a.x*a.y,d=a.x*(1-a.y),m=(1-a.x)*(1-a.y),g=(1-a.x)*a.y;return l.x=m*u.x+d*h.x+g*p.x+f*c.x,l.y=m*u.y+d*h.y+g*p.y+f*c.y,l}function eb(i,r,n){var o,s,a,l=n.x,u=n.y,h=n.z||0,c={};for(a=0;a<3;a++)if(!r||2!==a||void 0!==n.z)switch(0===a?(o=l,s=-1!=="ew".indexOf(i.axis[a])?"x":"y"):1===a?(o=u,s=-1!=="ns".indexOf(i.axis[a])?"y":"x"):(o=h,s="z"),i.axis[a]){case"e":case"n":c[s]=o;break;case"w":case"s":c[s]=-o;break;case"u":void 0!==n[s]&&(c.z=o);break;case"d":void 0!==n[s]&&(c.z=-o);break;default:return null}return c}function ew(i){var r={x:i[0],y:i[1]};return i.length>2&&(r.z=i[2]),i.length>3&&(r.m=i[3]),r}function eE(i){if("function"==typeof Number.isFinite){if(Number.isFinite(i))return;throw TypeError("coordinates must be finite numbers")}if("number"!=typeof i||i!=i||!isFinite(i))throw TypeError("coordinates must be finite numbers")}function eI(i,r,n,o){var s,a,l;if(Array.isArray(n)&&(n=ew(n)),eE((a=n).x),eE(a.y),i.datum&&r.datum&&(((l=i).datum.datum_type===tG.PJD_3PARAM||l.datum.datum_type===tG.PJD_7PARAM)&&"WGS84"!==r.datumCode||(r.datum.datum_type===tG.PJD_3PARAM||r.datum.datum_type===tG.PJD_7PARAM)&&"WGS84"!==l.datumCode)&&(n=eI(i,s=new em("WGS84"),n,o),i=s),o&&"enu"!==i.axis&&(n=eb(i,!1,n)),"longlat"===i.projName)n={x:n.x*tG.D2R,y:n.y*tG.D2R,z:n.z||0};else if(i.to_meter&&(n={x:n.x*i.to_meter,y:n.y*i.to_meter,z:n.z||0}),!(n=i.inverse(n)))return;if(i.from_greenwich&&(n.x+=i.from_greenwich),n=function(i,r,n){if(!(i.datum_type!==r.datum_type||i.a!==r.a||Math.abs(i.es-r.es)>5e-11)&&(i.datum_type===tG.PJD_3PARAM?i.datum_params[0]===r.datum_params[0]&&i.datum_params[1]===r.datum_params[1]&&i.datum_params[2]===r.datum_params[2]:i.datum_type!==tG.PJD_7PARAM||i.datum_params[0]===r.datum_params[0]&&i.datum_params[1]===r.datum_params[1]&&i.datum_params[2]===r.datum_params[2]&&i.datum_params[3]===r.datum_params[3]&&i.datum_params[4]===r.datum_params[4]&&i.datum_params[5]===r.datum_params[5]&&i.datum_params[6]===r.datum_params[6])||i.datum_type===tG.PJD_NODATUM||r.datum_type===tG.PJD_NODATUM)return n;var o=i.a,s=i.es;if(i.datum_type===tG.PJD_GRIDSHIFT){if(0!==ev(i,!1,n))return;o=tG.SRS_WGS84_SEMIMAJOR,s=tG.SRS_WGS84_ESQUARED}var a=r.a,l=r.b,u=r.es;if(r.datum_type===tG.PJD_GRIDSHIFT&&(a=tG.SRS_WGS84_SEMIMAJOR,l=tG.SRS_WGS84_SEMIMINOR,u=tG.SRS_WGS84_ESQUARED),s===u&&o===a&&!e_(i.datum_type)&&!e_(r.datum_type)||(n=eg(n,s,o),e_(i.datum_type)&&(n=function(i,r,n){if(r===tG.PJD_3PARAM)return{x:i.x+n[0],y:i.y+n[1],z:i.z+n[2]};if(r===tG.PJD_7PARAM){var o=n[0],s=n[1],a=n[2],l=n[3],u=n[4],h=n[5],c=n[6];return{x:c*(i.x-h*i.y+u*i.z)+o,y:c*(h*i.x+i.y-l*i.z)+s,z:c*(-u*i.x+l*i.y+i.z)+a}}}(n,i.datum_type,i.datum_params)),e_(r.datum_type)&&(n=function(i,r,n){if(r===tG.PJD_3PARAM)return{x:i.x-n[0],y:i.y-n[1],z:i.z-n[2]};if(r===tG.PJD_7PARAM){var o=n[0],s=n[1],a=n[2],l=n[3],u=n[4],h=n[5],c=n[6],p=(i.x-o)/c,f=(i.y-s)/c,d=(i.z-a)/c;return{x:p+h*f-u*d,y:-h*p+f+l*d,z:u*p-l*f+d}}}(n,r.datum_type,r.datum_params)),n=ey(n,u,a,l),r.datum_type!==tG.PJD_GRIDSHIFT||0===ev(r,!0,n)))return n}(i.datum,r.datum,n))return(r.from_greenwich&&(n={x:n.x-r.from_greenwich,y:n.y,z:n.z||0}),"longlat"===r.projName?n={x:n.x*tG.R2D,y:n.y*tG.R2D,z:n.z||0}:(n=r.forward(n),r.to_meter&&(n={x:n.x/r.to_meter,y:n.y/r.to_meter,z:n.z||0})),o&&"enu"!==r.axis)?eb(r,!0,n):n}var eS=em("WGS84");function eM(i,r,n,o){var s,a,l;return Array.isArray(n)?(s=eI(i,r,n,o)||{x:NaN,y:NaN},n.length>2)?(void 0===i.name||"geocent"!==i.name)&&(void 0===r.name||"geocent"!==r.name)?[s.x,s.y].concat(n.splice(2)):"number"==typeof s.z?[s.x,s.y,s.z].concat(n.splice(3)):[s.x,s.y,n[2]].concat(n.splice(3)):[s.x,s.y]:(a=eI(i,r,n,o),2===(l=Object.keys(n)).length||l.forEach(function(o){if(void 0!==i.name&&"geocent"===i.name||void 0!==r.name&&"geocent"===r.name){if("x"===o||"y"===o||"z"===o)return}else if("x"===o||"y"===o)return;a[o]=n[o]}),a)}function eT(i){return i instanceof em?i:i.oProj?i.oProj:em(i)}var eC=function(i,r,n){i=eT(i);var o,s=!1;return(void 0===r?(r=i,i=eS,s=!0):(void 0!==r.x||Array.isArray(r))&&(n=r,r=i,i=eS,s=!0),r=eT(r),n)?eM(i,r,n):(o={forward:function(n,o){return eM(i,r,n,o)},inverse:function(n,o){return eM(r,i,n,o)}},s&&(o.oProj=r),o)},eP="AJSAJS",eA="AFAFAF";function eL(i,r){var n,o,s,a,l,u,h,c,p,f,d,m,g,y,_;return r=r||5,n=function(i){var r,n,o,s,a,l,u,h=i.lat,c=i.lon,p=eR(h),f=eR(c);u=Math.floor((c+180)/6)+1,180===c&&(u=60),h>=56&&h<64&&c>=3&&c<12&&(u=32),h>=72&&h<84&&(c>=0&&c<9?u=31:c>=9&&c<21?u=33:c>=21&&c<33?u=35:c>=33&&c<42&&(u=37)),l=eR((u-1)*6-180+3),n=6378137/Math.sqrt(1-.00669438*Math.sin(p)*Math.sin(p)),o=Math.tan(p)*Math.tan(p),s=.006739496752268451*Math.cos(p)*Math.cos(p);var d=.9996*n*((a=Math.cos(p)*(f-l))+(1-o+s)*a*a*a/6+(5-18*o+o*o+72*s-.39089081163157013)*a*a*a*a*a/120)+5e5,m=.9996*(6378137*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-3418046101696858e-24*Math.sin(6*p))+n*Math.tan(p)*(a*a/2+(5-o+9*s+4*s*s)*a*a*a*a/24+(61-58*o+o*o+600*s-2.2240339282485886)*a*a*a*a*a*a/720));return h<0&&(m+=1e7),{northing:Math.round(m),easting:Math.round(d),zoneNumber:u,zoneLetter:(r="Z",84>=h&&h>=72?r="X":72>h&&h>=64?r="W":64>h&&h>=56?r="V":56>h&&h>=48?r="U":48>h&&h>=40?r="T":40>h&&h>=32?r="S":32>h&&h>=24?r="R":24>h&&h>=16?r="Q":16>h&&h>=8?r="P":8>h&&h>=0?r="N":0>h&&h>=-8?r="M":-8>h&&h>=-16?r="L":-16>h&&h>=-24?r="K":-24>h&&h>=-32?r="J":-32>h&&h>=-40?r="H":-40>h&&h>=-48?r="G":-48>h&&h>=-56?r="F":-56>h&&h>=-64?r="E":-64>h&&h>=-72?r="D":-72>h&&h>=-80&&(r="C"),r)}}({lat:i[1],lon:i[0]}),o=r,s="00000"+n.easting,a="00000"+n.northing,n.zoneNumber+n.zoneLetter+(l=n.easting,u=n.northing,h=n.zoneNumber,c=Math.floor(l/1e5),p=Math.floor(u/1e5)%20,f=eO(h)-1,d=eP.charCodeAt(f),m=eA.charCodeAt(f),g=d+c-1,y=m+p,_=!1,g>90&&(g=g-90+65-1,_=!0),(73===g||d<73&&g>73||(g>73||d<73)&&_)&&g++,(79===g||d<79&&g>79||(g>79||d<79)&&_)&&73==++g&&g++,g>90&&(g=g-90+65-1),y>86?(y=y-86+65-1,_=!0):_=!1,(73===y||m<73&&y>73||(y>73||m<73)&&_)&&y++,(79===y||m<79&&y>79||(y>79||m<79)&&_)&&73==++y&&y++,y>86&&(y=y-86+65-1),String.fromCharCode(g)+String.fromCharCode(y))+s.substr(s.length-5,o)+a.substr(a.length-5,o)}function ek(i){var r=eN(ez(i.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function eR(i){return Math.PI/180*i}function eD(i){return i/Math.PI*180}function eN(i){var r,n,o,s,a,l,u,h,c,p=i.northing,f=i.easting,d=i.zoneLetter,m=i.zoneNumber;if(m<0||m>60)return null;var g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=p;d<"N"&&(y-=1e7),l=(m-1)*6-180+3,r=6378137/Math.sqrt(1-.00669438*Math.sin(h=(u=y/.9996/6367449.145945056)+(3*g/2-27*g*g*g/32)*Math.sin(2*u)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*u)+151*g*g*g/96*Math.sin(6*u))*Math.sin(h)),n=Math.tan(h)*Math.tan(h),o=.006739496752268451*Math.cos(h)*Math.cos(h),s=6335439.32722994/Math.pow(1-.00669438*Math.sin(h)*Math.sin(h),1.5),a=(f-5e5)/(.9996*r);var _=h-r*Math.tan(h)/s*(a*a/2-(5+3*n+10*o-4*o*o-.06065547077041606)*a*a*a*a/24+(61+90*n+298*o+45*n*n-1.6983531815716497-3*o*o)*a*a*a*a*a*a/720);_=eD(_);var v=(a-(1+2*n+o)*a*a*a/6+(5-2*o+28*n-3*o*o+.05391597401814761+24*n*n)*a*a*a*a*a/120)/Math.cos(h);if(v=l+eD(v),i.accuracy){var x=eN({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});c={top:x.lat,right:x.lon,bottom:_,left:v}}else c={lat:_,lon:v};return c}function eO(i){var r=i%6;return 0===r&&(r=6),r}function ez(i){if(i&&0===i.length)throw"MGRSPoint coverting from nothing";for(var r,n,o=i.length,s=null,a="",l=0;!/[A-Z]/.test(r=i.charAt(l));){if(l>=2)throw"MGRSPoint bad conversion from: "+i;a+=r,l++}var u=parseInt(a,10);if(0===l||l+3>o)throw"MGRSPoint bad conversion from: "+i;var h=i.charAt(l++);if(h<="A"||"B"===h||"Y"===h||h>="Z"||"I"===h||"O"===h)throw"MGRSPoint zone letter "+h+" not handled: "+i;s=i.substring(l,l+=2);for(var c=eO(u),p=function(i,r){for(var n=eP.charCodeAt(r-1),o=1e5,s=!1;n!==i.charCodeAt(0);){if(73==++n&&n++,79===n&&n++,n>90){if(s)throw"Bad character: "+i;n=65,s=!0}o+=1e5}return o}(s.charAt(0),c),f=function(i,r){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var n=eA.charCodeAt(r-1),o=0,s=!1;n!==i.charCodeAt(0);){if(73==++n&&n++,79===n&&n++,n>86){if(s)throw"Bad character: "+i;n=65,s=!0}o+=1e5}return o}(s.charAt(1),c);f<function(i){var r;switch(i){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+i}(h);)f+=2e6;var d=o-l;if(d%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+i;var m=d/2,g=0,y=0;return m>0&&(n=1e5/Math.pow(10,m),g=parseFloat(i.substring(l,l+m))*n,y=parseFloat(i.substring(l+m))*n),{easting:g+p,northing:y+f,zoneLetter:h,zoneNumber:u,accuracy:n}}function eF(i,r,n){if(!(this instanceof eF))return new eF(i,r,n);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if("object"==typeof i)this.x=i.x,this.y=i.y,this.z=i.z||0;else if("string"==typeof i&&void 0===r){var o=i.split(",");this.x=parseFloat(o[0],10),this.y=parseFloat(o[1],10),this.z=parseFloat(o[2],10)||0}else this.x=i,this.y=r,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}eF.fromMGRS=function(i){return new eF(ek(i))},eF.prototype.toMGRS=function(i){return eL([this.x,this.y],i)};var eB=d("fMWdI"),eU=d("17UQw"),t7=d("fKwbA"),eU=d("17UQw");function eG(i,r){return Math.pow((1-i)/(1+i),r)}var tG=(d("2tD7m"),d("2tD7m")),eV={init:function(){var i=Math.sin(this.lat0),r=Math.cos(this.lat0);r*=r,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*r*r/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+tG.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+tG.FORTPI),this.C)*eG(this.e*i,this.ratexp))},forward:function(i){var r=i.x,n=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+tG.FORTPI),this.C)*eG(this.e*Math.sin(n),this.ratexp))-tG.HALF_PI,i.x=this.C*r,i},inverse:function(i){for(var r=i.x/this.C,n=i.y,o=Math.pow(Math.tan(.5*n+tG.FORTPI)/this.K,1/this.C),s=20;s>0&&!(1e-14>Math.abs((n=2*Math.atan(o*eG(this.e*Math.sin(i.y),-.5*this.e))-tG.HALF_PI)-i.y));--s)i.y=n;return s?(i.x=r,i.y=n,i):null},names:["gauss"]},t7=d("fKwbA"),eq=d("kAlZb"),et=d("dXS7W"),t7=d("fKwbA"),ee=d("lUD03"),tG=d("2tD7m"),t9=d("4brs7"),et=d("dXS7W"),ej=d("9MBM4"),t7=d("fKwbA"),ee=d("lUD03"),tG=d("2tD7m");function eZ(i,r,n,o,s){return i*s-r*Math.sin(2*s)+n*Math.sin(4*s)-o*Math.sin(6*s)}function eX(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function e$(i){return .375*i*(1+.25*i*(1+.46875*i))}function eW(i){return .05859375*i*i*(1+.75*i)}function eH(i){return i*i*i*(35/3072)}function eY(i,r,n){var o=r*n;return i/Math.sqrt(1-o*o)}var t7=(d("fKwbA"),d("fKwbA")),tG=d("2tD7m"),ej=d("9MBM4");function eK(i){return Math.abs(i)<tG.HALF_PI?i:i-(0,ej.default)(i)*Math.PI}function eJ(i,r,n,o,s){a=i/r;for(var a,l,u=0;u<15;u++)if(l=(i-(r*a-n*Math.sin(2*a)+o*Math.sin(4*a)-s*Math.sin(6*a)))/(r-2*n*Math.cos(2*a)+4*o*Math.cos(4*a)-6*s*Math.cos(6*a)),a+=l,1e-10>=Math.abs(l))return a;return NaN}var tG=d("2tD7m"),eQ=d("4hir7"),e0=d("4esCO"),t7=d("fKwbA"),e1=d("eWZoB"),tG=d("2tD7m"),t7=d("fKwbA"),e2=d("3UUgM"),t9=d("4brs7"),tG=d("2tD7m"),t7=(d("fKwbA"),d("fKwbA")),tG=d("2tD7m"),e3=d("bShNf"),t7=(d("fKwbA"),d("fKwbA")),e5=d("ej898"),e4=d("emueP"),e6=d("kUbYC"),tG=d("2tD7m"),e1=d("eWZoB"),t7=d("fKwbA"),tG=d("2tD7m"),t9=d("4brs7"),t7=d("fKwbA"),tG=d("2tD7m"),t7=d("fKwbA"),tG=d("2tD7m"),e1=d("eWZoB"),t7=d("fKwbA"),tG=d("2tD7m"),e1=d("eWZoB"),t7=d("fKwbA"),e1=d("eWZoB"),tG=(d("2tD7m"),d("2tD7m")),e8={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},e9={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function e7(i,r,n,o){var s;return i<tG.EPSLN?(o.value=e9.AREA_0,s=0):Math.abs(s=Math.atan2(r,n))<=tG.FORTPI?o.value=e9.AREA_0:s>tG.FORTPI&&s<=tG.HALF_PI+tG.FORTPI?(o.value=e9.AREA_1,s-=tG.HALF_PI):s>tG.HALF_PI+tG.FORTPI||s<=-(tG.HALF_PI+tG.FORTPI)?(o.value=e9.AREA_2,s=s>=0?s-tG.SPI:s+tG.SPI):(o.value=e9.AREA_3,s+=tG.HALF_PI),s}function it(i,r){var n=i+r;return n<-tG.SPI?n+=tG.TWO_PI:n>+tG.SPI&&(n-=tG.TWO_PI),n}var tG=d("2tD7m"),t7=d("fKwbA"),ie=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ii=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],ir=tG.R2D/5,io=1/ir,is=function(i,r){return i[0]+r*(i[1]+r*(i[2]+r*i[3]))},tG=d("2tD7m"),ia=d("98Kl2"),il={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},iu={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function ih(i,r){return i.length>=2&&"number"==typeof i[0]&&"number"==typeof i[1]?r(i):i.map(function(i){return ih(i,r)})}function ic(i,r,n){if(null==n)return n;var o=function(i){if(null==i||"object"!=typeof i)return i;var r=i.constructor();for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);return r}(n),s=ic.bind(this,i,r);switch(n.type){case"Feature":o.geometry=s(n.geometry);break;case"FeatureCollection":o.features=o.features.map(s);break;case"GeometryCollection":o.geometries=o.geometries.map(s);break;default:i(o)}return r&&r(o),o}function ip(i,r){var n,o=i.crs;if(void 0===o)throw Error('Unable to detect CRS, GeoJSON has no "crs" property.');if("name"===o.type?n=r[o.properties.name]:"EPSG"===o.type&&(n=r["EPSG:"+o.properties.code]),!n)throw Error("CRS defined in crs section could not be identified: "+JSON.stringify(o));return n}function id(i,r){return"string"==typeof i||i instanceof String?r[i]||eC.Proj(i):i}function im(i,r,n,o){o=o||{};var s=eC(r=r?id(r,o):ip(i,o),n=id(n,o)).forward.bind(s);function a(i){var r=s(i);return 3===i.length&&void 0!==i[2]&&void 0===r[2]&&(r[2]=i[2]),r}return ic(function(i){i.crs&&delete i.crs,i.coordinates=ih(i.coordinates,a)},function(i){if(i.bbox){var r,n;i.bbox=(r=[Number.MAX_VALUE,Number.MAX_VALUE],n=[-Number.MAX_VALUE,-Number.MAX_VALUE],ic(function(i){ih(i.coordinates,function(i){r[0]=Math.min(r[0],i[0]),r[1]=Math.min(r[1],i[1]),n[0]=Math.max(n[0],i[0]),n[1]=Math.max(n[1],i[1])})},null,i),[r[0],r[1],n[0],n[1]])}},i)}eC.defaultDatum="WGS84",eC.Proj=em,eC.WGS84=new eC.Proj("WGS84"),eC.Point=eF,eC.toPoint=ew,eC.defs=t3,eC.nadgrid=function(i,r){var n,o=new DataView(r),s=11!==o.getInt32(8,!1)&&(11!==o.getInt32(8,!0)&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0),a={nFields:o.getInt32(8,s),nSubgridFields:o.getInt32(24,s),nSubgrids:o.getInt32(40,s),shiftType:ed(o,56,64).trim(),fromSemiMajorAxis:o.getFloat64(120,s),fromSemiMinorAxis:o.getFloat64(136,s),toSemiMajorAxis:o.getFloat64(152,s),toSemiMinorAxis:o.getFloat64(168,s)};a.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var l=function(i,r,n){for(var o=[],s=0;s<r.nSubgrids;s++){var a={name:ed(i,184,192).trim(),parent:ed(i,200,208).trim(),lowerLatitude:i.getFloat64(248,n),upperLatitude:i.getFloat64(264,n),lowerLongitude:i.getFloat64(280,n),upperLongitude:i.getFloat64(296,n),latitudeInterval:i.getFloat64(312,n),longitudeInterval:i.getFloat64(328,n),gridNodeCount:i.getInt32(344,n)},l=function(i,r,n,o){for(var s=[],a=0;a<n.gridNodeCount;a++){var l={latitudeShift:i.getFloat32(352+16*a,o),longitudeShift:i.getFloat32(352+16*a+4,o),latitudeAccuracy:i.getFloat32(352+16*a+8,o),longitudeAccuracy:i.getFloat32(352+16*a+12,o)};s.push(l)}return s}(i,0,a,n),u=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);o.push({ll:[ef(a.lowerLongitude),ef(a.lowerLatitude)],del:[ef(a.longitudeInterval),ef(a.latitudeInterval)],lim:[u,h],count:a.gridNodeCount,cvs:l.map(function(i){return[ef(i.longitudeShift),ef(i.latitudeShift)]})})}return o}(o,a,s),u={header:a,subgrids:l};return ec[i]=u,u},eC.transform=eI,eC.mgrs={forward:eL,inverse:function(i){var r=eN(ez(i.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]},toPoint:ek},eC.version="__VERSION__",eC.Proj.projections.add(eB.default),eC.Proj.projections.add(eU.default),eC.Proj.projections.add({init:function(){var i=function(i,r){if(void 0===i){if((i=Math.floor(((0,t7.default)(r)+Math.PI)*30/Math.PI)+1)<0)return 0;if(i>60)return 60}return i}(this.zone,this.long0);if(void 0===i)throw Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*tG.D2R,this.x0=5e5,this.y0=1e7*!!this.utmSouth,this.k0=.9996,(0,eU.default).init.apply(this),this.forward=eU.default.forward,this.inverse=eU.default.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"}),eC.Proj.projections.add({init:function(){eV.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(i){var r,n,o,s;return i.x=(0,t7.default)(i.x-this.long0),eV.forward.apply(this,[i]),r=Math.sin(i.y),n=Math.cos(i.y),o=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*r+this.cosc0*n*o),i.x=s*n*Math.sin(i.x),i.y=s*(this.cosc0*r-this.sinc0*n*o),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){var r,n,o,s,a;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,a=Math.sqrt(i.x*i.x+i.y*i.y)){var l=2*Math.atan2(a,this.R2);r=Math.sin(l),s=Math.asin((n=Math.cos(l))*this.sinc0+i.y*r*this.cosc0/a),o=Math.atan2(i.x*r,a*this.cosc0*n-i.y*this.sinc0*r)}else s=this.phic0,o=0;return i.x=o,i.y=s,eV.inverse.apply(this,[i]),i.x=(0,t7.default)(i.x+this.long0),i},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]}),eC.Proj.projections.add(eq.default),eC.Proj.projections.add({init:function(){var i=this.lat0;this.lambda0=this.long0;var r=Math.sin(i),n=this.a,o=1/this.rf,s=2*o-Math.pow(o,2),a=this.e=Math.sqrt(s);this.R=this.k0*n*Math.sqrt(1-s)/(1-s*Math.pow(r,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(r/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+i/2)),h=Math.log((1+a*r)/(1-a*r));this.K=l-this.alpha*u+this.alpha*a/2*h},forward:function(i){var r=Math.log(Math.tan(Math.PI/4-i.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),o=2*(Math.atan(Math.exp(-this.alpha*(r+n)+this.K))-Math.PI/4),s=this.alpha*(i.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(s))),l=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(s));return i.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,i.x=this.R*a+this.x0,i},inverse:function(i){for(var r=i.x-this.x0,n=i.y-this.y0,o=r/this.R,s=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(o)),l=Math.atan(Math.sin(o)/(Math.cos(this.b0)*Math.cos(o)-Math.sin(this.b0)*Math.tan(s))),u=this.lambda0+l/this.alpha,h=0,c=a,p=-1e3,f=0;Math.abs(c-p)>1e-7;){if(++f>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),p=c,c=2*Math.atan(Math.exp(h))-Math.PI/2}return i.x=u,i.y=c,i},names:["somerc"]}),eC.Proj.projections.add({init:function(){var i,r,n,o,s,a,l,u,h,c,p,f,d=0,m=0,g=0,y=0,_=0,v=0,x=0;this.no_off=(i="object"==typeof this.PROJECTION?Object.keys(this.PROJECTION)[0]:this.PROJECTION,"no_uoff"in this||"no_off"in this||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(i)),this.no_rot="no_rot"in this;var b=!1;"alpha"in this&&(b=!0);var w=!1;if("rectified_grid_angle"in this&&(w=!0),b&&(x=this.alpha),w&&(d=this.rectified_grid_angle*tG.D2R),b||w)m=this.longc;else if(g=this.long1,_=this.lat1,y=this.long2,1e-7>=Math.abs(_-(v=this.lat2))||(r=Math.abs(_))<=1e-7||1e-7>=Math.abs(r-tG.HALF_PI)||1e-7>=Math.abs(Math.abs(this.lat0)-tG.HALF_PI)||1e-7>=Math.abs(Math.abs(v)-tG.HALF_PI))throw Error();var E=1-this.es;n=Math.sqrt(E),Math.abs(this.lat0)>tG.EPSLN?(h=Math.sin(this.lat0),o=Math.cos(this.lat0),r=1-this.es*h*h,this.B=o*o,this.B=Math.sqrt(1+this.es*this.B*this.B/E),this.A=this.B*this.k0*n/r,(a=(s=this.B*n/(o*Math.sqrt(r)))*s-1)<=0?a=0:(a=Math.sqrt(a),this.lat0<0&&(a=-a)),this.E=a+=s,this.E*=Math.pow((0,et.default)(this.e,this.lat0,h),this.B)):(this.B=1/n,this.A=this.k0,this.E=s=a=1),b||w?(b?(f=Math.asin(Math.sin(x)/s),w||(d=x)):x=Math.asin(s*Math.sin(f=d)),this.lam0=m-Math.asin(.5*(a-1/a)*Math.tan(f))/this.B):(l=Math.pow((0,et.default)(this.e,_,Math.sin(_)),this.B),u=Math.pow((0,et.default)(this.e,v,Math.sin(v)),this.B),a=this.E/l,c=(u-l)/(u+l),p=((p=this.E*this.E)-u*l)/(p+u*l),(r=g-y)<-Math.pi?y-=tG.TWO_PI:r>Math.pi&&(y+=tG.TWO_PI),this.lam0=(0,t7.default)(.5*(g+y)-Math.atan(p*Math.tan(.5*this.B*(g-y))/c)/this.B),d=x=Math.asin(s*Math.sin(f=Math.atan(2*Math.sin(this.B*(0,t7.default)(g-this.lam0))/(a-1/a))))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(x))),this.lat0<0&&(this.u_0=-this.u_0)),a=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(tG.FORTPI-a)),this.v_pole_s=this.ArB*Math.log(Math.tan(tG.FORTPI+a))},forward:function(i){var r,n,o,s,a,l,u,h,c={};if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-tG.HALF_PI)>tG.EPSLN){if(l=1/(a=this.E/Math.pow((0,et.default)(this.e,i.y,Math.sin(i.y)),this.B)),r=.5*(a-l),n=.5*(a+l),s=Math.sin(this.B*i.x),Math.abs(Math.abs(o=(r*this.singam-s*this.cosgam)/n)-1)<tG.EPSLN)throw Error();h=.5*this.ArB*Math.log((1-o)/(1+o)),u=1e-7>Math.abs(l=Math.cos(this.B*i.x))?this.A*i.x:this.ArB*Math.atan2(r*this.cosgam+s*this.singam,l)}else h=i.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*i.y;return this.no_rot?(c.x=u,c.y=h):(u-=this.u_0,c.x=h*this.cosrot+u*this.sinrot,c.y=u*this.cosrot-h*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c},inverse:function(i){var r,n,o,s,a,l,u,h={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(n=i.y,r=i.x):(n=i.x*this.cosrot-i.y*this.sinrot,r=i.y*this.cosrot+i.x*this.sinrot+this.u_0),s=.5*((o=Math.exp(-this.BrA*n))-1/o),a=.5*(o+1/o),Math.abs(Math.abs(u=((l=Math.sin(this.BrA*r))*this.cosgam+s*this.singam)/a)-1)<tG.EPSLN)h.x=0,h.y=u<0?-tG.HALF_PI:tG.HALF_PI;else{if(h.y=this.E/Math.sqrt((1+u)/(1-u)),h.y=(0,ee.default)(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw Error();h.x=-this.rB*Math.atan2(s*this.cosgam-l*this.singam,Math.cos(this.BrA*r))}return h.x+=this.lam0,h},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]}),eC.Proj.projections.add({init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<tG.EPSLN)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var r=Math.sin(this.lat1),n=Math.cos(this.lat1),o=(0,t9.default)(this.e,r,n),s=(0,et.default)(this.e,this.lat1,r),a=Math.sin(this.lat2),l=Math.cos(this.lat2),u=(0,t9.default)(this.e,a,l),h=(0,et.default)(this.e,this.lat2,a),c=(0,et.default)(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>tG.EPSLN?this.ns=Math.log(o/u)/Math.log(s/h):this.ns=r,isNaN(this.ns)&&(this.ns=r),this.f0=o/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(i){var r,n,o=i.x,s=i.y;Math.abs(2*Math.abs(s)-Math.PI)<=tG.EPSLN&&(s=(0,ej.default)(s)*(tG.HALF_PI-2*tG.EPSLN));var a=Math.abs(Math.abs(s)-tG.HALF_PI);if(a>tG.EPSLN)r=(0,et.default)(this.e,s,Math.sin(s)),n=this.a*this.f0*Math.pow(r,this.ns);else{if((a=s*this.ns)<=0)return null;n=0}var l=this.ns*(0,t7.default)(o-this.long0);return i.x=this.k0*(n*Math.sin(l))+this.x0,i.y=this.k0*(this.rh-n*Math.cos(l))+this.y0,i},inverse:function(i){var r,n,o,s,a,l=(i.x-this.x0)/this.k0,u=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(r=Math.sqrt(l*l+u*u),n=1):(r=-Math.sqrt(l*l+u*u),n=-1);var h=0;if(0!==r&&(h=Math.atan2(n*l,n*u)),0!==r||this.ns>0){if(n=1/this.ns,o=Math.pow(r/(this.a*this.f0),n),-9999===(s=(0,ee.default)(this.e,o)))return null}else s=-tG.HALF_PI;return a=(0,t7.default)(h/this.ns+this.long0),i.x=a,i.y=s,i},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc"]}),eC.Proj.projections.add({init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(i){var r,n,o,s,a,l,u,h=i.x,c=i.y,p=(0,t7.default)(h-this.long0);return r=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/r)-this.s45),o=-p*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(o)),a=Math.asin(Math.cos(n)*Math.sin(o)/Math.cos(s)),l=this.n*a,u=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=u*Math.cos(l)/1,i.x=u*Math.sin(l)/1,this.czech||(i.y*=-1,i.x*=-1),i},inverse:function(i){var r,n,o,s,a,l,u,h=i.x;i.x=i.y,i.y=h,this.czech||(i.y*=-1,i.x*=-1),a=Math.sqrt(i.x*i.x+i.y*i.y),s=Math.atan2(i.y,i.x)/Math.sin(this.s0),o=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),r=Math.asin(Math.cos(this.ad)*Math.sin(o)-Math.sin(this.ad)*Math.cos(o)*Math.cos(s)),n=Math.asin(Math.cos(o)*Math.sin(s)/Math.cos(r)),i.x=this.long0-n/this.alfa,l=r,u=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(r/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),1e-10>Math.abs(l-i.y)&&(u=1),l=i.y,c+=1;while(0===u&&c<15)return c>=15?null:i},names:["Krovak","krovak"]}),eC.Proj.projections.add({init:function(){this.sphere||(this.e0=eX(this.es),this.e1=e$(this.es),this.e2=eW(this.es),this.e3=eH(this.es),this.ml0=this.a*eZ(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(i){var r,n,o=i.x,s=i.y;if(o=(0,t7.default)(o-this.long0),this.sphere)r=this.a*Math.asin(Math.cos(s)*Math.sin(o)),n=this.a*(Math.atan2(Math.tan(s),Math.cos(o))-this.lat0);else{var a=Math.sin(s),l=Math.cos(s),u=eY(this.a,this.e,a),h=Math.tan(s)*Math.tan(s),c=o*Math.cos(s),p=c*c,f=this.es*l*l/(1-this.es),d=this.a*eZ(this.e0,this.e1,this.e2,this.e3,s);r=u*c*(1-p*h*(1/6-(8-h+8*f)*p/120)),n=d-this.ml0+u*a/l*p*(.5+(5-h+6*f)*p/24)}return i.x=r+this.x0,i.y=n+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var r,n,o=i.x/this.a,s=i.y/this.a;if(this.sphere){var a=s+this.lat0;r=Math.asin(Math.sin(a)*Math.cos(o)),n=Math.atan2(Math.tan(o),Math.cos(a))}else{var l=eJ(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-tG.HALF_PI)<=tG.EPSLN)return i.x=this.long0,i.y=tG.HALF_PI,s<0&&(i.y*=-1),i;var u=eY(this.a,this.e,Math.sin(l)),h=u*u*u/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(l),2),p=o*this.a/u,f=p*p;r=l-u*Math.tan(l)/h*p*p*(.5-(1+3*c)*p*p/24),n=p*(1-f*(c/3+(1+3*c)*c*f/15))/Math.cos(l)}return i.x=(0,t7.default)(n+this.long0),i.y=eK(r),i},names:["Cassini","Cassini_Soldner","cass"]}),eC.Proj.projections.add(eQ.default),eC.Proj.projections.add(e0.default),eC.Proj.projections.add({init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(i){var r,n,o,s,a,l,u,h=i.x,c=i.y;return o=(0,t7.default)(h-this.long0),r=Math.sin(c),n=Math.cos(c),s=Math.cos(o),(a=this.sin_p14*r+this.cos_p14*n*s)>0||Math.abs(a)<=tG.EPSLN?(l=this.x0+ +this.a*n*Math.sin(o)/a,u=this.y0+ +this.a*(this.cos_p14*r-this.sin_p14*n*s)/a):(l=this.x0+this.infinity_dist*n*Math.sin(o),u=this.y0+this.infinity_dist*(this.cos_p14*r-this.sin_p14*n*s)),i.x=l,i.y=u,i},inverse:function(i){var r,n,o,s,a,l;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(r=Math.sqrt(i.x*i.x+i.y*i.y))?(n=Math.sin(s=Math.atan2(r,this.rc)),o=Math.cos(s),l=(0,e1.default)(o*this.sin_p14+i.y*n*this.cos_p14/r),a=Math.atan2(i.x*n,r*this.cos_p14*o-i.y*this.sin_p14*n),a=(0,t7.default)(this.long0+a)):(l=this.phic0,a=0),i.x=a,i.y=l,i},names:["gnom"]}),eC.Proj.projections.add({init:function(){this.sphere||(this.k0=(0,t9.default)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(i){var r,n,o=i.x,s=i.y,a=(0,t7.default)(o-this.long0);if(this.sphere)r=this.x0+this.a*a*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var l=(0,e2.default)(this.e,Math.sin(s));r=this.x0+this.a*this.k0*a,n=this.y0+this.a*l*.5/this.k0}return i.x=r,i.y=n,i},inverse:function(i){var r,n;return i.x-=this.x0,i.y-=this.y0,this.sphere?(r=(0,t7.default)(this.long0+i.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(n=function(i,r){if(1e-6>Math.abs(Math.abs(r)-(1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i)))))return r<0?-1*tG.HALF_PI:tG.HALF_PI;for(var n,o,s,a,l=Math.asin(.5*r),u=0;u<30;u++)if(o=Math.sin(l),s=Math.cos(l),l+=n=Math.pow(1-(a=i*o)*a,2)/(2*s)*(r/(1-i*i)-o/(1-a*a)+.5/i*Math.log((1-a)/(1+a))),1e-10>=Math.abs(n))return l;return NaN}(this.e,2*i.y*this.k0/this.a),r=(0,t7.default)(this.long0+i.x/(this.a*this.k0))),i.x=r,i.y=n,i},names:["cea"]}),eC.Proj.projections.add({init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(i){var r=i.x,n=i.y,o=(0,t7.default)(r-this.long0),s=eK(n-this.lat0);return i.x=this.x0+this.a*o*this.rc,i.y=this.y0+this.a*s,i},inverse:function(i){var r=i.x,n=i.y;return i.x=(0,t7.default)(this.long0+(r-this.x0)/(this.a*this.rc)),i.y=eK(this.lat0+(n-this.y0)/this.a),i},names:["Equirectangular","Equidistant_Cylindrical","eqc"]}),eC.Proj.projections.add({init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=eX(this.es),this.e1=e$(this.es),this.e2=eW(this.es),this.e3=eH(this.es),this.ml0=this.a*eZ(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(i){var r,n,o,s=i.x,a=i.y,l=(0,t7.default)(s-this.long0);if(o=l*Math.sin(a),this.sphere)Math.abs(a)<=tG.EPSLN?(r=this.a*l,n=-1*this.a*this.lat0):(r=this.a*Math.sin(o)/Math.tan(a),n=this.a*(eK(a-this.lat0)+(1-Math.cos(o))/Math.tan(a)));else if(Math.abs(a)<=tG.EPSLN)r=this.a*l,n=-1*this.ml0;else{var u=eY(this.a,this.e,Math.sin(a))/Math.tan(a);r=u*Math.sin(o),n=this.a*eZ(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+u*(1-Math.cos(o))}return i.x=r+this.x0,i.y=n+this.y0,i},inverse:function(i){var r,n,o,s,a,l,u,h,c,p,f,d,m,g,y;if(o=i.x-this.x0,s=i.y-this.y0,this.sphere){if(Math.abs(s+this.a*this.lat0)<=tG.EPSLN)r=(0,t7.default)(o/this.a+this.long0),n=0;else{for(a=20,l=this.lat0+s/this.a,u=o*o/this.a/this.a+l*l,h=l;a;--a)if(p=Math.tan(h),c=-1*(l*(h*p+1)-h-.5*(h*h+u)*p)/((h-l)/p-1),h+=c,Math.abs(c)<=tG.EPSLN){n=h;break}r=(0,t7.default)(this.long0+Math.asin(o*Math.tan(h)/this.a)/Math.sin(n))}}else if(Math.abs(s+this.ml0)<=tG.EPSLN)n=0,r=(0,t7.default)(this.long0+o/this.a);else{for(a=20,l=(this.ml0+s)/this.a,u=o*o/this.a/this.a+l*l,h=l;a;--a)if(f=Math.sqrt(1-(y=this.e*Math.sin(h))*y)*Math.tan(h),d=this.a*eZ(this.e0,this.e1,this.e2,this.e3,h),m=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),c=(l*(f*(g=d/this.a)+1)-g-.5*f*(g*g+u))/(this.es*Math.sin(2*h)*(g*g+u-2*l*g)/(4*f)+(l-g)*(f*m-2/Math.sin(2*h))-m),h-=c,Math.abs(c)<=tG.EPSLN){n=h;break}f=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),r=(0,t7.default)(this.long0+Math.asin(o*f/this.a)/Math.sin(n))}return i.x=r,i.y=n,i},names:["Polyconic","poly"]}),eC.Proj.projections.add(e3.default),eC.Proj.projections.add({init:function(){},forward:function(i){var r=i.x,n=i.y,o=(0,t7.default)(r-this.long0),s=this.x0+this.a*o,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return i.x=s,i.y=a,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var r=(0,t7.default)(this.long0+i.x/this.a),n=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=r,i.y=n,i},names:["Miller_Cylindrical","mill"]}),eC.Proj.projections.add({init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=(0,e5.default)(this.es)},forward:function(i){var r,n,o=i.x,s=i.y;if(o=(0,t7.default)(o-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(s),l=20;l;--l){var u=(this.m*s+Math.sin(s)-a)/(this.m+Math.cos(s));if(s-=u,Math.abs(u)<tG.EPSLN)break}else s=1!==this.n?Math.asin(this.n*Math.sin(s)):s;r=this.a*this.C_x*o*(this.m+Math.cos(s)),n=this.a*this.C_y*s}else{var h=Math.sin(s),c=Math.cos(s);n=this.a*(0,e4.default)(s,h,c,this.en),r=this.a*o*c/Math.sqrt(1-this.es*h*h)}return i.x=r,i.y=n,i},inverse:function(i){var r,n,o,s;return i.x-=this.x0,o=i.x/this.a,i.y-=this.y0,r=i.y/this.a,this.sphere?(r/=this.C_y,o/=this.C_x*(this.m+Math.cos(r)),this.m?r=(0,e1.default)((this.m*r+Math.sin(r))/this.n):1!==this.n&&(r=(0,e1.default)(Math.sin(r)/this.n)),o=(0,t7.default)(o+this.long0),r=eK(r)):(s=Math.abs(r=(0,e6.default)(i.y/this.a,this.es,this.en)))<tG.HALF_PI?(s=Math.sin(r),n=this.long0+i.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(r)),o=(0,t7.default)(n)):s-tG.EPSLN<tG.HALF_PI&&(o=this.long0),i.x=o,i.y=r,i},names:["Sinusoidal","sinu"]}),eC.Proj.projections.add({init:function(){},forward:function(i){for(var r=i.x,n=i.y,o=(0,t7.default)(r-this.long0),s=n,a=Math.PI*Math.sin(n);;){var l=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=l,Math.abs(l)<tG.EPSLN)break}s/=2,Math.PI/2-Math.abs(n)<tG.EPSLN&&(o=0);var u=.900316316158*this.a*o*Math.cos(s)+this.x0,h=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=u,i.y=h,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0,Math.abs(n=i.y/(1.4142135623731*this.a))>.999999999999&&(n=.999999999999),r=Math.asin(n);var r,n,o=(0,t7.default)(this.long0+i.x/(.900316316158*this.a*Math.cos(r)));o<-Math.PI&&(o=-Math.PI),o>Math.PI&&(o=Math.PI),Math.abs(n=(2*r+Math.sin(2*r))/Math.PI)>1&&(n=1);var s=Math.asin(n);return i.x=o,i.y=s,i},names:["Mollweide","moll"]}),eC.Proj.projections.add({init:function(){Math.abs(this.lat1+this.lat2)<tG.EPSLN||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=eX(this.es),this.e1=e$(this.es),this.e2=eW(this.es),this.e3=eH(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=(0,t9.default)(this.e,this.sinphi,this.cosphi),this.ml1=eZ(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<tG.EPSLN?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=(0,t9.default)(this.e,this.sinphi,this.cosphi),this.ml2=eZ(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=eZ(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(i){var r,n=i.x,o=i.y;if(this.sphere)r=this.a*(this.g-o);else{var s=eZ(this.e0,this.e1,this.e2,this.e3,o);r=this.a*(this.g-s)}var a=this.ns*(0,t7.default)(n-this.long0),l=this.x0+r*Math.sin(a),u=this.y0+this.rh-r*Math.cos(a);return i.x=l,i.y=u,i},inverse:function(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns>=0?(n=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(n=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1);var r,n,o,s,a=0;return(0!==n&&(a=Math.atan2(r*i.x,r*i.y)),this.sphere)?(s=(0,t7.default)(this.long0+a/this.ns),o=eK(this.g-n/this.a)):(o=eJ(this.g-n/this.a,this.e0,this.e1,this.e2,this.e3),s=(0,t7.default)(this.long0+a/this.ns)),i.x=s,i.y=o,i},names:["Equidistant_Conic","eqdc"]}),eC.Proj.projections.add({init:function(){this.R=this.a},forward:function(i){var r,n,o=i.x,s=i.y,a=(0,t7.default)(o-this.long0);Math.abs(s)<=tG.EPSLN&&(r=this.x0+this.R*a,n=this.y0);var l=(0,e1.default)(2*Math.abs(s/Math.PI));(Math.abs(a)<=tG.EPSLN||Math.abs(Math.abs(s)-tG.HALF_PI)<=tG.EPSLN)&&(r=this.x0,n=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+-(Math.PI*this.R*Math.tan(.5*l)));var u=.5*Math.abs(Math.PI/a-a/Math.PI),h=u*u,c=Math.sin(l),p=Math.cos(l),f=p/(c+p-1),d=f*(2/c-1),m=d*d,g=Math.PI*this.R*(u*(f-m)+Math.sqrt(h*(f-m)*(f-m)-(m+h)*(f*f-m)))/(m+h);a<0&&(g=-g),r=this.x0+g;var y=h+f;return g=Math.PI*this.R*(d*y-u*Math.sqrt((m+h)*(h+1)-y*y))/(m+h),n=s>=0?this.y0+g:this.y0-g,i.x=r,i.y=n,i},inverse:function(i){var r,n,o,s,a,l,u,h,c,p,f,d,m;return i.x-=this.x0,i.y-=this.y0,f=Math.PI*this.R,a=(o=i.x/f)*o+(s=i.y/f)*s,u=(l=-Math.abs(s)*(1+a))-2*s*s+o*o,h=-2*l+1+2*s*s+a*a,m=s*s/h+(2*u*u*u/h/h/h-9*l*u/h/h)/27,p=2*Math.sqrt(-(c=(l-u*u/3/h)/h)/3),Math.abs(f=3*m/c/p)>1&&(f=f>=0?1:-1),d=Math.acos(f)/3,n=i.y>=0?(-p*Math.cos(d+Math.PI/3)-u/3/h)*Math.PI:-(-p*Math.cos(d+Math.PI/3)-u/3/h)*Math.PI,r=Math.abs(o)<tG.EPSLN?this.long0:(0,t7.default)(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(o*o-s*s)+a*a))/2/o),i.x=r,i.y=n,i},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]}),eC.Proj.projections.add({init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(i){var r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S=i.x,M=i.y,T=Math.sin(i.y),C=Math.cos(i.y),P=(0,t7.default)(S-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=tG.EPSLN?(i.x=this.x0+this.a*(tG.HALF_PI-M)*Math.sin(P),i.y=this.y0-this.a*(tG.HALF_PI-M)*Math.cos(P)):Math.abs(this.sin_p12+1)<=tG.EPSLN?(i.x=this.x0+this.a*(tG.HALF_PI+M)*Math.sin(P),i.y=this.y0+this.a*(tG.HALF_PI+M)*Math.cos(P)):(v=(_=Math.acos(this.sin_p12*T+this.cos_p12*C*Math.cos(P)))?_/Math.sin(_):1,i.x=this.x0+this.a*v*C*Math.sin(P),i.y=this.y0+this.a*v*(this.cos_p12*T-this.sin_p12*C*Math.cos(P))):(r=eX(this.es),n=e$(this.es),o=eW(this.es),s=eH(this.es),Math.abs(this.sin_p12-1)<=tG.EPSLN)?(a=this.a*eZ(r,n,o,s,tG.HALF_PI),l=this.a*eZ(r,n,o,s,M),i.x=this.x0+(a-l)*Math.sin(P),i.y=this.y0-(a-l)*Math.cos(P)):Math.abs(this.sin_p12+1)<=tG.EPSLN?(a=this.a*eZ(r,n,o,s,tG.HALF_PI),l=this.a*eZ(r,n,o,s,M),i.x=this.x0+(a+l)*Math.sin(P),i.y=this.y0+(a+l)*Math.cos(P)):(u=T/C,h=eY(this.a,this.e,this.sin_p12),c=eY(this.a,this.e,T),p=Math.atan((1-this.es)*u+this.es*h*this.sin_p12/(c*C)),x=0===(f=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(p)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):Math.abs(Math.abs(f)-Math.PI)<=tG.EPSLN?-Math.asin(this.cos_p12*Math.sin(p)-this.sin_p12*Math.cos(p)):Math.asin(Math.sin(P)*Math.cos(p)/Math.sin(f)),g=(d=this.e*this.sin_p12/Math.sqrt(1-this.es))*(m=this.e*this.cos_p12*Math.cos(f)/Math.sqrt(1-this.es)),y=m*m,I=(E=(w=(b=x*x)*x)*x)*x,_=h*x*(1-b*y*(1-y)/6+w/8*g*(1-2*y)+E/120*(y*(4-7*y)-3*d*d*(1-7*y))-I/48*g),i.x=this.x0+_*Math.sin(f),i.y=this.y0+_*Math.cos(f)),i},inverse:function(i){var r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I;if(i.x-=this.x0,i.y-=this.y0,this.sphere){if((r=Math.sqrt(i.x*i.x+i.y*i.y))>2*tG.HALF_PI*this.a)return;return o=Math.sin(n=r/this.a),s=Math.cos(n),a=this.long0,Math.abs(r)<=tG.EPSLN?l=this.lat0:(l=(0,e1.default)(s*this.sin_p12+i.y*o*this.cos_p12/r),a=Math.abs(Math.abs(this.lat0)-tG.HALF_PI)<=tG.EPSLN?this.lat0>=0?(0,t7.default)(this.long0+Math.atan2(i.x,-i.y)):(0,t7.default)(this.long0-Math.atan2(-i.x,i.y)):(0,t7.default)(this.long0+Math.atan2(i.x*o,r*this.cos_p12*s-i.y*this.sin_p12*o))),i.x=a,i.y=l,i}return(u=eX(this.es),h=e$(this.es),c=eW(this.es),p=eH(this.es),Math.abs(this.sin_p12-1)<=tG.EPSLN)?(l=eJ(((f=this.a*eZ(u,h,c,p,tG.HALF_PI))-(r=Math.sqrt(i.x*i.x+i.y*i.y)))/this.a,u,h,c,p),a=(0,t7.default)(this.long0+Math.atan2(i.x,-1*i.y))):Math.abs(this.sin_p12+1)<=tG.EPSLN?(f=this.a*eZ(u,h,c,p,tG.HALF_PI),l=eJ(((r=Math.sqrt(i.x*i.x+i.y*i.y))-f)/this.a,u,h,c,p),a=(0,t7.default)(this.long0+Math.atan2(i.x,i.y))):(r=Math.sqrt(i.x*i.x+i.y*i.y),g=Math.atan2(i.x,i.y),d=eY(this.a,this.e,this.sin_p12),y=Math.cos(g),v=-(_=this.e*this.cos_p12*y)*_/(1-this.es),x=3*this.es*(1-v)*this.sin_p12*this.cos_p12*y/(1-this.es),w=(b=r/d)-v*(1+v)*Math.pow(b,3)/6-x*(1+3*v)*Math.pow(b,4)/24,E=1-v*w*w/2-b*w*w*w/6,m=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*y),a=(0,t7.default)(this.long0+Math.asin(Math.sin(g)*Math.sin(w)/Math.cos(m))),l=Math.atan2(((I=Math.sin(m))-this.es*E*this.sin_p12)*Math.tan(m),I*(1-this.es))),i.x=a,i.y=l,i},names:["Azimuthal_Equidistant","aeqd"]}),eC.Proj.projections.add({init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(i){var r,n,o,s,a,l,u,h=i.x,c=i.y;return o=(0,t7.default)(h-this.long0),r=Math.sin(c),n=Math.cos(c),s=Math.cos(o),((a=this.sin_p14*r+this.cos_p14*n*s)>0||Math.abs(a)<=tG.EPSLN)&&(l=+this.a*n*Math.sin(o),u=this.y0+ +this.a*(this.cos_p14*r-this.sin_p14*n*s)),i.x=l,i.y=u,i},inverse:function(i){var r,n,o,s,a,l;return(i.x-=this.x0,i.y-=this.y0,r=Math.sqrt(i.x*i.x+i.y*i.y),o=Math.sin(n=(0,e1.default)(r/this.a)),s=Math.cos(n),a=this.long0,Math.abs(r)<=tG.EPSLN)?l=this.lat0:(l=(0,e1.default)(s*this.sin_p14+i.y*o*this.cos_p14/r),a=Math.abs(Math.abs(this.lat0)-tG.HALF_PI)<=tG.EPSLN?this.lat0>=0?(0,t7.default)(this.long0+Math.atan2(i.x,-i.y)):(0,t7.default)(this.long0-Math.atan2(-i.x,i.y)):(0,t7.default)(this.long0+Math.atan2(i.x*o,r*this.cos_p14*s-i.y*this.sin_p14*o))),i.x=a,i.y=l,i},names:["ortho"]}),eC.Proj.projections.add({init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=tG.HALF_PI-tG.FORTPI/2?this.face=e8.TOP:this.lat0<=-(tG.HALF_PI-tG.FORTPI/2)?this.face=e8.BOTTOM:Math.abs(this.long0)<=tG.FORTPI?this.face=e8.FRONT:Math.abs(this.long0)<=tG.HALF_PI+tG.FORTPI?this.face=this.long0>0?e8.RIGHT:e8.LEFT:this.face=e8.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(i){var r,n,o,s,a,l,u,h,c,p,f,d={x:0,y:0},m={value:0};return(i.x-=this.long0,r=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(i.y)):i.y,n=i.x,this.face===e8.TOP)?(s=tG.HALF_PI-r,n>=tG.FORTPI&&n<=tG.HALF_PI+tG.FORTPI?(m.value=e9.AREA_0,o=n-tG.HALF_PI):n>tG.HALF_PI+tG.FORTPI||n<=-(tG.HALF_PI+tG.FORTPI)?(m.value=e9.AREA_1,o=n>0?n-tG.SPI:n+tG.SPI):n>-(tG.HALF_PI+tG.FORTPI)&&n<=-tG.FORTPI?(m.value=e9.AREA_2,o=n+tG.HALF_PI):(m.value=e9.AREA_3,o=n)):this.face===e8.BOTTOM?(s=tG.HALF_PI+r,n>=tG.FORTPI&&n<=tG.HALF_PI+tG.FORTPI?(m.value=e9.AREA_0,o=-n+tG.HALF_PI):n<tG.FORTPI&&n>=-tG.FORTPI?(m.value=e9.AREA_1,o=-n):n<-tG.FORTPI&&n>=-(tG.HALF_PI+tG.FORTPI)?(m.value=e9.AREA_2,o=-n-tG.HALF_PI):(m.value=e9.AREA_3,o=n>0?-n+tG.SPI:-n-tG.SPI)):(this.face===e8.RIGHT?n=it(n,+tG.HALF_PI):this.face===e8.BACK?n=it(n,+tG.SPI):this.face===e8.LEFT&&(n=it(n,-tG.HALF_PI)),c=Math.sin(r),p=Math.cos(r),f=Math.sin(n),u=p*Math.cos(n),h=p*f,this.face===e8.FRONT?o=e7(s=Math.acos(u),c,h,m):this.face===e8.RIGHT?o=e7(s=Math.acos(h),c,-u,m):this.face===e8.BACK?o=e7(s=Math.acos(-u),c,-h,m):this.face===e8.LEFT?o=e7(s=Math.acos(-h),c,u,m):(s=o=0,m.value=e9.AREA_0)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(l=Math.atan(12/tG.SPI*(o+Math.acos(Math.sin(o)*Math.cos(tG.FORTPI))-tG.HALF_PI)))*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(o))))),m.value===e9.AREA_1?l+=tG.HALF_PI:m.value===e9.AREA_2?l+=tG.SPI:m.value===e9.AREA_3&&(l+=1.5*tG.SPI),d.x=a*Math.cos(l),d.y=a*Math.sin(l),d.x=d.x*this.a+this.x0,d.y=d.y*this.a+this.y0,i.x=d.x,i.y=d.y,i},inverse:function(i){var r,n,o,s,a,l,u,h,c,p,f,d,m,g,y={lam:0,phi:0},_={value:0};return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,n=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),r=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?_.value=e9.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(_.value=e9.AREA_1,r-=tG.HALF_PI):i.x<0&&-i.x>=Math.abs(i.y)?(_.value=e9.AREA_2,r=r<0?r+tG.SPI:r-tG.SPI):(_.value=e9.AREA_3,r+=tG.HALF_PI),a=Math.atan(Math.sin(h=tG.SPI/12*Math.tan(r))/(Math.cos(h)-1/Math.sqrt(2))),(l=1-(o=Math.cos(r))*o*(s=Math.tan(n))*s*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?l=-1:l>1&&(l=1),this.face===e8.TOP?(u=Math.acos(l),y.phi=tG.HALF_PI-u,_.value===e9.AREA_0?y.lam=a+tG.HALF_PI:_.value===e9.AREA_1?y.lam=a<0?a+tG.SPI:a-tG.SPI:_.value===e9.AREA_2?y.lam=a-tG.HALF_PI:y.lam=a):this.face===e8.BOTTOM?(u=Math.acos(l),y.phi=u-tG.HALF_PI,_.value===e9.AREA_0?y.lam=-a+tG.HALF_PI:_.value===e9.AREA_1?y.lam=-a:_.value===e9.AREA_2?y.lam=-a-tG.HALF_PI:y.lam=a<0?-a-tG.SPI:-a+tG.SPI):(f=(h=(c=l)*c)>=1?0:Math.sqrt(1-h)*Math.sin(a),h+=f*f,p=h>=1?0:Math.sqrt(1-h),_.value===e9.AREA_1?(h=p,p=-f,f=h):_.value===e9.AREA_2?(p=-p,f=-f):_.value===e9.AREA_3&&(h=p,p=f,f=-h),this.face===e8.RIGHT?(h=c,c=-p,p=h):this.face===e8.BACK?(c=-c,p=-p):this.face===e8.LEFT&&(h=c,c=p,p=-h),y.phi=Math.acos(-f)-tG.HALF_PI,y.lam=Math.atan2(p,c),this.face===e8.RIGHT?y.lam=it(y.lam,-tG.HALF_PI):this.face===e8.BACK?y.lam=it(y.lam,-tG.SPI):this.face===e8.LEFT&&(y.lam=it(y.lam,+tG.HALF_PI))),0!==this.es&&(d=+(y.phi<0),m=Math.tan(y.phi),g=this.b/Math.sqrt(m*m+this.one_minus_f_squared),y.phi=Math.atan(Math.sqrt(this.a*this.a-g*g)/(this.one_minus_f*g)),d&&(y.phi=-y.phi)),y.lam+=this.long0,i.x=y.lam,i.y=y.phi,i},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]}),eC.Proj.projections.add({init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(i){var r=(0,t7.default)(i.x-this.long0),n=Math.abs(i.y),o=Math.floor(n*ir);o<0?o=0:o>=18&&(o=17),n=tG.R2D*(n-io*o);var s={x:is(ie[o],n)*r,y:is(ii[o],n)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*.8487+this.x0,s.y=s.y*this.a*1.3523+this.y0,s},inverse:function(i){var r={x:(i.x-this.x0)/(.8487*this.a),y:Math.abs(i.y-this.y0)/(1.3523*this.a)};if(r.y>=1)r.x/=ie[18][0],r.y=i.y<0?-tG.HALF_PI:tG.HALF_PI;else{var n=Math.floor(18*r.y);for(n<0?n=0:n>=18&&(n=17);;)if(ii[n][0]>r.y)--n;else if(ii[n+1][0]<=r.y)++n;else break;var o=ii[n],s=5*(r.y-o[0])/(ii[n+1][0]-o[0]);s=function(i,r,n,o){for(var s=r;o;--o){var a=i(s);if(s-=a,Math.abs(a)<n)break}return s}(function(i){return(is(o,i)-r.y)/(o[1]+i*(2*o[2]+3*i*o[3]))},s,tG.EPSLN,100),r.x/=is(ie[n],s),r.y=(5*n+s)*tG.D2R,i.y<0&&(r.y=-r.y)}return r.x=(0,t7.default)(r.x+this.long0),r},names:["Robinson","robin"]}),eC.Proj.projections.add({init:function(){this.name="geocent"},forward:function(i){return eg(i,this.es,this.a)},inverse:function(i){return ey(i,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]}),eC.Proj.projections.add({init:function(){if(Object.keys(iu).forEach((function(i){if(void 0===this[i])this[i]=iu[i].def;else if(iu[i].num&&isNaN(this[i]))throw Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);else iu[i].num&&(this[i]=parseFloat(this[i]));iu[i].degrees&&(this[i]=this[i]*tG.D2R)}).bind(this)),Math.abs(Math.abs(this.lat0)-tG.HALF_PI)<tG.EPSLN?this.mode=this.lat0<0?il.S_POLE:il.N_POLE:Math.abs(this.lat0)<tG.EPSLN?this.mode=il.EQUIT:(this.mode=il.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,r=this.azi;this.cg=Math.cos(r),this.sg=Math.sin(r),this.cw=Math.cos(i),this.sw=Math.sin(i)},forward:function(i){i.x-=this.long0;var r,n,o,s,a=Math.sin(i.y),l=Math.cos(i.y),u=Math.cos(i.x);switch(this.mode){case il.OBLIQ:n=this.sinph0*a+this.cosph0*l*u;break;case il.EQUIT:n=l*u;break;case il.S_POLE:n=-a;break;case il.N_POLE:n=a}switch(r=(n=this.pn1/(this.p-n))*l*Math.sin(i.x),this.mode){case il.OBLIQ:n*=this.cosph0*a-this.sinph0*l*u;break;case il.EQUIT:n*=a;break;case il.N_POLE:n*=-(l*u);break;case il.S_POLE:n*=l*u}return s=1/((o=n*this.cg+r*this.sg)*this.sw*this.h1+this.cw),r=(r*this.cg-n*this.sg)*this.cw*s,n=o*s,i.x=r*this.a,i.y=n*this.a,i},inverse:function(i){i.x/=this.a,i.y/=this.a;var r,n,o,s,a,l={x:i.x,y:i.y};o=1/(this.pn1-i.y*this.sw),r=this.pn1*i.x*o,n=this.pn1*i.y*this.cw*o,i.x=r*this.cg+n*this.sg,i.y=n*this.cg-r*this.sg;var u=(0,ia.default)(i.x,i.y);if(Math.abs(u)<tG.EPSLN)l.x=0,l.y=i.y;else{switch(a=1-u*u*this.pfact,s=Math.sqrt(1-(a=(this.p-Math.sqrt(a))/(this.pn1/u+u/this.pn1))*a),this.mode){case il.OBLIQ:l.y=Math.asin(s*this.sinph0+i.y*a*this.cosph0/u),i.y=(s-this.sinph0*Math.sin(l.y))*u,i.x*=a*this.cosph0;break;case il.EQUIT:l.y=Math.asin(i.y*a/u),i.y=s*u,i.x*=a;break;case il.N_POLE:l.y=Math.asin(s),i.y=-i.y;break;case il.S_POLE:l.y=-Math.asin(s)}l.x=Math.atan2(i.x,i.y)}return i.x=l.x+this.long0,i.y=l.y,i},names:["Tilted_Perspective","tpers"]}),tU={detectCrs:ip,reproject:im,reverse:function(i){return ic(function(i){i.coordinates=ih(i.coordinates,function(i){return[i[1],i[0]]})},null,i)},toWgs84:function(i,r,n){return im(i,r,eC.WGS84,n)}};var ig={};!function(i){var r,n,o,s,a={centimeters:0x25f96350,centimetres:0x25f96350,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999},l={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:15696101377226164e-23,yards:1.0936133},u={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function h(i,r,n){void 0===n&&(n={});var o={type:"Feature"};return(0===n.id||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=r||{},o.geometry=i,o}function c(i,r,n){switch(i){case"Point":return p(r).geometry;case"LineString":return g(r).geometry;case"Polygon":return d(r).geometry;case"MultiPoint":return x(r).geometry;case"MultiLineString":return v(r).geometry;case"MultiPolygon":return b(r).geometry;default:throw Error(i+" is invalid")}}function p(i,r,n){if(void 0===n&&(n={}),!i)throw Error("coordinates is required");if(!Array.isArray(i))throw Error("coordinates must be an Array");if(i.length<2)throw Error("coordinates must be at least 2 numbers long");if(!k(i[0])||!k(i[1]))throw Error("coordinates must contain numbers");return h({type:"Point",coordinates:i},r,n)}function f(i,r,n){return void 0===n&&(n={}),_(i.map(function(i){return p(i,r)}),n)}function d(i,r,n){void 0===n&&(n={});for(var o=0;o<i.length;o++){var s=i[o];if(s.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw Error("First and last Position are not equivalent.")}return h({type:"Polygon",coordinates:i},r,n)}function m(i,r,n){return void 0===n&&(n={}),_(i.map(function(i){return d(i,r)}),n)}function g(i,r,n){if(void 0===n&&(n={}),i.length<2)throw Error("coordinates must be an array of two or more positions");return h({type:"LineString",coordinates:i},r,n)}function y(i,r,n){return void 0===n&&(n={}),_(i.map(function(i){return g(i,r)}),n)}function _(i,r){void 0===r&&(r={});var n={type:"FeatureCollection"};return r.id&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.features=i,n}function v(i,r,n){return void 0===n&&(n={}),h({type:"MultiLineString",coordinates:i},r,n)}function x(i,r,n){return void 0===n&&(n={}),h({type:"MultiPoint",coordinates:i},r,n)}function b(i,r,n){return void 0===n&&(n={}),h({type:"MultiPolygon",coordinates:i},r,n)}function w(i,r,n){return void 0===n&&(n={}),h({type:"GeometryCollection",geometries:i},r,n)}function E(i,r){if(void 0===r&&(r=0),r&&!(r>=0))throw Error("precision must be a positive number");var n=Math.pow(10,r||0);return Math.round(i*n)/n}function I(i,r){void 0===r&&(r="kilometers");var n=a[r];if(!n)throw Error(r+" units is invalid");return i*n}function S(i,r){void 0===r&&(r="kilometers");var n=a[r];if(!n)throw Error(r+" units is invalid");return i/n}function M(i,r){return C(S(i,r))}function T(i){var r=i%360;return r<0&&(r+=360),r}function C(i){return i%(2*Math.PI)*180/Math.PI}function P(i){return i%360*Math.PI/180}function A(i,r,n){if(void 0===r&&(r="kilometers"),void 0===n&&(n="kilometers"),!(i>=0))throw Error("length must be a positive number");return I(S(i,r),n)}function L(i,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(i>=0))throw Error("area must be a positive number");var o=u[r];if(!o)throw Error("invalid original units");var s=u[n];if(!s)throw Error("invalid final units");return i/o*s}function k(i){return!isNaN(i)&&null!==i&&!Array.isArray(i)}function R(i){return!!i&&i.constructor===Object}function D(i){if(!i)throw Error("bbox is required");if(!Array.isArray(i))throw Error("bbox must be an Array");if(4!==i.length&&6!==i.length)throw Error("bbox must be an Array of 4 or 6 numbers");i.forEach(function(i){if(!k(i))throw Error("bbox must only contain numbers")})}function N(i){if(!i)throw Error("id is required");if(-1===["string","number"].indexOf(typeof i))throw Error("id must be a number or a string")}var O=Object.freeze({__proto__:null,earthRadius:6371008.8,factors:a,unitsFactors:l,areaFactors:u,feature:h,geometry:c,point:p,points:f,polygon:d,polygons:m,lineString:g,lineStrings:y,featureCollection:_,multiLineString:v,multiPoint:x,multiPolygon:b,geometryCollection:w,round:E,radiansToLength:I,lengthToRadians:S,lengthToDegrees:M,bearingToAzimuth:T,radiansToDegrees:C,degreesToRadians:P,convertLength:A,convertArea:L,isNumber:k,isObject:R,validateBBox:D,validateId:N});function z(i,r,n){if(null!==i)for(var o,s,a,l,u,h,c,p,f=0,d=0,m=i.type,g="FeatureCollection"===m,y="Feature"===m,_=g?i.features.length:1,v=0;v<_;v++){u=(p=!!(c=g?i.features[v].geometry:y?i.geometry:i)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var x=0;x<u;x++){var b=0,w=0;if(null!==(l=p?c.geometries[x]:c)){h=l.coordinates;var E=l.type;switch(f=n&&("Polygon"===E||"MultiPolygon"===E)?1:0,E){case null:break;case"Point":if(!1===r(h,d,v,b,w))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(o=0;o<h.length;o++){if(!1===r(h[o],d,v,b,w))return!1;d++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(o=0;o<h.length;o++){for(s=0;s<h[o].length-f;s++){if(!1===r(h[o][s],d,v,b,w))return!1;d++}"MultiLineString"===E&&b++,"Polygon"===E&&w++}"Polygon"===E&&b++;break;case"MultiPolygon":for(o=0;o<h.length;o++){for(w=0,s=0;s<h[o].length;s++){for(a=0;a<h[o][s].length-f;a++){if(!1===r(h[o][s][a],d,v,b,w))return!1;d++}w++}b++}break;case"GeometryCollection":for(o=0;o<l.geometries.length;o++)if(!1===z(l.geometries[o],r,n))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function F(i,r,n,o){var s=n;return z(i,function(i,o,a,l,u){s=0===o&&void 0===n?i:r(s,i,o,a,l,u)},o),s}function B(i,r){var n;switch(i.type){case"FeatureCollection":for(n=0;n<i.features.length&&!1!==r(i.features[n].properties,n);n++);break;case"Feature":r(i.properties,0)}}function U(i,r,n){var o=n;return B(i,function(i,s){o=0===s&&void 0===n?i:r(o,i,s)}),o}function G(i,r){if("Feature"===i.type)r(i,0);else if("FeatureCollection"===i.type)for(var n=0;n<i.features.length&&!1!==r(i.features[n],n);n++);}function V(i,r,n){var o=n;return G(i,function(i,s){o=0===s&&void 0===n?i:r(o,i,s)}),o}function q(i){var r=[];return z(i,function(i){r.push(i)}),r}function j(i,r){var n,o,s,a,l,u,h,c,p,f,d=0,m="FeatureCollection"===i.type,g="Feature"===i.type,y=m?i.features.length:1;for(n=0;n<y;n++){for(u=m?i.features[n].geometry:g?i.geometry:i,c=m?i.features[n].properties:g?i.properties:{},p=m?i.features[n].bbox:g?i.bbox:void 0,f=m?i.features[n].id:g?i.id:void 0,l=(h=!!u&&"GeometryCollection"===u.type)?u.geometries.length:1,s=0;s<l;s++)if(null!==(a=h?u.geometries[s]:u))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===r(a,d,c,p,f))return!1;break;case"GeometryCollection":for(o=0;o<a.geometries.length;o++)if(!1===r(a.geometries[o],d,c,p,f))return!1;break;default:throw Error("Unknown Geometry Type")}else if(!1===r(null,d,c,p,f))return!1;d++}}function Z(i,r,n){var o=n;return j(i,function(i,s,a,l,u){o=0===s&&void 0===n?i:r(o,i,s,a,l,u)}),o}function X(i,r){j(i,function(i,n,o,s,a){var l,u=null===i?null:i.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==r(h(i,o,{bbox:s,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon"}for(var c=0;c<i.coordinates.length;c++)if(!1===r(h({type:l,coordinates:i.coordinates[c]},o),n,c))return!1})}function $(i,r,n){var o=n;return X(i,function(i,s,a){o=0===s&&0===a&&void 0===n?i:r(o,i,s,a)}),o}function W(i,r){X(i,function(i,n,o){var s=0;if(i.geometry){var a=i.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var l,u=0,h=0,c=0;return!1!==z(i,function(a,p,f,d,m){return void 0===l||n>u||d>h||m>c?(l=a,u=n,h=d,c=m,void(s=0)):!1!==r(g([l,a],i.properties),n,o,m,s)&&void(s++,l=a)})&&void 0}}})}function H(i,r,n){var o=n,s=!1;return W(i,function(i,a,l,u,h){o=!1===s&&void 0===n?i:r(o,i,a,l,u,h),s=!0}),o}function Y(i,r){if(!i)throw Error("geojson is required");X(i,function(i,n,o){if(null!==i.geometry){var s=i.geometry.type,a=i.geometry.coordinates;switch(s){case"LineString":if(!1===r(i,n,o,0,0))return!1;break;case"Polygon":for(var l=0;l<a.length;l++)if(!1===r(g(a[l],i.properties),n,o,l))return!1}}})}function K(i,r,n){var o=n;return Y(i,function(i,s,a,l){o=0===s&&void 0===n?i:r(o,i,s,a,l)}),o}function J(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n,o=r.featureIndex||0,s=r.multiFeatureIndex||0,a=r.geometryIndex||0,l=r.segmentIndex||0,u=r.properties;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),u=u||i.features[o].properties,n=i.features[o].geometry;break;case"Feature":u=u||i.properties,n=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=i;break;default:throw Error("geojson is invalid")}if(null===n)return null;var h=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=h.length+l-1),g([h[l],h[l+1]],u,r);case"Polygon":return a<0&&(a=h.length+a),l<0&&(l=h[a].length+l-1),g([h[a][l],h[a][l+1]],u,r);case"MultiLineString":return s<0&&(s=h.length+s),l<0&&(l=h[s].length+l-1),g([h[s][l],h[s][l+1]],u,r);case"MultiPolygon":return s<0&&(s=h.length+s),a<0&&(a=h[s].length+a),l<0&&(l=h[s][a].length-l-1),g([h[s][a][l],h[s][a][l+1]],u,r)}throw Error("geojson is invalid")}function Q(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n,o=r.featureIndex||0,s=r.multiFeatureIndex||0,a=r.geometryIndex||0,l=r.coordIndex||0,u=r.properties;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),u=u||i.features[o].properties,n=i.features[o].geometry;break;case"Feature":u=u||i.properties,n=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=i;break;default:throw Error("geojson is invalid")}if(null===n)return null;var h=n.coordinates;switch(n.type){case"Point":return p(h,u,r);case"MultiPoint":return s<0&&(s=h.length+s),p(h[s],u,r);case"LineString":return l<0&&(l=h.length+l),p(h[l],u,r);case"Polygon":return a<0&&(a=h.length+a),l<0&&(l=h[a].length+l),p(h[a][l],u,r);case"MultiLineString":return s<0&&(s=h.length+s),l<0&&(l=h[s].length+l),p(h[s][l],u,r);case"MultiPolygon":return s<0&&(s=h.length+s),a<0&&(a=h[s].length+a),l<0&&(l=h[s][a].length-l),p(h[s][a][l],u,r)}throw Error("geojson is invalid")}var tt=Object.freeze({__proto__:null,coordAll:q,coordEach:z,coordReduce:F,featureEach:G,featureReduce:V,findPoint:Q,findSegment:J,flattenEach:X,flattenReduce:$,geomEach:j,geomReduce:Z,lineEach:Y,lineReduce:K,propEach:B,propReduce:U,segmentEach:W,segmentReduce:H});function te(i){var r=[1/0,1/0,-1/0,-1/0];return z(i,function(i){r[0]>i[0]&&(r[0]=i[0]),r[1]>i[1]&&(r[1]=i[1]),r[2]<i[0]&&(r[2]=i[0]),r[3]<i[1]&&(r[3]=i[1])}),r}function ti(i){if(!i)throw Error("coord is required");if(!Array.isArray(i)){if("Feature"===i.type&&null!==i.geometry&&"Point"===i.geometry.type)return i.geometry.coordinates;if("Point"===i.type)return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw Error("coord must be GeoJSON Point or an Array of numbers")}function tr(i){if(Array.isArray(i))return i;if("Feature"===i.type){if(null!==i.geometry)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function tn(i){if(i.length>1&&k(i[0])&&k(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return tn(i[0]);throw Error("coordinates must only contain numbers")}function to(i,r,n){if(!r||!n)throw Error("type and name required");if(!i||i.type!==r)throw Error("Invalid input to "+n+": must be a "+r+", given "+i.type)}function ts(i,r,n){if(!i)throw Error("No feature passed");if(!n)throw Error(".featureOf() requires a name");if(!i||"Feature"!==i.type||!i.geometry)throw Error("Invalid input to "+n+", Feature with geometry required");if(!i.geometry||i.geometry.type!==r)throw Error("Invalid input to "+n+": must be a "+r+", given "+i.geometry.type)}function ta(i,r,n){if(!i)throw Error("No featureCollection passed");if(!n)throw Error(".collectionOf() requires a name");if(!i||"FeatureCollection"!==i.type)throw Error("Invalid input to "+n+", FeatureCollection required");for(var o=0,s=i.features;o<s.length;o++){var a=s[o];if(!a||"Feature"!==a.type||!a.geometry)throw Error("Invalid input to "+n+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw Error("Invalid input to "+n+": must be a "+r+", given "+a.geometry.type)}}function tl(i){return"Feature"===i.type?i.geometry:i}function tu(i,r){return"FeatureCollection"===i.type?"FeatureCollection":"GeometryCollection"===i.type?"GeometryCollection":"Feature"===i.type&&null!==i.geometry?i.geometry.type:i.type}te.default=te;var th=Object.freeze({__proto__:null,getCoord:ti,getCoords:tr,containsNumber:tn,geojsonType:to,featureOf:ts,collectionOf:ta,getGeom:tl,getType:tu}),tc=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,tf=Object.prototype.propertyIsEnumerable,td=!function(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de","5"===Object.getOwnPropertyNames(i)[0])return!1;for(var r={},n=0;n<10;n++)r["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(r).map(function(i){return r[i]}).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(i){o[i]=i}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(i){return!1}}()?function(i,r){for(var n,o,s=/*
    object-assign
    (c) Sindre Sorhus
    @license MIT
    */function(i){if(null==i)throw TypeError("Object.assign cannot be called with null or undefined");return Object(i)}(i),a=1;a<arguments.length;a++){for(var l in n=Object(arguments[a]))tp.call(n,l)&&(s[l]=n[l]);if(tc){o=tc(n);for(var u=0;u<o.length;u++)tf.call(n,o[u])&&(s[o[u]]=n[o[u]])}}return s}:Object.assign,tm={successCallback:null,verbose:!1},tg={};function ty(i){return 0===i.cval||15===i.cval}function t_(i){ty(i)||5===i.cval||10===i.cval||(i.cval=15)}function tv(i,r){return"top"===r?[i.top,1]:"bottom"===r?[i.bottom,0]:"right"===r?[1,i.right]:"left"===r?[0,i.left]:void 0}var tx=tb;function tb(i,r,n,o,s){!function i(r,n,o,s,a){for(;s>o;){if(s-o>600){var l=s-o+1,u=n-o+1,h=Math.log(l),c=.5*Math.exp(2*h/3),p=.5*Math.sqrt(h*c*(l-c)/l)*(u-l/2<0?-1:1);i(r,n,Math.max(o,Math.floor(n-u*c/l+p)),Math.min(s,Math.floor(n+(l-u)*c/l+p)),a)}var f=r[n],d=o,m=s;for(tw(r,o,n),a(r[s],f)>0&&tw(r,o,s);d<m;){for(tw(r,d,m),d++,m--;0>a(r[d],f);)d++;for(;a(r[m],f)>0;)m--}0===a(r[o],f)?tw(r,o,m):tw(r,++m,s),m<=n&&(o=m+1),n<=m&&(s=m-1)}}(i,r,n||0,o||i.length-1,s||tE)}function tw(i,r,n){var o=i[r];i[r]=i[n],i[n]=o}function tE(i,r){return i<r?-1:+(i>r)}tx.default=tb;var tI=tS;function tS(i,r){if(!(this instanceof tS))return new tS(i,r);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),r&&this._initFormat(r),this.clear()}function tM(i,r){tT(i,0,i.children.length,r,i)}function tT(i,r,n,o,s){s||(s=tN(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,l=r;l<n;l++)a=i.children[l],tC(s,i.leaf?o(a):a);return s}function tC(i,r){return i.minX=Math.min(i.minX,r.minX),i.minY=Math.min(i.minY,r.minY),i.maxX=Math.max(i.maxX,r.maxX),i.maxY=Math.max(i.maxY,r.maxY),i}function tP(i,r){return i.minX-r.minX}function tA(i,r){return i.minY-r.minY}function tL(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function tk(i){return i.maxX-i.minX+(i.maxY-i.minY)}function tR(i,r){return i.minX<=r.minX&&i.minY<=r.minY&&r.maxX<=i.maxX&&r.maxY<=i.maxY}function tD(i,r){return r.minX<=i.maxX&&r.minY<=i.maxY&&r.maxX>=i.minX&&r.maxY>=i.minY}function tN(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function tO(i,r,n,o,s){for(var a,l=[r,n];l.length;)(n=l.pop())-(r=l.pop())<=o||(tx(i,a=r+Math.ceil((n-r)/o/2)*o,r,n,s),l.push(r,a,a,n))}function tz(i){var r={exports:{}};return i(r,r.exports),r.exports}tS.prototype={all:function(){return this._all(this.data,[])},search:function(i){var r=this.data,n=[],o=this.toBBox;if(!tD(i,r))return n;for(var s,a,l,u,h=[];r;){for(s=0,a=r.children.length;s<a;s++)l=r.children[s],tD(i,u=r.leaf?o(l):l)&&(r.leaf?n.push(l):tR(i,u)?this._all(l,n):h.push(l));r=h.pop()}return n},collides:function(i){var r=this.data,n=this.toBBox;if(!tD(i,r))return!1;for(var o,s,a,l,u=[];r;){for(o=0,s=r.children.length;o<s;o++)if(a=r.children[o],tD(i,l=r.leaf?n(a):a)){if(r.leaf||tR(i,l))return!0;u.push(a)}r=u.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var r=0,n=i.length;r<n;r++)this.insert(i[r]);return this}var o=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length){if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var s=this.data;this.data=o,o=s}this._insert(o,this.data.height-o.height-1,!0)}}else this.data=o;return this},insert:function(i){return i&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=tN([]),this},remove:function(i,r){if(!i)return this;for(var n,o,s,a,l=this.data,u=this.toBBox(i),h=[],c=[];l||h.length;){if(l||(l=h.pop(),o=h[h.length-1],n=c.pop(),a=!0),l.leaf&&-1!==(s=function(i,r,n){if(!n)return r.indexOf(i);for(var o=0;o<r.length;o++)if(n(i,r[o]))return o;return -1}(i,l.children,r)))return l.children.splice(s,1),h.push(l),this._condense(h),this;a||l.leaf||!tR(l,u)?o?(n++,l=o.children[n],a=!1):l=null:(h.push(l),c.push(n),n=0,o=l,l=l.children[0])}return this},toBBox:function(i){return i},compareMinX:tP,compareMinY:tA,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,r){for(var n=[];i;)i.leaf?r.push.apply(r,i.children):n.push.apply(n,i.children),i=n.pop();return r},_build:function(i,r,n,o){var s,a=n-r+1,l=this._maxEntries;if(a<=l)return tM(s=tN(i.slice(r,n+1)),this.toBBox),s;o||(o=Math.ceil(Math.log(a)/Math.log(l)),l=Math.ceil(a/Math.pow(l,o-1))),(s=tN([])).leaf=!1,s.height=o;var u,h,c,p,f=Math.ceil(a/l),d=f*Math.ceil(Math.sqrt(l));for(tO(i,r,n,d,this.compareMinX),u=r;u<=n;u+=d)for(tO(i,u,c=Math.min(u+d-1,n),f,this.compareMinY),h=u;h<=c;h+=f)p=Math.min(h+f-1,c),s.children.push(this._build(i,h,p,o-1));return tM(s,this.toBBox),s},_chooseSubtree:function(i,r,n,o){for(var s,a,l,u,h,c,p,f;o.push(r),!r.leaf&&o.length-1!==n;){for(p=f=1/0,s=0,a=r.children.length;s<a;s++)h=tL(l=r.children[s]),(c=(Math.max(l.maxX,i.maxX)-Math.min(l.minX,i.minX))*(Math.max(l.maxY,i.maxY)-Math.min(l.minY,i.minY))-h)<f?(f=c,p=h<p?h:p,u=l):c===f&&h<p&&(p=h,u=l);r=u||r.children[0]}return r},_insert:function(i,r,n){var o=this.toBBox,s=n?i:o(i),a=[],l=this._chooseSubtree(s,this.data,r,a);for(l.children.push(i),tC(l,s);r>=0&&a[r].children.length>this._maxEntries;)this._split(a,r),r--;this._adjustParentBBoxes(s,a,r)},_split:function(i,r){var n=i[r],o=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,o);var a=this._chooseSplitIndex(n,s,o),l=tN(n.children.splice(a,n.children.length-a));l.height=n.height,l.leaf=n.leaf,tM(n,this.toBBox),tM(l,this.toBBox),r?i[r-1].children.push(l):this._splitRoot(n,l)},_splitRoot:function(i,r){this.data=tN([i,r]),this.data.height=i.height+1,this.data.leaf=!1,tM(this.data,this.toBBox)},_chooseSplitIndex:function(i,r,n){var o,s,a,l,u,h,c,p,f,d,m;for(h=c=1/0,o=r;o<=n-r;o++)s=tT(i,0,o,this.toBBox),a=tT(i,o,n,this.toBBox),f=void 0,d=void 0,f=Math.max(s.minX,a.minX),d=Math.max(s.minY,a.minY),l=Math.max(0,Math.min(s.maxX,a.maxX)-f)*Math.max(0,Math.min(s.maxY,a.maxY)-d),u=tL(s)+tL(a),l<h?(h=l,p=o,c=u<c?u:c):l===h&&u<c&&(c=u,p=o);return p},_chooseSplitAxis:function(i,r,n){var o=i.leaf?this.compareMinX:tP,s=i.leaf?this.compareMinY:tA;this._allDistMargin(i,r,n,o)<this._allDistMargin(i,r,n,s)&&i.children.sort(o)},_allDistMargin:function(i,r,n,o){i.children.sort(o);var s,a,l=this.toBBox,u=tT(i,0,r,l),h=tT(i,n-r,n,l),c=tk(u)+tk(h);for(s=r;s<n-r;s++)a=i.children[s],tC(u,i.leaf?l(a):a),c+=tk(u);for(s=n-r-1;s>=r;s--)a=i.children[s],tC(h,i.leaf?l(a):a),c+=tk(h);return c},_adjustParentBBoxes:function(i,r,n){for(var o=n;o>=0;o--)tC(r[o],i)},_condense:function(i){for(var r,n=i.length-1;n>=0;n--)0===i[n].children.length?n>0?(r=i[n-1].children).splice(r.indexOf(i[n]),1):this.clear():tM(i[n],this.toBBox)},_initFormat:function(i){var r=["return a"," - b",";"];this.compareMinX=Function("a","b",r.join(i[0])),this.compareMinY=Function("a","b",r.join(i[1])),this.toBBox=Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}},tI.default=tS;var tF=function(i,r,n){var o=i*r,s=tB*i,a=s-(s-i),l=i-a,u=tB*r,h=u-(u-r),c=r-h,p=l*c-(o-a*h-l*h-a*c);return n?(n[0]=p,n[1]=o,n):[p,o]},tB=0x8000001,tU=function(i,r){var n=0|i.length,o=0|r.length;if(1===n&&1===o)return u=(l=(s=i[0])+(a=r[0]))-s,(h=s-(l-u)+(a-u))?[h,l]:[l];var s,a,l,u,h,c,p,f=Array(n+o),d=0,m=0,g=0,y=Math.abs,_=i[0],v=y(_),x=r[g],b=y(x);v<b?(p=_,(m+=1)<n&&(v=y(_=i[m]))):(p=x,(g+=1)<o&&(b=y(x=r[g]))),m<n&&v<b||g>=o?(c=_,(m+=1)<n&&(v=y(_=i[m]))):(c=x,(g+=1)<o&&(b=y(x=r[g])));for(var w,E,I=c+p,S=I-c,M=p-S,T=M,C=I;m<n&&g<o;)v<b?(c=_,(m+=1)<n&&(v=y(_=i[m]))):(c=x,(g+=1)<o&&(b=y(x=r[g]))),(M=(p=T)-(S=(I=c+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w;for(;m<n;)(M=(p=T)-(S=(I=(c=_)+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w,(m+=1)<n&&(_=i[m]);for(;g<o;)(M=(p=T)-(S=(I=(c=x)+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w,(g+=1)<o&&(x=r[g]);return T&&(f[d++]=T),C&&(f[d++]=C),d||(f[d++]=0),f.length=d,f},tG=function(i,r,n){var o=i+r,s=o-i,a=r-s,l=i-(o-s);return n?(n[0]=l+a,n[1]=o,n):[l+a,o]},tV=function(i,r){var n=i.length;if(1===n){var o=tF(i[0],r);return o[0]?o:[o[1]]}var s=Array(2*n),a=[.1,.1],l=[.1,.1],u=0;tF(i[0],r,a),a[0]&&(s[u++]=a[0]);for(var h=1;h<n;++h){tF(i[h],r,l),tG(a[1],l[0],a),a[0]&&(s[u++]=a[0]);var c=l[1],p=a[1],f=c+p,d=p-(f-c);a[1]=f,d&&(s[u++]=d)}return a[1]&&(s[u++]=a[1]),0===u&&(s[u++]=0),s.length=u,s},tq=function(i,r){var n=0|i.length,o=0|r.length;if(1===n&&1===o)return u=(l=(s=i[0])+(a=-r[0]))-s,(h=s-(l-u)+(a-u))?[h,l]:[l];var s,a,l,u,h,c,p,f=Array(n+o),d=0,m=0,g=0,y=Math.abs,_=i[0],v=y(_),x=-r[g],b=y(x);v<b?(p=_,(m+=1)<n&&(v=y(_=i[m]))):(p=x,(g+=1)<o&&(b=y(x=-r[g]))),m<n&&v<b||g>=o?(c=_,(m+=1)<n&&(v=y(_=i[m]))):(c=x,(g+=1)<o&&(b=y(x=-r[g])));for(var w,E,I=c+p,S=I-c,M=p-S,T=M,C=I;m<n&&g<o;)v<b?(c=_,(m+=1)<n&&(v=y(_=i[m]))):(c=x,(g+=1)<o&&(b=y(x=-r[g]))),(M=(p=T)-(S=(I=c+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w;for(;m<n;)(M=(p=T)-(S=(I=(c=_)+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w,(m+=1)<n&&(_=i[m]);for(;g<o;)(M=(p=T)-(S=(I=(c=x)+p)-c))&&(f[d++]=M),T=C-((w=C+I)-(E=w-C))+(I-E),C=w,(g+=1)<o&&(x=-r[g]);return T&&(f[d++]=T),C&&(f[d++]=C),d||(f[d++]=0),f.length=d,f},tj=tz(function(i){function r(i,r){for(var n=Array(i.length-1),o=1;o<i.length;++o)for(var s=n[o-1]=Array(i.length-1),a=0,l=0;a<i.length;++a)a!==r&&(s[l++]=i[o][a]);return n}function n(i){if(1===i.length)return i[0];if(2===i.length)return["sum(",i[0],",",i[1],")"].join("");var r=i.length>>1;return["sum(",n(i.slice(0,r)),",",n(i.slice(r)),")"].join("")}function o(i){if(2===i.length)return[["sum(prod(",i[0][0],",",i[1][1],"),prod(-",i[0][1],",",i[1][0],"))"].join("")];for(var s=[],a=0;a<i.length;++a)s.push(["scale(",n(o(r(i,a))),",",1&a?"-":"",i[0][a],")"].join(""));return s}function s(i){for(var s=[],a=[],l=function(i){for(var r=Array(i),n=0;n<i;++n){r[n]=Array(i);for(var o=0;o<i;++o)r[n][o]=["m",o,"[",i-n-1,"]"].join("")}return r}(i),u=[],h=0;h<i;++h)0==(1&h)?s.push.apply(s,o(r(l,h))):a.push.apply(a,o(r(l,h))),u.push("m"+h);var c=n(s),p=n(a),f="orientation"+i+"Exact";return Function("sum","prod","scale","sub",["function ",f,"(",u.join(),"){var p=",c,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",f].join(""))(tU,tF,tV,tq)}var a=s(3),l=s(4),u=[function(){return 0},function(){return 0},function(i,r){return r[0]-i[0]},function(i,r,n){var o,s=(i[1]-n[1])*(r[0]-n[0]),l=(i[0]-n[0])*(r[1]-n[1]),u=s-l;if(s>0){if(l<=0)return u;o=s+l}else{if(!(s<0)||l>=0)return u;o=-(s+l)}var h=33306690738754716e-32*o;return u>=h||u<=-h?u:a(i,r,n)},function(i,r,n,o){var s=i[0]-o[0],a=r[0]-o[0],u=n[0]-o[0],h=i[1]-o[1],c=r[1]-o[1],p=n[1]-o[1],f=i[2]-o[2],d=r[2]-o[2],m=n[2]-o[2],g=a*p,y=u*c,_=u*h,v=s*p,x=s*c,b=a*h,w=f*(g-y)+d*(_-v)+m*(x-b),E=7771561172376103e-31*((Math.abs(g)+Math.abs(y))*Math.abs(f)+(Math.abs(_)+Math.abs(v))*Math.abs(d)+(Math.abs(x)+Math.abs(b))*Math.abs(m));return w>E||-w>E?w:l(i,r,n,o)}];function h(i){var r=u[i.length];return r||(r=u[i.length]=s(i.length)),r.apply(void 0,i)}!function(){for(;u.length<=5;)u.push(s(u.length));for(var r=[],n=["slow"],o=0;o<=5;++o)r.push("a"+o),n.push("o"+o);var a=["function getOrientation(",r.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(o=2;o<=5;++o)a.push("case ",o,":return o",o,"(",r.slice(0,o).join(),");");a.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(a.join(""));var l=Function.apply(void 0,n);for(i.exports=l.apply(void 0,[h].concat(u)),o=0;o<=5;++o)i.exports[o]=u[o]}()}),tZ=function(i){var r=i.length;if(r<3){for(var n=Array(r),o=0;o<r;++o)n[o]=o;return 2===r&&i[0][0]===i[1][0]&&i[0][1]===i[1][1]?[0]:n}var s=Array(r);for(o=0;o<r;++o)s[o]=o;s.sort(function(r,n){return i[r][0]-i[n][0]||i[r][1]-i[n][1]});var a=[s[0],s[1]],l=[s[0],s[1]];for(o=2;o<r;++o){for(var u=s[o],h=i[u],c=a.length;c>1&&0>=tX(i[a[c-2]],i[a[c-1]],h);)c-=1,a.pop();for(a.push(u),c=l.length;c>1&&tX(i[l[c-2]],i[l[c-1]],h)>=0;)c-=1,l.pop();l.push(u)}n=Array(l.length+a.length-2);for(var p=0,f=(o=0,a.length);o<f;++o)n[p++]=a[o];for(var d=l.length-2;d>0;--d)n[p++]=l[d];return n},tX=tj[3];function t$(i,r){if(!(this instanceof t$))return new t$(i,r);if(this.data=i||[],this.length=this.data.length,this.compare=r||tW,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function tW(i,r){return i<r?-1:+(i>r)}t$.prototype={push:function(i){this.data.push(i),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var i=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),i}},peek:function(){return this.data[0]},_up:function(i){for(var r=this.data,n=this.compare,o=r[i];i>0;){var s=i-1>>1,a=r[s];if(n(o,a)>=0)break;r[i]=a,i=s}r[i]=o},_down:function(i){for(var r=this.data,n=this.compare,o=this.length>>1,s=r[i];i<o;){var a=1+(i<<1),l=a+1,u=r[a];if(l<this.length&&0>n(r[l],u)&&(a=l,u=r[l]),n(u,s)>=0)break;r[i]=u,i=a}r[i]=s}},t$.default=t$;var tH=function(i,r){for(var n=i[0],o=i[1],s=!1,a=0,l=r.length-1;a<r.length;l=a++){var u=r[a][0],h=r[a][1],c=r[l][0],p=r[l][1];h>o!=p>o&&n<(c-u)*(o-h)/(p-h)+u&&(s=!s)}return s},tY=tj[3],tK=tJ;function tJ(i,r,n){r=Math.max(0,void 0===r?2:r),n=n||0;for(var o,s=function(i){for(var r=i[0],n=i[0],o=i[0],s=i[0],a=0;a<i.length;a++){var l=i[a];l[0]<r[0]&&(r=l),l[0]>o[0]&&(o=l),l[1]<n[1]&&(n=l),l[1]>s[1]&&(s=l)}var u=[r,n,o,s],h=u.slice();for(a=0;a<i.length;a++)tH(i[a],u)||h.push(i[a]);var c=tZ(h),p=[];for(a=0;a<c.length;a++)p.push(h[c[a]]);return p}(i),a=tI(16,["[0]","[1]","[0]","[1]"]).load(i),l=[],u=0;u<s.length;u++){var h=s[u];a.remove(h),o=t3(h,o),l.push(o)}var c=tI(16);for(u=0;u<l.length;u++)c.insert(t2(l[u]));for(var p=r*r,f=n*n;l.length;){var d=l.shift(),m=d.p,g=d.next.p,y=t5(m,g);if(!(y<f)){var _=y/p;(h=function(i,r,n,o,s,a,l){for(var u=new t$(null,tQ),h=i.data;h;){for(var c=0;c<h.children.length;c++){var p=h.children[c],f=h.leaf?t4(p,n,o):function(i,r,n){if(t0(i,n)||t0(r,n))return 0;var o=t6(i[0],i[1],r[0],r[1],n.minX,n.minY,n.maxX,n.minY);if(0===o)return 0;var s=t6(i[0],i[1],r[0],r[1],n.minX,n.minY,n.minX,n.maxY);if(0===s)return 0;var a=t6(i[0],i[1],r[0],r[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===a)return 0;var l=t6(i[0],i[1],r[0],r[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===l?0:Math.min(o,s,a,l)}(n,o,p);f>a||u.push({node:p,dist:f})}for(;u.length&&!u.peek().node.children;){var d=u.pop(),m=d.node,g=t4(m,r,n),y=t4(m,o,s);if(d.dist<g&&d.dist<y&&t1(n,m,l)&&t1(o,m,l))return m}(h=u.pop())&&(h=h.node)}return null}(a,d.prev.p,m,g,d.next.next.p,_,c))&&Math.min(t5(h,m),t5(h,g))<=_&&(l.push(d),l.push(t3(h,d)),a.remove(h),c.remove(d),c.insert(t2(d)),c.insert(t2(d.next)))}}d=o;var v=[];do v.push(d.p),d=d.next;while(d!==o)return v.push(d.p),v}function tQ(i,r){return i.dist-r.dist}function t0(i,r){return i[0]>=r.minX&&i[0]<=r.maxX&&i[1]>=r.minY&&i[1]<=r.maxY}function t1(i,r,n){for(var o,s,a=Math.min(i[0],r[0]),l=Math.min(i[1],r[1]),u=Math.max(i[0],r[0]),h=Math.max(i[1],r[1]),c=n.search({minX:a,minY:l,maxX:u,maxY:h}),p=0;p<c.length;p++)if(o=c[p].p,s=c[p].next.p,o!==r&&s!==i&&tY(o,s,i)>0!=tY(o,s,r)>0&&tY(i,r,o)>0!=tY(i,r,s)>0)return!1;return!0}function t2(i){var r=i.p,n=i.next.p;return i.minX=Math.min(r[0],n[0]),i.minY=Math.min(r[1],n[1]),i.maxX=Math.max(r[0],n[0]),i.maxY=Math.max(r[1],n[1]),i}function t3(i,r){var n={p:i,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function t5(i,r){var n=i[0]-r[0],o=i[1]-r[1];return n*n+o*o}function t4(i,r,n){var o=r[0],s=r[1],a=n[0]-o,l=n[1]-s;if(0!==a||0!==l){var u=((i[0]-o)*a+(i[1]-s)*l)/(a*a+l*l);u>1?(o=n[0],s=n[1]):u>0&&(o+=a*u,s+=l*u)}return(a=i[0]-o)*a+(l=i[1]-s)*l}function t6(i,r,n,o,s,a,l,u){var h,c,p,f,d=n-i,m=o-r,g=l-s,y=u-a,_=i-s,v=r-a,x=d*d+m*m,b=d*g+m*y,w=g*g+y*y,E=d*_+m*v,I=g*_+y*v,S=x*w-b*b,M=S,T=S;0===S?(c=0,M=1,f=I,T=w):(f=x*I-b*E,(c=b*I-w*E)<0?(c=0,f=I,T=w):c>M&&(c=M,f=I+b,T=w)),f<0?(f=0,0>-E?c=0:-E>x?c=M:(c=-E,M=x)):f>T&&(f=T,-E+b<0?c=0:-E+b>x?c=M:(c=-E+b,M=x));var C=(1-(p=0===f?0:f/T))*s+p*l-((1-(h=0===c?0:c/M))*i+h*n),P=(1-p)*a+p*u-((1-h)*r+h*o);return C*C+P*P}function t8(i,r){void 0===r&&(r={}),r.concavity=r.concavity||1/0;var n=[];if(z(i,function(i){n.push([i[0],i[1]])}),!n.length)return null;var o=tK(n,r.concavity);return o.length>3?d([o]):null}function t9(i,r,n){if(void 0===n&&(n={}),!i)throw Error("point is required");if(!r)throw Error("polygon is required");var o=ti(i),s=tl(r),a=s.type,l=r.bbox,u=s.coordinates;if(l&&!1==(l[0]<=o[0]&&l[1]<=o[1]&&l[2]>=o[0]&&l[3]>=o[1]))return!1;"Polygon"===a&&(u=[u]);for(var h=!1,c=0;c<u.length&&!h;c++)if(t7(o,u[c][0],n.ignoreBoundary)){for(var p=!1,f=1;f<u[c].length&&!p;)t7(o,u[c][f],!n.ignoreBoundary)&&(p=!0),f++;p||(h=!0)}return h}function t7(i,r,n){var o=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var s=0,a=r.length-1;s<r.length;a=s++){var l=r[s][0],u=r[s][1],h=r[a][0],c=r[a][1];if(i[1]*(l-h)+u*(h-i[0])+c*(i[0]-l)==0&&(l-i[0])*(h-i[0])<=0&&(u-i[1])*(c-i[1])<=0)return!n;u>i[1]!=c>i[1]&&i[0]<(h-l)*(i[1]-u)/(c-u)+l&&(o=!o)}return o}function et(i,r){var n=[];return G(i,function(i){var o=!1;if("Point"===i.geometry.type)j(r,function(r){t9(i,r)&&(o=!0)}),o&&n.push(i);else{if("MultiPoint"!==i.geometry.type)throw Error("Input geometry must be a Point or MultiPoint");var s=[];j(r,function(r){z(i,function(i){t9(i,r)&&(o=!0,s.push(i))})}),o&&n.push(x(s))}}),_(n)}function ee(i,r,n){void 0===n&&(n={});var o=ti(i),s=ti(r),a=Math.pow(Math.sin(P(s[1]-o[1])/2),2)+Math.pow(Math.sin(P(s[0]-o[0])/2),2)*Math.cos(P(o[1]))*Math.cos(P(s[1]));return I(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),n.units)}function ei(i,r){var n=!1;return _((function(i){if(i.length<3)return[];i.sort(en);for(var r,n,o,s,a,l=i.length-1,u=i[l].x,h=i[0].x,c=i[l].y,p=c;l--;)i[l].y<c&&(c=i[l].y),i[l].y>p&&(p=i[l].y);var f,d=h-u,m=p-c,g=d>m?d:m,y=.5*(h+u),_=.5*(p+c),v=[new er({__sentinel:!0,x:y-20*g,y:_-g},{__sentinel:!0,x:y,y:_+20*g},{__sentinel:!0,x:y+20*g,y:_-g})],x=[],b=[];for(l=i.length;l--;){for(b.length=0,f=v.length;f--;)(d=i[l].x-v[f].x)>0&&d*d>v[f].r?(x.push(v[f]),v.splice(f,1)):d*d+(m=i[l].y-v[f].y)*m>v[f].r||(b.push(v[f].a,v[f].b,v[f].b,v[f].c,v[f].c,v[f].a),v.splice(f,1));for(function(i){var r,n,o,s,a,l=i.length;i:for(;l;)for(n=i[--l],r=i[--l],o=l;o;)if(a=i[--o],r===(s=i[--o])&&n===a||r===a&&n===s){i.splice(l,2),i.splice(o,2),l-=2;continue i}}(b),f=b.length;f;)n=b[--f],r=b[--f],o=i[l],s=n.x-r.x,a=n.y-r.y,Math.abs(2*(s*(o.y-n.y)-a*(o.x-n.x)))>1e-12&&v.push(new er(r,n,o))}for(Array.prototype.push.apply(x,v),l=x.length;l--;)(x[l].a.__sentinel||x[l].b.__sentinel||x[l].c.__sentinel)&&x.splice(l,1);return x})(i.features.map(function(i){var o={x:i.geometry.coordinates[0],y:i.geometry.coordinates[1]};return r?o.z=i.properties[r]:3===i.geometry.coordinates.length&&(n=!0,o.z=i.geometry.coordinates[2]),o})).map(function(i){var r=[i.a.x,i.a.y],o=[i.b.x,i.b.y],s=[i.c.x,i.c.y],a={};return n?(r.push(i.a.z),o.push(i.b.z),s.push(i.c.z)):a={a:i.a.z,b:i.b.z,c:i.c.z},d([[r,o,s,r]],a)}))}tK.default=tJ;var er=function(i,r,n){this.a=i,this.b=r,this.c=n;var o,s,a=r.x-i.x,l=r.y-i.y,u=n.x-i.x,h=n.y-i.y,c=a*(i.x+r.x)+l*(i.y+r.y),p=u*(i.x+n.x)+h*(i.y+n.y),f=2*(a*(n.y-r.y)-l*(n.x-r.x));this.x=(h*c-l*p)/f,this.y=(a*p-u*c)/f,o=this.x-i.x,s=this.y-i.y,this.r=o*o+s*s};function en(i,r){return r.x-i.x}function eo(i){if(!i)throw Error("geojson is required");switch(i.type){case"Feature":return es(i);case"FeatureCollection":var r;return r={type:"FeatureCollection"},Object.keys(i).forEach(function(n){switch(n){case"type":case"features":return;default:r[n]=i[n]}}),r.features=i.features.map(function(i){return es(i)}),r;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ea(i);default:throw Error("unknown GeoJSON type")}}function es(i){var r={type:"Feature"};return Object.keys(i).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:r[n]=i[n]}}),r.properties=function i(r){var n={};return r&&Object.keys(r).forEach(function(o){var s=r[o];"object"==typeof s?null===s?n[o]=null:Array.isArray(s)?n[o]=s.map(function(i){return i}):n[o]=i(s):n[o]=s}),n}(i.properties),r.geometry=ea(i.geometry),r}function ea(i){var r={type:i.type};return i.bbox&&(r.bbox=i.bbox),"GeometryCollection"===i.type?r.geometries=i.geometries.map(function(i){return ea(i)}):r.coordinates=function i(r){return"object"!=typeof r[0]?r.slice():r.map(function(r){return i(r)})}(i.coordinates),r}function el(i){return i[0].toString()+","+i[1].toString()}function eu(i){return i}function eh(i,r){var n=function(i){if(null==i)return eu;var r,n,o=i.scale[0],s=i.scale[1],a=i.translate[0],l=i.translate[1];return function(i,u){u||(r=n=0);var h=2,c=i.length,p=Array(c);for(p[0]=(r+=i[0])*o+a,p[1]=(n+=i[1])*s+l;h<c;)p[h]=i[h],++h;return p}}(i.transform),o=i.arcs;function s(i){return n(i)}function a(i){for(var r=[],s=0,a=i.length;s<a;++s)!function(i,r){r.length&&r.pop();for(var s=o[i<0?~i:i],a=0,l=s.length;a<l;++a)r.push(n(s[a],a));i<0&&function(i,r){for(var n,o=i.length,s=o-r;s<--o;)n=i[s],i[s++]=i[o],i[o]=n}(r,l)}(i[s],r);return r.length<2&&r.push(r[0]),r}function l(i){for(var r=a(i);r.length<4;)r.push(r[0]);return r}function u(i){return i.map(l)}return function i(r){var n,o=r.type;switch(o){case"GeometryCollection":return{type:o,geometries:r.geometries.map(i)};case"Point":n=s(r.coordinates);break;case"MultiPoint":n=r.coordinates.map(s);break;case"LineString":n=a(r.arcs);break;case"MultiLineString":n=r.arcs.map(a);break;case"Polygon":n=u(r.arcs);break;case"MultiPolygon":n=r.arcs.map(u);break;default:return null}return{type:o,coordinates:n}}(r)}function ec(i,r){var n={},o=[],s=[];function a(i){i.forEach(function(r){r.forEach(function(r){(n[r=r<0?~r:r]||(n[r]=[])).push(i)})}),o.push(i)}function l(r){return function(i){for(var r,n=-1,o=i.length,s=i[o-1],a=0;++n<o;)r=s,s=i[n],a+=r[0]*s[1]-r[1]*s[0];return Math.abs(a)}(eh(i,{type:"Polygon",arcs:[r]}).coordinates[0])}return r.forEach(function i(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(i);break;case"Polygon":a(r.arcs);break;case"MultiPolygon":r.arcs.forEach(a)}}),o.forEach(function(i){if(!i._){var r=[],o=[i];for(i._=1,s.push(r);i=o.pop();)r.push(i),i.forEach(function(i){i.forEach(function(i){n[i<0?~i:i].forEach(function(i){i._||(i._=1,o.push(i))})})})}}),o.forEach(function(i){delete i._}),{type:"MultiPolygon",arcs:s.map(function(r){var o,s=[];if(r.forEach(function(i){i.forEach(function(i){i.forEach(function(i){n[i<0?~i:i].length<2&&s.push(i)})})}),(o=(s=function(i,r){var n={},o={},s={},a=[],l=-1;function u(i,r){for(var o in i){var s=i[o];delete r[s.start],delete s.start,delete s.end,s.forEach(function(i){n[i<0?~i:i]=1}),a.push(s)}}return r.forEach(function(n,o){var s,a=i.arcs[n<0?~n:n];!(a.length<3)||a[1][0]||a[1][1]||(s=r[++l],r[l]=n,r[o]=s)}),r.forEach(function(r){var n,a,l,u,h,c=(l=(a=i.arcs[r<0?~r:r])[0],i.transform?(n=[0,0],a.forEach(function(i){n[0]+=i[0],n[1]+=i[1]})):n=a[a.length-1],r<0?[n,l]:[l,n]),p=c[0],f=c[1];if(u=s[p]){if(delete s[u.end],u.push(r),u.end=f,h=o[f]){delete o[h.start];var d=h===u?u:u.concat(h);o[d.start=u.start]=s[d.end=h.end]=d}else o[u.start]=s[u.end]=u}else if(u=o[f]){if(delete o[u.start],u.unshift(r),u.start=p,h=s[p]){delete s[h.end];var m=h===u?u:h.concat(u);o[m.start=h.start]=s[m.end=u.end]=m}else o[u.start]=s[u.end]=u}else o[(u=[r]).start=p]=s[u.end=f]=u}),u(s,o),u(o,s),r.forEach(function(i){n[i<0?~i:i]||a.push([i])}),a}(i,s)).length)>1)for(var a,u,h=1,c=l(s[0]);h<o;++h)(a=l(s[h]))>c&&(u=s[0],s[0]=s[h],s[h]=u,c=a);return s}).filter(function(i){return i.length>0})}}var ep=Object.prototype.hasOwnProperty;function ef(i,r,n,o,s,a){3==arguments.length&&(o=a=Array,s=null);for(var l=new o(i=1<<Math.max(4,Math.ceil(Math.log(i)/Math.LN2))),u=new a(i),h=i-1,c=0;c<i;++c)l[c]=s;return{set:function(o,a){for(var c=r(o)&h,p=l[c],f=0;p!=s;){if(n(p,o))return u[c]=a;if(++f>=i)throw Error("full hashmap");p=l[c=c+1&h]}return l[c]=o,u[c]=a,a},maybeSet:function(o,a){for(var c=r(o)&h,p=l[c],f=0;p!=s;){if(n(p,o))return u[c];if(++f>=i)throw Error("full hashmap");p=l[c=c+1&h]}return l[c]=o,u[c]=a,a},get:function(o,a){for(var c=r(o)&h,p=l[c],f=0;p!=s;){if(n(p,o))return u[c];if(++f>=i)break;p=l[c=c+1&h]}return a},keys:function(){for(var i=[],r=0,n=l.length;r<n;++r){var o=l[r];o!=s&&i.push(o)}return i}}}function ed(i,r){return i[0]===r[0]&&i[1]===r[1]}var em=new ArrayBuffer(16),eg=new Float64Array(em),ey=new Uint32Array(em);function e_(i){eg[0]=i[0],eg[1]=i[1];var r=ey[0]^ey[1];return 0x7fffffff&(r=r<<5^r>>7^ey[2]^ey[3])}function ev(i,r,n){for(var o,s=r+(n---r>>1);r<s;++r,--n)o=i[r],i[r]=i[n],i[n]=o}function ex(i){var r,n=eb(i.geometry);for(r in null!=i.id&&(n.id=i.id),null!=i.bbox&&(n.bbox=i.bbox),i.properties){n.properties=i.properties;break}return n}function eb(i){if(null==i)return{type:null};var r="GeometryCollection"===i.type?{type:"GeometryCollection",geometries:i.geometries.map(eb)}:"Point"===i.type||"MultiPoint"===i.type?{type:i.type,coordinates:i.coordinates}:{type:i.type,arcs:i.coordinates};return null!=i.bbox&&(r.bbox=i.bbox),r}function ew(i){var r,n=i[0],o=i[1];return o<n&&(r=n,n=o,o=r),n+31*o}function eE(i,r){var n,o=i[0],s=i[1],a=r[0],l=r[1];return s<o&&(n=o,o=s,s=n),l<a&&(n=a,a=l,l=n),o===a&&s===l}function eI(i,r){void 0===r&&(r={});var n="object"==typeof r?r.mutate:r;if(!i)throw Error("geojson is required");var o=tu(i),s=[];switch(o){case"LineString":s=eS(i);break;case"MultiLineString":case"Polygon":tr(i).forEach(function(i){s.push(eS(i))});break;case"MultiPolygon":tr(i).forEach(function(i){var r=[];i.forEach(function(i){r.push(eS(i))}),s.push(r)});break;case"Point":return i;case"MultiPoint":var a={};tr(i).forEach(function(i){var r=i.join("-");Object.prototype.hasOwnProperty.call(a,r)||(s.push(i),a[r]=!0)});break;default:throw Error(o+" geometry not supported")}return i.coordinates?!0===n?(i.coordinates=s,i):{type:o,coordinates:s}:!0===n?(i.geometry.coordinates=s,i):h({type:o,coordinates:s},i.properties,{bbox:i.bbox,id:i.id})}function eS(i){var r=tr(i);if(2===r.length&&!eM(r[0],r[1]))return r;var n=[],o=r.length-1,s=n.length;n.push(r[0]);for(var a=1;a<o;a++){var l=n[n.length-1];r[a][0]===l[0]&&r[a][1]===l[1]||(n.push(r[a]),(s=n.length)>2&&eT(n[s-3],n[s-1],n[s-2])&&n.splice(n.length-2,1))}if(n.push(r[r.length-1]),s=n.length,eM(r[0],r[r.length-1])&&s<4)throw Error("invalid polygon");return eT(n[s-3],n[s-1],n[s-2])&&n.splice(n.length-2,1),n}function eM(i,r){return i[0]===r[0]&&i[1]===r[1]}function eT(i,r,n){var o=n[0],s=n[1],a=i[0],l=i[1],u=r[0],h=r[1],c=u-a,p=h-l;return 0==(o-a)*p-(s-l)*c&&(Math.abs(c)>=Math.abs(p)?c>0?a<=o&&o<=u:u<=o&&o<=a:p>0?l<=s&&s<=h:h<=s&&s<=l)}function eC(i,r,n){if(i.length<=2)return i;var o,s,a,l=void 0!==r?r*r:1;return s=(o=i=n?i:function(i,r){for(var n,o,s,a,l,u=i[0],h=[u],c=1,p=i.length;c<p;c++)n=i[c],s=u,a=void 0,l=void 0,(a=(o=n).x-s.x)*a+(l=o.y-s.y)*l>r&&(h.push(n),u=n);return u!==n&&h.push(n),h}(i,l)).length-1,a=[o[0]],function i(r,n,o,s,a){for(var l,u=s,h=n+1;h<o;h++){var c=function(i,r,n){var o=r.x,s=r.y,a=n.x-o,l=n.y-s;if(0!==a||0!==l){var u=((i.x-o)*a+(i.y-s)*l)/(a*a+l*l);u>1?(o=n.x,s=n.y):u>0&&(o+=a*u,s+=l*u)}return(a=i.x-o)*a+(l=i.y-s)*l}(r[h],r[n],r[o]);c>u&&(l=h,u=c)}u>s&&(l-n>1&&i(r,n,l,s,a),a.push(r[l]),o-l>1&&i(r,l,o,s,a))}(o,0,s,l,a),a.push(o[s]),i=a}function eP(i,r,n){return eC(i.map(function(i){return{x:i[0],y:i[1],z:i[2]}}),r,n).map(function(i){return i.z?[i.x,i.y,i.z]:[i.x,i.y]})}function eA(i,r,n){return i.map(function(i){var o,s=i.map(function(i){return{x:i[0],y:i[1]}});if(s.length<4)throw Error("invalid polygon");for(var a=eC(s,r,n).map(function(i){return[i.x,i.y]});(o=a).length<3||3===o.length&&o[2][0]===o[0][0]&&o[2][1]===o[0][1];)a=eC(s,r-=.01*r,n).map(function(i){return[i.x,i.y]});return a[a.length-1][0]===a[0][0]&&a[a.length-1][1]===a[0][1]||a.push(a[0]),a})}var eL=function(){function i(i){this.points=i.points||[],this.duration=i.duration||1e4,this.sharpness=i.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=i.stepLength||60,this.length=this.points.length,this.delay=0;for(var r=0;r<this.length;r++)this.points[r].z=this.points[r].z||0;for(r=0;r<this.length-1;r++){var n=this.points[r],o=this.points[r+1];this.centers.push({x:(n.x+o.x)/2,y:(n.y+o.y)/2,z:(n.z+o.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),r=0;r<this.centers.length-1;r++){var s=this.points[r+1].x-(this.centers[r].x+this.centers[r+1].x)/2,a=this.points[r+1].y-(this.centers[r].y+this.centers[r+1].y)/2,l=this.points[r+1].z-(this.centers[r].y+this.centers[r+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[r+1].x+this.sharpness*(this.centers[r].x+s),y:(1-this.sharpness)*this.points[r+1].y+this.sharpness*(this.centers[r].y+a),z:(1-this.sharpness)*this.points[r+1].z+this.sharpness*(this.centers[r].z+l)},{x:(1-this.sharpness)*this.points[r+1].x+this.sharpness*(this.centers[r+1].x+s),y:(1-this.sharpness)*this.points[r+1].y+this.sharpness*(this.centers[r+1].y+a),z:(1-this.sharpness)*this.points[r+1].z+this.sharpness*(this.centers[r+1].z+l)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return i.prototype.cacheSteps=function(i){var r=[],n=this.pos(0);r.push(0);for(var o=0;o<this.duration;o+=10){var s=this.pos(o);Math.sqrt((s.x-n.x)*(s.x-n.x)+(s.y-n.y)*(s.y-n.y)+(s.z-n.z)*(s.z-n.z))>i&&(r.push(o),n=s)}return r},i.prototype.vector=function(i){var r=this.pos(i+10),n=this.pos(i-10);return{angle:180*Math.atan2(r.y-n.y,r.x-n.x)/3.14,speed:Math.sqrt((n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y)+(n.z-r.z)*(n.z-r.z))}},i.prototype.pos=function(i){var r,n,o,s,a,l,u,h=i-this.delay;h<0&&(h=0),h>this.duration&&(h=this.duration-1);var c=h/this.duration;if(c>=1)return this.points[this.length-1];var p=Math.floor((this.points.length-1)*c);return r=(this.length-1)*c-p,n=this.points[p],o=this.controls[p][1],s=this.controls[p+1][0],a=this.points[p+1],u=[(l=r*r)*r,3*l*(1-r),3*r*(1-r)*(1-r),(1-r)*(1-r)*(1-r)],{x:a.x*u[0]+s.x*u[1]+o.x*u[2]+n.x*u[3],y:a.y*u[0]+s.y*u[1]+o.y*u[2]+n.y*u[3],z:a.z*u[0]+s.z*u[1]+o.z*u[2]+n.z*u[3]}},i}();function ek(i,r){void 0===r&&(r={});for(var n=r.resolution||1e4,o=r.sharpness||.85,s=[],a=tl(i).coordinates.map(function(i){return{x:i[0],y:i[1]}}),l=new eL({duration:n,points:a,sharpness:o}),u=function(i){var r=l.pos(i);Math.floor(i/100)%2==0&&s.push([r.x,r.y])},h=0;h<l.duration;h+=10)u(h);return u(l.duration),g(s,r.properties)}function eR(i,r){void 0===r&&(r={});var n=Number(i[0]),o=Number(i[1]),s=Number(i[2]),a=Number(i[3]);if(6===i.length)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");var l=[n,o];return d([[l,[s,o],[s,a],[n,a],l]],r.properties,{bbox:i,id:r.id})}function eD(i){return eR(te(i))}function eN(i){var r=i[0],n=i[1],o=i[2],s=i[3];if(ee(i.slice(0,2),[o,n])>=ee(i.slice(0,2),[r,s])){var a=(n+s)/2;return[r,a-(o-r)/2,o,a+(o-r)/2]}var l=(r+o)/2;return[l-(s-n)/2,n,l+(s-n)/2,s]}function eO(i,r,n,o){void 0===o&&(o={});var s=ti(i),a=P(s[0]),l=P(s[1]),u=P(n),h=S(r,o.units),c=Math.asin(Math.sin(l)*Math.cos(h)+Math.cos(l)*Math.sin(h)*Math.cos(u));return p([C(a+Math.atan2(Math.sin(u)*Math.sin(h)*Math.cos(l),Math.cos(h)-Math.sin(l)*Math.sin(c))),C(c)],o.properties)}function ez(i,r,n){void 0===n&&(n={});for(var o=n.steps||64,s=n.properties?n.properties:!Array.isArray(i)&&"Feature"===i.type&&i.properties?i.properties:{},a=[],l=0;l<o;l++)a.push(eO(i,r,-360*l/o,n).geometry.coordinates);return a.push(a[0]),d([a],s)}function eF(i,r,n){if(void 0===n&&(n={}),!0===n.final)return(eF(r,i)+180)%360;var o=ti(i),s=ti(r),a=P(o[0]),l=P(s[0]),u=P(o[1]),h=P(s[1]);return C(Math.atan2(Math.sin(l-a)*Math.cos(h),Math.cos(u)*Math.sin(h)-Math.sin(u)*Math.cos(h)*Math.cos(l-a)))}function eB(i,r){void 0===r&&(r={});var n=te(i);return p([(n[0]+n[2])/2,(n[1]+n[3])/2],r.properties,r)}function eU(i,r){void 0===r&&(r={});var n=0,o=0,s=0;return z(i,function(i){n+=i[0],o+=i[1],s++},!0),p([n/s,o/s],r.properties)}function eG(i){var r=[];return"FeatureCollection"===i.type?G(i,function(i){z(i,function(n){r.push(p(n,i.properties))})}):z(i,function(n){r.push(p(n,i.properties))}),_(r)}var eV=eq;function eq(i,r,n){n=n||2;var o,s,a,l,u,h,c,p=r&&r.length,f=p?r[0]*n:i.length,d=ej(i,0,f,n,!0),m=[];if(!d)return m;if(p&&(d=function(i,r,n,o){var s,a,l,u=[];for(s=0,a=r.length;s<a;s++)(l=ej(i,r[s]*o,s<a-1?r[s+1]*o:i.length,o,!1))===l.next&&(l.steiner=!0),u.push(function(i){var r=i,n=i;do r.x<n.x&&(n=r),r=r.next;while(r!==i)return n}(l));for(u.sort(eX),s=0;s<u.length;s++)(function(i,r){if(r=function(i,r){var n,o=r,s=i.x,a=i.y,l=-1/0;do{if(a<=o.y&&a>=o.next.y&&o.next.y!==o.y){var u=o.x+(a-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(u<=s&&u>l){if(l=u,u===s){if(a===o.y)return o;if(a===o.next.y)return o.next}n=o.x<o.next.x?o:o.next}}o=o.next}while(o!==r)if(!n)return null;if(s===l)return n.prev;var h,c=n,p=n.x,f=n.y,d=1/0;for(o=n.next;o!==c;)s>=o.x&&o.x>=p&&s!==o.x&&eW(a<f?s:l,a,p,f,a<f?l:s,a,o.x,o.y)&&((h=Math.abs(a-o.y)/(s-o.x))<d||h===d&&o.x>n.x)&&eJ(o,i)&&(n=o,d=h),o=o.next;return n}(i,r)){var n=eQ(r,i);eZ(n,n.next)}})(u[s],n),n=eZ(n,n.next);return n}(i,r,d,n)),i.length>80*n){o=a=i[0],s=l=i[1];for(var g=n;g<f;g+=n)(u=i[g])<o&&(o=u),(h=i[g+1])<s&&(s=h),u>a&&(a=u),h>l&&(l=h);c=0!==(c=Math.max(a-o,l-s))?1/c:0}return function i(r,n,o,s,a,l,u){if(r){!u&&l&&function(i,r,n,o){var s=i;do null===s.z&&(s.z=e$(s.x,s.y,r,n,o)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i)s.prevZ.nextZ=null,s.prevZ=null,function(i){var r,n,o,s,a,l,u,h,c=1;do{for(n=i,i=null,a=null,l=0;n;){for(l++,o=n,u=0,r=0;r<c&&(u++,o=o.nextZ);r++);for(h=c;u>0||h>0&&o;)0!==u&&(0===h||!o||n.z<=o.z)?(s=n,n=n.nextZ,u--):(s=o,o=o.nextZ,h--),a?a.nextZ=s:i=s,s.prevZ=a,a=s;n=o}a.nextZ=null,c*=2}while(l>1)}(s)}(r,s,a,l);for(var h,c,p=r;r.prev!==r.next;)if(h=r.prev,c=r.next,l?function(i,r,n,o){var s=i.prev,a=i.next;if(eH(s,i,a)>=0)return!1;for(var l=s.x<i.x?s.x<a.x?s.x:a.x:i.x<a.x?i.x:a.x,u=s.y<i.y?s.y<a.y?s.y:a.y:i.y<a.y?i.y:a.y,h=s.x>i.x?s.x>a.x?s.x:a.x:i.x>a.x?i.x:a.x,c=s.y>i.y?s.y>a.y?s.y:a.y:i.y>a.y?i.y:a.y,p=e$(l,u,r,n,o),f=e$(h,c,r,n,o),d=i.prevZ,m=i.nextZ;d&&d.z>=p&&m&&m.z<=f;){if(d!==i.prev&&d!==i.next&&eW(s.x,s.y,i.x,i.y,a.x,a.y,d.x,d.y)&&eH(d.prev,d,d.next)>=0||(d=d.prevZ,m!==i.prev&&m!==i.next&&eW(s.x,s.y,i.x,i.y,a.x,a.y,m.x,m.y)&&eH(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;d&&d.z>=p;){if(d!==i.prev&&d!==i.next&&eW(s.x,s.y,i.x,i.y,a.x,a.y,d.x,d.y)&&eH(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=f;){if(m!==i.prev&&m!==i.next&&eW(s.x,s.y,i.x,i.y,a.x,a.y,m.x,m.y)&&eH(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}(r,s,a,l):function(i){var r=i.prev,n=i.next;if(eH(r,i,n)>=0)return!1;for(var o=i.next.next;o!==i.prev;){if(eW(r.x,r.y,i.x,i.y,n.x,n.y,o.x,o.y)&&eH(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}(r))n.push(h.i/o),n.push(r.i/o),n.push(c.i/o),e1(r),r=c.next,p=c.next;else if((r=c)===p){u?1===u?i(r=function(i,r,n){var o=i;do{var s=o.prev,a=o.next.next;!eY(s,a)&&eK(s,o,o.next,a)&&eJ(s,a)&&eJ(a,s)&&(r.push(s.i/n),r.push(o.i/n),r.push(a.i/n),e1(o),e1(o.next),o=i=a),o=o.next}while(o!==i)return o}(r,n,o),n,o,s,a,l,2):2===u&&function(r,n,o,s,a,l){var u=r;do{for(var h,c,p=u.next.next;p!==u.prev;){if(u.i!==p.i&&(h=u,c=p,h.next.i!==c.i&&h.prev.i!==c.i&&!function(i,r){var n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==r.i&&n.next.i!==r.i&&eK(n,n.next,i,r))return!0;n=n.next}while(n!==i)return!1}(h,c)&&eJ(h,c)&&eJ(c,h)&&function(i,r){var n=i,o=!1,s=(i.x+r.x)/2,a=(i.y+r.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next;while(n!==i)return o}(h,c))){var f=eQ(u,p);return u=eZ(u,u.next),f=eZ(f,f.next),i(u,n,o,s,a,l),void i(f,n,o,s,a,l)}p=p.next}u=u.next}while(u!==r)}(r,n,o,s,a,l):i(eZ(r),n,o,s,a,l,1);break}}}(d,m,n,o,s,c),m}function ej(i,r,n,o,s){var a,l;if(s===e3(i,r,n,o)>0)for(a=r;a<n;a+=o)l=e0(a,i[a],i[a+1],l);else for(a=n-o;a>=r;a-=o)l=e0(a,i[a],i[a+1],l);return l&&eY(l,l.next)&&(e1(l),l=l.next),l}function eZ(i,r){if(!i)return i;r||(r=i);var n,o=i;do if(n=!1,o.steiner||!eY(o,o.next)&&0!==eH(o.prev,o,o.next))o=o.next;else{if(e1(o),(o=r=o.prev)===o.next)break;n=!0}while(n||o!==r)return r}function eX(i,r){return i.x-r.x}function e$(i,r,n,o,s){return(i=0x55555555&((i=0x33333333&((i=0xf0f0f0f&((i=0xff00ff&((i=32767*(i-n)*s)|i<<8))|i<<4))|i<<2))|i<<1))|(r=0x55555555&((r=0x33333333&((r=0xf0f0f0f&((r=0xff00ff&((r=32767*(r-o)*s)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function eW(i,r,n,o,s,a,l,u){return(s-l)*(r-u)-(i-l)*(a-u)>=0&&(i-l)*(o-u)-(n-l)*(r-u)>=0&&(n-l)*(a-u)-(s-l)*(o-u)>=0}function eH(i,r,n){return(r.y-i.y)*(n.x-r.x)-(r.x-i.x)*(n.y-r.y)}function eY(i,r){return i.x===r.x&&i.y===r.y}function eK(i,r,n,o){return!!(eY(i,r)&&eY(n,o)||eY(i,o)&&eY(n,r))||eH(i,r,n)>0!=eH(i,r,o)>0&&eH(n,o,i)>0!=eH(n,o,r)>0}function eJ(i,r){return 0>eH(i.prev,i,i.next)?eH(i,r,i.next)>=0&&eH(i,i.prev,r)>=0:0>eH(i,r,i.prev)||0>eH(i,i.next,r)}function eQ(i,r){var n=new e2(i.i,i.x,i.y),o=new e2(r.i,r.x,r.y),s=i.next,a=r.prev;return i.next=r,r.prev=i,n.next=s,s.prev=n,o.next=n,n.prev=o,a.next=o,o.prev=a,o}function e0(i,r,n,o){var s=new e2(i,r,n);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function e1(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function e2(i,r,n){this.i=i,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function e3(i,r,n,o){for(var s=0,a=r,l=n-o;a<n;a+=o)s+=(i[l]-i[a])*(i[a+1]+i[l+1]),l=a;return s}function e5(i){var r=function(i){for(var r=i[0][0].length,n={vertices:[],holes:[],dimensions:r},o=0,s=0;s<i.length;s++){for(var a=0;a<i[s].length;a++)for(var l=0;l<r;l++)n.vertices.push(i[s][a][l]);s>0&&(o+=i[s-1].length,n.holes.push(o))}return n}(i),n=eV(r.vertices,r.holes,2),o=[],s=[];n.forEach(function(i,o){var a=n[o];s.push([r.vertices[2*a],r.vertices[2*a+1]])});for(var a=0;a<s.length;a+=3){var l=s.slice(a,a+3);l.push(s[a]),o.push(d([l]))}return o}function e4(i,r){if(!i)throw Error("targetPoint is required");if(!r)throw Error("points is required");var n,o=1/0,s=0;return G(r,function(r,n){var a=ee(i,r);a<o&&(s=n,o=a)}),(n=eo(r.features[s])).properties.featureIndex=s,n.properties.distanceToPoint=o,n}function e6(i){if(!i)throw Error("geojson is required");var r=[];return X(i,function(i){!function(i,r){var n=[],o=i.geometry;if(null!==o){switch(o.type){case"Polygon":n=tr(o);break;case"LineString":n=[tr(o)]}n.forEach(function(n){var o,s;(o=i.properties,s=[],n.reduce(function(i,r){var n,a,l,u,h=g([i,r],o);return h.bbox=(n=i[0],a=i[1],[n<(l=r[0])?n:l,a<(u=r[1])?a:u,n>l?n:l,a>u?a:u]),s.push(h),r}),s).forEach(function(i){i.id=r.length,r.push(i)})})}}(i,r)}),_(r)}eq.deviation=function(i,r,n,o){var s=r&&r.length,a=s?r[0]*n:i.length,l=Math.abs(e3(i,0,a,n));if(s)for(var u=0,h=r.length;u<h;u++){var c=r[u]*n,p=u<h-1?r[u+1]*n:i.length;l-=Math.abs(e3(i,c,p,n))}var f=0;for(u=0;u<o.length;u+=3){var d=o[u]*n,m=o[u+1]*n,g=o[u+2]*n;f+=Math.abs((i[d]-i[g])*(i[m+1]-i[d+1])-(i[d]-i[m])*(i[g+1]-i[d+1]))}return 0===l&&0===f?0:Math.abs((f-l)/l)},eq.flatten=function(i){for(var r=i[0][0].length,n={vertices:[],holes:[],dimensions:r},o=0,s=0;s<i.length;s++){for(var a=0;a<i[s].length;a++)for(var l=0;l<r;l++)n.vertices.push(i[s][a][l]);s>0&&(o+=i[s-1].length,n.holes.push(o))}return n},eV.default=eq;var e8=tz(function(i,r){function n(i,r,n){void 0===n&&(n={});var o={type:"Feature"};return(0===n.id||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=r||{},o.geometry=i,o}function o(i,r,o){if(void 0===o&&(o={}),!i)throw Error("coordinates is required");if(!Array.isArray(i))throw Error("coordinates must be an Array");if(i.length<2)throw Error("coordinates must be at least 2 numbers long");if(!m(i[0])||!m(i[1]))throw Error("coordinates must contain numbers");return n({type:"Point",coordinates:i},r,o)}function s(i,r,o){void 0===o&&(o={});for(var s=0;s<i.length;s++){var a=i[s];if(a.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<a[a.length-1].length;l++)if(a[a.length-1][l]!==a[0][l])throw Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:i},r,o)}function a(i,r,o){if(void 0===o&&(o={}),i.length<2)throw Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:i},r,o)}function l(i,r){void 0===r&&(r={});var n={type:"FeatureCollection"};return r.id&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.features=i,n}function u(i,r,o){return void 0===o&&(o={}),n({type:"MultiLineString",coordinates:i},r,o)}function h(i,r,o){return void 0===o&&(o={}),n({type:"MultiPoint",coordinates:i},r,o)}function c(i,r,o){return void 0===o&&(o={}),n({type:"MultiPolygon",coordinates:i},r,o)}function p(i,n){void 0===n&&(n="kilometers");var o=r.factors[n];if(!o)throw Error(n+" units is invalid");return i*o}function f(i,n){void 0===n&&(n="kilometers");var o=r.factors[n];if(!o)throw Error(n+" units is invalid");return i/o}function d(i){return i%(2*Math.PI)*180/Math.PI}function m(i){return!isNaN(i)&&null!==i&&!Array.isArray(i)}Object.defineProperty(r,"__esModule",{value:!0}),r.earthRadius=6371008.8,r.factors={centimeters:100*r.earthRadius,centimetres:100*r.earthRadius,degrees:r.earthRadius/111325,feet:3.28084*r.earthRadius,inches:39.37*r.earthRadius,kilometers:r.earthRadius/1e3,kilometres:r.earthRadius/1e3,meters:r.earthRadius,metres:r.earthRadius,miles:r.earthRadius/1609.344,millimeters:1e3*r.earthRadius,millimetres:1e3*r.earthRadius,nauticalmiles:r.earthRadius/1852,radians:1,yards:1.0936*r.earthRadius},r.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r.earthRadius,yards:1.0936133},r.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},r.feature=n,r.geometry=function(i,r,n){switch(i){case"Point":return o(r).geometry;case"LineString":return a(r).geometry;case"Polygon":return s(r).geometry;case"MultiPoint":return h(r).geometry;case"MultiLineString":return u(r).geometry;case"MultiPolygon":return c(r).geometry;default:throw Error(i+" is invalid")}},r.point=o,r.points=function(i,r,n){return void 0===n&&(n={}),l(i.map(function(i){return o(i,r)}),n)},r.polygon=s,r.polygons=function(i,r,n){return void 0===n&&(n={}),l(i.map(function(i){return s(i,r)}),n)},r.lineString=a,r.lineStrings=function(i,r,n){return void 0===n&&(n={}),l(i.map(function(i){return a(i,r)}),n)},r.featureCollection=l,r.multiLineString=u,r.multiPoint=h,r.multiPolygon=c,r.geometryCollection=function(i,r,o){return void 0===o&&(o={}),n({type:"GeometryCollection",geometries:i},r,o)},r.round=function(i,r){if(void 0===r&&(r=0),r&&!(r>=0))throw Error("precision must be a positive number");var n=Math.pow(10,r||0);return Math.round(i*n)/n},r.radiansToLength=p,r.lengthToRadians=f,r.lengthToDegrees=function(i,r){return d(f(i,r))},r.bearingToAzimuth=function(i){var r=i%360;return r<0&&(r+=360),r},r.radiansToDegrees=d,r.degreesToRadians=function(i){return i%360*Math.PI/180},r.convertLength=function(i,r,n){if(void 0===r&&(r="kilometers"),void 0===n&&(n="kilometers"),!(i>=0))throw Error("length must be a positive number");return p(f(i,r),n)},r.convertArea=function(i,n,o){if(void 0===n&&(n="meters"),void 0===o&&(o="kilometers"),!(i>=0))throw Error("area must be a positive number");var s=r.areaFactors[n];if(!s)throw Error("invalid original units");var a=r.areaFactors[o];if(!a)throw Error("invalid final units");return i/s*a},r.isNumber=m,r.isObject=function(i){return!!i&&i.constructor===Object},r.validateBBox=function(i){if(!i)throw Error("bbox is required");if(!Array.isArray(i))throw Error("bbox must be an Array");if(4!==i.length&&6!==i.length)throw Error("bbox must be an Array of 4 or 6 numbers");i.forEach(function(i){if(!m(i))throw Error("bbox must only contain numbers")})},r.validateId=function(i){if(!i)throw Error("id is required");if(-1===["string","number"].indexOf(typeof i))throw Error("id must be a number or a string")}});function e9(i,r,n){if(null!==i)for(var o,s,a,l,u,h,c,p,f=0,d=0,m=i.type,g="FeatureCollection"===m,y="Feature"===m,_=g?i.features.length:1,v=0;v<_;v++){u=(p=!!(c=g?i.features[v].geometry:y?i.geometry:i)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var x=0;x<u;x++){var b=0,w=0;if(null!==(l=p?c.geometries[x]:c)){h=l.coordinates;var E=l.type;switch(f=n&&("Polygon"===E||"MultiPolygon"===E)?1:0,E){case null:break;case"Point":if(!1===r(h,d,v,b,w))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(o=0;o<h.length;o++){if(!1===r(h[o],d,v,b,w))return!1;d++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(o=0;o<h.length;o++){for(s=0;s<h[o].length-f;s++){if(!1===r(h[o][s],d,v,b,w))return!1;d++}"MultiLineString"===E&&b++,"Polygon"===E&&w++}"Polygon"===E&&b++;break;case"MultiPolygon":for(o=0;o<h.length;o++){for(w=0,s=0;s<h[o].length;s++){for(a=0;a<h[o][s].length-f;a++){if(!1===r(h[o][s][a],d,v,b,w))return!1;d++}w++}b++}break;case"GeometryCollection":for(o=0;o<l.geometries.length;o++)if(!1===e9(l.geometries[o],r,n))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function e7(i,r){var n;switch(i.type){case"FeatureCollection":for(n=0;n<i.features.length&&!1!==r(i.features[n].properties,n);n++);break;case"Feature":r(i.properties,0)}}function it(i,r){if("Feature"===i.type)r(i,0);else if("FeatureCollection"===i.type)for(var n=0;n<i.features.length&&!1!==r(i.features[n],n);n++);}function ie(i,r){var n,o,s,a,l,u,h,c,p,f,d=0,m="FeatureCollection"===i.type,g="Feature"===i.type,y=m?i.features.length:1;for(n=0;n<y;n++){for(u=m?i.features[n].geometry:g?i.geometry:i,c=m?i.features[n].properties:g?i.properties:{},p=m?i.features[n].bbox:g?i.bbox:void 0,f=m?i.features[n].id:g?i.id:void 0,l=(h=!!u&&"GeometryCollection"===u.type)?u.geometries.length:1,s=0;s<l;s++)if(null!==(a=h?u.geometries[s]:u))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===r(a,d,c,p,f))return!1;break;case"GeometryCollection":for(o=0;o<a.geometries.length;o++)if(!1===r(a.geometries[o],d,c,p,f))return!1;break;default:throw Error("Unknown Geometry Type")}else if(!1===r(null,d,c,p,f))return!1;d++}}function ii(i,r){ie(i,function(i,n,o,s,a){var l,u=null===i?null:i.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==r(e8.feature(i,o,{bbox:s,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon"}for(var h=0;h<i.coordinates.length;h++){var c={type:l,coordinates:i.coordinates[h]};if(!1===r(e8.feature(c,o),n,h))return!1}})}function ir(i,r){ii(i,function(i,n,o){var s=0;if(i.geometry){var a=i.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var l,u=0,h=0,c=0;return!1!==e9(i,function(a,p,f,d,m){return void 0===l||n>u||d>h||m>c?(l=a,u=n,h=d,c=m,void(s=0)):!1!==r(e8.lineString([l,a],i.properties),n,o,m,s)&&void(s++,l=a)})&&void 0}}})}function io(i,r){if(!i)throw Error("geojson is required");ii(i,function(i,n,o){if(null!==i.geometry){var s=i.geometry.type,a=i.geometry.coordinates;switch(s){case"LineString":if(!1===r(i,n,o,0,0))return!1;break;case"Polygon":for(var l=0;l<a.length;l++)if(!1===r(e8.lineString(a[l],i.properties),n,o,l))return!1}}})}var is=Object.defineProperty({coordAll:function(i){var r=[];return e9(i,function(i){r.push(i)}),r},coordEach:e9,coordReduce:function(i,r,n,o){var s=n;return e9(i,function(i,o,a,l,u){s=0===o&&void 0===n?i:r(s,i,o,a,l,u)},o),s},featureEach:it,featureReduce:function(i,r,n){var o=n;return it(i,function(i,s){o=0===s&&void 0===n?i:r(o,i,s)}),o},findPoint:function(i,r){if(r=r||{},!e8.isObject(r))throw Error("options is invalid");var n,o=r.featureIndex||0,s=r.multiFeatureIndex||0,a=r.geometryIndex||0,l=r.coordIndex||0,u=r.properties;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),u=u||i.features[o].properties,n=i.features[o].geometry;break;case"Feature":u=u||i.properties,n=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=i;break;default:throw Error("geojson is invalid")}if(null===n)return null;var h=n.coordinates;switch(n.type){case"Point":return e8.point(h,u,r);case"MultiPoint":return s<0&&(s=h.length+s),e8.point(h[s],u,r);case"LineString":return l<0&&(l=h.length+l),e8.point(h[l],u,r);case"Polygon":return a<0&&(a=h.length+a),l<0&&(l=h[a].length+l),e8.point(h[a][l],u,r);case"MultiLineString":return s<0&&(s=h.length+s),l<0&&(l=h[s].length+l),e8.point(h[s][l],u,r);case"MultiPolygon":return s<0&&(s=h.length+s),a<0&&(a=h[s].length+a),l<0&&(l=h[s][a].length-l),e8.point(h[s][a][l],u,r)}throw Error("geojson is invalid")},findSegment:function(i,r){if(r=r||{},!e8.isObject(r))throw Error("options is invalid");var n,o=r.featureIndex||0,s=r.multiFeatureIndex||0,a=r.geometryIndex||0,l=r.segmentIndex||0,u=r.properties;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),u=u||i.features[o].properties,n=i.features[o].geometry;break;case"Feature":u=u||i.properties,n=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=i;break;default:throw Error("geojson is invalid")}if(null===n)return null;var h=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=h.length+l-1),e8.lineString([h[l],h[l+1]],u,r);case"Polygon":return a<0&&(a=h.length+a),l<0&&(l=h[a].length+l-1),e8.lineString([h[a][l],h[a][l+1]],u,r);case"MultiLineString":return s<0&&(s=h.length+s),l<0&&(l=h[s].length+l-1),e8.lineString([h[s][l],h[s][l+1]],u,r);case"MultiPolygon":return s<0&&(s=h.length+s),a<0&&(a=h[s].length+a),l<0&&(l=h[s][a].length-l-1),e8.lineString([h[s][a][l],h[s][a][l+1]],u,r)}throw Error("geojson is invalid")},flattenEach:ii,flattenReduce:function(i,r,n){var o=n;return ii(i,function(i,s,a){o=0===s&&0===a&&void 0===n?i:r(o,i,s,a)}),o},geomEach:ie,geomReduce:function(i,r,n){var o=n;return ie(i,function(i,s,a,l,u){o=0===s&&void 0===n?i:r(o,i,s,a,l,u)}),o},lineEach:io,lineReduce:function(i,r,n){var o=n;return io(i,function(i,s,a,l){o=0===s&&void 0===n?i:r(o,i,s,a,l)}),o},propEach:e7,propReduce:function(i,r,n){var o=n;return e7(i,function(i,s){o=0===s&&void 0===n?i:r(o,i,s)}),o},segmentEach:ir,segmentReduce:function(i,r,n){var o=n,s=!1;return ir(i,function(i,a,l,u,h){o=!1===s&&void 0===n?i:r(o,i,a,l,u,h),s=!0}),o}},"__esModule",{value:!0});function ia(i){var r=[1/0,1/0,-1/0,-1/0];return is.coordEach(i,function(i){r[0]>i[0]&&(r[0]=i[0]),r[1]>i[1]&&(r[1]=i[1]),r[2]<i[0]&&(r[2]=i[0]),r[3]<i[1]&&(r[3]=i[1])}),r}ia.default=ia;var il=Object.defineProperty({default:ia},"__esModule",{value:!0}).default,iu=is.featureEach,ih=(is.coordEach,e8.polygon,e8.featureCollection);function ic(i){var r=tI(i);return r.insert=function(i){if("Feature"!==i.type)throw Error("invalid feature");return i.bbox=i.bbox?i.bbox:il(i),tI.prototype.insert.call(this,i)},r.load=function(i){var r=[];return Array.isArray(i)?i.forEach(function(i){if("Feature"!==i.type)throw Error("invalid features");i.bbox=i.bbox?i.bbox:il(i),r.push(i)}):iu(i,function(i){if("Feature"!==i.type)throw Error("invalid features");i.bbox=i.bbox?i.bbox:il(i),r.push(i)}),tI.prototype.load.call(this,r)},r.remove=function(i,r){if("Feature"!==i.type)throw Error("invalid feature");return i.bbox=i.bbox?i.bbox:il(i),tI.prototype.remove.call(this,i,r)},r.clear=function(){return tI.prototype.clear.call(this)},r.search=function(i){return ih(tI.prototype.search.call(this,this.toBBox(i)))},r.collides=function(i){return tI.prototype.collides.call(this,this.toBBox(i))},r.all=function(){return ih(tI.prototype.all.call(this))},r.toJSON=function(){return tI.prototype.toJSON.call(this)},r.fromJSON=function(i){return tI.prototype.fromJSON.call(this,i)},r.toBBox=function(i){var r;if(i.bbox)r=i.bbox;else if(Array.isArray(i)&&4===i.length)r=i;else if(Array.isArray(i)&&6===i.length)r=[i[0],i[1],i[3],i[4]];else if("Feature"===i.type)r=il(i);else{if("FeatureCollection"!==i.type)throw Error("invalid geojson");r=il(i)}return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},r}function ip(i,r){var n={},o=[];if("LineString"===i.type&&(i=h(i)),"LineString"===r.type&&(r=h(r)),"Feature"===i.type&&"Feature"===r.type&&null!==i.geometry&&null!==r.geometry&&"LineString"===i.geometry.type&&"LineString"===r.geometry.type&&2===i.geometry.coordinates.length&&2===r.geometry.coordinates.length){var s=id(i,r);return s&&o.push(s),_(o)}var a=ic();return a.load(e6(r)),G(e6(i),function(i){G(a.search(i),function(r){var s=id(i,r);if(s){var a=tr(s).join(",");n[a]||(n[a]=!0,o.push(s))}})}),_(o)}function id(i,r){var n=tr(i),o=tr(r);if(2!==n.length)throw Error("<intersects> line1 must only contain 2 coordinates");if(2!==o.length)throw Error("<intersects> line2 must only contain 2 coordinates");var s=n[0][0],a=n[0][1],l=n[1][0],u=n[1][1],h=o[0][0],c=o[0][1],f=o[1][0],d=o[1][1],m=(d-c)*(l-s)-(f-h)*(u-a);if(0===m)return null;var g=((f-h)*(a-c)-(d-c)*(s-h))/m,y=((l-s)*(a-c)-(u-a)*(s-h))/m;return g>=0&&g<=1&&y>=0&&y<=1?p([s+g*(l-s),a+g*(u-a)]):null}function im(i,r,n){void 0===n&&(n={});var o=p([1/0,1/0],{dist:1/0}),s=0;return X(i,function(i){for(var a=tr(i),l=0;l<a.length-1;l++){var u=p(a[l]);u.properties.dist=ee(r,u,n);var h=p(a[l+1]);h.properties.dist=ee(r,h,n);var c=ee(u,h,n),f=Math.max(u.properties.dist,h.properties.dist),d=eF(u,h),m=eO(r,f,d+90,n),y=eO(r,f,d-90,n),_=ip(g([m.geometry.coordinates,y.geometry.coordinates]),g([u.geometry.coordinates,h.geometry.coordinates])),v=null;_.features.length>0&&((v=_.features[0]).properties.dist=ee(r,v,n),v.properties.location=s+ee(u,v,n)),u.properties.dist<o.properties.dist&&((o=u).properties.index=l,o.properties.location=s),h.properties.dist<o.properties.dist&&((o=h).properties.index=l+1,o.properties.location=s+c),v&&v.properties.dist<o.properties.dist&&((o=v).properties.index=l),s+=c}}),o}function ig(i,r,n){void 0===n&&(n={});var o,s,a,l,u,h,c,p,f=ti(i),d=ti(r);return d[0]+=d[0]-f[0]>180?-360:360*(f[0]-d[0]>180),A((s=o=void 0===o?6371008.8:Number(o),a=f[1]*Math.PI/180,u=(l=d[1]*Math.PI/180)-a,(h=Math.abs(d[0]-f[0])*Math.PI/180)>Math.PI&&(h-=2*Math.PI),p=Math.abs(c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)))>1e-11?u/c:Math.cos(a),Math.sqrt(u*u+p*p*h*h)*s),"meters",n.units)}function iy(i,r,n){if(void 0===n&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!i)throw Error("pt is required");if(Array.isArray(i)?i=p(i):"Point"===i.type?i=h(i):ts(i,"Point","point"),!r)throw Error("line is required");Array.isArray(r)?r=g(r):"LineString"===r.type?r=h(r):ts(r,"LineString","line");var o=1/0,s=i.geometry.coordinates;return W(r,function(i){var r=function(i,r,n,o){var s=[n[0]-r[0],n[1]-r[1]],a=i_([i[0]-r[0],i[1]-r[1]],s);if(a<=0)return iv(i,r,{method:o.method,units:"degrees"});var l=i_(s,s);if(l<=a)return iv(i,n,{method:o.method,units:"degrees"});var u=a/l;return iv(i,[r[0]+u*s[0],r[1]+u*s[1]],{method:o.method,units:"degrees"})}(s,i.geometry.coordinates[0],i.geometry.coordinates[1],n);r<o&&(o=r)}),A(o,"degrees",n.units)}function i_(i,r){return i[0]*r[0]+i[1]*r[1]}function iv(i,r,n){return"planar"===n.method?ig(i,r,n):ee(i,r,n)}function ix(i){for(var r="FeatureCollection"!==i.type?"Feature"!==i.type?_([h(i)]):_([i]):i,n=eB(r),o=!1,s=0;!o&&s<r.features.length;){var a,l=r.features[s].geometry,u=!1;if("Point"===l.type)n.geometry.coordinates[0]===l.coordinates[0]&&n.geometry.coordinates[1]===l.coordinates[1]&&(o=!0);else if("MultiPoint"===l.type){var c=!1;for(a=0;!c&&a<l.coordinates.length;)n.geometry.coordinates[0]===l.coordinates[a][0]&&n.geometry.coordinates[1]===l.coordinates[a][1]&&(o=!0,c=!0),a++}else if("LineString"===l.type)for(a=0;!u&&a<l.coordinates.length-1;)ib(n.geometry.coordinates[0],n.geometry.coordinates[1],l.coordinates[a][0],l.coordinates[a][1],l.coordinates[a+1][0],l.coordinates[a+1][1])&&(u=!0,o=!0),a++;else if("MultiLineString"===l.type)for(var f=0;f<l.coordinates.length;){u=!1,a=0;for(var d=l.coordinates[f];!u&&a<d.length-1;)ib(n.geometry.coordinates[0],n.geometry.coordinates[1],d[a][0],d[a][1],d[a+1][0],d[a+1][1])&&(u=!0,o=!0),a++;f++}else"Polygon"!==l.type&&"MultiPolygon"!==l.type||t9(n,l)&&(o=!0);s++}if(o)return n;var m=_([]);for(s=0;s<r.features.length;s++)m.features=m.features.concat(eG(r.features[s]).features);return p(e4(n,m).geometry.coordinates)}function ib(i,r,n,o,s,a){return Math.sqrt((s-n)*(s-n)+(a-o)*(a-o))===Math.sqrt((i-n)*(i-n)+(r-o)*(r-o))+Math.sqrt((s-i)*(s-i)+(a-r)*(a-r))}function iw(i){return Z(i,function(i,r){return i+function(i){var r,n=0;switch(i.type){case"Polygon":return iE(i.coordinates);case"MultiPolygon":for(r=0;r<i.coordinates.length;r++)n+=iE(i.coordinates[r]);return n}return 0}(r)},0)}function iE(i){var r=0;if(i&&i.length>0){r+=Math.abs(iI(i[0]));for(var n=1;n<i.length;n++)r-=Math.abs(iI(i[n]))}return r}function iI(i){var r,n,o,s,a,l,u=0,h=i.length;if(h>2){for(l=0;l<h;l++)l===h-2?(o=h-2,s=h-1,a=0):l===h-1?(o=h-1,s=0,a=1):(o=l,s=l+1,a=l+2),r=i[o],n=i[s],u+=(iS(i[a][0])-iS(r[0]))*Math.sin(iS(n[1]));u=0x24ffb2985f71*u/2}return u}function iS(i){return i*Math.PI/180}function iM(i,r){return void 0===r&&(r={}),H(i,function(i,n){var o=n.geometry.coordinates;return i+ee(o[0],o[1],r)},0)}function iT(i,r,n,o){if(!R(o=o||{}))throw Error("options is invalid");var s,a=[];if("Feature"===i.type)s=i.geometry.coordinates;else{if("LineString"!==i.type)throw Error("input must be a LineString Feature or Geometry");s=i.coordinates}for(var l,u,h,c=s.length,p=0,f=0;f<s.length&&!(r>=p&&f===s.length-1);f++){if(p>r&&0===a.length){if(!(l=r-p))return a.push(s[f]),g(a);u=eF(s[f],s[f-1])-180,h=eO(s[f],l,u,o),a.push(h.geometry.coordinates)}if(p>=n)return(l=n-p)?(u=eF(s[f],s[f-1])-180,h=eO(s[f],l,u,o),a.push(h.geometry.coordinates)):a.push(s[f]),g(a);if(p>=r&&a.push(s[f]),f===s.length-1)return g(a);p+=ee(s[f],s[f+1],o)}if(p<r&&s.length===c)throw Error("Start position is beyond line");var d=s[s.length-1];return g([d,d])}function iC(i,r,n){void 0===n&&(n={});for(var o=ti(i),s=tr(r),a=0;a<s.length-1;a++){var l=!1;if(n.ignoreEndVertices&&(0===a&&(l="start"),a===s.length-2&&(l="end"),0===a&&a+1===s.length-1&&(l="both")),function(i,r,n,o,s){var a=n[0],l=n[1],u=i[0],h=i[1],c=r[0],p=r[1],f=c-u,d=p-h,m=(n[0]-u)*d-(n[1]-h)*f;if(null!==s){if(Math.abs(m)>s)return!1}else if(0!==m)return!1;return o?"start"===o?Math.abs(f)>=Math.abs(d)?f>0?u<a&&a<=c:c<=a&&a<u:d>0?h<l&&l<=p:p<=l&&l<h:"end"===o?Math.abs(f)>=Math.abs(d)?f>0?u<=a&&a<c:c<a&&a<=u:d>0?h<=l&&l<p:p<l&&l<=h:"both"===o&&(Math.abs(f)>=Math.abs(d)?f>0?u<a&&a<c:c<a&&a<u:d>0?h<l&&l<p:p<l&&l<h):Math.abs(f)>=Math.abs(d)?f>0?u<=a&&a<=c:c<=a&&a<=u:d>0?h<=l&&l<=p:p<=l&&l<=h}(s[a],s[a+1],o,l,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function iP(i,r){var n=tl(i),o=tl(r),s=n.type,a=o.type;switch(s){case"Point":switch(a){case"MultiPoint":return function(i,r){var n,o=!1;for(n=0;n<r.coordinates.length;n++)if(iL(r.coordinates[n],i.coordinates)){o=!0;break}return o}(n,o);case"LineString":return iC(n,o,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return t9(n,o,{ignoreBoundary:!0});default:throw Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"MultiPoint":return function(i,r){for(var n=0;n<i.coordinates.length;n++){for(var o=!1,s=0;s<r.coordinates.length;s++)iL(i.coordinates[n],r.coordinates[s])&&(o=!0);if(!o)return!1}return!0}(n,o);case"LineString":return function(i,r){for(var n=!1,o=0;o<i.coordinates.length;o++){if(!iC(i.coordinates[o],r))return!1;n||(n=iC(i.coordinates[o],r,{ignoreEndVertices:!0}))}return n}(n,o);case"Polygon":case"MultiPolygon":return function(i,r){for(var n=!0,o=!1,s=0;s<i.coordinates.length;s++){if(!(o=t9(i.coordinates[1],r))){n=!1;break}o=t9(i.coordinates[1],r,{ignoreBoundary:!0})}return n&&o}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"LineString":return function(i,r){for(var n=0;n<i.coordinates.length;n++)if(!iC(i.coordinates[n],r))return!1;return!0}(n,o);case"Polygon":case"MultiPolygon":return function(i,r){if(!iA(te(r),te(i)))return!1;for(var n,o,s=!1,a=0;a<i.coordinates.length-1;a++){if(!t9(i.coordinates[a],r))return!1;s||(s=t9(i.coordinates[a],r,{ignoreBoundary:!0})),s||(s=t9((n=i.coordinates[a],o=i.coordinates[a+1],[(n[0]+o[0])/2,(n[1]+o[1])/2]),r,{ignoreBoundary:!0}))}return s}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Polygon":case"MultiPolygon":return function(i,r){var n=te(i);if(!iA(te(r),n))return!1;for(var o=0;o<i.coordinates[0].length;o++)if(!t9(i.coordinates[0][o],r))return!1;return!0}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}default:throw Error("feature1 "+s+" geometry not supported")}}function iA(i,r){return!(i[0]>r[0])&&!(i[2]<r[2])&&!(i[1]>r[1])&&!(i[3]<r[3])}function iL(i,r){return i[0]===r[0]&&i[1]===r[1]}function ik(i,r,n){void 0===n&&(n={}),n.mask&&!n.units&&(n.units="kilometers");for(var o=[],s=i[0],a=i[1],l=i[2],u=i[3],h=r/ee([s,a],[l,a],n)*(l-s),c=r/ee([s,a],[s,u],n)*(u-a),f=l-s,d=u-a,m=Math.floor(f/h),g=(d-Math.floor(d/c)*c)/2,y=s+(f-m*h)/2;y<=l;){for(var v=a+g;v<=u;){var x=p([y,v],n.properties);n.mask?iP(x,n.mask)&&o.push(x):o.push(x),v+=c}y+=h}return _(o)}function iR(i,r){void 0===r&&(r={});var n=r.precision,o=r.coordinates,s=r.mutate;if(n=null==n||isNaN(n)?6:n,o=null==o||isNaN(o)?3:o,!i)throw Error("<geojson> is required");if("number"!=typeof n)throw Error("<precision> must be a number");if("number"!=typeof o)throw Error("<coordinates> must be a number");!1!==s&&void 0!==s||(i=JSON.parse(JSON.stringify(i)));var a=Math.pow(10,n);return z(i,function(i){!function(i,r,n){i.length>n&&i.splice(n,i.length);for(var o=0;o<i.length;o++)i[o]=Math.round(i[o]*r)/r}(i,a,o)}),i}function iD(i){if(!i)throw Error("geojson is required");var r=[];return X(i,function(i){r.push(i)}),_(r)}function iN(i,r){if(!i||!r||i.length!==r.length)return!1;for(var n=0,o=i.length;n<o;n++)if(i[n]instanceof Array&&r[n]instanceof Array){if(!iN(i[n],r[n]))return!1}else if(i[n]!==r[n])return!1;return!0}ic.default=ic;var iO=function(i,r,n,o,s){this.coord=i,this.param=r,this.ringAndEdgeIn=n,this.ringAndEdgeOut=o,this.nxtIsectAlongEdgeIn=s},iz=function(i,r,n,o,s,a,l){this.coord=i,this.ringAndEdge1=r,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=o,this.nxtIsectAlongRingAndEdge2=s,this.ringAndEdge1Walkable=a,this.ringAndEdge2Walkable=l};function iF(i,r){if(void 0===r&&(r=!0),3!=i.length)throw Error("This function requires an array of three points [x,y]");return(i[1][0]-i[0][0])*(i[2][1]-i[0][1])-(i[1][1]-i[0][1])*(i[2][0]-i[0][0])>=0==r}function iB(i,r){if(!i||!r||i.length!=r.length)return!1;for(var n=0,o=i.length;n<o;n++)if(i[n]instanceof Array&&r[n]instanceof Array){if(!iB(i[n],r[n]))return!1}else if(i[n]!=r[n])return!1;return!0}var iU=Math.PI/180,iG=180/Math.PI,iV=function(i,r){this.lon=i,this.lat=r,this.x=iU*i,this.y=iU*r};iV.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},iV.prototype.antipode=function(){var i=-1*this.lat;return new iV(this.lon<0?180+this.lon:-1*(180-this.lon),i)};var iq=function(){this.coords=[],this.length=0};iq.prototype.move_to=function(i){this.length++,this.coords.push(i)};var ij=function(i){this.properties=i||{},this.geometries=[]};ij.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var i=[],r=0;r<this.geometries.length;r++)i.push(this.geometries[r].coords);return{geometry:{type:"MultiLineString",coordinates:i},type:"Feature",properties:this.properties}},ij.prototype.wkt=function(){for(var i="",r="LINESTRING(",n=function(i){r+=i[0]+" "+i[1]+","},o=0;o<this.geometries.length;o++){if(0===this.geometries[o].coords.length)return"LINESTRING(empty)";this.geometries[o].coords.forEach(n),i+=r.substring(0,r.length-1)+")"}return i};var iZ=function(i,r,n){if(!i||void 0===i.x||void 0===i.y||!r||void 0===r.x||void 0===r.y)throw Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new iV(i.x,i.y),this.end=new iV(r.x,r.y),this.properties=n||{};var o=this.start.x-this.end.x,s=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(o/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g===Math.PI)throw Error("it appears "+i.view()+" and "+r.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw Error("could not calculate great circle between "+i+" and "+r)};function iX(i,r){var n=[],o=ic();return X(r,function(r){if(n.forEach(function(i,r){i.id=r}),n.length){var s=o.search(r);if(s.features.length){var a=iW(r,s);n=n.filter(function(i){return i.id!==a.id}),o.remove(a),G(i$(a,r),function(i){n.push(i),o.insert(i)})}}else(n=i$(i,r).features).forEach(function(i){i.bbox||(i.bbox=eN(te(i)))}),o.load(_(n))}),_(n)}function i$(i,r){var n=[],o=tr(i)[0],s=tr(i)[i.geometry.coordinates.length-1];if(iH(o,ti(r))||iH(s,ti(r)))return _([i]);var a=ic(),l=e6(i);a.load(l);var u=a.search(r);if(!u.features.length)return _([i]);var h=iW(r,u),c=V(l,function(i,o,s){var a=tr(o)[1],l=ti(r);return s===h.id?(i.push(l),n.push(g(i)),iH(l,a)?[l]:[l,a]):(i.push(a),i)},[o]);return c.length>1&&n.push(g(c)),_(n)}function iW(i,r){if(!r.features.length)throw Error("lines must contain features");if(1===r.features.length)return r.features[0];var n,o=1/0;return G(r,function(r){var s=im(r,i).properties.dist;s<o&&(n=r,o=s)}),n}function iH(i,r){return i[0]===r[0]&&i[1]===r[1]}function iY(i,r,n,o,s){void 0===s&&(s={});var a=s.steps||64,l=iK(n),u=iK(o),h=Array.isArray(i)||"Feature"!==i.type?{}:i.properties;if(l===u)return g(ez(i,r,s).geometry.coordinates[0],h);for(var c=l<u?u:u+360,p=l,f=[],d=0;p<c;)f.push(eO(i,r,p,s).geometry.coordinates),p=l+360*++d/a;return p>c&&f.push(eO(i,r,c,s).geometry.coordinates),g(f,h)}function iK(i){var r=i%360;return r<0&&(r+=360),r}function iJ(i,r){void 0===r&&(r={});var n,o,s,a,l=tl(i);switch(r.properties||"Feature"!==i.type||(r.properties=i.properties),l.type){case"Polygon":return iQ(l,r);case"MultiPolygon":return void 0===(n=r)&&(n={}),o=tl(l).coordinates,s=n.properties?n.properties:"Feature"===l.type?l.properties:{},a=[],o.forEach(function(i){a.push(i0(i,s))}),_(a);default:throw Error("invalid poly")}}function iQ(i,r){return void 0===r&&(r={}),i0(tl(i).coordinates,r.properties?r.properties:"Feature"===i.type?i.properties:{})}function i0(i,r){return i.length>1?v(i,r):g(i[0],r)}function i1(i,r){void 0===r&&(r={});var n,o,s,a=r.properties,l=null===(n=r.autoComplete)||void 0===n||n,u=null===(o=r.orderCoords)||void 0===o||o;if(null!==(s=r.mutate)&&void 0!==s&&s||(i=eo(i)),"FeatureCollection"===i.type){var h=[];return i.features.forEach(function(i){h.push(tr(i2(i,{},l,u)))}),b(h,a)}return i2(i,a,l,u)}function i2(i,r,n,o){r=r||("Feature"===i.type?i.properties:{});var s=tl(i),a=s.coordinates,l=s.type;if(!a.length)throw Error("line must contain coordinates");switch(l){case"LineString":return n&&(a=i3(a)),d([a],r);case"MultiLineString":var u=[],h=0;return a.forEach(function(i){if(n&&(i=i3(i)),o){var r,s,a,l=(s=(r=te(g(i)))[0],a=r[1],Math.abs(s-r[2])*Math.abs(a-r[3]));l>h?(u.unshift(i),h=l):u.push(i)}else u.push(i)}),d(u,r);default:throw Error("geometry type "+l+" is not supported")}}function i3(i){var r=i[0],n=r[0],o=r[1],s=i[i.length-1],a=s[0],l=s[1];return n===a&&o===l||i.push(r),i}function i5(i,r,n,o){return 8&n?[i[0]+(r[0]-i[0])*(o[3]-i[1])/(r[1]-i[1]),o[3]]:4&n?[i[0]+(r[0]-i[0])*(o[1]-i[1])/(r[1]-i[1]),o[1]]:2&n?[o[2],i[1]+(r[1]-i[1])*(o[2]-i[0])/(r[0]-i[0])]:1&n?[o[0],i[1]+(r[1]-i[1])*(o[0]-i[0])/(r[0]-i[0])]:null}function i4(i,r){var n=0;return i[0]<r[0]?n|=1:i[0]>r[2]&&(n|=2),i[1]<r[1]?n|=4:i[1]>r[3]&&(n|=8),n}function i6(i,r){for(var n=[],o=0;o<i.length;o++){var s=function(i,r){var n,o,s,a,l,u,h;for(o=1;o<=8;o*=2){for(n=[],a=!(i4(s=i[i.length-1],r)&o),l=0;l<i.length;l++)(h=!(i4(u=i[l],r)&o))!==a&&n.push(i5(s,u,o,r)),h&&n.push(u),s=u,a=h;if(!(i=n).length)break}return n}(i[o],r);s.length>0&&(s[0][0]===s[s.length-1][0]&&s[0][1]===s[s.length-1][1]||s.push(s[0]),s.length>=4&&n.push(s))}return n}iZ.prototype.interpolate=function(i){var r=Math.sin((1-i)*this.g)/Math.sin(this.g),n=Math.sin(i*this.g)/Math.sin(this.g),o=r*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),s=r*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),a=iG*Math.atan2(r*Math.sin(this.start.y)+n*Math.sin(this.end.y),Math.sqrt(Math.pow(o,2)+Math.pow(s,2)));return[iG*Math.atan2(s,o),a]},iZ.prototype.Arc=function(i,r){var n=[];if(!i||i<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var o=1/(i-1),s=0;s<i;++s){var a=o*s,l=this.interpolate(a);n.push(l)}for(var u=!1,h=0,c=r&&r.offset?r.offset:10,p=180-c,f=-180+c,d=360-c,m=1;m<n.length;++m){var g=n[m-1][0],y=n[m][0],_=Math.abs(y-g);_>d&&(y>p&&g<f||g>p&&y<f)?u=!0:_>h&&(h=_)}var v=[];if(u&&h<c){var x=[];v.push(x);for(var b=0;b<n.length;++b){var w=parseFloat(n[b][0]);if(b>0&&Math.abs(w-n[b-1][0])>d){var E=parseFloat(n[b-1][0]),I=parseFloat(n[b-1][1]),S=parseFloat(n[b][0]),M=parseFloat(n[b][1]);if(E>-180&&E<f&&180===S&&b+1<n.length&&n[b-1][0]>-180&&n[b-1][0]<f){x.push([-180,n[b][1]]),b++,x.push([n[b][0],n[b][1]]);continue}if(E>p&&E<180&&-180===S&&b+1<n.length&&n[b-1][0]>p&&n[b-1][0]<180){x.push([180,n[b][1]]),b++,x.push([n[b][0],n[b][1]]);continue}if(E<f&&S>p){var T=E;E=S,S=T;var C=I;I=M,M=C}if(E>p&&S<f&&(S+=360),E<=180&&S>=180&&E<S){var P=(180-E)/(S-E),A=P*M+(1-P)*I;x.push([n[b-1][0]>p?180:-180,A]),(x=[]).push([n[b-1][0]>p?-180:180,A]),v.push(x)}else x=[],v.push(x);x.push([w,n[b][1]])}else x.push([n[b][0],n[b][1]])}}else{var L=[];v.push(L);for(var k=0;k<n.length;++k)L.push([n[k][0],n[k][1]])}for(var R=new ij(this.properties),D=0;D<v.length;++D){var N=new iq;R.geometries.push(N);for(var O=v[D],z=0;z<O.length;++z)N.move_to(O[z])}return R};var i8=tz(function(i,r){function n(i){var r=[];for(var n in i)r.push(n);return r}(i.exports="function"==typeof Object.keys?Object.keys:n).shim=n}),i9=tz(function(i,r){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function o(i){return"[object Arguments]"==Object.prototype.toString.call(i)}function s(i){return i&&"object"==typeof i&&"number"==typeof i.length&&Object.prototype.hasOwnProperty.call(i,"callee")&&!Object.prototype.propertyIsEnumerable.call(i,"callee")||!1}(r=i.exports=n?o:s).supported=o,r.unsupported=s}),i7=tz(function(i){var r=Array.prototype.slice,n=i.exports=function(i,s,a){return a||(a={}),i===s||(i instanceof Date&&s instanceof Date?i.getTime()===s.getTime():i&&s&&("object"==typeof i||"object"==typeof s)?function(i,s,a){var l,u;if(null==i||null==s||i.prototype!==s.prototype)return!1;if(i9(i))return!!i9(s)&&n(i=r.call(i),s=r.call(s),a);if(o(i)){if(!o(s)||i.length!==s.length)return!1;for(l=0;l<i.length;l++)if(i[l]!==s[l])return!1;return!0}try{var h=i8(i),c=i8(s)}catch(i){return!1}if(h.length!=c.length)return!1;for(h.sort(),c.sort(),l=h.length-1;l>=0;l--)if(h[l]!=c[l])return!1;for(l=h.length-1;l>=0;l--)if(!n(i[u=h[l]],s[u],a))return!1;return typeof i==typeof s}(i,s,a):a.strict?i===s:i==s)};function o(i){return!(!i||"object"!=typeof i||"number"!=typeof i.length)&&"function"==typeof i.copy&&"function"==typeof i.slice&&!(i.length>0&&"number"!=typeof i[0])}});function rt(i,r,n){if(void 0===n&&(n={}),!R(n=n||{}))throw Error("options is invalid");var o,s=n.tolerance||0,a=[],l=ic(),u=e6(i);return l.load(u),W(r,function(i){var r=!1;i&&(G(l.search(i),function(n){if(!1===r){var a=tr(i).sort(),l=tr(n).sort();i7(a,l)||(0===s?iC(a[0],n)&&iC(a[1],n):im(n,a[0]).properties.dist<=s&&im(n,a[1]).properties.dist<=s)?(r=!0,o=o?re(o,i):i):(0===s?iC(l[0],i)&&iC(l[1],i):im(i,l[0]).properties.dist<=s&&im(i,l[1]).properties.dist<=s)&&(o=o?re(o,n):n)}}),!1===r&&o&&(a.push(o),o=void 0))}),o&&a.push(o),_(a)}function re(i,r){var n=tr(r),o=tr(i),s=o[0],a=o[o.length-1],l=i.geometry.coordinates;return i7(n[0],s)?l.unshift(n[1]):i7(n[0],a)?l.push(n[1]):i7(n[1],s)?l.unshift(n[0]):i7(n[1],a)&&l.push(n[0]),i}function ri(i){var r=i%360;return r<0&&(r+=360),r}function rr(i,r,n){var o;return void 0===n&&(n={}),(o=n.final?rn(ti(r),ti(i)):rn(ti(i),ti(r)))>180?-(360-o):o}function rn(i,r){var n=P(i[1]),o=P(r[1]),s=P(r[0]-i[0]);return s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI),(C(Math.atan2(s,Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(n/2+Math.PI/4))))+360)%360}function ro(i,r,n,o){void 0===o&&(o={});var s,a,l,u,h,c,f,d,m=A(Math.abs(r),o.units,"meters");r<0&&(m=-Math.abs(m));var g=ti(i),y=(a=m/(s=void 0===s?6371008.8:Number(s)),l=g[0]*Math.PI/180,Math.abs(f=(u=P(g[1]))+(c=a*Math.cos(h=P(n))))>Math.PI/2&&(f=f>0?Math.PI-f:-Math.PI-f),[(180*(l+a*Math.sin(h)/(Math.abs(d=Math.log(Math.tan(f/2+Math.PI/4)/Math.tan(u/2+Math.PI/4)))>1e-11?c/d:Math.cos(u)))/Math.PI+540)%360-180,180*f/Math.PI]);return y[0]+=y[0]-g[0]>180?-360:360*(g[0]-y[0]>180),p(y,o.properties)}function rs(i,r,n,o,s,a){for(var l=0;l<i.length;l++){var u=i[l],h=i[l+1];l===i.length-1&&(h=i[0]),o=ra(u,h,r),n<=0&&o>0?0>ra(r,u,s)||(s=u):n>0&&o<=0&&(ra(r,u,a)>0||(a=u)),n=o}return[s,a]}function ra(i,r,n){return(r[0]-i[0])*(n[1]-i[1])-(n[0]-i[0])*(r[1]-i[1])}function rl(i){for(var r,n,o=tr(i),s=0,a=1;a<o.length;)r=n||o[0],s+=((n=o[a])[0]-r[0])*(n[1]+r[1]),a++;return s>0}function ru(i,r){switch("Feature"===i.type?i.geometry.type:i.type){case"GeometryCollection":return j(i,function(i){ru(i,r)}),i;case"LineString":return rh(tr(i),r),i;case"Polygon":return rc(tr(i),r),i;case"MultiLineString":return tr(i).forEach(function(i){rh(i,r)}),i;case"MultiPolygon":return tr(i).forEach(function(i){rc(i,r)}),i;case"Point":case"MultiPoint":return i}}function rh(i,r){rl(i)===r&&i.reverse()}function rc(i,r){rl(i[0])!==r&&i[0].reverse();for(var n=1;n<i.length;n++)rl(i[n])===r&&i[n].reverse()}var rp={successCallback:null,verbose:!1,polygons:!1},rf={},rd=[],rm=[],rg=[],ry=[],r_=[],rv=[],rx=[],rb=[],rw=[],rE=[],rI=[],rS=[],rM=[],rT=[],rC=[],rP=[],rA=[],rL=[],rk=[],rR=[],rD=[],rN=[],rO=[],rz=[];rx[85]=rE[85]=-1,rb[85]=rI[85]=0,rw[85]=rS[85]=1,rk[85]=rN[85]=1,rR[85]=rO[85]=0,rD[85]=rz[85]=1,rd[85]=ry[85]=0,rm[85]=r_[85]=-1,rg[85]=rC[85]=0,rP[85]=rM[85]=0,rA[85]=rT[85]=1,rv[85]=rL[85]=1,rN[1]=rN[169]=0,rO[1]=rO[169]=-1,rz[1]=rz[169]=0,rM[1]=rM[169]=-1,rT[1]=rT[169]=0,rC[1]=rC[169]=0,rE[4]=rE[166]=0,rI[4]=rI[166]=-1,rS[4]=rS[166]=1,rP[4]=rP[166]=1,rA[4]=rA[166]=0,rL[4]=rL[166]=0,rx[16]=rx[154]=0,rb[16]=rb[154]=1,rw[16]=rw[154]=1,ry[16]=ry[154]=1,r_[16]=r_[154]=0,rv[16]=rv[154]=1,rk[64]=rk[106]=0,rR[64]=rR[106]=1,rD[64]=rD[106]=0,rd[64]=rd[106]=-1,rm[64]=rm[106]=0,rg[64]=rg[106]=1,rk[2]=rk[168]=0,rR[2]=rR[168]=-1,rD[2]=rD[168]=1,rN[2]=rN[168]=0,rO[2]=rO[168]=-1,rz[2]=rz[168]=0,rM[2]=rM[168]=-1,rT[2]=rT[168]=0,rC[2]=rC[168]=0,rP[2]=rP[168]=-1,rA[2]=rA[168]=0,rL[2]=rL[168]=1,rx[8]=rx[162]=0,rb[8]=rb[162]=-1,rw[8]=rw[162]=0,rE[8]=rE[162]=0,rI[8]=rI[162]=-1,rS[8]=rS[162]=1,rM[8]=rM[162]=1,rT[8]=rT[162]=0,rC[8]=rC[162]=1,rP[8]=rP[162]=1,rA[8]=rA[162]=0,rL[8]=rL[162]=0,rx[32]=rx[138]=0,rb[32]=rb[138]=1,rw[32]=rw[138]=1,rE[32]=rE[138]=0,rI[32]=rI[138]=1,rS[32]=rS[138]=0,rd[32]=rd[138]=1,rm[32]=rm[138]=0,rg[32]=rg[138]=0,ry[32]=ry[138]=1,r_[32]=r_[138]=0,rv[32]=rv[138]=1,rN[128]=rN[42]=0,rO[128]=rO[42]=1,rz[128]=rz[42]=1,rk[128]=rk[42]=0,rR[128]=rR[42]=1,rD[128]=rD[42]=0,rd[128]=rd[42]=-1,rm[128]=rm[42]=0,rg[128]=rg[42]=1,ry[128]=ry[42]=-1,r_[128]=r_[42]=0,rv[128]=rv[42]=0,rE[5]=rE[165]=-1,rI[5]=rI[165]=0,rS[5]=rS[165]=0,rN[5]=rN[165]=1,rO[5]=rO[165]=0,rz[5]=rz[165]=0,rP[20]=rP[150]=0,rA[20]=rA[150]=1,rL[20]=rL[150]=1,ry[20]=ry[150]=0,r_[20]=r_[150]=-1,rv[20]=rv[150]=1,rx[80]=rx[90]=-1,rb[80]=rb[90]=0,rw[80]=rw[90]=1,rk[80]=rk[90]=1,rR[80]=rR[90]=0,rD[80]=rD[90]=1,rM[65]=rM[105]=0,rT[65]=rT[105]=1,rC[65]=rC[105]=0,rd[65]=rd[105]=0,rm[65]=rm[105]=-1,rg[65]=rg[105]=0,rx[160]=rx[10]=-1,rb[160]=rb[10]=0,rw[160]=rw[10]=1,rE[160]=rE[10]=-1,rI[160]=rI[10]=0,rS[160]=rS[10]=0,rN[160]=rN[10]=1,rO[160]=rO[10]=0,rz[160]=rz[10]=0,rk[160]=rk[10]=1,rR[160]=rR[10]=0,rD[160]=rD[10]=1,rP[130]=rP[40]=0,rA[130]=rA[40]=1,rL[130]=rL[40]=1,rM[130]=rM[40]=0,rT[130]=rT[40]=1,rC[130]=rC[40]=0,rd[130]=rd[40]=0,rm[130]=rm[40]=-1,rg[130]=rg[40]=0,ry[130]=ry[40]=0,r_[130]=r_[40]=-1,rv[130]=rv[40]=1,rE[37]=rE[133]=0,rI[37]=rI[133]=1,rS[37]=rS[133]=1,rN[37]=rN[133]=0,rO[37]=rO[133]=1,rz[37]=rz[133]=0,rd[37]=rd[133]=-1,rm[37]=rm[133]=0,rg[37]=rg[133]=0,ry[37]=ry[133]=1,r_[37]=r_[133]=0,rv[37]=rv[133]=0,rP[148]=rP[22]=-1,rA[148]=rA[22]=0,rL[148]=rL[22]=0,rN[148]=rN[22]=0,rO[148]=rO[22]=-1,rz[148]=rz[22]=1,rk[148]=rk[22]=0,rR[148]=rR[22]=1,rD[148]=rD[22]=1,ry[148]=ry[22]=-1,r_[148]=r_[22]=0,rv[148]=rv[22]=1,rx[82]=rx[88]=0,rb[82]=rb[88]=-1,rw[82]=rw[88]=1,rP[82]=rP[88]=1,rA[82]=rA[88]=0,rL[82]=rL[88]=1,rM[82]=rM[88]=-1,rT[82]=rT[88]=0,rC[82]=rC[88]=1,rk[82]=rk[88]=0,rR[82]=rR[88]=-1,rD[82]=rD[88]=0,rx[73]=rx[97]=0,rb[73]=rb[97]=1,rw[73]=rw[97]=0,rE[73]=rE[97]=0,rI[73]=rI[97]=-1,rS[73]=rS[97]=0,rM[73]=rM[97]=1,rT[73]=rT[97]=0,rC[73]=rC[97]=0,rd[73]=rd[97]=1,rm[73]=rm[97]=0,rg[73]=rg[97]=1,rx[145]=rx[25]=0,rb[145]=rb[25]=-1,rw[145]=rw[25]=0,rM[145]=rM[25]=1,rT[145]=rT[25]=0,rC[145]=rC[25]=1,rN[145]=rN[25]=0,rO[145]=rO[25]=1,rz[145]=rz[25]=1,ry[145]=ry[25]=-1,r_[145]=r_[25]=0,rv[145]=rv[25]=0,rE[70]=rE[100]=0,rI[70]=rI[100]=1,rS[70]=rS[100]=0,rP[70]=rP[100]=-1,rA[70]=rA[100]=0,rL[70]=rL[100]=1,rk[70]=rk[100]=0,rR[70]=rR[100]=-1,rD[70]=rD[100]=1,rd[70]=rd[100]=1,rm[70]=rm[100]=0,rg[70]=rg[100]=0,rE[101]=rE[69]=0,rI[101]=rI[69]=1,rS[101]=rS[69]=0,rd[101]=rd[69]=1,rm[101]=rm[69]=0,rg[101]=rg[69]=0,rN[149]=rN[21]=0,rO[149]=rO[21]=1,rz[149]=rz[21]=1,ry[149]=ry[21]=-1,r_[149]=r_[21]=0,rv[149]=rv[21]=0,rP[86]=rP[84]=-1,rA[86]=rA[84]=0,rL[86]=rL[84]=1,rk[86]=rk[84]=0,rR[86]=rR[84]=-1,rD[86]=rD[84]=1,rx[89]=rx[81]=0,rb[89]=rb[81]=-1,rw[89]=rw[81]=0,rM[89]=rM[81]=1,rT[89]=rT[81]=0,rC[89]=rC[81]=1,rx[96]=rx[74]=0,rb[96]=rb[74]=1,rw[96]=rw[74]=0,rE[96]=rE[74]=-1,rI[96]=rI[74]=0,rS[96]=rS[74]=1,rk[96]=rk[74]=1,rR[96]=rR[74]=0,rD[96]=rD[74]=0,rd[96]=rd[74]=1,rm[96]=rm[74]=0,rg[96]=rg[74]=1,rx[24]=rx[146]=0,rb[24]=rb[146]=-1,rw[24]=rw[146]=1,rP[24]=rP[146]=1,rA[24]=rA[146]=0,rL[24]=rL[146]=1,rM[24]=rM[146]=0,rT[24]=rT[146]=1,rC[24]=rC[146]=1,ry[24]=ry[146]=0,r_[24]=r_[146]=-1,rv[24]=rv[146]=0,rE[6]=rE[164]=-1,rI[6]=rI[164]=0,rS[6]=rS[164]=1,rP[6]=rP[164]=-1,rA[6]=rA[164]=0,rL[6]=rL[164]=0,rN[6]=rN[164]=0,rO[6]=rO[164]=-1,rz[6]=rz[164]=1,rk[6]=rk[164]=1,rR[6]=rR[164]=0,rD[6]=rD[164]=0,rM[129]=rM[41]=0,rT[129]=rT[41]=1,rC[129]=rC[41]=1,rN[129]=rN[41]=0,rO[129]=rO[41]=1,rz[129]=rz[41]=0,rd[129]=rd[41]=-1,rm[129]=rm[41]=0,rg[129]=rg[41]=0,ry[129]=ry[41]=0,r_[129]=r_[41]=-1,rv[129]=rv[41]=0,rP[66]=rP[104]=0,rA[66]=rA[104]=1,rL[66]=rL[104]=0,rM[66]=rM[104]=-1,rT[66]=rT[104]=0,rC[66]=rC[104]=1,rk[66]=rk[104]=0,rR[66]=rR[104]=-1,rD[66]=rD[104]=0,rd[66]=rd[104]=0,rm[66]=rm[104]=-1,rg[66]=rg[104]=1,rx[144]=rx[26]=-1,rb[144]=rb[26]=0,rw[144]=rw[26]=0,rN[144]=rN[26]=1,rO[144]=rO[26]=0,rz[144]=rz[26]=1,rk[144]=rk[26]=0,rR[144]=rR[26]=1,rD[144]=rD[26]=1,ry[144]=ry[26]=-1,r_[144]=r_[26]=0,rv[144]=rv[26]=1,rE[36]=rE[134]=0,rI[36]=rI[134]=1,rS[36]=rS[134]=1,rP[36]=rP[134]=0,rA[36]=rA[134]=1,rL[36]=rL[134]=0,rd[36]=rd[134]=0,rm[36]=rm[134]=-1,rg[36]=rg[134]=1,ry[36]=ry[134]=1,r_[36]=r_[134]=0,rv[36]=rv[134]=0,rx[9]=rx[161]=-1,rb[9]=rb[161]=0,rw[9]=rw[161]=0,rE[9]=rE[161]=0,rI[9]=rI[161]=-1,rS[9]=rS[161]=0,rM[9]=rM[161]=1,rT[9]=rT[161]=0,rC[9]=rC[161]=0,rN[9]=rN[161]=1,rO[9]=rO[161]=0,rz[9]=rz[161]=1,rx[136]=0,rb[136]=1,rw[136]=1,rE[136]=0,rI[136]=1,rS[136]=0,rP[136]=-1,rA[136]=0,rL[136]=1,rM[136]=-1,rT[136]=0,rC[136]=0,rN[136]=0,rO[136]=-1,rz[136]=0,rk[136]=0,rR[136]=-1,rD[136]=1,rd[136]=1,rm[136]=0,rg[136]=0,ry[136]=1,r_[136]=0,rv[136]=1,rx[34]=0,rb[34]=-1,rw[34]=0,rE[34]=0,rI[34]=-1,rS[34]=1,rP[34]=1,rA[34]=0,rL[34]=0,rM[34]=1,rT[34]=0,rC[34]=1,rN[34]=0,rO[34]=1,rz[34]=1,rk[34]=0,rR[34]=1,rD[34]=0,rd[34]=-1,rm[34]=0,rg[34]=1,ry[34]=-1,r_[34]=0,rv[34]=0,rx[35]=0,rb[35]=1,rw[35]=1,rE[35]=0,rI[35]=-1,rS[35]=1,rP[35]=1,rA[35]=0,rL[35]=0,rM[35]=-1,rT[35]=0,rC[35]=0,rN[35]=0,rO[35]=-1,rz[35]=0,rk[35]=0,rR[35]=1,rD[35]=0,rd[35]=-1,rm[35]=0,rg[35]=1,ry[35]=1,r_[35]=0,rv[35]=1,rx[153]=0,rb[153]=1,rw[153]=1,rM[153]=-1,rT[153]=0,rC[153]=0,rN[153]=0,rO[153]=-1,rz[153]=0,ry[153]=1,r_[153]=0,rv[153]=1,rE[102]=0,rI[102]=-1,rS[102]=1,rP[102]=1,rA[102]=0,rL[102]=0,rk[102]=0,rR[102]=1,rD[102]=0,rd[102]=-1,rm[102]=0,rg[102]=1,rx[155]=0,rb[155]=-1,rw[155]=0,rM[155]=1,rT[155]=0,rC[155]=1,rN[155]=0,rO[155]=1,rz[155]=1,ry[155]=-1,r_[155]=0,rv[155]=0,rE[103]=0,rI[103]=1,rS[103]=0,rP[103]=-1,rA[103]=0,rL[103]=1,rk[103]=0,rR[103]=-1,rD[103]=1,rd[103]=1,rm[103]=0,rg[103]=0,rx[152]=0,rb[152]=1,rw[152]=1,rP[152]=-1,rA[152]=0,rL[152]=1,rM[152]=-1,rT[152]=0,rC[152]=0,rN[152]=0,rO[152]=-1,rz[152]=0,rk[152]=0,rR[152]=-1,rD[152]=1,ry[152]=1,r_[152]=0,rv[152]=1,rx[156]=0,rb[156]=-1,rw[156]=1,rP[156]=1,rA[156]=0,rL[156]=1,rM[156]=-1,rT[156]=0,rC[156]=0,rN[156]=0,rO[156]=-1,rz[156]=0,rk[156]=0,rR[156]=1,rD[156]=1,ry[156]=-1,r_[156]=0,rv[156]=1,rx[137]=0,rb[137]=1,rw[137]=1,rE[137]=0,rI[137]=1,rS[137]=0,rM[137]=-1,rT[137]=0,rC[137]=0,rN[137]=0,rO[137]=-1,rz[137]=0,rd[137]=1,rm[137]=0,rg[137]=0,ry[137]=1,r_[137]=0,rv[137]=1,rx[139]=0,rb[139]=1,rw[139]=1,rE[139]=0,rI[139]=-1,rS[139]=0,rM[139]=1,rT[139]=0,rC[139]=0,rN[139]=0,rO[139]=1,rz[139]=0,rd[139]=-1,rm[139]=0,rg[139]=0,ry[139]=1,r_[139]=0,rv[139]=1,rx[98]=0,rb[98]=-1,rw[98]=0,rE[98]=0,rI[98]=-1,rS[98]=1,rP[98]=1,rA[98]=0,rL[98]=0,rM[98]=1,rT[98]=0,rC[98]=1,rk[98]=0,rR[98]=1,rD[98]=0,rd[98]=-1,rm[98]=0,rg[98]=1,rx[99]=0,rb[99]=1,rw[99]=0,rE[99]=0,rI[99]=-1,rS[99]=1,rP[99]=1,rA[99]=0,rL[99]=0,rM[99]=-1,rT[99]=0,rC[99]=1,rk[99]=0,rR[99]=-1,rD[99]=0,rd[99]=1,rm[99]=0,rg[99]=1,rE[38]=0,rI[38]=-1,rS[38]=1,rP[38]=1,rA[38]=0,rL[38]=0,rN[38]=0,rO[38]=1,rz[38]=1,rk[38]=0,rR[38]=1,rD[38]=0,rd[38]=-1,rm[38]=0,rg[38]=1,ry[38]=-1,r_[38]=0,rv[38]=0,rE[39]=0,rI[39]=1,rS[39]=1,rP[39]=-1,rA[39]=0,rL[39]=0,rN[39]=0,rO[39]=-1,rz[39]=1,rk[39]=0,rR[39]=1,rD[39]=0,rd[39]=-1,rm[39]=0,rg[39]=1,ry[39]=1,r_[39]=0,rv[39]=0;var rF=function(i){return[[i.bottomleft,0],[0,0],[0,i.leftbottom]]},rB=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0]]},rU=function(i){return[[i.topright,1],[1,1],[1,i.righttop]]},rG=function(i){return[[0,i.lefttop],[0,1],[i.topleft,1]]},rV=function(i){return[[i.bottomright,0],[i.bottomleft,0],[0,i.leftbottom],[0,i.lefttop]]},rq=function(i){return[[i.bottomright,0],[i.bottomleft,0],[1,i.righttop],[1,i.rightbottom]]},rj=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.topleft,1],[i.topright,1]]},rZ=function(i){return[[0,i.leftbottom],[0,i.lefttop],[i.topleft,1],[i.topright,1]]},rX=[],r$=[],rW=[],rH=[],rY=[],rK=[],rJ=[],rQ=[];rH[1]=rY[1]=18,rH[169]=rY[169]=18,rW[4]=r$[4]=12,rW[166]=r$[166]=12,rX[16]=rQ[16]=4,rX[154]=rQ[154]=4,rK[64]=rJ[64]=22,rK[106]=rJ[106]=22,rW[2]=rK[2]=17,rH[2]=rY[2]=18,rW[168]=rK[168]=17,rH[168]=rY[168]=18,rX[8]=rH[8]=9,r$[8]=rW[8]=12,rX[162]=rH[162]=9,r$[162]=rW[162]=12,rX[32]=rQ[32]=4,r$[32]=rJ[32]=1,rX[138]=rQ[138]=4,r$[138]=rJ[138]=1,rY[128]=rQ[128]=21,rK[128]=rJ[128]=22,rY[42]=rQ[42]=21,rK[42]=rJ[42]=22,r$[5]=rY[5]=14,r$[165]=rY[165]=14,rW[20]=rQ[20]=6,rW[150]=rQ[150]=6,rX[80]=rK[80]=11,rX[90]=rK[90]=11,rH[65]=rJ[65]=3,rH[105]=rJ[105]=3,rX[160]=rK[160]=11,r$[160]=rY[160]=14,rX[10]=rK[10]=11,r$[10]=rY[10]=14,rW[130]=rQ[130]=6,rH[130]=rJ[130]=3,rW[40]=rQ[40]=6,rH[40]=rJ[40]=3,r$[101]=rJ[101]=1,r$[69]=rJ[69]=1,rY[149]=rQ[149]=21,rY[21]=rQ[21]=21,rW[86]=rK[86]=17,rW[84]=rK[84]=17,rX[89]=rH[89]=9,rX[81]=rH[81]=9,rX[96]=rJ[96]=0,r$[96]=rK[96]=15,rX[74]=rJ[74]=0,r$[74]=rK[74]=15,rX[24]=rW[24]=8,rH[24]=rQ[24]=7,rX[146]=rW[146]=8,rH[146]=rQ[146]=7,r$[6]=rK[6]=15,rW[6]=rY[6]=16,r$[164]=rK[164]=15,rW[164]=rY[164]=16,rH[129]=rQ[129]=7,rY[129]=rJ[129]=20,rH[41]=rQ[41]=7,rY[41]=rJ[41]=20,rW[66]=rJ[66]=2,rH[66]=rK[66]=19,rW[104]=rJ[104]=2,rH[104]=rK[104]=19,rX[144]=rY[144]=10,rK[144]=rQ[144]=23,rX[26]=rY[26]=10,rK[26]=rQ[26]=23,r$[36]=rQ[36]=5,rW[36]=rJ[36]=2,r$[134]=rQ[134]=5,rW[134]=rJ[134]=2,rX[9]=rY[9]=10,r$[9]=rH[9]=13,rX[161]=rY[161]=10,r$[161]=rH[161]=13,r$[37]=rQ[37]=5,rY[37]=rJ[37]=20,r$[133]=rQ[133]=5,rY[133]=rJ[133]=20,rW[148]=rY[148]=16,rK[148]=rQ[148]=23,rW[22]=rY[22]=16,rK[22]=rQ[22]=23,rX[82]=rW[82]=8,rH[82]=rK[82]=19,rX[88]=rW[88]=8,rH[88]=rK[88]=19,rX[73]=rJ[73]=0,r$[73]=rH[73]=13,rX[97]=rJ[97]=0,r$[97]=rH[97]=13,rX[145]=rH[145]=9,rY[145]=rQ[145]=21,rX[25]=rH[25]=9,rY[25]=rQ[25]=21,r$[70]=rJ[70]=1,rW[70]=rK[70]=17,r$[100]=rJ[100]=1,rW[100]=rK[100]=17,rX[34]=rH[34]=9,r$[34]=rW[34]=12,rY[34]=rQ[34]=21,rK[34]=rJ[34]=22,rX[136]=rQ[136]=4,r$[136]=rJ[136]=1,rW[136]=rK[136]=17,rH[136]=rY[136]=18,rX[35]=rQ[35]=4,r$[35]=rW[35]=12,rH[35]=rY[35]=18,rK[35]=rJ[35]=22,rX[153]=rQ[153]=4,rH[153]=rY[153]=18,r$[102]=rW[102]=12,rK[102]=rJ[102]=22,rX[155]=rH[155]=9,rY[155]=rQ[155]=23,r$[103]=rJ[103]=1,rW[103]=rK[103]=17,rX[152]=rQ[152]=4,rW[152]=rK[152]=17,rH[152]=rY[152]=18,rX[156]=rW[156]=8,rH[156]=rY[156]=18,rK[156]=rQ[156]=23,rX[137]=rQ[137]=4,r$[137]=rJ[137]=1,rH[137]=rY[137]=18,rX[139]=rQ[139]=4,r$[139]=rH[139]=13,rY[139]=rJ[139]=20,rX[98]=rH[98]=9,r$[98]=rW[98]=12,rK[98]=rJ[98]=22,rX[99]=rJ[99]=0,r$[99]=rW[99]=12,rH[99]=rK[99]=19,r$[38]=rW[38]=12,rY[38]=rQ[38]=21,rK[38]=rJ[38]=22,r$[39]=rQ[39]=5,rW[39]=rY[39]=16,rK[39]=rJ[39]=22;var r0=[];function r1(i){return i.constructor.toString().indexOf("Array")>-1}function r2(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o=n.pivot,s=n.mutate;if(!i)throw Error("geojson is required");if(null==r||isNaN(r))throw Error("angle is required");return 0===r||(o||(o=eU(i)),!1!==s&&void 0!==s||(i=eo(i)),z(i,function(i){var n=rr(o,i)+r,s=ig(o,i),a=tr(ro(o,s,n));i[0]=a[0],i[1]=a[1]})),i}function r3(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o=n.origin,s=n.mutate;if(!i)throw Error("geojson required");if("number"!=typeof r||0===r)throw Error("invalid factor");var a=Array.isArray(o)||"object"==typeof o;return!0!==s&&(i=eo(i)),"FeatureCollection"!==i.type||a?r5(i,r,o):(G(i,function(n,s){i.features[s]=r5(n,r,o)}),i)}function r5(i,r,n){var o="Point"===tu(i);return n=function(i,r){if(null==r&&(r="centroid"),Array.isArray(r)||"object"==typeof r)return ti(r);var n=i.bbox?i.bbox:te(i),o=n[0],s=n[1],a=n[2],l=n[3];switch(r){case"sw":case"southwest":case"westsouth":case"bottomleft":return p([o,s]);case"se":case"southeast":case"eastsouth":case"bottomright":return p([a,s]);case"nw":case"northwest":case"westnorth":case"topleft":return p([o,l]);case"ne":case"northeast":case"eastnorth":case"topright":return p([a,l]);case"center":return eB(i);case void 0:case null:case"centroid":return eU(i);default:throw Error("invalid origin")}}(i,n),1===r||o||z(i,function(i){var o=ig(n,i),s=rr(n,i),a=tr(ro(n,o*r,s));i[0]=a[0],i[1]=a[1],3===i.length&&(i[2]*=r)}),i}function r4(i){var r=i[0],n=i[1];return[n[0]-r[0],n[1]-r[1]]}function r6(i,r){return i[0]*r[1]-r[0]*i[1]}function r8(i,r,n){var o=[],s=M(r,n),a=tr(i),l=[];return a.forEach(function(i,r){if(r!==a.length-1){var n,u,h,c,p=(n=a[r+1],u=Math.sqrt((i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])),h=i[0]+s*(n[1]-i[1])/u,c=n[0]+s*(n[1]-i[1])/u,[[h,i[1]+s*(i[0]-n[0])/u],[c,n[1]+s*(i[0]-n[0])/u]]);if(o.push(p),r>0){var f,d,m,g,y,_,v,x,b,w=o[r-1],E=0!==r6(r4(p),r4(w))&&(f=p,d=w,y=f[0],_=r4(f),v=d[0],b=r6(_,x=r4(d)),g=[(m=r6([v[0]-y[0],v[1]-y[1]],x)/b)*_[0],m*_[1]],[y[0]+g[0],y[1]+g[1]]);!1!==E&&(w[1]=E,p[0]=E),l.push(w[0]),r===a.length-2&&(l.push(p[0]),l.push(p[1]))}2===a.length&&(l.push(p[0]),l.push(p[1]))}}),g(l,i.properties)}function r9(i,r,n){var o,s=r[0]-i[0],a=r[1]-i[1],l=n[0]-r[0];return((o=s*(n[1]-r[1])-l*a)>0)-(o<0)||+o}function r7(i,r){return r.geometry.coordinates[0].every(function(r){return t9(p(r),i)})}r0[1]=r0[169]=rF,r0[4]=r0[166]=rB,r0[16]=r0[154]=rU,r0[64]=r0[106]=rG,r0[168]=r0[2]=rV,r0[162]=r0[8]=rq,r0[138]=r0[32]=rj,r0[42]=r0[128]=rZ,r0[5]=r0[165]=function(i){return[[0,0],[0,i.leftbottom],[1,i.rightbottom],[1,0]]},r0[20]=r0[150]=function(i){return[[1,0],[i.bottomright,0],[i.topright,1],[1,1]]},r0[80]=r0[90]=function(i){return[[1,1],[1,i.righttop],[0,i.lefttop],[0,1]]},r0[65]=r0[105]=function(i){return[[i.bottomleft,0],[0,0],[0,1],[i.topleft,1]]},r0[160]=r0[10]=function(i){return[[1,i.righttop],[1,i.rightbottom],[0,i.leftbottom],[0,i.lefttop]]},r0[130]=r0[40]=function(i){return[[i.topleft,1],[i.topright,1],[i.bottomright,0],[i.bottomleft,0]]},r0[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},r0[101]=r0[69]=function(i){return[[1,i.rightbottom],[1,0],[0,0],[0,1],[i.topleft,1]]},r0[149]=r0[21]=function(i){return[[i.topright,1],[1,1],[1,0],[0,0],[0,i.leftbottom]]},r0[86]=r0[84]=function(i){return[[1,0],[i.bottomright,0],[0,i.lefttop],[0,1],[1,1]]},r0[89]=r0[81]=function(i){return[[1,1],[1,i.righttop],[i.bottomleft,0],[0,0],[0,1]]},r0[96]=r0[74]=function(i){return[[1,i.righttop],[1,i.rightbottom],[0,i.lefttop],[0,1],[i.topleft,1]]},r0[24]=r0[146]=function(i){return[[1,1],[1,i.righttop],[i.bottomright,0],[i.bottomleft,0],[i.topright,1]]},r0[6]=r0[164]=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0],[0,i.leftbottom],[0,i.lefttop]]},r0[129]=r0[41]=function(i){return[[i.topright,1],[i.bottomleft,0],[0,0],[0,i.leftbottom],[i.topleft,1]]},r0[66]=r0[104]=function(i){return[[i.bottomright,0],[i.bottomleft,0],[0,i.lefttop],[0,1],[i.topleft,1]]},r0[144]=r0[26]=function(i){return[[1,1],[1,i.righttop],[0,i.leftbottom],[0,i.lefttop],[i.topright,1]]},r0[36]=r0[134]=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0],[i.topleft,1],[i.topright,1]]},r0[9]=r0[161]=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.bottomleft,0],[0,0],[0,i.leftbottom]]},r0[37]=r0[133]=function(i){return[[1,i.rightbottom],[1,0],[0,0],[0,i.leftbottom],[i.topleft,1],[i.topright,1]]},r0[148]=r0[22]=function(i){return[[1,1],[1,0],[i.bottomright,0],[0,i.leftbottom],[0,i.lefttop],[i.topright,1]]},r0[82]=r0[88]=function(i){return[[1,1],[1,i.righttop],[i.bottomright,0],[i.bottomleft,0],[0,i.lefttop],[0,1]]},r0[73]=r0[97]=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.bottomleft,0],[0,0],[0,1],[i.topleft,1]]},r0[145]=r0[25]=function(i){return[[1,1],[1,i.righttop],[i.bottomleft,0],[0,0],[0,i.leftbottom],[i.topright,1]]},r0[70]=r0[100]=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0],[0,i.lefttop],[0,1],[i.topleft,1]]},r0[34]=function(i){return[rZ(i),rq(i)]},r0[35]=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.bottomright,0],[i.bottomleft,0],[0,i.leftbottom],[0,i.lefttop],[i.topleft,1],[i.topright,1]]},r0[136]=function(i){return[rj(i),rV(i)]},r0[153]=function(i){return[rU(i),rF(i)]},r0[102]=function(i){return[rB(i),rG(i)]},r0[155]=function(i){return[[1,1],[1,i.righttop],[i.bottomleft,0],[0,0],[0,i.leftbottom],[i.topright,1]]},r0[103]=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0],[0,i.lefttop],[0,1],[i.topleft,1]]},r0[152]=function(i){return[rU(i),rV(i)]},r0[156]=function(i){return[[1,1],[1,i.righttop],[i.bottomright,0],[i.bottomleft,0],[0,i.leftbottom],[0,i.lefttop],[i.topright,1]]},r0[137]=function(i){return[rj(i),rF(i)]},r0[139]=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.bottomleft,0],[0,0],[0,i.leftbottom],[i.topleft,1],[i.topright,1]]},r0[98]=function(i){return[rq(i),rG(i)]},r0[99]=function(i){return[[1,i.righttop],[1,i.rightbottom],[i.bottomright,0],[i.bottomleft,0],[0,i.lefttop],[0,1],[i.topleft,1]]},r0[38]=function(i){return[rB(i),rZ(i)]},r0[39]=function(i){return[[1,i.rightbottom],[1,0],[i.bottomright,0],[0,i.leftbottom],[0,i.lefttop],[i.topleft,1],[i.topright,1]]};var nt=function(){function i(r){this.id=i.buildId(r),this.coordinates=r,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return i.buildId=function(i){return i.join(",")},i.prototype.removeInnerEdge=function(i){this.innerEdges=this.innerEdges.filter(function(r){return r.from.id!==i.from.id})},i.prototype.removeOuterEdge=function(i){this.outerEdges=this.outerEdges.filter(function(r){return r.to.id!==i.to.id})},i.prototype.addOuterEdge=function(i){this.outerEdges.push(i),this.outerEdgesSorted=!1},i.prototype.sortOuterEdges=function(){var i=this;this.outerEdgesSorted||(this.outerEdges.sort(function(r,n){var o=r.to,s=n.to;if(o.coordinates[0]-i.coordinates[0]>=0&&s.coordinates[0]-i.coordinates[0]<0)return 1;if(o.coordinates[0]-i.coordinates[0]<0&&s.coordinates[0]-i.coordinates[0]>=0)return -1;if(o.coordinates[0]-i.coordinates[0]==0&&s.coordinates[0]-i.coordinates[0]==0)return o.coordinates[1]-i.coordinates[1]>=0||s.coordinates[1]-i.coordinates[1]>=0?o.coordinates[1]-s.coordinates[1]:s.coordinates[1]-o.coordinates[1];var a=r9(i.coordinates,o.coordinates,s.coordinates);return a<0?1:a>0?-1:Math.pow(o.coordinates[0]-i.coordinates[0],2)+Math.pow(o.coordinates[1]-i.coordinates[1],2)-(Math.pow(s.coordinates[0]-i.coordinates[0],2)+Math.pow(s.coordinates[1]-i.coordinates[1],2))}),this.outerEdgesSorted=!0)},i.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},i.prototype.getOuterEdge=function(i){return this.sortOuterEdges(),this.outerEdges[i]},i.prototype.addInnerEdge=function(i){this.innerEdges.push(i)},i}(),ne=function(){function i(i,r){this.from=i,this.to=r,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return i.prototype.getSymetric=function(){return this.symetric||(this.symetric=new i(this.to,this.from),this.symetric.symetric=this),this.symetric},i.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},i.prototype.isEqual=function(i){return this.from.id===i.from.id&&this.to.id===i.to.id},i.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},i.prototype.toLineString=function(){return g([this.from.coordinates,this.to.coordinates])},i.prototype.compareTo=function(i){return r9(i.from.coordinates,i.to.coordinates,this.to.coordinates)},i}(),ni=function(){function i(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return i.prototype.push=function(i){this.edges.push(i),this.polygon=this.envelope=void 0},i.prototype.get=function(i){return this.edges[i]},Object.defineProperty(i.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),i.prototype.forEach=function(i){this.edges.forEach(i)},i.prototype.map=function(i){return this.edges.map(i)},i.prototype.some=function(i){return this.edges.some(i)},i.prototype.isValid=function(){return!0},i.prototype.isHole=function(){var i=this,r=this.edges.reduce(function(r,n,o){return n.from.coordinates[1]>i.edges[r].from.coordinates[1]&&(r=o),r},0),n=(0===r?this.length:r)-1,o=(r+1)%this.length,s=r9(this.edges[n].from.coordinates,this.edges[r].from.coordinates,this.edges[o].from.coordinates);return 0===s?this.edges[n].from.coordinates[0]>this.edges[o].from.coordinates[0]:s>0},i.prototype.toMultiPoint=function(){return x(this.edges.map(function(i){return i.from.coordinates}))},i.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var i=this.edges.map(function(i){return i.from.coordinates});return i.push(this.edges[0].from.coordinates),this.polygon=d([i])},i.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=eD(this.toPolygon())},i.findEdgeRingContaining=function(i,r){var n,o,s=i.getEnvelope();return r.forEach(function(r){var a,l,u,h,c=r.getEnvelope();if(o&&(n=o.getEnvelope()),a=c.geometry.coordinates[0].map(function(i){return i[0]}),l=c.geometry.coordinates[0].map(function(i){return i[1]}),u=s.geometry.coordinates[0].map(function(i){return i[0]}),h=s.geometry.coordinates[0].map(function(i){return i[1]}),(Math.max.apply(null,a)!==Math.max.apply(null,u)||Math.max.apply(null,l)!==Math.max.apply(null,h)||Math.min.apply(null,a)!==Math.min.apply(null,u)||Math.min.apply(null,l)!==Math.min.apply(null,h))&&r7(c,s)){for(var f=i.map(function(i){return i.from.coordinates}),d=void 0,m=function(i){r.some(function(r){var n;return n=r.from.coordinates,i[0]===n[0]&&i[1]===n[1]})||(d=i)},g=0;g<f.length;g++)m(f[g]);d&&r.inside(p(d))&&(o&&!r7(n,c)||(o=r))}}),o},i.prototype.inside=function(i){return t9(i,this.toPolygon())},i}(),nr=function(){function i(){this.edges=[],this.nodes={}}return i.fromGeoJson=function(r){!function(i){if(!i)throw Error("No geojson passed");if("FeatureCollection"!==i.type&&"GeometryCollection"!==i.type&&"MultiLineString"!==i.type&&"LineString"!==i.type&&"Feature"!==i.type)throw Error("Invalid input type '"+i.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(r);var n=new i;return X(r,function(i){ts(i,"LineString","Graph::fromGeoJson"),F(i,function(i,r){if(i){var o=n.getNode(i),s=n.getNode(r);n.addEdge(o,s)}return r})}),n},i.prototype.getNode=function(i){var r=nt.buildId(i),n=this.nodes[r];return n||(n=this.nodes[r]=new nt(i)),n},i.prototype.addEdge=function(i,r){var n=new ne(i,r),o=n.getSymetric();this.edges.push(n),this.edges.push(o)},i.prototype.deleteDangles=function(){var i=this;Object.keys(this.nodes).map(function(r){return i.nodes[r]}).forEach(function(r){return i._removeIfDangle(r)})},i.prototype._removeIfDangle=function(i){var r=this;if(i.innerEdges.length<=1){var n=i.getOuterEdges().map(function(i){return i.to});this.removeNode(i),n.forEach(function(i){return r._removeIfDangle(i)})}},i.prototype.deleteCutEdges=function(){var i=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(r){r.label===r.symetric.label&&(i.removeEdge(r.symetric),i.removeEdge(r))})},i.prototype._computeNextCWEdges=function(i){var r=this;void 0===i?Object.keys(this.nodes).forEach(function(i){return r._computeNextCWEdges(r.nodes[i])}):i.getOuterEdges().forEach(function(r,n){i.getOuterEdge((0===n?i.getOuterEdges().length:n)-1).symetric.next=r})},i.prototype._computeNextCCWEdges=function(i,r){for(var n,o,s=i.getOuterEdges(),a=s.length-1;a>=0;--a){var l=s[a],u=l.symetric,h=void 0,c=void 0;l.label===r&&(h=l),u.label===r&&(c=u),h&&c&&(c&&(o=c),h&&(o&&(o.next=h,o=void 0),n||(n=h)))}o&&(o.next=n)},i.prototype._findLabeledEdgeRings=function(){var i=[],r=0;return this.edges.forEach(function(n){if(!(n.label>=0)){i.push(n);var o=n;do o.label=r,o=o.next;while(!n.isEqual(o))r++}}),i},i.prototype.getEdgeRings=function(){var i=this;this._computeNextCWEdges(),this.edges.forEach(function(i){i.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){i._findIntersectionNodes(r).forEach(function(n){i._computeNextCCWEdges(n,r.label)})});var r=[];return this.edges.forEach(function(n){n.ring||r.push(i._findEdgeRing(n))}),r},i.prototype._findIntersectionNodes=function(i){var r=[],n=i;do(function(){var o=0;n.from.getOuterEdges().forEach(function(r){r.label===i.label&&++o}),o>1&&r.push(n.from),n=n.next})();while(!i.isEqual(n))return r},i.prototype._findEdgeRing=function(i){var r=i,n=new ni;do n.push(r),r.ring=n,r=r.next;while(!i.isEqual(r))return n},i.prototype.removeNode=function(i){var r=this;i.getOuterEdges().forEach(function(i){return r.removeEdge(i)}),i.innerEdges.forEach(function(i){return r.removeEdge(i)}),delete this.nodes[i.id]},i.prototype.removeEdge=function(i){this.edges=this.edges.filter(function(r){return!r.isEqual(i)}),i.deleteEdge()},i}();function nn(i,r){var n=!0;return X(i,function(i){X(r,function(r){if(!1===n)return!1;n=function(i,r){var n,o;switch(i.type){case"Point":switch(r.type){case"Point":return n=i.coordinates,o=r.coordinates,n[0]!==o[0]||n[1]!==o[1];case"LineString":return!no(r,i);case"Polygon":return!t9(i,r)}break;case"LineString":switch(r.type){case"Point":return!no(i,r);case"LineString":return!(ip(i,r).features.length>0);case"Polygon":return!ns(r,i)}break;case"Polygon":switch(r.type){case"Point":return!t9(r,i);case"LineString":return!ns(i,r);case"Polygon":return!function(i,r){for(var n=0,o=i.coordinates[0];n<o.length;n++)if(t9(o[n],r))return!0;for(var s=0,a=r.coordinates[0];s<a.length;s++)if(t9(a[s],i))return!0;return ip(iJ(i),iJ(r)).features.length>0}(r,i)}}return!1}(i.geometry,r.geometry)})}),n}function no(i,r){for(var n=0;n<i.coordinates.length-1;n++)if(function(i,r,n){var o=n[0]-i[0],s=n[1]-i[1],a=r[0]-i[0],l=r[1]-i[1];return 0==o*l-s*a&&(Math.abs(a)>=Math.abs(l)?a>0?i[0]<=n[0]&&n[0]<=r[0]:r[0]<=n[0]&&n[0]<=i[0]:l>0?i[1]<=n[1]&&n[1]<=r[1]:r[1]<=n[1]&&n[1]<=i[1])}(i.coordinates[n],i.coordinates[n+1],r.coordinates))return!0;return!1}function ns(i,r){for(var n=0,o=r.coordinates;n<o.length;n++)if(t9(o[n],i))return!0;return ip(r,iJ(i)).features.length>0}function na(i,r){return!(i[0]>r[0])&&!(i[2]<r[2])&&!(i[1]>r[1])&&!(i[3]<r[3])}function nl(i,r){return i[0]===r[0]&&i[1]===r[1]}function nu(i,r){for(var n=!1,o=!1,s=i.coordinates.length,a=0;a<s&&!n&&!o;){for(var l=0;l<r.coordinates.length-1;l++){var u=!0;0!==l&&l!==r.coordinates.length-2||(u=!1),np(r.coordinates[l],r.coordinates[l+1],i.coordinates[a],u)?n=!0:o=!0}a++}return n&&o}function nh(i,r){return ip(i,iQ(r)).features.length>0}function nc(i,r){for(var n=!1,o=!1,s=i.coordinates.length,a=0;a<s&&(!n||!o);a++)t9(p(i.coordinates[a]),r)?n=!0:o=!0;return o&&n}function np(i,r,n,o){var s=n[0]-i[0],a=n[1]-i[1],l=r[0]-i[0],u=r[1]-i[1];return 0==s*u-a*l&&(o?Math.abs(l)>=Math.abs(u)?l>0?i[0]<=n[0]&&n[0]<=r[0]:r[0]<=n[0]&&n[0]<=i[0]:u>0?i[1]<=n[1]&&n[1]<=r[1]:r[1]<=n[1]&&n[1]<=i[1]:Math.abs(l)>=Math.abs(u)?l>0?i[0]<n[0]&&n[0]<r[0]:r[0]<n[0]&&n[0]<i[0]:u>0?i[1]<n[1]&&n[1]<r[1]:r[1]<n[1]&&n[1]<i[1])}var nf=function(i){this.precision=i&&i.precision?i.precision:17,this.direction=!(!i||!i.direction)&&i.direction,this.pseudoNode=!(!i||!i.pseudoNode)&&i.pseudoNode,this.objectComparator=i&&i.objectComparator?i.objectComparator:ng};function nd(i){return i.coordinates.map(function(r){return{type:i.type.replace("Multi",""),coordinates:r}})}function nm(i,r){return i.hasOwnProperty("coordinates")?i.coordinates.length===r.coordinates.length:i.length===r.length}function ng(i,r){return i7(i,r,{strict:!0})}function ny(i,r){var n=!1;return X(i,function(i){X(r,function(r){if(!0===n)return!0;n=!nn(i.geometry,r.geometry)})}),n}nf.prototype.compare=function(i,r){if(i.type!==r.type||!nm(i,r))return!1;switch(i.type){case"Point":return this.compareCoord(i.coordinates,r.coordinates);case"LineString":return this.compareLine(i.coordinates,r.coordinates,0,!1);case"Polygon":return this.comparePolygon(i,r);case"Feature":return this.compareFeature(i,r);default:if(0===i.type.indexOf("Multi")){var n=this,o=nd(i),s=nd(r);return o.every(function(i){return this.some(function(r){return n.compare(i,r)})},s)}}return!1},nf.prototype.compareCoord=function(i,r){if(i.length!==r.length)return!1;for(var n=0;n<i.length;n++)if(i[n].toFixed(this.precision)!==r[n].toFixed(this.precision))return!1;return!0},nf.prototype.compareLine=function(i,r,n,o){if(!nm(i,r))return!1;var s=this.pseudoNode?i:this.removePseudo(i),a=this.pseudoNode?r:this.removePseudo(r);if(!o||this.compareCoord(s[0],a[0])||(a=this.fixStartIndex(a,s))){var l=this.compareCoord(s[n],a[n]);return this.direction||l?this.comparePath(s,a):!!this.compareCoord(s[n],a[a.length-(1+n)])&&this.comparePath(s.slice().reverse(),a)}},nf.prototype.fixStartIndex=function(i,r){for(var n,o=-1,s=0;s<i.length;s++)if(this.compareCoord(i[s],r[0])){o=s;break}return o>=0&&(n=[].concat(i.slice(o,i.length),i.slice(1,o+1))),n},nf.prototype.comparePath=function(i,r){var n=this;return i.every(function(i,r){return n.compareCoord(i,this[r])},r)},nf.prototype.comparePolygon=function(i,r){if(this.compareLine(i.coordinates[0],r.coordinates[0],1,!0)){var n=i.coordinates.slice(1,i.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length),s=this;return n.every(function(i){return this.some(function(r){return s.compareLine(i,r,1,!0)})},o)}return!1},nf.prototype.compareFeature=function(i,r){return!(i.id!==r.id||!this.objectComparator(i.properties,r.properties)||!this.compareBBox(i,r))&&this.compare(i.geometry,r.geometry)},nf.prototype.compareBBox=function(i,r){return!!(!i.bbox&&!r.bbox||i.bbox&&r.bbox&&this.compareCoord(i.bbox,r.bbox))},nf.prototype.removePseudo=function(i){return i};var n_=tz(function(i){function r(i,r,n,o){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(i,r,n,o)}r.prototype.run=function(i,r,n,o){this._init(i,r,n,o);for(var s=0;s<this._datasetLength;s++)if(1!==this._visited[s]){this._visited[s]=1;var a=this._regionQuery(s);if(a.length<this.minPts)this.noise.push(s);else{var l=this.clusters.length;this.clusters.push([]),this._addToCluster(s,l),this._expandCluster(l,a)}}return this.clusters},r.prototype._init=function(i,r,n,o){if(i){if(!(i instanceof Array))throw Error("Dataset must be of type array, "+typeof i+" given");this.dataset=i,this.clusters=[],this.noise=[],this._datasetLength=i.length,this._visited=Array(this._datasetLength),this._assigned=Array(this._datasetLength)}r&&(this.epsilon=r),n&&(this.minPts=n),o&&(this.distance=o)},r.prototype._expandCluster=function(i,r){for(var n=0;n<r.length;n++){var o=r[n];if(1!==this._visited[o]){this._visited[o]=1;var s=this._regionQuery(o);s.length>=this.minPts&&(r=this._mergeArrays(r,s))}1!==this._assigned[o]&&this._addToCluster(o,i)}},r.prototype._addToCluster=function(i,r){this.clusters[r].push(i),this._assigned[i]=1},r.prototype._regionQuery=function(i){for(var r=[],n=0;n<this._datasetLength;n++)this.distance(this.dataset[i],this.dataset[n])<this.epsilon&&r.push(n);return r},r.prototype._mergeArrays=function(i,r){for(var n=r.length,o=0;o<n;o++){var s=r[o];0>i.indexOf(s)&&i.push(s)}return i},r.prototype._euclideanDistance=function(i,r){for(var n=0,o=Math.min(i.length,r.length);o--;)n+=(i[o]-r[o])*(i[o]-r[o]);return Math.sqrt(n)},i.exports&&(i.exports=r)}),nv=tz(function(i){function r(i,r,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(i,r,n)}r.prototype.init=function(i,r,n){this.assignments=[],this.centroids=[],void 0!==i&&(this.dataset=i),void 0!==r&&(this.k=r),void 0!==n&&(this.distance=n)},r.prototype.run=function(i,r){this.init(i,r);for(var n=this.dataset.length,o=0;o<this.k;o++)this.centroids[o]=this.randomCentroid();for(var s=!0;s;){s=this.assign();for(var a=0;a<this.k;a++){for(var l=Array(p),u=0,h=0;h<p;h++)l[h]=0;for(var c=0;c<n;c++){var p=this.dataset[c].length;if(a===this.assignments[c]){for(h=0;h<p;h++)l[h]+=this.dataset[c][h];u++}}if(u>0){for(h=0;h<p;h++)l[h]/=u;this.centroids[a]=l}else this.centroids[a]=this.randomCentroid(),s=!0}}return this.getClusters()},r.prototype.randomCentroid=function(){var i,r,n=this.dataset.length-1;do r=Math.round(Math.random()*n),i=this.dataset[r];while(this.centroids.indexOf(i)>=0)return i},r.prototype.assign=function(){for(var i,r=!1,n=this.dataset.length,o=0;o<n;o++)(i=this.argmin(this.dataset[o],this.centroids,this.distance))!=this.assignments[o]&&(this.assignments[o]=i,r=!0);return r},r.prototype.getClusters=function(){for(var i,r=Array(this.k),n=0;n<this.assignments.length;n++)void 0===r[i=this.assignments[n]]&&(r[i]=[]),r[i].push(n);return r},r.prototype.argmin=function(i,r,n){for(var o,s=Number.MAX_VALUE,a=0,l=r.length,u=0;u<l;u++)(o=n(i,r[u]))<s&&(s=o,a=u);return a},r.prototype.distance=function(i,r){for(var n=0,o=Math.min(i.length,r.length);o--;){var s=i[o]-r[o];n+=s*s}return Math.sqrt(n)},i.exports&&(i.exports=r)}),nx=tz(function(i){function r(i,r,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(i,r,n)}r.prototype.insert=function(i,r){for(var n=this._queue.length,o=n;o--;){var s=this._priorities[o];"desc"===this._sorting?r>s&&(n=o):r<s&&(n=o)}this._insertAt(i,r,n)},r.prototype.remove=function(i){for(var r=this._queue.length;r--;)if(i===this._queue[r]){this._queue.splice(r,1),this._priorities.splice(r,1);break}},r.prototype.forEach=function(i){this._queue.forEach(i)},r.prototype.getElements=function(){return this._queue},r.prototype.getElementPriority=function(i){return this._priorities[i]},r.prototype.getPriorities=function(){return this._priorities},r.prototype.getElementsWithPriorities=function(){for(var i=[],r=0,n=this._queue.length;r<n;r++)i.push([this._queue[r],this._priorities[r]]);return i},r.prototype._init=function(i,r,n){if(i&&r){if(this._queue=[],this._priorities=[],i.length!==r.length)throw Error("Arrays must have the same length");for(var o=0;o<i.length;o++)this.insert(i[o],r[o])}n&&(this._sorting=n)},r.prototype._insertAt=function(i,r,n){this._queue.length===n?(this._queue.push(i),this._priorities.push(r)):(this._queue.splice(n,0,i),this._priorities.splice(n,0,r))},i.exports&&(i.exports=r)}),nb=tz(function(i){if(i.exports)var r=nx;function n(i,r,n,o){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(i,r,n,o)}n.prototype.run=function(i,n,o,s){this._init(i,n,o,s);for(var a=0,l=this.dataset.length;a<l;a++)if(1!==this._processed[a]){this._processed[a]=1,this.clusters.push([a]);var u=this.clusters.length-1;this._orderedList.push(a);var h=new r(null,null,"asc"),c=this._regionQuery(a);void 0!==this._distanceToCore(a)&&(this._updateQueue(a,c,h),this._expandCluster(u,h))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var i=[],r=0,n=this._orderedList.length;r<n;r++){var o=this._orderedList[r],s=this._reachability[o];i.push([o,s])}return i},n.prototype._init=function(i,r,n,o){if(i){if(!(i instanceof Array))throw Error("Dataset must be of type array, "+typeof i+" given");this.dataset=i,this.clusters=[],this._reachability=Array(this.dataset.length),this._processed=Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}r&&(this.epsilon=r),n&&(this.minPts=n),o&&(this.distance=o)},n.prototype._updateQueue=function(i,r,n){var o=this;this._coreDistance=this._distanceToCore(i),r.forEach(function(r){if(void 0===o._processed[r]){var s=o.distance(o.dataset[i],o.dataset[r]),a=Math.max(o._coreDistance,s);void 0===o._reachability[r]?(o._reachability[r]=a,n.insert(r,a)):a<o._reachability[r]&&(o._reachability[r]=a,n.remove(r),n.insert(r,a))}})},n.prototype._expandCluster=function(i,r){for(var n=r.getElements(),o=0,s=n.length;o<s;o++){var a=n[o];if(void 0===this._processed[a]){var l=this._regionQuery(a);this._processed[a]=1,this.clusters[i].push(a),this._orderedList.push(a),void 0!==this._distanceToCore(a)&&(this._updateQueue(a,l,r),this._expandCluster(i,r))}}},n.prototype._distanceToCore=function(i){for(var r=this.epsilon,n=0;n<r;n++)if(this._regionQuery(i,n).length>=this.minPts)return n},n.prototype._regionQuery=function(i,r){r=r||this.epsilon;for(var n=[],o=0,s=this.dataset.length;o<s;o++)this.distance(this.dataset[i],this.dataset[o])<r&&n.push(o);return n},n.prototype._euclideanDistance=function(i,r){for(var n=0,o=Math.min(i.length,r.length);o--;)n+=(i[o]-r[o])*(i[o]-r[o]);return Math.sqrt(n)},i.exports&&(i.exports=n)}),nw=tz(function(i){i.exports&&(i.exports={DBSCAN:n_,KMEANS:nv,OPTICS:nb,PriorityQueue:nx})}),nE=function(i,r,n){for(var o=i.length,s=0,a=0;a<o;a++){var l=(i[a]||0)-(r[a]||0);s+=l*l}return n?Math.sqrt(s):s},nI=function(i,r,n){var o=Math.abs(i-r);return n?o:o*o},nS=function(i,r){for(var n={},o=[],s=r<<2,a=i.length,l=i[0].length>0;o.length<r&&s-- >0;){var u=i[Math.floor(Math.random()*a)],h=l?u.join("_"):""+u;n[h]||(n[h]=!0,o.push(u))}if(o.length<r)throw Error("Error initializating clusters");return o},nM=function(i,r){var n=i[0].length?nE:nI,o=[],s=i.length,a=i[0].length>0,l=i[Math.floor(Math.random()*s)];for(a&&l.join("_"),o.push(l);o.length<r;){for(var u=[],h=o.length,c=0,p=[],f=0;f<s;f++){for(var d=1/0,m=0;m<h;m++){var g=n(i[f],o[m]);g<=d&&(d=g)}u[f]=d}for(var y=0;y<s;y++)c+=u[y];for(var _=0;_<s;_++)p[_]={i:_,v:i[_],pr:u[_]/c,cs:0};p.sort(function(i,r){return i.pr-r.pr}),p[0].cs=p[0].pr;for(var v=1;v<s;v++)p[v].cs=p[v-1].cs+p[v].pr;for(var x=Math.random(),b=0;b<s-1&&p[b++].cs<x;);o.push(p[b-1].v)}return o};function nT(i,r,n){n=n||[];for(var o=0;o<i;o++)n[o]=r;return n}var nC=function(i,r,n,o){var s=[],a=[],l=[],u=[],h=!1,c=o||1e4,p=i.length,f=i[0].length,d=f>0,m=[];if(n)s="kmrand"==n?nS(i,r):"kmpp"==n?nM(i,r):n;else for(var g={};s.length<r;){var y=Math.floor(Math.random()*p);g[y]||(g[y]=!0,s.push(i[y]))}do{nT(r,0,m);for(var _=0;_<p;_++){for(var v=1/0,x=0,b=0;b<r;b++)(u=d?nE(i[_],s[b]):Math.abs(i[_]-s[b]))<=v&&(v=u,x=b);l[_]=x,m[x]++}for(var w=[],E=(a=[],0);E<r;E++)w[E]=d?nT(f,0,w[E]):0,a[E]=s[E];if(d){for(var I=0;I<r;I++)s[I]=[];for(var S=0;S<p;S++)for(var M=w[l[S]],T=i[S],C=0;C<f;C++)M[C]+=T[C];h=!0;for(var P=0;P<r;P++){for(var A=s[P],L=w[P],k=a[P],R=m[P],D=0;D<f;D++)A[D]=L[D]/R||0;if(h){for(var N=0;N<f;N++)if(k[N]!=A[N]){h=!1;break}}}}else{for(var O=0;O<p;O++)w[l[O]]+=i[O];for(var z=0;z<r;z++)s[z]=w[z]/m[z]||0;h=!0;for(var F=0;F<r;F++)if(a[F]!=s[F]){h=!1;break}}h=h||--c<=0}while(!h)return{it:1e4-c,k:r,idxs:l,centroids:s}};function nP(i,r){if(i.geometry&&i.geometry.type)return i.geometry.type;if(i.type)return i.type;throw Error("Invalid GeoJSON object for "+r)}function nA(i){for(var r=i,n=[];r.parent;)n.unshift(r),r=r.parent;return n}var nL={search:function(i,r,n,o){i.cleanDirty();var s=(o=o||{}).heuristic||nL.heuristics.manhattan,a=o.closest||!1,l=new nD(function(i){return i.f}),u=r;for(r.h=s(r,n),l.push(r);l.size()>0;){var h=l.pop();if(h===n)return nA(h);h.closed=!0;for(var c=i.neighbors(h),p=0,f=c.length;p<f;++p){var d=c[p];if(!d.closed&&!d.isWall()){var m=h.g+d.getCost(h),g=d.visited;(!g||m<d.g)&&(d.visited=!0,d.parent=h,d.h=d.h||s(d,n),d.g=m,d.f=d.g+d.h,i.markDirty(d),a&&(d.h<u.h||d.h===u.h&&d.g<u.g)&&(u=d),g?l.rescoreElement(d):l.push(d))}}}return a?nA(u):[]},heuristics:{manhattan:function(i,r){return Math.abs(r.x-i.x)+Math.abs(r.y-i.y)},diagonal:function(i,r){var n=Math.sqrt(2),o=Math.abs(r.x-i.x),s=Math.abs(r.y-i.y);return+(o+s)+(n-2)*Math.min(o,s)}},cleanNode:function(i){i.f=0,i.g=0,i.h=0,i.visited=!1,i.closed=!1,i.parent=null}};function nk(i,r){r=r||{},this.nodes=[],this.diagonal=!!r.diagonal,this.grid=[];for(var n=0;n<i.length;n++){this.grid[n]=[];for(var o=0,s=i[n];o<s.length;o++){var a=new nR(n,o,s[o]);this.grid[n][o]=a,this.nodes.push(a)}}this.init()}function nR(i,r,n){this.x=i,this.y=r,this.weight=n}function nD(i){this.content=[],this.scoreFunction=i}function nN(i){return function(){return i}}function nO(i){return i[0]}function nz(i){return i[1]}function nF(){this._=null}function nB(i){i.U=i.C=i.L=i.R=i.P=i.N=null}function nU(i,r){var n=r.R,o=r.U;o?o.L===r?o.L=n:o.R=n:i._=n,n.U=o,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function nG(i,r){var n=r.L,o=r.U;o?o.L===r?o.L=n:o.R=n:i._=n,n.U=o,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function nV(i){for(;i.L;)i=i.L;return i}function nq(i,r,n,o){var s=[null,null],a=n6.push(s)-1;return s.left=i,s.right=r,n&&nZ(s,i,r,n),o&&nZ(s,r,i,o),n5[i.index].halfedges.push(a),n5[r.index].halfedges.push(a),s}function nj(i,r,n){var o=[r,n];return o.left=i,o}function nZ(i,r,n,o){i[0]||i[1]?i.left===n?i[1]=o:i[0]=o:(i[0]=o,i.left=r,i.right=n)}function nX(i,r){return r[+(r.left!==i.site)]}nk.prototype.init=function(){this.dirtyNodes=[];for(var i=0;i<this.nodes.length;i++)nL.cleanNode(this.nodes[i])},nk.prototype.cleanDirty=function(){for(var i=0;i<this.dirtyNodes.length;i++)nL.cleanNode(this.dirtyNodes[i]);this.dirtyNodes=[]},nk.prototype.markDirty=function(i){this.dirtyNodes.push(i)},nk.prototype.neighbors=function(i){var r=[],n=i.x,o=i.y,s=this.grid;return s[n-1]&&s[n-1][o]&&r.push(s[n-1][o]),s[n+1]&&s[n+1][o]&&r.push(s[n+1][o]),s[n]&&s[n][o-1]&&r.push(s[n][o-1]),s[n]&&s[n][o+1]&&r.push(s[n][o+1]),this.diagonal&&(s[n-1]&&s[n-1][o-1]&&r.push(s[n-1][o-1]),s[n+1]&&s[n+1][o-1]&&r.push(s[n+1][o-1]),s[n-1]&&s[n-1][o+1]&&r.push(s[n-1][o+1]),s[n+1]&&s[n+1][o+1]&&r.push(s[n+1][o+1])),r},nk.prototype.toString=function(){for(var i,r,n,o,s=[],a=this.grid,l=0,u=a.length;l<u;l++){for(i=[],n=0,o=(r=a[l]).length;n<o;n++)i.push(r[n].weight);s.push(i.join(" "))}return s.join("\n")},nR.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},nR.prototype.getCost=function(i){return i&&i.x!==this.x&&i.y!==this.y?1.41421*this.weight:this.weight},nR.prototype.isWall=function(){return 0===this.weight},nD.prototype={push:function(i){this.content.push(i),this.sinkDown(this.content.length-1)},pop:function(){var i=this.content[0],r=this.content.pop();return this.content.length>0&&(this.content[0]=r,this.bubbleUp(0)),i},remove:function(i){var r=this.content.indexOf(i),n=this.content.pop();r!==this.content.length-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(i)?this.sinkDown(r):this.bubbleUp(r))},size:function(){return this.content.length},rescoreElement:function(i){this.sinkDown(this.content.indexOf(i))},sinkDown:function(i){for(var r=this.content[i];i>0;){var n=(i+1>>1)-1,o=this.content[n];if(!(this.scoreFunction(r)<this.scoreFunction(o)))break;this.content[n]=r,this.content[i]=o,i=n}},bubbleUp:function(i){for(var r=this.content.length,n=this.content[i],o=this.scoreFunction(n);;){var s,a=i+1<<1,l=a-1,u=null;if(l<r){var h=this.content[l];(s=this.scoreFunction(h))<o&&(u=l)}if(a<r){var c=this.content[a];this.scoreFunction(c)<(null===u?o:s)&&(u=a)}if(null===u)break;this.content[i]=this.content[u],this.content[u]=n,i=u}}},nF.prototype={constructor:nF,insert:function(i,r){var n,o,s;if(i){if(r.P=i,r.N=i.N,i.N&&(i.N.P=r),i.N=r,i.R){for(i=i.R;i.L;)i=i.L;i.L=r}else i.R=r;n=i}else this._?(i=nV(this._),r.P=null,r.N=i,i.P=i.L=r,n=i):(r.P=r.N=null,this._=r,n=null);for(r.L=r.R=null,r.U=n,r.C=!0,i=r;n&&n.C;)n===(o=n.U).L?(s=o.R)&&s.C?(n.C=s.C=!1,o.C=!0,i=o):(i===n.R&&(nU(this,n),n=(i=n).U),n.C=!1,o.C=!0,nG(this,o)):(s=o.L)&&s.C?(n.C=s.C=!1,o.C=!0,i=o):(i===n.L&&(nG(this,n),n=(i=n).U),n.C=!1,o.C=!0,nU(this,o)),n=i.U;this._.C=!1},remove:function(i){i.N&&(i.N.P=i.P),i.P&&(i.P.N=i.N),i.N=i.P=null;var r,n,o,s=i.U,a=i.L,l=i.R;if(n=a?l?nV(l):a:l,s?s.L===i?s.L=n:s.R=n:this._=n,a&&l?(o=n.C,n.C=i.C,n.L=a,a.U=n,n!==l?(s=n.U,n.U=i.U,i=n.R,s.L=i,n.R=l,l.U=n):(n.U=s,s=n,i=n.R)):(o=i.C,i=n),i&&(i.U=s),!o){if(i&&i.C)i.C=!1;else{do{if(i===this._)break;if(i===s.L){if((r=s.R).C&&(r.C=!1,s.C=!0,nU(this,s),r=s.R),r.L&&r.L.C||r.R&&r.R.C){r.R&&r.R.C||(r.L.C=!1,r.C=!0,nG(this,r),r=s.R),r.C=s.C,s.C=r.R.C=!1,nU(this,s),i=this._;break}}else if((r=s.L).C&&(r.C=!1,s.C=!0,nG(this,s),r=s.L),r.L&&r.L.C||r.R&&r.R.C){r.L&&r.L.C||(r.R.C=!1,r.C=!0,nU(this,r),r=s.L),r.C=s.C,s.C=r.L.C=!1,nG(this,s),i=this._;break}r.C=!0,i=s,s=s.U}while(!i.C)i&&(i.C=!1)}}}};var n$,nW=[];function nH(){nB(this),this.x=this.y=this.arc=this.site=this.cy=null}function nY(i){var r=i.P,n=i.N;if(r&&n){var o=r.site,s=i.site,a=n.site;if(o!==a){var l=s[0],u=s[1],h=o[0]-l,c=o[1]-u,p=a[0]-l,f=a[1]-u,d=2*(h*f-c*p);if(!(d>=-n8)){var m=h*h+c*c,g=p*p+f*f,y=(f*m-c*g)/d,_=(h*g-p*m)/d,v=nW.pop()||new nH;v.arc=i,v.site=s,v.x=y+l,v.y=(v.cy=_+u)+Math.sqrt(y*y+_*_),i.circle=v;for(var x=null,b=n4._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x){if(!b.L){x=b.P;break}b=b.L}else{if(!b.R){x=b;break}b=b.R}n4.insert(x,v),x||(n$=v)}}}}function nK(i){var r=i.circle;r&&(r.P||(n$=r.N),n4.remove(r),nW.push(r),nB(r),i.circle=null)}var nJ=[];function nQ(){nB(this),this.edge=this.site=this.circle=null}function n0(i){var r=nJ.pop()||new nQ;return r.site=i,r}function n1(i){nK(i),n3.remove(i),nJ.push(i),nB(i)}function n2(i,r){var n=i.site,o=n[0],s=n[1],a=s-r;if(!a)return o;var l=i.P;if(!l)return-1/0;var u=(n=l.site)[0],h=n[1],c=h-r;if(!c)return u;var p=u-o,f=1/a-1/c,d=p/c;return f?(-d+Math.sqrt(d*d-2*f*(p*p/(-2*c)-h+c/2+s-a/2)))/f+o:(o+u)/2}var n3,n5,n4,n6,n8=1e-12;function n9(i,r){return r[1]-i[1]||r[0]-i[0]}function n7(i,r){var n,o,s,a=i.sort(n9).pop();for(n6=[],n5=Array(i.length),n3=new nF,n4=new nF;;)if(s=n$,a&&(!s||a[1]<s.y||a[1]===s.y&&a[0]<s.x))a[0]===n&&a[1]===o||(function(i){for(var r,n,o,s,a=i[0],l=i[1],u=n3._;u;)if((o=n2(u,l)-a)>1e-6)u=u.L;else{if(!((s=a-function(i,r){var n=i.N;if(n)return n2(n,r);var o=i.site;return o[1]===r?o[0]:1/0}(u,l))>1e-6)){o>-1e-6?(r=u.P,n=u):s>-1e-6?(r=u,n=u.N):r=n=u;break}if(!u.R){r=u;break}u=u.R}n5[i.index]={site:i,halfedges:[]};var h=n0(i);if(n3.insert(r,h),r||n){if(r===n)return nK(r),n=n0(r.site),n3.insert(h,n),h.edge=n.edge=nq(r.site,h.site),nY(r),void nY(n);if(n){nK(r),nK(n);var c=r.site,p=c[0],f=c[1],d=i[0]-p,m=i[1]-f,g=n.site,y=g[0]-p,_=g[1]-f,v=2*(d*_-m*y),x=d*d+m*m,b=y*y+_*_,w=[(_*x-m*b)/v+p,(d*b-y*x)/v+f];nZ(n.edge,c,g,w),h.edge=nq(c,i,null,w),n.edge=nq(i,g,null,w),nY(r),nY(n)}else h.edge=nq(r.site,h.site)}}(a),n=a[0],o=a[1]),a=i.pop();else{if(!s)break;!function(i){var r=i.circle,n=r.x,o=r.cy,s=[n,o],a=i.P,l=i.N,u=[i];n1(i);for(var h=a;h.circle&&1e-6>Math.abs(n-h.circle.x)&&1e-6>Math.abs(o-h.circle.cy);)a=h.P,u.unshift(h),n1(h),h=a;u.unshift(h),nK(h);for(var c=l;c.circle&&1e-6>Math.abs(n-c.circle.x)&&1e-6>Math.abs(o-c.circle.cy);)l=c.N,u.push(c),n1(c),c=l;u.push(c),nK(c);var p,f=u.length;for(p=1;p<f;++p)c=u[p],h=u[p-1],nZ(c.edge,h.site,c.site,s);h=u[0],(c=u[f-1]).edge=nq(h.site,c.site,null,s),nY(h),nY(c)}(s.arc)}if(function(){for(var i,r,n,o,s=0,a=n5.length;s<a;++s)if((i=n5[s])&&(o=(r=i.halfedges).length)){var l=Array(o),u=Array(o);for(n=0;n<o;++n)l[n]=n,u[n]=function(i,r){var n=i.site,o=r.left,s=r.right;return n===s&&(s=o,o=n),s?Math.atan2(s[1]-o[1],s[0]-o[0]):(n===o?(o=r[1],s=r[0]):(o=r[0],s=r[1]),Math.atan2(o[0]-s[0],s[1]-o[1]))}(i,n6[r[n]]);for(l.sort(function(i,r){return u[r]-u[i]}),n=0;n<o;++n)u[n]=r[l[n]];for(n=0;n<o;++n)r[n]=u[n]}}(),r){var l=+r[0][0],u=+r[0][1],h=+r[1][0],c=+r[1][1];(function(i,r,n,o){for(var s,a=n6.length;a--;)(function(i,r,n,o,s){var a=i[1];if(a)return!0;var l,u,h=i[0],c=i.left,p=i.right,f=c[0],d=c[1],m=p[0],g=p[1],y=(f+m)/2;if(g===d){if(y<r||y>=o)return;if(f>m){if(h){if(h[1]>=s)return}else h=[y,n];a=[y,s]}else{if(h){if(h[1]<n)return}else h=[y,s];a=[y,n]}}else if(u=(d+g)/2-(l=(f-m)/(g-d))*y,l<-1||l>1){if(f>m){if(h){if(h[1]>=s)return}else h=[(n-u)/l,n];a=[(s-u)/l,s]}else{if(h){if(h[1]<n)return}else h=[(s-u)/l,s];a=[(n-u)/l,n]}}else if(d<g){if(h){if(h[0]>=o)return}else h=[r,l*r+u];a=[o,l*o+u]}else{if(h){if(h[0]<r)return}else h=[o,l*o+u];a=[r,l*r+u]}return i[0]=h,i[1]=a,!0})(s=n6[a],i,r,n,o)&&function(i,r,n,o,s){var a,l=i[0],u=i[1],h=l[0],c=l[1],p=0,f=1,d=u[0]-h,m=u[1]-c;if(a=r-h,d||!(a>0)){if(a/=d,d<0){if(a<p)return;a<f&&(f=a)}else if(d>0){if(a>f)return;a>p&&(p=a)}if(a=o-h,d||!(a<0)){if(a/=d,d<0){if(a>f)return;a>p&&(p=a)}else if(d>0){if(a<p)return;a<f&&(f=a)}if(a=n-c,m||!(a>0)){if(a/=m,m<0){if(a<p)return;a<f&&(f=a)}else if(m>0){if(a>f)return;a>p&&(p=a)}if(a=s-c,m||!(a<0)){if(a/=m,m<0){if(a>f)return;a>p&&(p=a)}else if(m>0){if(a<p)return;a<f&&(f=a)}return!(p>0||f<1)||(p>0&&(i[0]=[h+p*d,c+p*m]),f<1&&(i[1]=[h+f*d,c+f*m]),!0)}}}}}(s,i,r,n,o)&&(Math.abs(s[0][0]-s[1][0])>1e-6||Math.abs(s[0][1]-s[1][1])>1e-6)||delete n6[a]})(l,u,h,c),function(i,r,n,o){var s,a,l,u,h,c,p,f,d,m,g,y,_=n5.length,v=!0;for(s=0;s<_;++s)if(a=n5[s]){for(l=a.site,u=(h=a.halfedges).length;u--;)n6[h[u]]||h.splice(u,1);for(u=0,c=h.length;u<c;)g=(x=a,m=(b=n6[h[u]])[+(b.left===x.site)])[0],y=m[1],f=(p=nX(a,n6[h[++u%c]]))[0],d=p[1],(Math.abs(g-f)>1e-6||Math.abs(y-d)>1e-6)&&(h.splice(u,0,n6.push(nj(l,m,1e-6>Math.abs(g-i)&&o-y>1e-6?[i,1e-6>Math.abs(f-i)?d:o]:1e-6>Math.abs(y-o)&&n-g>1e-6?[1e-6>Math.abs(d-o)?f:n,o]:1e-6>Math.abs(g-n)&&y-r>1e-6?[n,1e-6>Math.abs(f-n)?d:r]:1e-6>Math.abs(y-r)&&g-i>1e-6?[1e-6>Math.abs(d-r)?f:i,r]:null))-1),++c);c&&(v=!1)}if(v){var x,b,w,E,I,S=1/0;for(s=0,v=null;s<_;++s)(a=n5[s])&&(I=(w=(l=a.site)[0]-i)*w+(E=l[1]-r)*E)<S&&(S=I,v=a);if(v){var M=[i,r],T=[i,o],C=[n,o],P=[n,r];v.halfedges.push(n6.push(nj(l=v.site,M,T))-1,n6.push(nj(l,T,C))-1,n6.push(nj(l,C,P))-1,n6.push(nj(l,P,M))-1)}}for(s=0;s<_;++s)(a=n5[s])&&(a.halfedges.length||delete n5[s])}(l,u,h,c)}this.edges=n6,this.cells=n5,n3=n4=n6=n5=null}function ot(i){return(i=i.slice()).push(i[0]),d([i])}function oe(i,r,n,o){var s=(o=o||{}).steps||64,a=o.units||"kilometers",l=o.angle||0,u=o.pivot||i,h=o.properties||i.properties||{};if(!i)throw Error("center is required");if(!r)throw Error("xSemiAxis is required");if(!n)throw Error("ySemiAxis is required");if(!R(o))throw Error("options must be an object");if(!k(s))throw Error("steps must be a number");if(!k(l))throw Error("angle must be a number");var c=ti(i);if("degrees"===a)var p=P(l);else r=ro(i,r,90,{units:a}),n=ro(i,n,0,{units:a}),r=ti(r)[0]-c[0],n=ti(n)[1]-c[1];for(var f=[],m=0;m<s;m+=1){var g=-360*m/s,y=r*n/Math.sqrt(Math.pow(n,2)+Math.pow(r,2)*Math.pow(oi(g),2)),_=r*n/Math.sqrt(Math.pow(r,2)+Math.pow(n,2)/Math.pow(oi(g),2));if(g<-90&&g>=-270&&(y=-y),g<-180&&g>=-360&&(_=-_),"degrees"===a){var v=y*Math.cos(p)+_*Math.sin(p),x=_*Math.cos(p)-y*Math.sin(p);y=v,_=x}f.push([y+c[0],_+c[1]])}return f.push(f[0]),"degrees"===a?d([f],h):r2(d([f],h),l,{pivot:u})}function oi(i){return Math.tan(i*Math.PI/180)}function or(i,r){void 0===r&&(r={});var n=0,o=0,s=0;return j(i,function(i,a,l){var u=r.weight?null==l?void 0:l[r.weight]:void 0;if(!k(u=null==u?1:u))throw Error("weight value must be a number for feature index "+a);(u=Number(u))>0&&z(i,function(i){n+=i[0]*u,o+=i[1]*u,s+=u})}),p([n/s,o/s],r.properties,r)}function on(i,r){return{x:i[0]-r[0],y:i[1]-r[1]}}function oo(i,r){var n=(r=r||{}).threshold||1e4,o=r.p||2,s=r.binary||!1,a=r.alpha||-1,l=r.standardization||!1,u=[];G(i,function(i){u.push(eU(i))});for(var h=[],c=0;c<u.length;c++)h[c]=[];for(c=0;c<u.length;c++)for(var p=c;p<u.length;p++){c===p&&(h[c][p]=0);var f=function(i,r,n){void 0===n&&(n=2);var o=ti(i),s=ti(r),a=o[0]-s[0],l=o[1]-s[1];return 1===n?Math.abs(a)+Math.abs(l):Math.pow(Math.pow(a,n)+Math.pow(l,n),1/n)}(u[c],u[p],o);h[c][p]=f,h[p][c]=f}for(c=0;c<u.length;c++)for(p=0;p<u.length;p++)0!==(f=h[c][p])&&(h[c][p]=s?+(f<=n):f<=n?Math.pow(f,a):0);if(l)for(c=0;c<u.length;c++){var d=h[c].reduce(function(i,r){return i+r},0);for(p=0;p<u.length;p++)h[c][p]=h[c][p]/d}return h}function os(i){for(var r=0,n=0;n<i.length;n++)r+=i[n];return r/i.length}function oa(i,r){return void 0===r&&(r={}),ou(i,"mercator",r)}function ol(i,r){return void 0===r&&(r={}),ou(i,"wgs84",r)}function ou(i,r,n){void 0===n&&(n={});var o=(n=n||{}).mutate;if(!i)throw Error("geojson is required");return Array.isArray(i)&&k(i[0])?i="mercator"===r?oh(i):oc(i):(!0!==o&&(i=eo(i)),z(i,function(i){var n="mercator"===r?oh(i):oc(i);i[0]=n[0],i[1]=n[1]})),i}function oh(i){var r,n=Math.PI/180,o=[6378137*(180>=Math.abs(i[0])?i[0]:i[0]-360*((r=i[0])<0?-1:+(r>0)))*n,6378137*Math.log(Math.tan(.25*Math.PI+.5*i[1]*n))];return o[0]>20037508.342789244&&(o[0]=20037508.342789244),o[0]<-20037508.342789244&&(o[0]=-20037508.342789244),o[1]>20037508.342789244&&(o[1]=20037508.342789244),o[1]<-20037508.342789244&&(o[1]=-20037508.342789244),o}function oc(i){var r=180/Math.PI;return[i[0]*r/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-i[1]/6378137)))*r]}n7.prototype={constructor:n7,polygons:function(){var i=this.edges;return this.cells.map(function(r){var n=r.halfedges.map(function(n){return nX(r,i[n])});return n.data=r.site.data,n})},triangles:function(){var i=[],r=this.edges;return this.cells.forEach(function(n,o){if(a=(s=n.halfedges).length)for(var s,a,l,u,h=n.site,c=-1,p=r[s[a-1]],f=p.left===h?p.right:p.left;++c<a;)l=f,f=(p=r[s[c]]).left===h?p.right:p.left,l&&f&&o<l.index&&o<f.index&&(u=f,(h[0]-u[0])*(l[1]-h[1])-(h[0]-l[0])*(u[1]-h[1])<0)&&i.push([h.data,l.data,f.data])}),i},links:function(){return this.edges.filter(function(i){return i.right}).map(function(i){return{source:i.left.data,target:i.right.data}})},find:function(i,r,n){for(var o,s,a=this,l=a._found||0,u=a.cells.length;!(s=a.cells[l]);)if(++l>=u)return null;var h=i-s.site[0],c=r-s.site[1],p=h*h+c*c;do s=a.cells[o=l],l=null,s.halfedges.forEach(function(n){var o=a.edges[n],u=o.left;if(u!==s.site&&u||(u=o.right)){var h=i-u[0],c=r-u[1],f=h*h+c*c;f<p&&(p=f,l=u.index)}});while(null!==l)return a._found=o,null==n||p<=n*n?s.site:null}};var op=Object.freeze({__proto__:null,toMercator:oa,toWgs84:ol}),of=function(){for(var i=0,r=0,n=arguments.length;r<n;r++)i+=arguments[r].length;var o=Array(i),s=0;for(r=0;r<n;r++)for(var a=arguments[r],l=0,u=a.length;l<u;l++,s++)o[s]=a[l];return o};function od(i){return Array.isArray(i)?ov(i):i&&i.bbox?ov(i.bbox):[360*o_(),180*o_()]}function om(i,r){void 0===r&&(r={}),null==i&&(i=1);for(var n=[],o=0;o<i;o++)n.push(p(od(r.bbox)));return _(n)}function og(i,r){void 0===r&&(r={}),null==i&&(i=1),k(r.num_vertices)&&void 0!==r.num_vertices||(r.num_vertices=10),k(r.max_radial_length)&&void 0!==r.max_radial_length||(r.max_radial_length=10);for(var n=[],o=0;o<i;o++)!function(i){var o,s=[],a=of(Array(r.num_vertices+1)).map(Math.random);a.forEach(function(i,r,n){n[r]=r>0?i+n[r-1]:i}),a.forEach(function(i){i=2*i*Math.PI/a[a.length-1];var n=Math.random();s.push([n*(r.max_radial_length||10)*Math.sin(i),n*(r.max_radial_length||10)*Math.cos(i)])}),s[s.length-1]=s[0],s=s.map((o=od(r.bbox),function(i){return[i[0]+o[0],i[1]+o[1]]})),n.push(d([s]))}();return _(n)}function oy(i,r){if(void 0===r&&(r={}),!R(r=r||{}))throw Error("options is invalid");var n=r.bbox,o=r.num_vertices,s=r.max_length,a=r.max_rotation;null==i&&(i=1),(!k(o)||void 0===o||o<2)&&(o=10),k(s)&&void 0!==s||(s=1e-4),k(a)&&void 0!==a||(a=Math.PI/8);for(var l=[],u=0;u<i;u++){for(var h=[od(n)],c=0;c<o-1;c++){var p=(0===c?2*Math.random()*Math.PI:Math.tan((h[c][1]-h[c-1][1])/(h[c][0]-h[c-1][0])))+(Math.random()-.5)*a*2,f=Math.random()*s;h.push([h[c][0]+f*Math.cos(p),h[c][1]+f*Math.sin(p)])}l.push(g(h))}return _(l)}function o_(){return Math.random()-.5}function ov(i){return[Math.random()*(i[2]-i[0])+i[0],Math.random()*(i[3]-i[1])+i[1]]}var ox=Object.freeze({__proto__:null,randomPosition:od,randomPoint:om,randomPolygon:og,randomLineString:oy});function ob(i,r){if(!i)throw Error("geojson is required");if("FeatureCollection"!==i.type)throw Error("geojson must be a FeatureCollection");if(null==r)throw Error("filter is required");var n=[];return G(i,function(i){oS(i.properties,r)&&n.push(i)}),_(n)}function ow(i,r,n){if(!i)throw Error("geojson is required");if("FeatureCollection"!==i.type)throw Error("geojson must be a FeatureCollection");if(null==r)throw Error("property is required");for(var o=oI(i,r),s=Object.keys(o),a=0;a<s.length;a++){for(var l=s[a],u=o[l],h=[],c=0;c<u.length;c++)h.push(i.features[u[c]]);n(_(h),l,a)}}function oE(i,r,n,o){var s=o;return ow(i,r,function(i,r,a){s=0===a&&void 0===o?i:n(s,i,r,a)}),s}function oI(i,r){var n={};return G(i,function(i,o){var s=i.properties||{};if(Object.prototype.hasOwnProperty.call(s,String(r))){var a=s[r];Object.prototype.hasOwnProperty.call(n,a)?n[a].push(o):n[a]=[o]}}),n}function oS(i,r){if(void 0===i)return!1;var n=typeof r;if("number"===n||"string"===n)return Object.prototype.hasOwnProperty.call(i,r);if(Array.isArray(r)){for(var o=0;o<r.length;o++)if(!oS(i,r[o]))return!1;return!0}return oM(i,r)}function oM(i,r){for(var n=Object.keys(r),o=0;o<n.length;o++){var s=n[o];if(i[s]!==r[s])return!1}return!0}function oT(i,r){if(!r||!r.length)return{};for(var n={},o=0;o<r.length;o++){var s=r[o];Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n}var oC=Object.freeze({__proto__:null,getCluster:ob,clusterEach:ow,clusterReduce:oE,createBins:oI,applyFilter:oS,propertiesContainsFilter:oM,filterProperties:oT}),oP=function(i,r){this.next=null,this.key=i,this.data=r,this.left=null,this.right=null};/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */function oA(i,r){return i>r?1:i<r?-1:0}function oL(i,r,n){for(var o=new oP(null,null),s=o,a=o;;){var l=n(i,r.key);if(l<0){if(null===r.left)break;if(0>n(i,r.left.key)){var u=r.left;if(r.left=u.right,u.right=r,null===(r=u).left)break}a.left=r,a=r,r=r.left}else{if(!(l>0)||null===r.right||n(i,r.right.key)>0&&(u=r.right,r.right=u.left,u.left=r,null===(r=u).right))break;s.right=r,s=r,r=r.right}}return s.right=r.left,a.left=r.right,r.left=o.right,r.right=o.left,r}function ok(i,r,n,o){var s=new oP(i,r);if(null===n)return s.left=s.right=null,s;var a=o(i,(n=oL(i,n,o)).key);return a<0?(s.left=n.left,s.right=n,n.left=null):a>=0&&(s.right=n.right,s.left=n,n.right=null),s}function oR(i,r,n){var o=null,s=null;if(r){var a=n((r=oL(i,r,n)).key,i);0===a?(o=r.left,s=r.right):a<0?(s=r.right,r.right=null,o=r):(o=r.left,r.left=null,s=r)}return{left:o,right:s}}var oD=function(){function i(i){void 0===i&&(i=oA),this._root=null,this._size=0,this._comparator=i}return i.prototype.insert=function(i,r){return this._size++,this._root=ok(i,r,this._root,this._comparator)},i.prototype.add=function(i,r){var n=new oP(i,r);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,s=oL(i,this._root,o),a=o(i,s.key);return 0===a?this._root=s:(a<0?(n.left=s.left,n.right=s,s.left=null):a>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},i.prototype.remove=function(i){this._root=this._remove(i,this._root,this._comparator)},i.prototype._remove=function(i,r,n){var o;return null===r?null:0===n(i,(r=oL(i,r,n)).key)?(null===r.left?o=r.right:(o=oL(i,r.left,n)).right=r.right,this._size--,o):r},i.prototype.pop=function(){var i=this._root;if(i){for(;i.left;)i=i.left;return this._root=oL(i.key,this._root,this._comparator),this._root=this._remove(i.key,this._root,this._comparator),{key:i.key,data:i.data}}return null},i.prototype.findStatic=function(i){for(var r=this._root,n=this._comparator;r;){var o=n(i,r.key);if(0===o)return r;r=o<0?r.left:r.right}return null},i.prototype.find=function(i){return this._root&&(this._root=oL(i,this._root,this._comparator),0!==this._comparator(i,this._root.key))?null:this._root},i.prototype.contains=function(i){for(var r=this._root,n=this._comparator;r;){var o=n(i,r.key);if(0===o)return!0;r=o<0?r.left:r.right}return!1},i.prototype.forEach=function(i,r){for(var n=this._root,o=[],s=!1;!s;)null!==n?(o.push(n),n=n.left):0!==o.length?(n=o.pop(),i.call(r,n),n=n.right):s=!0;return this},i.prototype.range=function(i,r,n,o){for(var s=[],a=this._comparator,l=this._root;0!==s.length||l;)if(l)s.push(l),l=l.left;else{if(a((l=s.pop()).key,r)>0)break;if(a(l.key,i)>=0&&n.call(o,l))return this;l=l.right}return this},i.prototype.keys=function(){var i=[];return this.forEach(function(r){var n=r.key;return i.push(n)}),i},i.prototype.values=function(){var i=[];return this.forEach(function(r){var n=r.data;return i.push(n)}),i},i.prototype.min=function(){return this._root?this.minNode(this._root).key:null},i.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},i.prototype.minNode=function(i){if(void 0===i&&(i=this._root),i)for(;i.left;)i=i.left;return i},i.prototype.maxNode=function(i){if(void 0===i&&(i=this._root),i)for(;i.right;)i=i.right;return i},i.prototype.at=function(i){for(var r=this._root,n=!1,o=0,s=[];!n;)if(r)s.push(r),r=r.left;else if(s.length>0){if(r=s.pop(),o===i)return r;o++,r=r.right}else n=!0;return null},i.prototype.next=function(i){var r=this._root,n=null;if(i.right){for(n=i.right;n.left;)n=n.left;return n}for(var o=this._comparator;r;){var s=o(i.key,r.key);if(0===s)break;s<0?(n=r,r=r.left):r=r.right}return n},i.prototype.prev=function(i){var r=this._root,n=null;if(null!==i.left){for(n=i.left;n.right;)n=n.right;return n}for(var o=this._comparator;r;){var s=o(i.key,r.key);if(0===s)break;s<0?r=r.left:(n=r,r=r.right)}return n},i.prototype.clear=function(){return this._root=null,this._size=0,this},i.prototype.toList=function(){return function(i){for(var r=i,n=[],o=!1,s=new oP(null,null),a=s;!o;)r?(n.push(r),r=r.left):n.length>0?r=(r=a=a.next=n.pop()).right:o=!0;return a.next=null,s.next}(this._root)},i.prototype.load=function(i,r,n){void 0===r&&(r=[]),void 0===n&&(n=!1);var o=i.length,s=this._comparator;if(n&&function i(r,n,o,s,a){if(!(o>=s)){for(var l=r[o+s>>1],u=o-1,h=s+1;;){do u++;while(0>a(r[u],l))do h--;while(a(r[h],l)>0)if(u>=h)break;var c=r[u];r[u]=r[h],r[h]=c,c=n[u],n[u]=n[h],n[h]=c}i(r,n,o,h,a),i(r,n,h+1,s,a)}}(i,r,0,o-1,s),null===this._root)this._root=function i(r,n,o,s){var a=s-o;if(a>0){var l=o+Math.floor(a/2),u=new oP(r[l],n[l]);return u.left=i(r,n,o,l),u.right=i(r,n,l+1,s),u}return null}(i,r,0,o),this._size=o;else{var a=function(i,r,n){for(var o=new oP(null,null),s=o,a=i,l=r;null!==a&&null!==l;)0>n(a.key,l.key)?(s.next=a,a=a.next):(s.next=l,l=l.next),s=s.next;return null!==a?s.next=a:null!==l&&(s.next=l),o.next}(this.toList(),function(i,r){for(var n=new oP(null,null),o=n,s=0;s<i.length;s++)o=o.next=new oP(i[s],r[s]);return o.next=null,n.next}(i,r),s);o=this._size+o,this._root=function i(r,n,o){var s=o-n;if(s>0){var a=n+Math.floor(s/2),l=i(r,n,a),u=r.head;return u.left=l,r.head=r.head.next,u.right=i(r,a+1,o),u}return null}({head:a},0,o)}return this},i.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),i.prototype.toString=function(i){void 0===i&&(i=function(i){return String(i.key)});var r=[];return function i(r,n,o,s,a){if(r){s(n+(o?"└── ":"├── ")+a(r)+"\n");var l=n+(o?"    ":"│   ");r.left&&i(r.left,l,!1,s,a),r.right&&i(r.right,l,!0,s,a)}}(this._root,"",!0,function(i){return r.push(i)},i),r.join("")},i.prototype.update=function(i,r,n){var o,s,a=this._comparator,l=oR(i,this._root,a),u=l.left,h=l.right;0>a(i,r)?h=ok(r,n,h,a):u=ok(r,n,u,a),this._root=(o=u,null===(s=h)?o:(null===o||((s=oL(o.key,s,a)).left=o),s))},i.prototype.split=function(i){return oR(i,this._root,this._comparator)},i}();function oN(i,r){if(!(i instanceof r))throw TypeError("Cannot call a class as a function")}function oO(i,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}function oz(i,r,n){return r&&oO(i.prototype,r),n&&oO(i,n),i}var oF=function(i,r){return i.ll.x<=r.x&&r.x<=i.ur.x&&i.ll.y<=r.y&&r.y<=i.ur.y},oB=function(i,r){if(r.ur.x<i.ll.x||i.ur.x<r.ll.x||r.ur.y<i.ll.y||i.ur.y<r.ll.y)return null;var n=i.ll.x<r.ll.x?r.ll.x:i.ll.x,o=i.ur.x<r.ur.x?i.ur.x:r.ur.x;return{ll:{x:n,y:i.ll.y<r.ll.y?r.ll.y:i.ll.y},ur:{x:o,y:i.ur.y<r.ur.y?i.ur.y:r.ur.y}}},oU=Number.EPSILON;void 0===oU&&(oU=2220446049250313e-31);var oG=oU*oU,oV=function(i,r){if(-oU<i&&i<oU&&-oU<r&&r<oU)return 0;var n=i-r;return n*n<oG*i*r?0:i<r?-1:1},oq=function(){function i(){oN(this,i),this.reset()}return oz(i,[{key:"reset",value:function(){this.xRounder=new oj,this.yRounder=new oj}},{key:"round",value:function(i,r){return{x:this.xRounder.round(i),y:this.yRounder.round(r)}}}]),i}(),oj=function(){function i(){oN(this,i),this.tree=new oD,this.round(0)}return oz(i,[{key:"round",value:function(i){var r=this.tree.add(i),n=this.tree.prev(r);if(null!==n&&0===oV(r.key,n.key))return this.tree.remove(i),n.key;var o=this.tree.next(r);return null!==o&&0===oV(r.key,o.key)?(this.tree.remove(i),o.key):i}}]),i}(),oZ=new oq,oX=function(i,r){return i.x*r.y-i.y*r.x},o$=function(i,r){return i.x*r.x+i.y*r.y},oW=function(i,r,n){return oV(oX({x:r.x-i.x,y:r.y-i.y},{x:n.x-i.x,y:n.y-i.y}),0)},oH=function(i){return Math.sqrt(o$(i,i))},oY=function(i,r,n){var o={x:r.x-i.x,y:r.y-i.y},s={x:n.x-i.x,y:n.y-i.y};return o$(s,o)/oH(s)/oH(o)},oK=function(i,r,n){return 0===r.y?null:{x:i.x+r.x/r.y*(n-i.y),y:n}},oJ=function(i,r,n){return 0===r.x?null:{x:n,y:i.y+r.y/r.x*(n-i.x)}},oQ=function(){function i(r,n){oN(this,i),void 0===r.events?r.events=[this]:r.events.push(this),this.point=r,this.isLeft=n}return oz(i,null,[{key:"compare",value:function(r,n){var o=i.comparePoints(r.point,n.point);return 0!==o?o:(r.point!==n.point&&r.link(n),r.isLeft!==n.isLeft?r.isLeft?1:-1:o1.compare(r.segment,n.segment))}},{key:"comparePoints",value:function(i,r){return i.x<r.x?-1:i.x>r.x?1:i.y<r.y?-1:+(i.y>r.y)}}]),oz(i,[{key:"link",value:function(i){if(i.point===this.point)throw Error("Tried to link already linked events");for(var r=i.point.events,n=0,o=r.length;n<o;n++){var s=r[n];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var i=this.point.events.length,r=0;r<i;r++){var n=this.point.events[r];if(void 0===n.segment.consumedBy)for(var o=r+1;o<i;o++){var s=this.point.events[o];void 0===s.consumedBy&&n.otherSE.point.events===s.otherSE.point.events&&n.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var i=[],r=0,n=this.point.events.length;r<n;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&i.push(o)}return i}},{key:"getLeftmostComparator",value:function(i){var r=this,n=new Map,o=function(o){var s,a,l,u,h,c=o.otherSE;n.set(o,{sine:(s=r.point,a=i.point,l=c.point,u={x:a.x-s.x,y:a.y-s.y},oX(h={x:l.x-s.x,y:l.y-s.y},u)/oH(h)/oH(u)),cosine:oY(r.point,i.point,c.point)})};return function(i,r){n.has(i)||o(i),n.has(r)||o(r);var s=n.get(i),a=s.sine,l=s.cosine,u=n.get(r),h=u.sine,c=u.cosine;return a>=0&&h>=0?l<c?1:l>c?-1:0:a<0&&h<0?l<c?-1:+(l>c):h<a?-1:+(h>a)}}}]),i}(),o0=0,o1=function(){function i(r,n,o,s){oN(this,i),this.id=++o0,this.leftSE=r,r.segment=this,r.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=r,this.rings=o,this.windings=s}return oz(i,null,[{key:"compare",value:function(i,r){var n=i.leftSE.point.x,o=r.leftSE.point.x,s=i.rightSE.point.x,a=r.rightSE.point.x;if(a<n)return 1;if(s<o)return -1;var l=i.leftSE.point.y,u=r.leftSE.point.y,h=i.rightSE.point.y,c=r.rightSE.point.y;if(n<o){if(u<l&&u<h)return 1;if(u>l&&u>h)return -1;var p=i.comparePoint(r.leftSE.point);if(p<0)return 1;if(p>0)return -1;var f=r.comparePoint(i.rightSE.point);return 0!==f?f:-1}if(n>o){if(l<u&&l<c)return -1;if(l>u&&l>c)return 1;var d=r.comparePoint(i.leftSE.point);if(0!==d)return d;var m=i.comparePoint(r.rightSE.point);return m<0?1:m>0?-1:1}if(l<u)return -1;if(l>u)return 1;if(s<a){var g=r.comparePoint(i.rightSE.point);if(0!==g)return g}if(s>a){var y=i.comparePoint(r.rightSE.point);if(y<0)return 1;if(y>0)return -1}if(s!==a){var _=h-l,v=s-n,x=c-u,b=a-o;if(_>v&&x<b)return 1;if(_<v&&x>b)return -1}return s>a?1:s<a||h<c?-1:h>c?1:i.id<r.id?-1:+(i.id>r.id)}}]),oz(i,[{key:"replaceRightSE",value:function(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var i=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i<r?i:r},ur:{x:this.rightSE.point.x,y:i>r?i:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(i){return i.x===this.leftSE.point.x&&i.y===this.leftSE.point.y||i.x===this.rightSE.point.x&&i.y===this.rightSE.point.y}},{key:"comparePoint",value:function(i){if(this.isAnEndpoint(i))return 0;var r=this.leftSE.point,n=this.rightSE.point,o=this.vector();if(r.x===n.x)return i.x===r.x?0:i.x<r.x?1:-1;var s=(i.y-r.y)/o.y,a=r.x+s*o.x;if(i.x===a)return 0;var l=(i.x-r.x)/o.x,u=r.y+l*o.y;return i.y===u?0:i.y<u?-1:1}},{key:"getIntersection",value:function(i){var r=this.bbox(),n=i.bbox(),o=oB(r,n);if(null===o)return null;var s=this.leftSE.point,a=this.rightSE.point,l=i.leftSE.point,u=i.rightSE.point,h=oF(r,l)&&0===this.comparePoint(l),c=oF(n,s)&&0===i.comparePoint(s),p=oF(r,u)&&0===this.comparePoint(u),f=oF(n,a)&&0===i.comparePoint(a);if(c&&h)return f&&!p?a:!f&&p?u:null;if(c)return p&&s.x===u.x&&s.y===u.y?null:s;if(h)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&p)return null;if(f)return a;if(p)return u;var d=function(i,r,n,o){if(0===r.x)return oJ(n,o,i.x);if(0===o.x)return oJ(i,r,n.x);if(0===r.y)return oK(n,o,i.y);if(0===o.y)return oK(i,r,n.y);var s=oX(r,o);if(0==s)return null;var a={x:n.x-i.x,y:n.y-i.y},l=oX(a,r)/s,u=oX(a,o)/s;return{x:(i.x+u*r.x+(n.x+l*o.x))/2,y:(i.y+u*r.y+(n.y+l*o.y))/2}}(s,this.vector(),l,i.vector());return null===d?null:oF(o,d)?oZ.round(d.x,d.y):null}},{key:"split",value:function(r){var n=[],o=void 0!==r.events,s=new oQ(r,!0),a=new oQ(r,!1),l=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(s);var u=new i(s,l,this.rings.slice(),this.windings.slice());return oQ.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),oQ.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(s.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}},{key:"consume",value:function(r){for(var n=this,o=r;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var s=i.compare(n,o);if(0!==s){if(s>0){var a=n;n=o,o=a}if(n.prev===o){var l=n;n=o,o=l}for(var u=0,h=o.rings.length;u<h;u++){var c=o.rings[u],p=o.windings[u],f=n.rings.indexOf(c);-1===f?(n.rings.push(c),n.windings.push(p)):n.windings[f]+=p}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,n=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],h=r.indexOf(l);-1===h?(r.push(l),n.push(u)):n[h]+=u}for(var c=[],p=[],f=0,d=r.length;f<d;f++)if(0!==n[f]){var m=r[f],g=m.poly;if(-1===p.indexOf(g)){if(m.isExterior)c.push(g);else{-1===p.indexOf(g)&&p.push(g);var y=c.indexOf(m.poly);-1!==y&&c.splice(y,1)}}}for(var _=0,v=c.length;_<v;_++){var x=c[_].multiPoly;-1===o.indexOf(x)&&o.push(x)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var i,r,n=this.beforeState().multiPolys,o=this.afterState().multiPolys;switch(o7.type){case"union":var s=0===n.length,a=0===o.length;this._isInResult=s!==a;break;case"intersection":n.length<o.length?(i=n.length,r=o.length):(i=o.length,r=n.length),this._isInResult=r===o7.numMultiPolys&&i<r;break;case"xor":var l=Math.abs(n.length-o.length);this._isInResult=l%2==1;break;case"difference":var u=function(i){return 1===i.length&&i[0].isSubject};this._isInResult=u(n)!==u(o);break;default:throw Error("Unrecognized operation type found ".concat(o7.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,n,o){var s,a,l,u=oQ.comparePoints(r,n);if(u<0)s=r,a=n,l=1;else{if(!(u>0))throw Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));s=n,a=r,l=-1}return new i(new oQ(s,!0),new oQ(a,!1),[o],[l])}}]),i}(),o2=function(){function i(r,n,o){if(oN(this,i),!Array.isArray(r)||0===r.length||(this.poly=n,this.isExterior=o,this.segments=[],"number"!=typeof r[0][0]||"number"!=typeof r[0][1]))throw Error("Input geometry is not a valid Polygon or MultiPolygon");var s=oZ.round(r[0][0],r[0][1]);this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};for(var a=s,l=1,u=r.length;l<u;l++){if("number"!=typeof r[l][0]||"number"!=typeof r[l][1])throw Error("Input geometry is not a valid Polygon or MultiPolygon");var h=oZ.round(r[l][0],r[l][1]);h.x===a.x&&h.y===a.y||(this.segments.push(o1.fromRing(a,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),a=h)}s.x===a.x&&s.y===a.y||this.segments.push(o1.fromRing(a,s,this))}return oz(i,[{key:"getSweepEvents",value:function(){for(var i=[],r=0,n=this.segments.length;r<n;r++){var o=this.segments[r];i.push(o.leftSE),i.push(o.rightSE)}return i}}]),i}(),o3=function(){function i(r,n){if(oN(this,i),!Array.isArray(r))throw Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new o2(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var o=1,s=r.length;o<s;o++){var a=new o2(r[o],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=n}return oz(i,[{key:"getSweepEvents",value:function(){for(var i=this.exteriorRing.getSweepEvents(),r=0,n=this.interiorRings.length;r<n;r++)for(var o=this.interiorRings[r].getSweepEvents(),s=0,a=o.length;s<a;s++)i.push(o[s]);return i}}]),i}(),o5=function(){function i(r,n){if(oN(this,i),!Array.isArray(r))throw Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof r[0][0][0]&&(r=[r])}catch(i){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var o=0,s=r.length;o<s;o++){var a=new o3(r[o],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=n}return oz(i,[{key:"getSweepEvents",value:function(){for(var i=[],r=0,n=this.polys.length;r<n;r++)for(var o=this.polys[r].getSweepEvents(),s=0,a=o.length;s<a;s++)i.push(o[s]);return i}}]),i}(),o4=function(){function i(r){oN(this,i),this.events=r;for(var n=0,o=r.length;n<o;n++)r[n].segment.ringOut=this;this.poly=null}return oz(i,null,[{key:"factory",value:function(r){for(var n=[],o=0,s=r.length;o<s;o++){var a=r[o];if(a.isInResult()&&!a.ringOut){for(var l=null,u=a.leftSE,h=a.rightSE,c=[u],p=u.point,f=[];l=u,u=h,c.push(u),u.point!==p;)for(;;){var d=u.getAvailableLinkedEvents();if(0===d.length){var m=c[0].point,g=c[c.length-1].point;throw Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(1===d.length){h=d[0].otherSE;break}for(var y=null,_=0,v=f.length;_<v;_++)if(f[_].point===u.point){y=_;break}if(null===y){f.push({index:c.length,point:u.point});var x=u.getLeftmostComparator(l);h=d.sort(x)[0].otherSE;break}var b=f.splice(y)[0],w=c.splice(b.index);w.unshift(w[0].otherSE),n.push(new i(w.reverse()))}n.push(new i(c))}}return n}}]),oz(i,[{key:"getGeom",value:function(){for(var i=this.events[0].point,r=[i],n=1,o=this.events.length-1;n<o;n++){var s=this.events[n].point;0!==oW(s,i,this.events[n+1].point)&&(r.push(s),i=s)}if(1===r.length)return null;0===oW(r[0],i,r[1])&&r.shift(),r.push(r[0]);for(var a=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:r.length-1,u=this.isExteriorRing()?r.length:-1,h=[],c=l;c!=u;c+=a)h.push([r[c].x,r[c].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var i=this.enclosingRing();this._isExteriorRing=!i||!i.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var i=this.events[0],r=1,n=this.events.length;r<n;r++){var o=this.events[r];oQ.compare(i,o)>0&&(i=o)}for(var s=i.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();a=(s=a.prevInResult())?s.prevInResult():null}}}]),i}(),o6=function(){function i(r){oN(this,i),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}return oz(i,[{key:"addInterior",value:function(i){this.interiorRings.push(i),i.poly=this}},{key:"getGeom",value:function(){var i=[this.exteriorRing.getGeom()];if(null===i[0])return null;for(var r=0,n=this.interiorRings.length;r<n;r++){var o=this.interiorRings[r].getGeom();null!==o&&i.push(o)}return i}}]),i}(),o8=function(){function i(r){oN(this,i),this.rings=r,this.polys=this._composePolys(r)}return oz(i,[{key:"getGeom",value:function(){for(var i=[],r=0,n=this.polys.length;r<n;r++){var o=this.polys[r].getGeom();null!==o&&i.push(o)}return i}},{key:"_composePolys",value:function(i){for(var r=[],n=0,o=i.length;n<o;n++){var s=i[n];if(!s.poly){if(s.isExteriorRing())r.push(new o6(s));else{var a=s.enclosingRing();a.poly||r.push(new o6(a)),a.poly.addInterior(s)}}}return r}}]),i}(),o9=function(){function i(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o1.compare;oN(this,i),this.queue=r,this.tree=new oD(n),this.segments=[]}return oz(i,[{key:"process",value:function(i){var r=i.segment,n=[];if(i.consumedBy)return i.isLeft?this.queue.remove(i.otherSE):this.tree.remove(r),n;var o=i.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;void 0===l;)null===(s=this.tree.prev(s))?l=null:void 0===s.key.consumedBy&&(l=s.key);for(;void 0===u;)null===(a=this.tree.next(a))?u=null:void 0===a.key.consumedBy&&(u=a.key);if(i.isLeft){var h=null;if(l){var c=l.getIntersection(r);if(null!==c&&(r.isAnEndpoint(c)||(h=c),!l.isAnEndpoint(c)))for(var p=this._splitSafely(l,c),f=0,d=p.length;f<d;f++)n.push(p[f])}var m=null;if(u){var g=u.getIntersection(r);if(null!==g&&(r.isAnEndpoint(g)||(m=g),!u.isAnEndpoint(g)))for(var y=this._splitSafely(u,g),_=0,v=y.length;_<v;_++)n.push(y[_])}if(null!==h||null!==m){var x=null;x=null===h?m:null===m?h:0>=oQ.comparePoints(h,m)?h:m,this.queue.remove(r.rightSE),n.push(r.rightSE);for(var b=r.split(x),w=0,E=b.length;w<E;w++)n.push(b[w])}n.length>0?(this.tree.remove(r),n.push(i)):(this.segments.push(r),r.prev=l)}else{if(l&&u){var I=l.getIntersection(u);if(null!==I){if(!l.isAnEndpoint(I))for(var S=this._splitSafely(l,I),M=0,T=S.length;M<T;M++)n.push(S[M]);if(!u.isAnEndpoint(I))for(var C=this._splitSafely(u,I),P=0,A=C.length;P<A;P++)n.push(C[P])}}this.tree.remove(r)}return n}},{key:"_splitSafely",value:function(i,r){this.tree.remove(i);var n=i.rightSE;this.queue.remove(n);var o=i.split(r);return o.push(n),void 0===i.consumedBy&&this.tree.insert(i),o}}]),i}(),o7=new(function(){function i(){oN(this,i)}return oz(i,[{key:"run",value:function(i,r,n){o7.type=i,oZ.reset();for(var o=[new o5(r,!0)],s=0,a=n.length;s<a;s++)o.push(new o5(n[s],!1));if(o7.numMultiPolys=o.length,"difference"===o7.type)for(var l=o[0],u=1;u<o.length;)null!==oB(o[u].bbox,l.bbox)?u++:o.splice(u,1);if("intersection"===o7.type){for(var h=0,c=o.length;h<c;h++)for(var p=o[h],f=h+1,d=o.length;f<d;f++)if(null===oB(p.bbox,o[f].bbox))return[]}for(var m=new oD(oQ.compare),g=0,y=o.length;g<y;g++)for(var _=o[g].getSweepEvents(),v=0,x=_.length;v<x;v++)if(m.insert(_[v]),m.size>1e6)throw Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new o9(m),w=m.size,E=m.pop();E;){var I=E.key;if(m.size===w){var S=I.segment;throw Error("Unable to pop() ".concat(I.isLeft?"left":"right"," SweepEvent ")+"[".concat(I.point.x,", ").concat(I.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>1e6)throw Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>1e6)throw Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var M=b.process(I),T=0,C=M.length;T<C;T++){var P=M[T];void 0===P.consumedBy&&m.insert(P)}w=m.size,E=m.pop()}return oZ.reset(),new o8(o4.factory(b.segments)).getGeom()}}]),i}()),st={union:function(i){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return o7.run("union",i,n)},intersection:function(i){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return o7.run("intersection",i,n)},xor:function(i){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return o7.run("xor",i,n)},difference:function(i){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return o7.run("difference",i,n)}};"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(i){if(null==this)throw TypeError(this+" is not an object");var r=Object(this),n=Math.max(Math.min(r.length,0x1fffffffffffff),0)||0,o=1 in arguments&&parseInt(Number(arguments[1]),10)||0;o=o<0?Math.max(n+o,0):Math.min(o,n);var s=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(s=s<0?Math.max(n+arguments[2],0):Math.min(s,n);o<s;)r[o]=i,++o;return r},writable:!0}),Number.isFinite=Number.isFinite||function(i){return"number"==typeof i&&isFinite(i)},Number.isInteger=Number.isInteger||function(i){return"number"==typeof i&&isFinite(i)&&Math.floor(i)===i},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(i){return i!=i},Math.trunc=Math.trunc||function(i){return i<0?Math.ceil(i):Math.floor(i)};var se=function(){};se.prototype.interfaces_=function(){return[]},se.prototype.getClass=function(){return se},se.prototype.equalsWithTolerance=function(i,r,n){return Math.abs(i-r)<=n};var si=function(i){function r(r){i.call(this,r),this.name="IllegalArgumentException",this.message=r,this.stack=(new i).stack}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r}(Error),sr=function(){},sn={MAX_VALUE:{configurable:!0}};sr.isNaN=function(i){return Number.isNaN(i)},sr.doubleToLongBits=function(i){return i},sr.longBitsToDouble=function(i){return i},sr.isInfinite=function(i){return!Number.isFinite(i)},sn.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(sr,sn);var so=function(){},ss=function(){},sa=function(){};function sl(){}var su=function i(){if(this.x=null,this.y=null,this.z=null,0==arguments.length)this.x=0,this.y=0,this.z=i.NULL_ORDINATE;else if(1==arguments.length){var r=arguments[0];this.x=r.x,this.y=r.y,this.z=r.z}else 2==arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=i.NULL_ORDINATE):3==arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},sh={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};su.prototype.setOrdinate=function(i,r){switch(i){case su.X:this.x=r;break;case su.Y:this.y=r;break;case su.Z:this.z=r;break;default:throw new si("Invalid ordinate index: "+i)}},su.prototype.equals2D=function(){if(1==arguments.length){var i=arguments[0];return this.x===i.x&&this.y===i.y}if(2==arguments.length){var r=arguments[0],n=arguments[1];return!!se.equalsWithTolerance(this.x,r.x,n)&&!!se.equalsWithTolerance(this.y,r.y,n)}},su.prototype.getOrdinate=function(i){switch(i){case su.X:return this.x;case su.Y:return this.y;case su.Z:return this.z}throw new si("Invalid ordinate index: "+i)},su.prototype.equals3D=function(i){return this.x===i.x&&this.y===i.y&&(this.z===i.z||sr.isNaN(this.z))&&sr.isNaN(i.z)},su.prototype.equals=function(i){return i instanceof su&&this.equals2D(i)},su.prototype.equalInZ=function(i,r){return se.equalsWithTolerance(this.z,i.z,r)},su.prototype.compareTo=function(i){return this.x<i.x?-1:this.x>i.x?1:this.y<i.y?-1:+(this.y>i.y)},su.prototype.clone=function(){},su.prototype.copy=function(){return new su(this)},su.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},su.prototype.distance3D=function(i){var r=this.x-i.x,n=this.y-i.y,o=this.z-i.z;return Math.sqrt(r*r+n*n+o*o)},su.prototype.distance=function(i){var r=this.x-i.x,n=this.y-i.y;return Math.sqrt(r*r+n*n)},su.prototype.hashCode=function(){return 37*(629+su.hashCode(this.x))+su.hashCode(this.y)},su.prototype.setCoordinate=function(i){this.x=i.x,this.y=i.y,this.z=i.z},su.prototype.interfaces_=function(){return[so,ss,sl]},su.prototype.getClass=function(){return su},su.hashCode=function(){if(1==arguments.length){var i=arguments[0],r=sr.doubleToLongBits(i);return Math.trunc((r^r)>>>32)}},sh.DimensionalComparator.get=function(){return sc},sh.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},sh.NULL_ORDINATE.get=function(){return sr.NaN},sh.X.get=function(){return 0},sh.Y.get=function(){return 1},sh.Z.get=function(){return 2},Object.defineProperties(su,sh);var sc=function(i){if(this._dimensionsToTest=2,0==arguments.length);else if(1==arguments.length){var r=arguments[0];if(2!==r&&3!==r)throw new si("only 2 or 3 dimensions may be specified");this._dimensionsToTest=r}};sc.prototype.compare=function(i,r){var n=sc.compare(i.x,r.x);if(0!==n)return n;var o=sc.compare(i.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:sc.compare(i.z,r.z)},sc.prototype.interfaces_=function(){return[sa]},sc.prototype.getClass=function(){return sc},sc.compare=function(i,r){return i<r?-1:i>r?1:sr.isNaN(i)?sr.isNaN(r)?0:-1:+!!sr.isNaN(r)};var sp=function(){};sp.prototype.create=function(){},sp.prototype.interfaces_=function(){return[]},sp.prototype.getClass=function(){return sp};var sf=function(){},sd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};sf.prototype.interfaces_=function(){return[]},sf.prototype.getClass=function(){return sf},sf.toLocationSymbol=function(i){switch(i){case sf.EXTERIOR:return"e";case sf.BOUNDARY:return"b";case sf.INTERIOR:return"i";case sf.NONE:return"-"}throw new si("Unknown location value: "+i)},sd.INTERIOR.get=function(){return 0},sd.BOUNDARY.get=function(){return 1},sd.EXTERIOR.get=function(){return 2},sd.NONE.get=function(){return -1},Object.defineProperties(sf,sd);var sm=function(i,r){return i.interfaces_&&i.interfaces_().indexOf(r)>-1},sg=function(){},sy={LOG_10:{configurable:!0}};sg.prototype.interfaces_=function(){return[]},sg.prototype.getClass=function(){return sg},sg.log10=function(i){var r=Math.log(i);return sr.isInfinite(r)||sr.isNaN(r)?r:r/sg.LOG_10},sg.min=function(i,r,n,o){var s=i;return r<s&&(s=r),n<s&&(s=n),o<s&&(s=o),s},sg.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],n=arguments[2];return i<r?r:i>n?n:i}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1],a=arguments[2];return o<s?s:o>a?a:o}},sg.wrap=function(i,r){return i<0?r- -i%r:i%r},sg.max=function(){if(3==arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=i;return r>o&&(o=r),n>o&&(o=n),o}if(4==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3],h=s;return a>h&&(h=a),l>h&&(h=l),u>h&&(h=u),h}},sg.average=function(i,r){return(i+r)/2},sy.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(sg,sy);var s_=function(i){this.str=i};s_.prototype.append=function(i){this.str+=i},s_.prototype.setCharAt=function(i,r){this.str=this.str.substr(0,i)+r+this.str.substr(i+1)},s_.prototype.toString=function(i){return this.str};var sv=function(i){this.value=i};sv.prototype.intValue=function(){return this.value},sv.prototype.compareTo=function(i){return this.value<i?-1:+(this.value>i)},sv.isNaN=function(i){return Number.isNaN(i)};var sx=function(){};sx.isWhitespace=function(i){return i<=32&&i>=0||127===i},sx.toUpperCase=function(i){return i.toUpperCase()};var sb=function i(){if(this._hi=0,this._lo=0,0==arguments.length)this.init(0);else if(1==arguments.length){if("number"==typeof arguments[0]){var r=arguments[0];this.init(r)}else if(arguments[0]instanceof i){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var o=arguments[0];i.call(this,i.parse(o))}}else if(2==arguments.length){var s=arguments[0],a=arguments[1];this.init(s,a)}},sw={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};sb.prototype.le=function(i){return(this._hi<i._hi||this._hi===i._hi)&&this._lo<=i._lo},sb.prototype.extractSignificantDigits=function(i,r){var n=this.abs(),o=sb.magnitude(n._hi),s=sb.TEN.pow(o);(n=n.divide(s)).gt(sb.TEN)?(n=n.divide(sb.TEN),o+=1):n.lt(sb.ONE)&&(n=n.multiply(sb.TEN),o-=1);for(var a=o+1,l=new s_,u=sb.MAX_PRINT_DIGITS-1,h=0;h<=u;h++){i&&h===a&&l.append(".");var c=Math.trunc(n._hi);if(c<0)break;var p=!1,f=0;c>9?(p=!0,f="9"):f="0"+c,l.append(f),n=n.subtract(sb.valueOf(c)).multiply(sb.TEN),p&&n.selfAdd(sb.TEN);var d=!0,m=sb.magnitude(n._hi);if(m<0&&Math.abs(m)>=u-h&&(d=!1),!d)break}return r[0]=o,l.toString()},sb.prototype.sqr=function(){return this.multiply(this)},sb.prototype.doubleValue=function(){return this._hi+this._lo},sb.prototype.subtract=function(){if(arguments[0]instanceof sb){var i=arguments[0];return this.add(i.negate())}if("number"==typeof arguments[0]){var r=arguments[0];return this.add(-r)}},sb.prototype.equals=function(){if(1==arguments.length){var i=arguments[0];return this._hi===i._hi&&this._lo===i._lo}},sb.prototype.isZero=function(){return 0===this._hi&&0===this._lo},sb.prototype.selfSubtract=function(){if(arguments[0]instanceof sb){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i._hi,-i._lo)}if("number"==typeof arguments[0]){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r,0)}},sb.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},sb.prototype.min=function(i){return this.le(i)?this:i},sb.prototype.selfDivide=function(){if(1==arguments.length){if(arguments[0]instanceof sb){var i=arguments[0];return this.selfDivide(i._hi,i._lo)}if("number"==typeof arguments[0]){var r=arguments[0];return this.selfDivide(r,0)}}else if(2==arguments.length){var n=arguments[0],o=arguments[1],s=null,a=null,l=null,u=null,h=null,c=null,p=null,f=null;return h=this._hi/n,f=(s=(c=sb.SPLIT*h)-(s=c-h))*(l=(f=sb.SPLIT*n)-(l=f-n))-(p=h*n)+s*(u=n-l)+(a=h-s)*l+a*u,f=h+(c=(this._hi-p-f+this._lo-h*o)/n),this._hi=f,this._lo=h-f+c,this}},sb.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},sb.prototype.divide=function(){if(arguments[0]instanceof sb){var i=arguments[0],r=null,n=null,o=null,s=null,a=null,l=null,u=null,h=null;return n=(a=this._hi/i._hi)-(r=(l=sb.SPLIT*a)-(r=l-a)),h=r*(o=(h=sb.SPLIT*i._hi)-(o=h-i._hi))-(u=a*i._hi)+r*(s=i._hi-o)+n*o+n*s,new sb(h=a+(l=(this._hi-u-h+this._lo-a*i._lo)/i._hi),a-h+l)}if("number"==typeof arguments[0]){var c=arguments[0];return sr.isNaN(c)?sb.createNaN():sb.copy(this).selfDivide(c,0)}},sb.prototype.ge=function(i){return(this._hi>i._hi||this._hi===i._hi)&&this._lo>=i._lo},sb.prototype.pow=function(i){if(0===i)return sb.valueOf(1);var r=new sb(this),n=sb.valueOf(1),o=Math.abs(i);if(o>1)for(;o>0;)o%2==1&&n.selfMultiply(r),(o/=2)>0&&(r=r.sqr());else n=r;return i<0?n.reciprocal():n},sb.prototype.ceil=function(){if(this.isNaN())return sb.NaN;var i=Math.ceil(this._hi),r=0;return i===this._hi&&(r=Math.ceil(this._lo)),new sb(i,r)},sb.prototype.compareTo=function(i){return this._hi<i._hi?-1:this._hi>i._hi?1:this._lo<i._lo?-1:+(this._lo>i._lo)},sb.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},sb.prototype.setValue=function(){if(arguments[0]instanceof sb){var i=arguments[0];return this.init(i),this}if("number"==typeof arguments[0]){var r=arguments[0];return this.init(r),this}},sb.prototype.max=function(i){return this.ge(i)?this:i},sb.prototype.sqrt=function(){if(this.isZero())return sb.valueOf(0);if(this.isNegative())return sb.NaN;var i=1/Math.sqrt(this._hi),r=this._hi*i,n=sb.valueOf(r),o=this.subtract(n.sqr())._hi*(.5*i);return n.add(o)},sb.prototype.selfAdd=function(){if(1==arguments.length){if(arguments[0]instanceof sb){var i=arguments[0];return this.selfAdd(i._hi,i._lo)}if("number"==typeof arguments[0]){var r=arguments[0],n=null,o=null,s=null,a=null,l=null,u=null;return a=(s=this._hi+r)-(l=s-this._hi),o=(u=(a=r-l+(this._hi-a))+this._lo)+(s-(n=s+u)),this._hi=n+o,this._lo=o+(n-this._hi),this}}else if(2==arguments.length){var h=arguments[0],c=arguments[1],p=null,f=null,d=null,m=null,g=null,y=null,_=null;m=this._hi+h,f=this._lo+c,g=m-(y=m-this._hi),d=f-(_=f-this._lo);var v=(p=m+(y=(g=h-y+(this._hi-g))+f))+(y=(d=c-_+(this._lo-d))+(y+(m-p))),x=y+(p-v);return this._hi=v,this._lo=x,this}},sb.prototype.selfMultiply=function(){if(1==arguments.length){if(arguments[0]instanceof sb){var i=arguments[0];return this.selfMultiply(i._hi,i._lo)}if("number"==typeof arguments[0]){var r=arguments[0];return this.selfMultiply(r,0)}}else if(2==arguments.length){var n=arguments[0],o=arguments[1],s=null,a=null,l=null,u=null,h=null,c=null;s=(h=sb.SPLIT*this._hi)-this._hi,c=sb.SPLIT*n,s=h-s,a=this._hi-s,l=c-n;var p=(h=this._hi*n)+(c=s*(l=c-l)-h+s*(u=n-l)+a*l+a*u+(this._hi*o+this._lo*n)),f=c+(s=h-p);return this._hi=p,this._lo=f,this}},sb.prototype.selfSqr=function(){return this.selfMultiply(this)},sb.prototype.floor=function(){if(this.isNaN())return sb.NaN;var i=Math.floor(this._hi),r=0;return i===this._hi&&(r=Math.floor(this._lo)),new sb(i,r)},sb.prototype.negate=function(){return this.isNaN()?this:new sb(-this._hi,-this._lo)},sb.prototype.clone=function(){},sb.prototype.multiply=function(){if(arguments[0]instanceof sb){var i=arguments[0];return i.isNaN()?sb.createNaN():sb.copy(this).selfMultiply(i)}if("number"==typeof arguments[0]){var r=arguments[0];return sr.isNaN(r)?sb.createNaN():sb.copy(this).selfMultiply(r,0)}},sb.prototype.isNaN=function(){return sr.isNaN(this._hi)},sb.prototype.intValue=function(){return Math.trunc(this._hi)},sb.prototype.toString=function(){var i=sb.magnitude(this._hi);return i>=-3&&i<=20?this.toStandardNotation():this.toSciNotation()},sb.prototype.toStandardNotation=function(){var i=this.getSpecialNumberString();if(null!==i)return i;var r=[,].fill(null),n=this.extractSignificantDigits(!0,r),o=r[0]+1,s=n;if("."===n.charAt(0))s="0"+n;else if(o<0)s="0."+sb.stringOfChar("0",-o)+n;else if(-1===n.indexOf(".")){var a=o-n.length;s=n+sb.stringOfChar("0",a)+".0"}return this.isNegative()?"-"+s:s},sb.prototype.reciprocal=function(){var i,r,n,o,s=null,a=null,l=null,u=null;i=(n=1/this._hi)-(s=(l=sb.SPLIT*n)-(s=l-n)),a=(u=sb.SPLIT*this._hi)-this._hi;var h=n+(l=(1-(o=n*this._hi)-(u=s*(a=u-a)-o+s*(r=this._hi-a)+i*a+i*r)-n*this._lo)/this._hi);return new sb(h,n-h+l)},sb.prototype.toSciNotation=function(){if(this.isZero())return sb.SCI_NOT_ZERO;var i=this.getSpecialNumberString();if(null!==i)return i;var r=[,].fill(null),n=this.extractSignificantDigits(!1,r),o=sb.SCI_NOT_EXPONENT_CHAR+r[0];if("0"===n.charAt(0))throw Error("Found leading zero: "+n);var s="";n.length>1&&(s=n.substring(1));var a=n.charAt(0)+"."+s;return this.isNegative()?"-"+a+o:a+o},sb.prototype.abs=function(){return this.isNaN()?sb.NaN:this.isNegative()?this.negate():new sb(this)},sb.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},sb.prototype.lt=function(i){return(this._hi<i._hi||this._hi===i._hi)&&this._lo<i._lo},sb.prototype.add=function(){if(arguments[0]instanceof sb){var i=arguments[0];return sb.copy(this).selfAdd(i)}if("number"==typeof arguments[0]){var r=arguments[0];return sb.copy(this).selfAdd(r)}},sb.prototype.init=function(){if(1==arguments.length){if("number"==typeof arguments[0]){var i=arguments[0];this._hi=i,this._lo=0}else if(arguments[0]instanceof sb){var r=arguments[0];this._hi=r._hi,this._lo=r._lo}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this._hi=n,this._lo=o}},sb.prototype.gt=function(i){return(this._hi>i._hi||this._hi===i._hi)&&this._lo>i._lo},sb.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},sb.prototype.trunc=function(){return this.isNaN()?sb.NaN:this.isPositive()?this.floor():this.ceil()},sb.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},sb.prototype.interfaces_=function(){return[sl,so,ss]},sb.prototype.getClass=function(){return sb},sb.sqr=function(i){return sb.valueOf(i).selfMultiply(i)},sb.valueOf=function(){if("string"==typeof arguments[0]){var i=arguments[0];return sb.parse(i)}if("number"==typeof arguments[0]){var r=arguments[0];return new sb(r)}},sb.sqrt=function(i){return sb.valueOf(i).sqrt()},sb.parse=function(i){for(var r=0,n=i.length;sx.isWhitespace(i.charAt(r));)r++;var o=!1;if(r<n){var s=i.charAt(r);"-"!==s&&"+"!==s||(r++,"-"===s&&(o=!0))}for(var a=new sb,l=0,u=0,h=0;!(r>=n);){var c=i.charAt(r);if(r++,sx.isDigit(c)){var p=c-"0";a.selfMultiply(sb.TEN),a.selfAdd(p),l++}else{if("."!==c){if("e"===c||"E"===c){var f=i.substring(r);try{h=sv.parseInt(f)}catch(r){throw r instanceof Error?Error("Invalid exponent "+f+" in string "+i):r}break}throw Error("Unexpected character '"+c+"' at position "+r+" in string "+i)}u=l}}var d=a,m=l-u-h;if(0===m)d=a;else if(m>0){var g=sb.TEN.pow(m);d=a.divide(g)}else if(m<0){var y=sb.TEN.pow(-m);d=a.multiply(y)}return o?d.negate():d},sb.createNaN=function(){return new sb(sr.NaN,sr.NaN)},sb.copy=function(i){return new sb(i)},sb.magnitude=function(i){var r=Math.abs(i),n=Math.trunc(Math.floor(Math.log(r)/Math.log(10)));return 10*Math.pow(10,n)<=r&&(n+=1),n},sb.stringOfChar=function(i,r){for(var n=new s_,o=0;o<r;o++)n.append(i);return n.toString()},sw.PI.get=function(){return new sb(3.141592653589793,12246467991473532e-32)},sw.TWO_PI.get=function(){return new sb(6.283185307179586,24492935982947064e-32)},sw.PI_2.get=function(){return new sb(1.5707963267948966,6123233995736766e-32)},sw.E.get=function(){return new sb(2.718281828459045,14456468917292502e-32)},sw.NaN.get=function(){return new sb(sr.NaN,sr.NaN)},sw.EPS.get=function(){return 123259516440783e-46},sw.SPLIT.get=function(){return 0x8000001},sw.MAX_PRINT_DIGITS.get=function(){return 32},sw.TEN.get=function(){return sb.valueOf(10)},sw.ONE.get=function(){return sb.valueOf(1)},sw.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},sw.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(sb,sw);var sE=function(){},sI={DP_SAFE_EPSILON:{configurable:!0}};sE.prototype.interfaces_=function(){return[]},sE.prototype.getClass=function(){return sE},sE.orientationIndex=function(i,r,n){var o=sE.orientationIndexFilter(i,r,n);if(o<=1)return o;var s=sb.valueOf(r.x).selfAdd(-i.x),a=sb.valueOf(r.y).selfAdd(-i.y),l=sb.valueOf(n.x).selfAdd(-r.x),u=sb.valueOf(n.y).selfAdd(-r.y);return s.selfMultiply(u).selfSubtract(a.selfMultiply(l)).signum()},sE.signOfDet2x2=function(i,r,n,o){return i.multiply(o).selfSubtract(r.multiply(n)).signum()},sE.intersection=function(i,r,n,o){var s=sb.valueOf(o.y).selfSubtract(n.y).selfMultiply(sb.valueOf(r.x).selfSubtract(i.x)),a=sb.valueOf(o.x).selfSubtract(n.x).selfMultiply(sb.valueOf(r.y).selfSubtract(i.y)),l=s.subtract(a),u=sb.valueOf(o.x).selfSubtract(n.x).selfMultiply(sb.valueOf(i.y).selfSubtract(n.y)),h=sb.valueOf(o.y).selfSubtract(n.y).selfMultiply(sb.valueOf(i.x).selfSubtract(n.x)),c=u.subtract(h).selfDivide(l).doubleValue(),p=sb.valueOf(i.x).selfAdd(sb.valueOf(r.x).selfSubtract(i.x).selfMultiply(c)).doubleValue(),f=sb.valueOf(r.x).selfSubtract(i.x).selfMultiply(sb.valueOf(i.y).selfSubtract(n.y)),d=sb.valueOf(r.y).selfSubtract(i.y).selfMultiply(sb.valueOf(i.x).selfSubtract(n.x)),m=f.subtract(d).selfDivide(l).doubleValue();return new su(p,sb.valueOf(n.y).selfAdd(sb.valueOf(o.y).selfSubtract(n.y).selfMultiply(m)).doubleValue())},sE.orientationIndexFilter=function(i,r,n){var o=null,s=(i.x-n.x)*(r.y-n.y),a=(i.y-n.y)*(r.x-n.x),l=s-a;if(s>0){if(a<=0)return sE.signum(l);o=s+a}else{if(!(s<0)||a>=0)return sE.signum(l);o=-s-a}var u=sE.DP_SAFE_EPSILON*o;return l>=u||-l>=u?sE.signum(l):2},sE.signum=function(i){return i>0?1:i<0?-1:0},sI.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(sE,sI);var sS=function(){},sM={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};sM.X.get=function(){return 0},sM.Y.get=function(){return 1},sM.Z.get=function(){return 2},sM.M.get=function(){return 3},sS.prototype.setOrdinate=function(i,r,n){},sS.prototype.size=function(){},sS.prototype.getOrdinate=function(i,r){},sS.prototype.getCoordinate=function(){},sS.prototype.getCoordinateCopy=function(i){},sS.prototype.getDimension=function(){},sS.prototype.getX=function(i){},sS.prototype.clone=function(){},sS.prototype.expandEnvelope=function(i){},sS.prototype.copy=function(){},sS.prototype.getY=function(i){},sS.prototype.toCoordinateArray=function(){},sS.prototype.interfaces_=function(){return[ss]},sS.prototype.getClass=function(){return sS},Object.defineProperties(sS,sM);var sT=function(){},sC=function(i){function r(){i.call(this,"Projective point not representable on the Cartesian plane.")}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(sT),sP=function(){};sP.arraycopy=function(i,r,n,o,s){for(var a=0,l=r;l<r+s;l++)n[o+a]=i[l],a++},sP.getProperty=function(i){return({"line.separator":"\n"})[i]};var sA=function i(){if(this.x=null,this.y=null,this.w=null,0==arguments.length)this.x=0,this.y=0,this.w=1;else if(1==arguments.length){var r=arguments[0];this.x=r.x,this.y=r.y,this.w=1}else if(2==arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],o=arguments[1];this.x=n,this.y=o,this.w=1}else if(arguments[0]instanceof i&&arguments[1]instanceof i){var s=arguments[0],a=arguments[1];this.x=s.y*a.w-a.y*s.w,this.y=a.x*s.w-s.x*a.w,this.w=s.x*a.y-a.x*s.y}else if(arguments[0]instanceof su&&arguments[1]instanceof su){var l=arguments[0],u=arguments[1];this.x=l.y-u.y,this.y=u.x-l.x,this.w=l.x*u.y-u.x*l.y}}else if(3==arguments.length){var h=arguments[0],c=arguments[1],p=arguments[2];this.x=h,this.y=c,this.w=p}else if(4==arguments.length){var f=arguments[0],d=arguments[1],m=arguments[2],g=arguments[3],y=f.y-d.y,_=d.x-f.x,v=f.x*d.y-d.x*f.y,x=m.y-g.y,b=g.x-m.x,w=m.x*g.y-g.x*m.y;this.x=_*w-b*v,this.y=x*v-y*w,this.w=y*b-x*_}};sA.prototype.getY=function(){var i=this.y/this.w;if(sr.isNaN(i)||sr.isInfinite(i))throw new sC;return i},sA.prototype.getX=function(){var i=this.x/this.w;if(sr.isNaN(i)||sr.isInfinite(i))throw new sC;return i},sA.prototype.getCoordinate=function(){var i=new su;return i.x=this.getX(),i.y=this.getY(),i},sA.prototype.interfaces_=function(){return[]},sA.prototype.getClass=function(){return sA},sA.intersection=function(i,r,n,o){var s=i.y-r.y,a=r.x-i.x,l=i.x*r.y-r.x*i.y,u=n.y-o.y,h=o.x-n.x,c=n.x*o.y-o.x*n.y,p=s*h-u*a,f=(a*c-h*l)/p,d=(u*l-s*c)/p;if(sr.isNaN(f)||sr.isInfinite(f)||sr.isNaN(d)||sr.isInfinite(d))throw new sC;return new su(f,d)};var sL=function i(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0==arguments.length)this.init();else if(1==arguments.length){if(arguments[0]instanceof su){var r=arguments[0];this.init(r.x,r.x,r.y,r.y)}else if(arguments[0]instanceof i){var n=arguments[0];this.init(n)}}else if(2==arguments.length){var o=arguments[0],s=arguments[1];this.init(o.x,s.x,o.y,s.y)}else if(4==arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2],h=arguments[3];this.init(a,l,u,h)}},sk={serialVersionUID:{configurable:!0}};sL.prototype.getArea=function(){return this.getWidth()*this.getHeight()},sL.prototype.equals=function(i){return i instanceof sL&&(this.isNull()?i.isNull():this._maxx===i.getMaxX()&&this._maxy===i.getMaxY()&&this._minx===i.getMinX()&&this._miny===i.getMinY())},sL.prototype.intersection=function(i){if(this.isNull()||i.isNull()||!this.intersects(i))return new sL;var r=this._minx>i._minx?this._minx:i._minx,n=this._miny>i._miny?this._miny:i._miny;return new sL(r,this._maxx<i._maxx?this._maxx:i._maxx,n,this._maxy<i._maxy?this._maxy:i._maxy)},sL.prototype.isNull=function(){return this._maxx<this._minx},sL.prototype.getMaxX=function(){return this._maxx},sL.prototype.covers=function(){if(1==arguments.length){if(arguments[0]instanceof su){var i=arguments[0];return this.covers(i.x,i.y)}if(arguments[0]instanceof sL){var r=arguments[0];return!this.isNull()&&!r.isNull()&&r.getMinX()>=this._minx&&r.getMaxX()<=this._maxx&&r.getMinY()>=this._miny&&r.getMaxY()<=this._maxy}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&o>=this._miny&&o<=this._maxy}},sL.prototype.intersects=function(){if(1==arguments.length){if(arguments[0]instanceof sL){var i=arguments[0];return!this.isNull()&&!i.isNull()&&!(i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny)}if(arguments[0]instanceof su){var r=arguments[0];return this.intersects(r.x,r.y)}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||o>this._maxy||o<this._miny)}},sL.prototype.getMinY=function(){return this._miny},sL.prototype.getMinX=function(){return this._minx},sL.prototype.expandToInclude=function(){if(1==arguments.length){if(arguments[0]instanceof su){var i=arguments[0];this.expandToInclude(i.x,i.y)}else if(arguments[0]instanceof sL){var r=arguments[0];if(r.isNull())return null;this.isNull()?(this._minx=r.getMinX(),this._maxx=r.getMaxX(),this._miny=r.getMinY(),this._maxy=r.getMaxY()):(r._minx<this._minx&&(this._minx=r._minx),r._maxx>this._maxx&&(this._maxx=r._maxx),r._miny<this._miny&&(this._miny=r._miny),r._maxy>this._maxy&&(this._maxy=r._maxy))}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=o,this._maxy=o):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),o<this._miny&&(this._miny=o),o>this._maxy&&(this._maxy=o))}},sL.prototype.minExtent=function(){if(this.isNull())return 0;var i=this.getWidth(),r=this.getHeight();return i<r?i:r},sL.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},sL.prototype.compareTo=function(i){return this.isNull()?i.isNull()?0:-1:i.isNull()?1:this._minx<i._minx?-1:this._minx>i._minx?1:this._miny<i._miny?-1:this._miny>i._miny?1:this._maxx<i._maxx?-1:this._maxx>i._maxx?1:this._maxy<i._maxy?-1:+(this._maxy>i._maxy)},sL.prototype.translate=function(i,r){if(this.isNull())return null;this.init(this.getMinX()+i,this.getMaxX()+i,this.getMinY()+r,this.getMaxY()+r)},sL.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},sL.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},sL.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},sL.prototype.maxExtent=function(){if(this.isNull())return 0;var i=this.getWidth(),r=this.getHeight();return i>r?i:r},sL.prototype.expandBy=function(){if(1==arguments.length){var i=arguments[0];this.expandBy(i,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=r,this._maxx+=r,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},sL.prototype.contains=function(){if(1==arguments.length){if(arguments[0]instanceof sL){var i=arguments[0];return this.covers(i)}if(arguments[0]instanceof su){var r=arguments[0];return this.covers(r)}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];return this.covers(n,o)}},sL.prototype.centre=function(){return this.isNull()?null:new su((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},sL.prototype.init=function(){if(0==arguments.length)this.setToNull();else if(1==arguments.length){if(arguments[0]instanceof su){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof sL){var r=arguments[0];this._minx=r._minx,this._maxx=r._maxx,this._miny=r._miny,this._maxy=r._maxy}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this.init(n.x,o.x,n.y,o.y)}else if(4==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3];s<a?(this._minx=s,this._maxx=a):(this._minx=a,this._maxx=s),l<u?(this._miny=l,this._maxy=u):(this._miny=u,this._maxy=l)}},sL.prototype.getMaxY=function(){return this._maxy},sL.prototype.distance=function(i){if(this.intersects(i))return 0;var r=0;this._maxx<i._minx?r=i._minx-this._maxx:this._minx>i._maxx&&(r=this._minx-i._maxx);var n=0;return this._maxy<i._miny?n=i._miny-this._maxy:this._miny>i._maxy&&(n=this._miny-i._maxy),0===r?n:0===n?r:Math.sqrt(r*r+n*n)},sL.prototype.hashCode=function(){return 37*(37*(37*(629+su.hashCode(this._minx))+su.hashCode(this._maxx))+su.hashCode(this._miny))+su.hashCode(this._maxy)},sL.prototype.interfaces_=function(){return[so,sl]},sL.prototype.getClass=function(){return sL},sL.intersects=function(){if(3==arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];return n.x>=(i.x<r.x?i.x:r.x)&&n.x<=(i.x>r.x?i.x:r.x)&&n.y>=(i.y<r.y?i.y:r.y)&&n.y<=(i.y>r.y?i.y:r.y)}if(4==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3],u=Math.min(a.x,l.x),h=Math.max(a.x,l.x),c=Math.min(o.x,s.x),p=Math.max(o.x,s.x);return!(c>h)&&!(p<u)&&(u=Math.min(a.y,l.y),h=Math.max(a.y,l.y),c=Math.min(o.y,s.y),p=Math.max(o.y,s.y),!(c>h)&&!(p<u))}},sk.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(sL,sk);var sR={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},sD=function(i){this.geometryFactory=i||new a7};sD.prototype.read=function(i){i=i.replace(/[\n\r]/g," ");var r,n,o,s=sR.typeStr.exec(i);if(-1!==i.search("EMPTY")&&((s=sR.emptyTypeStr.exec(i))[2]=void 0),s&&(n=s[1].toLowerCase(),o=s[2],sO[n]&&(r=sO[n].apply(this,[o]))),void 0===r)throw Error("Could not parse WKT "+i);return r},sD.prototype.write=function(i){return this.extractGeometry(i)},sD.prototype.extractGeometry=function(i){var r=i.getGeometryType().toLowerCase();if(!sN[r])return null;var n=r.toUpperCase();return i.isEmpty()?n+" EMPTY":n+"("+sN[r].apply(this,[i])+")"};var sN={coordinate:function(i){return i.x+" "+i.y},point:function(i){return sN.coordinate.call(this,i._coordinates._coordinates[0])},multipoint:function(i){for(var r=[],n=0,o=i._geometries.length;n<o;++n)r.push("("+sN.point.apply(this,[i._geometries[n]])+")");return r.join(",")},linestring:function(i){for(var r=[],n=0,o=i._points._coordinates.length;n<o;++n)r.push(sN.coordinate.apply(this,[i._points._coordinates[n]]));return r.join(",")},linearring:function(i){for(var r=[],n=0,o=i._points._coordinates.length;n<o;++n)r.push(sN.coordinate.apply(this,[i._points._coordinates[n]]));return r.join(",")},multilinestring:function(i){for(var r=[],n=0,o=i._geometries.length;n<o;++n)r.push("("+sN.linestring.apply(this,[i._geometries[n]])+")");return r.join(",")},polygon:function(i){var r=[];r.push("("+sN.linestring.apply(this,[i._shell])+")");for(var n=0,o=i._holes.length;n<o;++n)r.push("("+sN.linestring.apply(this,[i._holes[n]])+")");return r.join(",")},multipolygon:function(i){for(var r=[],n=0,o=i._geometries.length;n<o;++n)r.push("("+sN.polygon.apply(this,[i._geometries[n]])+")");return r.join(",")},geometrycollection:function(i){for(var r=[],n=0,o=i._geometries.length;n<o;++n)r.push(this.extractGeometry(i._geometries[n]));return r.join(",")}},sO={point:function(i){if(void 0===i)return this.geometryFactory.createPoint();var r=i.trim().split(sR.spaces);return this.geometryFactory.createPoint(new su(Number.parseFloat(r[0]),Number.parseFloat(r[1])))},multipoint:function(i){var r;if(void 0===i)return this.geometryFactory.createMultiPoint();for(var n=i.trim().split(","),o=[],s=0,a=n.length;s<a;++s)r=n[s].replace(sR.trimParens,"$1"),o.push(sO.point.apply(this,[r]));return this.geometryFactory.createMultiPoint(o)},linestring:function(i){if(void 0===i)return this.geometryFactory.createLineString();for(var r,n=i.trim().split(","),o=[],s=0,a=n.length;s<a;++s)r=n[s].trim().split(sR.spaces),o.push(new su(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(o)},linearring:function(i){if(void 0===i)return this.geometryFactory.createLinearRing();for(var r,n=i.trim().split(","),o=[],s=0,a=n.length;s<a;++s)r=n[s].trim().split(sR.spaces),o.push(new su(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(o)},multilinestring:function(i){var r;if(void 0===i)return this.geometryFactory.createMultiLineString();for(var n=i.trim().split(sR.parenComma),o=[],s=0,a=n.length;s<a;++s)r=n[s].replace(sR.trimParens,"$1"),o.push(sO.linestring.apply(this,[r]));return this.geometryFactory.createMultiLineString(o)},polygon:function(i){var r,n,o;if(void 0===i)return this.geometryFactory.createPolygon();for(var s,a=i.trim().split(sR.parenComma),l=[],u=0,h=a.length;u<h;++u)r=a[u].replace(sR.trimParens,"$1"),n=sO.linestring.apply(this,[r]),o=this.geometryFactory.createLinearRing(n._points),0===u?s=o:l.push(o);return this.geometryFactory.createPolygon(s,l)},multipolygon:function(i){var r;if(void 0===i)return this.geometryFactory.createMultiPolygon();for(var n=i.trim().split(sR.doubleParenComma),o=[],s=0,a=n.length;s<a;++s)r=n[s].replace(sR.trimParens,"$1"),o.push(sO.polygon.apply(this,[r]));return this.geometryFactory.createMultiPolygon(o)},geometrycollection:function(i){if(void 0===i)return this.geometryFactory.createGeometryCollection();for(var r=(i=i.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],o=0,s=r.length;o<s;++o)n.push(this.read(r[o]));return this.geometryFactory.createGeometryCollection(n)}},sz=function(i){this.parser=new sD(i)};sz.prototype.write=function(i){return this.parser.write(i)},sz.toLineString=function(i,r){if(2!=arguments.length)throw Error("Not implemented");return"LINESTRING ( "+i.x+" "+i.y+", "+r.x+" "+r.y+" )"};var sF=function(i){function r(r){i.call(this,r),this.name="RuntimeException",this.message=r,this.stack=(new i).stack}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r}(Error),sB=function(i){function r(){if(i.call(this),0==arguments.length)i.call(this);else if(1==arguments.length){var r=arguments[0];i.call(this,r)}}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(sF),sU=function(){};sU.prototype.interfaces_=function(){return[]},sU.prototype.getClass=function(){return sU},sU.shouldNeverReachHere=function(){if(0==arguments.length)sU.shouldNeverReachHere(null);else if(1==arguments.length){var i=arguments[0];throw new sB("Should never reach here"+(null!==i?": "+i:""))}},sU.isTrue=function(){var i;if(1==arguments.length)sU.isTrue(arguments[0],null);else if(2==arguments.length&&(i=arguments[1],!arguments[0]))throw null===i?new sB:new sB(i)},sU.equals=function(){var i,r,n;if(2==arguments.length)sU.equals(i=arguments[0],r=arguments[1],null);else if(3==arguments.length&&(i=arguments[0],n=arguments[2],!(r=arguments[1]).equals(i)))throw new sB("Expected "+i+" but encountered "+r+(null!==n?": "+n:""))};var sG=function(){this._result=null,this._inputLines=[,,].fill().map(function(){return[,,]}),this._intPt=[,,].fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new su,this._intPt[1]=new su,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},sV={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};sG.prototype.getIndexAlongSegment=function(i,r){return this.computeIntLineIndex(),this._intLineIndex[i][r]},sG.prototype.getTopologySummary=function(){var i=new s_;return this.isEndPoint()&&i.append(" endpoint"),this._isProper&&i.append(" proper"),this.isCollinear()&&i.append(" collinear"),i.toString()},sG.prototype.computeIntersection=function(i,r,n,o){this._inputLines[0][0]=i,this._inputLines[0][1]=r,this._inputLines[1][0]=n,this._inputLines[1][1]=o,this._result=this.computeIntersect(i,r,n,o)},sG.prototype.getIntersectionNum=function(){return this._result},sG.prototype.computeIntLineIndex=function(){if(0==arguments.length)null===this._intLineIndex&&(this._intLineIndex=[,,].fill().map(function(){return[,,]}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1==arguments.length){var i=arguments[0];this.getEdgeDistance(i,0)>this.getEdgeDistance(i,1)?(this._intLineIndex[i][0]=0,this._intLineIndex[i][1]=1):(this._intLineIndex[i][0]=1,this._intLineIndex[i][1]=0)}},sG.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},sG.prototype.setPrecisionModel=function(i){this._precisionModel=i},sG.prototype.isInteriorIntersection=function(){if(0==arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1==arguments.length){for(var i=arguments[0],r=0;r<this._result;r++)if(!this._intPt[r].equals2D(this._inputLines[i][0])&&!this._intPt[r].equals2D(this._inputLines[i][1]))return!0;return!1}},sG.prototype.getIntersection=function(i){return this._intPt[i]},sG.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},sG.prototype.hasIntersection=function(){return this._result!==sG.NO_INTERSECTION},sG.prototype.getEdgeDistance=function(i,r){return sG.computeEdgeDistance(this._intPt[r],this._inputLines[i][0],this._inputLines[i][1])},sG.prototype.isCollinear=function(){return this._result===sG.COLLINEAR_INTERSECTION},sG.prototype.toString=function(){return sz.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+sz.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},sG.prototype.getEndpoint=function(i,r){return this._inputLines[i][r]},sG.prototype.isIntersection=function(i){for(var r=0;r<this._result;r++)if(this._intPt[r].equals2D(i))return!0;return!1},sG.prototype.getIntersectionAlongSegment=function(i,r){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[i][r]]},sG.prototype.interfaces_=function(){return[]},sG.prototype.getClass=function(){return sG},sG.computeEdgeDistance=function(i,r,n){var o=Math.abs(n.x-r.x),s=Math.abs(n.y-r.y),a=-1;if(i.equals(r))a=0;else if(i.equals(n))a=o>s?o:s;else{var l=Math.abs(i.x-r.x),u=Math.abs(i.y-r.y);0!==(a=o>s?l:u)||i.equals(r)||(a=Math.max(l,u))}return sU.isTrue(!(0===a&&!i.equals(r)),"Bad distance calculation"),a},sG.nonRobustComputeEdgeDistance=function(i,r,n){var o=i.x-r.x,s=i.y-r.y,a=Math.sqrt(o*o+s*s);return sU.isTrue(!(0===a&&!i.equals(r)),"Invalid distance calculation"),a},sV.DONT_INTERSECT.get=function(){return 0},sV.DO_INTERSECT.get=function(){return 1},sV.COLLINEAR.get=function(){return 2},sV.NO_INTERSECTION.get=function(){return 0},sV.POINT_INTERSECTION.get=function(){return 1},sV.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(sG,sV);var sq=function(i){function r(){i.apply(this,arguments)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.isInSegmentEnvelopes=function(i){var r=new sL(this._inputLines[0][0],this._inputLines[0][1]),n=new sL(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(i)&&n.contains(i)},r.prototype.computeIntersection=function(){if(3!=arguments.length)return i.prototype.computeIntersection.apply(this,arguments);var r=arguments[0],n=arguments[1],o=arguments[2];if(this._isProper=!1,sL.intersects(n,o,r)&&0===sX.orientationIndex(n,o,r)&&0===sX.orientationIndex(o,n,r))return this._isProper=!0,(r.equals(n)||r.equals(o))&&(this._isProper=!1),this._result=i.POINT_INTERSECTION,null;this._result=i.NO_INTERSECTION},r.prototype.normalizeToMinimum=function(i,r,n,o,s){s.x=this.smallestInAbsValue(i.x,r.x,n.x,o.x),s.y=this.smallestInAbsValue(i.y,r.y,n.y,o.y),i.x-=s.x,i.y-=s.y,r.x-=s.x,r.y-=s.y,n.x-=s.x,n.y-=s.y,o.x-=s.x,o.y-=s.y},r.prototype.safeHCoordinateIntersection=function(i,n,o,s){var a=null;try{a=sA.intersection(i,n,o,s)}catch(l){if(!(l instanceof sC))throw l;a=r.nearestEndpoint(i,n,o,s)}return a},r.prototype.intersection=function(i,n,o,s){var a=this.intersectionWithNormalization(i,n,o,s);return this.isInSegmentEnvelopes(a)||(a=new su(r.nearestEndpoint(i,n,o,s))),null!==this._precisionModel&&this._precisionModel.makePrecise(a),a},r.prototype.smallestInAbsValue=function(i,r,n,o){var s=i,a=Math.abs(s);return Math.abs(r)<a&&(s=r,a=Math.abs(r)),Math.abs(n)<a&&(s=n,a=Math.abs(n)),Math.abs(o)<a&&(s=o),s},r.prototype.checkDD=function(i,r,n,o,s){var a=sE.intersection(i,r,n,o),l=this.isInSegmentEnvelopes(a);sP.out.println("DD in env = "+l+"  --------------------- "+a),s.distance(a)>1e-4&&sP.out.println("Distance = "+s.distance(a))},r.prototype.intersectionWithNormalization=function(i,r,n,o){var s=new su(i),a=new su(r),l=new su(n),u=new su(o),h=new su;this.normalizeToEnvCentre(s,a,l,u,h);var c=this.safeHCoordinateIntersection(s,a,l,u);return c.x+=h.x,c.y+=h.y,c},r.prototype.computeCollinearIntersection=function(r,n,o,s){var a=sL.intersects(r,n,o),l=sL.intersects(r,n,s),u=sL.intersects(o,s,r),h=sL.intersects(o,s,n);return a&&l?(this._intPt[0]=o,this._intPt[1]=s,i.COLLINEAR_INTERSECTION):u&&h?(this._intPt[0]=r,this._intPt[1]=n,i.COLLINEAR_INTERSECTION):a&&u?(this._intPt[0]=o,this._intPt[1]=r,!o.equals(r)||l||h?i.COLLINEAR_INTERSECTION:i.POINT_INTERSECTION):a&&h?(this._intPt[0]=o,this._intPt[1]=n,!o.equals(n)||l||u?i.COLLINEAR_INTERSECTION:i.POINT_INTERSECTION):l&&u?(this._intPt[0]=s,this._intPt[1]=r,!s.equals(r)||a||h?i.COLLINEAR_INTERSECTION:i.POINT_INTERSECTION):l&&h?(this._intPt[0]=s,this._intPt[1]=n,!s.equals(n)||a||u?i.COLLINEAR_INTERSECTION:i.POINT_INTERSECTION):i.NO_INTERSECTION},r.prototype.normalizeToEnvCentre=function(i,r,n,o,s){var a=i.x<r.x?i.x:r.x,l=i.y<r.y?i.y:r.y,u=i.x>r.x?i.x:r.x,h=i.y>r.y?i.y:r.y,c=n.x<o.x?n.x:o.x,p=n.y<o.y?n.y:o.y,f=n.x>o.x?n.x:o.x,d=n.y>o.y?n.y:o.y;s.x=((a>c?a:c)+(u<f?u:f))/2,s.y=((l>p?l:p)+(h<d?h:d))/2,i.x-=s.x,i.y-=s.y,r.x-=s.x,r.y-=s.y,n.x-=s.x,n.y-=s.y,o.x-=s.x,o.y-=s.y},r.prototype.computeIntersect=function(r,n,o,s){if(this._isProper=!1,!sL.intersects(r,n,o,s))return i.NO_INTERSECTION;var a=sX.orientationIndex(r,n,o),l=sX.orientationIndex(r,n,s);if(a>0&&l>0||a<0&&l<0)return i.NO_INTERSECTION;var u=sX.orientationIndex(o,s,r),h=sX.orientationIndex(o,s,n);return u>0&&h>0||u<0&&h<0?i.NO_INTERSECTION:0===a&&0===l&&0===u&&0===h?this.computeCollinearIntersection(r,n,o,s):(0===a||0===l||0===u||0===h?(this._isProper=!1,r.equals2D(o)||r.equals2D(s)?this._intPt[0]=r:n.equals2D(o)||n.equals2D(s)?this._intPt[0]=n:0===a?this._intPt[0]=new su(o):0===l?this._intPt[0]=new su(s):0===u?this._intPt[0]=new su(r):0===h&&(this._intPt[0]=new su(n))):(this._isProper=!0,this._intPt[0]=this.intersection(r,n,o,s)),i.POINT_INTERSECTION)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.nearestEndpoint=function(i,r,n,o){var s=i,a=sX.distancePointLine(i,n,o),l=sX.distancePointLine(r,n,o);return l<a&&(a=l,s=r),(l=sX.distancePointLine(n,i,r))<a&&(a=l,s=n),(l=sX.distancePointLine(o,i,r))<a&&(a=l,s=o),s},r}(sG),sj=function(){};sj.prototype.interfaces_=function(){return[]},sj.prototype.getClass=function(){return sj},sj.orientationIndex=function(i,r,n){var o=r.x-i.x,s=r.y-i.y,a=n.x-r.x,l=n.y-r.y;return sj.signOfDet2x2(o,s,a,l)},sj.signOfDet2x2=function(i,r,n,o){var s=null,a=null,l=null;if(s=1,0===i||0===o)return 0===r||0===n?0:r>0?n>0?-s:s:n>0?s:-s;if(0===r||0===n)return o>0?i>0?s:-s:i>0?-s:s;if(r>0?o>0?r<=o||(s=-s,a=i,i=n,n=a,a=r,r=o,o=a):r<=-o?(s=-s,n=-n,o=-o):(a=i,i=-n,n=a,a=r,r=-o,o=a):o>0?-r<=o?(s=-s,i=-i,r=-r):(a=-i,i=n,n=a,a=-r,r=o,o=a):r>=o?(i=-i,r=-r,n=-n,o=-o):(s=-s,a=-i,i=-n,n=a,a=-r,r=-o,o=a),i>0){if(!(n>0)||!(i<=n))return s}else{if(n>0||!(i>=n))return-s;s=-s,i=-i,n=-n}for(;;){if((o-=(l=Math.floor(n/i))*r)<0)return-s;if(o>r)return s;if(i>(n-=l*i)+n){if(r<o+o)return s}else{if(r>o+o)return-s;n=i-n,o=r-o,s=-s}if(0===o)return 0===n?0:-s;if(0===n||(r-=(l=Math.floor(i/n))*o)<0)return s;if(r>o)return-s;if(n>(i-=l*n)+i){if(o<r+r)return-s}else{if(o>r+r)return s;i=n-i,r=o-r,s=-s}if(0===r)return 0===i?0:s;if(0===i)return-s}};var sZ=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var i=arguments[0];this._p=i};sZ.prototype.countSegment=function(i,r){if(i.x<this._p.x&&r.x<this._p.x)return null;if(this._p.x===r.x&&this._p.y===r.y)return this._isPointOnSegment=!0,null;if(i.y===this._p.y&&r.y===this._p.y){var n=i.x,o=r.x;return n>o&&(n=r.x,o=i.x),this._p.x>=n&&this._p.x<=o&&(this._isPointOnSegment=!0),null}if(i.y>this._p.y&&r.y<=this._p.y||r.y>this._p.y&&i.y<=this._p.y){var s=i.x-this._p.x,a=i.y-this._p.y,l=r.x-this._p.x,u=r.y-this._p.y,h=sj.signOfDet2x2(s,a,l,u);if(0===h)return this._isPointOnSegment=!0,null;u<a&&(h=-h),h>0&&this._crossingCount++}},sZ.prototype.isPointInPolygon=function(){return this.getLocation()!==sf.EXTERIOR},sZ.prototype.getLocation=function(){return this._isPointOnSegment?sf.BOUNDARY:this._crossingCount%2==1?sf.INTERIOR:sf.EXTERIOR},sZ.prototype.isOnSegment=function(){return this._isPointOnSegment},sZ.prototype.interfaces_=function(){return[]},sZ.prototype.getClass=function(){return sZ},sZ.locatePointInRing=function(){if(arguments[0]instanceof su&&sm(arguments[1],sS)){for(var i=arguments[0],r=arguments[1],n=new sZ(i),o=new su,s=new su,a=1;a<r.size()&&(r.getCoordinate(a,o),r.getCoordinate(a-1,s),n.countSegment(o,s),!n.isOnSegment());a++);return n.getLocation()}if(arguments[0]instanceof su&&arguments[1]instanceof Array){for(var l=arguments[0],u=arguments[1],h=new sZ(l),c=1;c<u.length;c++){var p=u[c],f=u[c-1];if(h.countSegment(p,f),h.isOnSegment())break}return h.getLocation()}};var sX=function(){},s$={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};sX.prototype.interfaces_=function(){return[]},sX.prototype.getClass=function(){return sX},sX.orientationIndex=function(i,r,n){return sE.orientationIndex(i,r,n)},sX.signedArea=function(){if(arguments[0]instanceof Array){var i=arguments[0];if(i.length<3)return 0;for(var r=0,n=i[0].x,o=1;o<i.length-1;o++){var s=i[o].x-n,a=i[o+1].y;r+=s*(i[o-1].y-a)}return r/2}if(sm(arguments[0],sS)){var l=arguments[0],u=l.size();if(u<3)return 0;var h=new su,c=new su,p=new su;l.getCoordinate(0,c),l.getCoordinate(1,p);var f=c.x;p.x-=f;for(var d=0,m=1;m<u-1;m++)h.y=c.y,c.x=p.x,c.y=p.y,l.getCoordinate(m+1,p),p.x-=f,d+=c.x*(h.y-p.y);return d/2}},sX.distanceLineLine=function(i,r,n,o){if(i.equals(r))return sX.distancePointLine(i,n,o);if(n.equals(o))return sX.distancePointLine(o,i,r);var s=!1;if(sL.intersects(i,r,n,o)){var a=(r.x-i.x)*(o.y-n.y)-(r.y-i.y)*(o.x-n.x);if(0===a)s=!0;else{var l=(i.y-n.y)*(o.x-n.x)-(i.x-n.x)*(o.y-n.y),u=((i.y-n.y)*(r.x-i.x)-(i.x-n.x)*(r.y-i.y))/a,h=l/a;(h<0||h>1||u<0||u>1)&&(s=!0)}}else s=!0;return s?sg.min(sX.distancePointLine(i,n,o),sX.distancePointLine(r,n,o),sX.distancePointLine(n,i,r),sX.distancePointLine(o,i,r)):0},sX.isPointInRing=function(i,r){return sX.locatePointInRing(i,r)!==sf.EXTERIOR},sX.computeLength=function(i){var r=i.size();if(r<=1)return 0;var n=0,o=new su;i.getCoordinate(0,o);for(var s=o.x,a=o.y,l=1;l<r;l++){i.getCoordinate(l,o);var u=o.x,h=o.y,c=u-s,p=h-a;n+=Math.sqrt(c*c+p*p),s=u,a=h}return n},sX.isCCW=function(i){var r=i.length-1;if(r<3)throw new si("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=i[0],o=0,s=1;s<=r;s++){var a=i[s];a.y>n.y&&(n=a,o=s)}var l=o;do(l-=1)<0&&(l=r);while(i[l].equals2D(n)&&l!==o)var u=o;do u=(u+1)%r;while(i[u].equals2D(n)&&u!==o)var h=i[l],c=i[u];if(h.equals2D(n)||c.equals2D(n)||h.equals2D(c))return!1;var p=sX.computeOrientation(h,n,c);return 0===p?h.x>c.x:p>0},sX.locatePointInRing=function(i,r){return sZ.locatePointInRing(i,r)},sX.distancePointLinePerpendicular=function(i,r,n){var o=(n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y);return Math.abs(((r.y-i.y)*(n.x-r.x)-(r.x-i.x)*(n.y-r.y))/o)*Math.sqrt(o)},sX.computeOrientation=function(i,r,n){return sX.orientationIndex(i,r,n)},sX.distancePointLine=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];if(0===r.length)throw new si("Line array must contain at least one vertex");for(var n=i.distance(r[0]),o=0;o<r.length-1;o++){var s=sX.distancePointLine(i,r[o],r[o+1]);s<n&&(n=s)}return n}if(3==arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2];if(l.x===u.x&&l.y===u.y)return a.distance(l);var h=(u.x-l.x)*(u.x-l.x)+(u.y-l.y)*(u.y-l.y),c=((a.x-l.x)*(u.x-l.x)+(a.y-l.y)*(u.y-l.y))/h;return c<=0?a.distance(l):c>=1?a.distance(u):Math.abs(((l.y-a.y)*(u.x-l.x)-(l.x-a.x)*(u.y-l.y))/h)*Math.sqrt(h)}},sX.isOnLine=function(i,r){for(var n=new sq,o=1;o<r.length;o++){var s=r[o-1],a=r[o];if(n.computeIntersection(i,s,a),n.hasIntersection())return!0}return!1},s$.CLOCKWISE.get=function(){return -1},s$.RIGHT.get=function(){return sX.CLOCKWISE},s$.COUNTERCLOCKWISE.get=function(){return 1},s$.LEFT.get=function(){return sX.COUNTERCLOCKWISE},s$.COLLINEAR.get=function(){return 0},s$.STRAIGHT.get=function(){return sX.COLLINEAR},Object.defineProperties(sX,s$);var sW=function(){};sW.prototype.filter=function(i){},sW.prototype.interfaces_=function(){return[]},sW.prototype.getClass=function(){return sW};var sH=function(){var i=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=i,this._SRID=i.getSRID()},sY={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};sH.prototype.isGeometryCollection=function(){return this.getSortIndex()===sH.SORTINDEX_GEOMETRYCOLLECTION},sH.prototype.getFactory=function(){return this._factory},sH.prototype.getGeometryN=function(i){return this},sH.prototype.getArea=function(){return 0},sH.prototype.isRectangle=function(){return!1},sH.prototype.equals=function(){if(arguments[0]instanceof sH){var i=arguments[0];return null!==i&&this.equalsTopo(i)}if(arguments[0]instanceof Object){var r=arguments[0];return r instanceof sH&&this.equalsExact(r)}},sH.prototype.equalsExact=function(i){return this===i||this.equalsExact(i,0)},sH.prototype.geometryChanged=function(){this.apply(sH.geometryChangedFilter)},sH.prototype.geometryChangedAction=function(){this._envelope=null},sH.prototype.equalsNorm=function(i){return null!==i&&this.norm().equalsExact(i.norm())},sH.prototype.getLength=function(){return 0},sH.prototype.getNumGeometries=function(){return 1},sH.prototype.compareTo=function(){if(1==arguments.length){var i=arguments[0];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i)}if(2==arguments.length){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}},sH.prototype.getUserData=function(){return this._userData},sH.prototype.getSRID=function(){return this._SRID},sH.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},sH.prototype.checkNotGeometryCollection=function(i){if(i.getSortIndex()===sH.SORTINDEX_GEOMETRYCOLLECTION)throw new si("This method does not support GeometryCollection arguments")},sH.prototype.equal=function(i,r,n){return 0===n?i.equals(r):i.distance(r)<=n},sH.prototype.norm=function(){var i=this.copy();return i.normalize(),i},sH.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},sH.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new sL(this._envelope)},sH.prototype.setSRID=function(i){this._SRID=i},sH.prototype.setUserData=function(i){this._userData=i},sH.prototype.compare=function(i,r){for(var n=i.iterator(),o=r.iterator();n.hasNext()&&o.hasNext();){var s=n.next(),a=o.next(),l=s.compareTo(a);if(0!==l)return l}return n.hasNext()?1:o.hasNext()?-1:0},sH.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},sH.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===sH.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===sH.SORTINDEX_MULTIPOINT||this.getSortIndex()===sH.SORTINDEX_MULTILINESTRING||this.getSortIndex()===sH.SORTINDEX_MULTIPOLYGON},sH.prototype.interfaces_=function(){return[ss,so,sl]},sH.prototype.getClass=function(){return sH},sH.hasNonEmptyElements=function(i){for(var r=0;r<i.length;r++)if(!i[r].isEmpty())return!0;return!1},sH.hasNullElements=function(i){for(var r=0;r<i.length;r++)if(null===i[r])return!0;return!1},sY.serialVersionUID.get=function(){return 0x799ea46522854c00},sY.SORTINDEX_POINT.get=function(){return 0},sY.SORTINDEX_MULTIPOINT.get=function(){return 1},sY.SORTINDEX_LINESTRING.get=function(){return 2},sY.SORTINDEX_LINEARRING.get=function(){return 3},sY.SORTINDEX_MULTILINESTRING.get=function(){return 4},sY.SORTINDEX_POLYGON.get=function(){return 5},sY.SORTINDEX_MULTIPOLYGON.get=function(){return 6},sY.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},sY.geometryChangedFilter.get=function(){return sK},Object.defineProperties(sH,sY);var sK=function(){};sK.interfaces_=function(){return[sW]},sK.filter=function(i){i.geometryChangedAction()};var sJ=function(){};sJ.prototype.filter=function(i){},sJ.prototype.interfaces_=function(){return[]},sJ.prototype.getClass=function(){return sJ};var sQ=function(){},s0={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};sQ.prototype.isInBoundary=function(i){},sQ.prototype.interfaces_=function(){return[]},sQ.prototype.getClass=function(){return sQ},s0.Mod2BoundaryNodeRule.get=function(){return s1},s0.EndPointBoundaryNodeRule.get=function(){return s2},s0.MultiValentEndPointBoundaryNodeRule.get=function(){return s3},s0.MonoValentEndPointBoundaryNodeRule.get=function(){return s5},s0.MOD2_BOUNDARY_RULE.get=function(){return new s1},s0.ENDPOINT_BOUNDARY_RULE.get=function(){return new s2},s0.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new s3},s0.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new s5},s0.OGC_SFS_BOUNDARY_RULE.get=function(){return sQ.MOD2_BOUNDARY_RULE},Object.defineProperties(sQ,s0);var s1=function(){};s1.prototype.isInBoundary=function(i){return i%2==1},s1.prototype.interfaces_=function(){return[sQ]},s1.prototype.getClass=function(){return s1};var s2=function(){};s2.prototype.isInBoundary=function(i){return i>0},s2.prototype.interfaces_=function(){return[sQ]},s2.prototype.getClass=function(){return s2};var s3=function(){};s3.prototype.isInBoundary=function(i){return i>1},s3.prototype.interfaces_=function(){return[sQ]},s3.prototype.getClass=function(){return s3};var s5=function(){};s5.prototype.isInBoundary=function(i){return 1===i},s5.prototype.interfaces_=function(){return[sQ]},s5.prototype.getClass=function(){return s5};var s4=function(){};function s6(i){this.message=i||""}s4.prototype.add=function(){},s4.prototype.addAll=function(){},s4.prototype.isEmpty=function(){},s4.prototype.iterator=function(){},s4.prototype.size=function(){},s4.prototype.toArray=function(){},s4.prototype.remove=function(){},s6.prototype=Error(),s6.prototype.name="IndexOutOfBoundsException";var s8=function(){};s8.prototype.hasNext=function(){},s8.prototype.next=function(){},s8.prototype.remove=function(){};var s9=function(i){function r(){i.apply(this,arguments)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.get=function(){},r.prototype.set=function(){},r.prototype.isEmpty=function(){},r}(s4);function s7(i){this.message=i||""}s7.prototype=Error(),s7.prototype.name="NoSuchElementException";var at=function(i){function r(){i.call(this),this.array_=[],arguments[0]instanceof s4&&this.addAll(arguments[0])}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.ensureCapacity=function(){},r.prototype.interfaces_=function(){return[i,s4]},r.prototype.add=function(i){return 1==arguments.length?this.array_.push(i):this.array_.splice(arguments[0],arguments[1]),!0},r.prototype.clear=function(){this.array_=[]},r.prototype.addAll=function(i){for(var r=i.iterator();r.hasNext();)this.add(r.next());return!0},r.prototype.set=function(i,r){var n=this.array_[i];return this.array_[i]=r,n},r.prototype.iterator=function(){return new ae(this)},r.prototype.get=function(i){if(i<0||i>=this.size())throw new s6;return this.array_[i]},r.prototype.isEmpty=function(){return 0===this.array_.length},r.prototype.size=function(){return this.array_.length},r.prototype.toArray=function(){for(var i=[],r=0,n=this.array_.length;r<n;r++)i.push(this.array_[r]);return i},r.prototype.remove=function(i){for(var r=!1,n=0,o=this.array_.length;n<o;n++)if(this.array_[n]===i){this.array_.splice(n,1),r=!0;break}return r},r}(s9),ae=function(i){function r(r){i.call(this),this.arrayList_=r,this.position_=0}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new s7;return this.arrayList_.get(this.position_++)},r.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},r.prototype.set=function(i){return this.arrayList_.set(this.position_-1,i)},r.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},r}(s8),ai=function(i){function r(){if(i.call(this),0==arguments.length);else if(1==arguments.length){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this.ensureCapacity(n.length),this.add(n,o)}}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return[].fill(null)},r.prototype.getCoordinate=function(i){return this.get(i)},r.prototype.addAll=function(){if(2==arguments.length){for(var r=arguments[0],n=arguments[1],o=!1,s=r.iterator();s.hasNext();)this.add(s.next(),n),o=!0;return o}return i.prototype.addAll.apply(this,arguments)},r.prototype.clone=function(){for(var r=i.prototype.clone.call(this),n=0;n<this.size();n++)r.add(n,this.get(n).copy());return r},r.prototype.toCoordinateArray=function(){return this.toArray(r.coordArrayType)},r.prototype.add=function(){if(1==arguments.length){var r=arguments[0];i.prototype.add.call(this,r)}else if(2==arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],o=arguments[1];return this.add(n,o,!0),!0}if(arguments[0]instanceof su&&"boolean"==typeof arguments[1]){var s=arguments[0],a=arguments[1];if(!a&&this.size()>=1&&this.get(this.size()-1).equals2D(s))return null;i.prototype.add.call(this,s)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var l=arguments[0],u=arguments[1];return this.add(l,u),!0}}else if(3==arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var h=arguments[0],c=arguments[1],p=arguments[2];if(p)for(var f=0;f<h.length;f++)this.add(h[f],c);else for(var d=h.length-1;d>=0;d--)this.add(h[d],c);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof su){var m=arguments[0],g=arguments[1],y=arguments[2];if(!y){var _=this.size();if(_>0&&(m>0&&this.get(m-1).equals2D(g)||m<_&&this.get(m).equals2D(g)))return null}i.prototype.add.call(this,m,g)}}else if(4==arguments.length){var v=arguments[0],x=arguments[1],b=arguments[2],w=arguments[3],E=1;b>w&&(E=-1);for(var I=b;I!==w;I+=E)this.add(v[I],x);return!0}},r.prototype.closeRing=function(){this.size()>0&&this.add(new su(this.get(0)),!1)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},Object.defineProperties(r,n),r}(at),ar=function(){},an={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};an.ForwardComparator.get=function(){return ao},an.BidirectionalComparator.get=function(){return as},an.coordArrayType.get=function(){return[].fill(null)},ar.prototype.interfaces_=function(){return[]},ar.prototype.getClass=function(){return ar},ar.isRing=function(i){return!(i.length<4)&&!!i[0].equals2D(i[i.length-1])},ar.ptNotInList=function(i,r){for(var n=0;n<i.length;n++){var o=i[n];if(0>ar.indexOf(o,r))return o}return null},ar.scroll=function(i,r){var n=ar.indexOf(r,i);if(n<0)return null;var o=Array(i.length).fill(null);sP.arraycopy(i,n,o,0,i.length-n),sP.arraycopy(i,0,o,i.length-n,n),sP.arraycopy(o,0,i,0,i.length)},ar.equals=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];if(i===r)return!0;if(null===i||null===r||i.length!==r.length)return!1;for(var n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!1;return!0}if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(o===s)return!0;if(null===o||null===s||o.length!==s.length)return!1;for(var l=0;l<o.length;l++)if(0!==a.compare(o[l],s[l]))return!1;return!0}},ar.intersection=function(i,r){for(var n=new ai,o=0;o<i.length;o++)r.intersects(i[o])&&n.add(i[o],!0);return n.toCoordinateArray()},ar.hasRepeatedPoints=function(i){for(var r=1;r<i.length;r++)if(i[r-1].equals(i[r]))return!0;return!1},ar.removeRepeatedPoints=function(i){return ar.hasRepeatedPoints(i)?new ai(i,!1).toCoordinateArray():i},ar.reverse=function(i){for(var r=i.length-1,n=Math.trunc(r/2),o=0;o<=n;o++){var s=i[o];i[o]=i[r-o],i[r-o]=s}},ar.removeNull=function(i){for(var r=0,n=0;n<i.length;n++)null!==i[n]&&r++;var o=Array(r).fill(null);if(0===r)return o;for(var s=0,a=0;a<i.length;a++)null!==i[a]&&(o[s++]=i[a]);return o},ar.copyDeep=function(){if(1==arguments.length){for(var i=arguments[0],r=Array(i.length).fill(null),n=0;n<i.length;n++)r[n]=new su(i[n]);return r}if(5==arguments.length)for(var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3],u=arguments[4],h=0;h<u;h++)a[l+h]=new su(o[s+h])},ar.isEqualReversed=function(i,r){for(var n=0;n<i.length;n++){var o=i[n],s=r[i.length-n-1];if(0!==o.compareTo(s))return!1}return!0},ar.envelope=function(i){for(var r=new sL,n=0;n<i.length;n++)r.expandToInclude(i[n]);return r},ar.toCoordinateArray=function(i){return i.toArray(ar.coordArrayType)},ar.atLeastNCoordinatesOrNothing=function(i,r){return r.length>=i?r:[]},ar.indexOf=function(i,r){for(var n=0;n<r.length;n++)if(i.equals(r[n]))return n;return -1},ar.increasingDirection=function(i){for(var r=0;r<Math.trunc(i.length/2);r++){var n=i.length-1-r,o=i[r].compareTo(i[n]);if(0!==o)return o}return 1},ar.compare=function(i,r){for(var n=0;n<i.length&&n<r.length;){var o=i[n].compareTo(r[n]);if(0!==o)return o;n++}return n<r.length?-1:+(n<i.length)},ar.minCoordinate=function(i){for(var r=null,n=0;n<i.length;n++)(null===r||r.compareTo(i[n])>0)&&(r=i[n]);return r},ar.extract=function(i,r,n){r=sg.clamp(r,0,i.length);var o=(n=sg.clamp(n,-1,i.length))-r+1;n<0&&(o=0),r>=i.length&&(o=0),n<r&&(o=0);var s=Array(o).fill(null);if(0===o)return s;for(var a=0,l=r;l<=n;l++)s[a++]=i[l];return s},Object.defineProperties(ar,an);var ao=function(){};ao.prototype.compare=function(i,r){return ar.compare(i,r)},ao.prototype.interfaces_=function(){return[sa]},ao.prototype.getClass=function(){return ao};var as=function(){};as.prototype.compare=function(i,r){if(i.length<r.length)return -1;if(i.length>r.length)return 1;if(0===i.length)return 0;var n=ar.compare(i,r);return ar.isEqualReversed(i,r)?0:n},as.prototype.OLDcompare=function(i,r){if(i.length<r.length)return -1;if(i.length>r.length)return 1;if(0===i.length)return 0;for(var n=ar.increasingDirection(i),o=ar.increasingDirection(r),s=n>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var u=i[s].compareTo(r[a]);if(0!==u)return u;s+=n,a+=o}return 0},as.prototype.interfaces_=function(){return[sa]},as.prototype.getClass=function(){return as};var aa=function(){};aa.prototype.get=function(){},aa.prototype.put=function(){},aa.prototype.size=function(){},aa.prototype.values=function(){},aa.prototype.entrySet=function(){};var al=function(i){function r(){i.apply(this,arguments)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r}(aa);function au(i){this.message=i||""}function ah(){}au.prototype=Error(),au.prototype.name="OperationNotSupported",ah.prototype=new s4,ah.prototype.contains=function(){};var ac=function(i){function r(){i.call(this),this.array_=[],arguments[0]instanceof s4&&this.addAll(arguments[0])}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.contains=function(i){for(var r=0,n=this.array_.length;r<n;r++)if(this.array_[r]===i)return!0;return!1},r.prototype.add=function(i){return!this.contains(i)&&(this.array_.push(i),!0)},r.prototype.addAll=function(i){for(var r=i.iterator();r.hasNext();)this.add(r.next());return!0},r.prototype.remove=function(i){throw Error()},r.prototype.size=function(){return this.array_.length},r.prototype.isEmpty=function(){return 0===this.array_.length},r.prototype.toArray=function(){for(var i=[],r=0,n=this.array_.length;r<n;r++)i.push(this.array_[r]);return i},r.prototype.iterator=function(){return new ap(this)},r}(ah),ap=function(i){function r(r){i.call(this),this.hashSet_=r,this.position_=0}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new s7;return this.hashSet_.array_[this.position_++]},r.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},r.prototype.remove=function(){throw new au},r}(s8);function af(i){return null===i?0:i.color}function ad(i){return null===i?null:i.parent}function am(i,r){null!==i&&(i.color=r)}function ag(i){return null===i?null:i.left}function ay(i){return null===i?null:i.right}function a_(){this.root_=null,this.size_=0}a_.prototype=new al,a_.prototype.get=function(i){for(var r=this.root_;null!==r;){var n=i.compareTo(r.key);if(n<0)r=r.left;else{if(!(n>0))return r.value;r=r.right}}return null},a_.prototype.put=function(i,r){if(null===this.root_)return this.root_={key:i,value:r,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,o,s=this.root_;do if(n=s,(o=i.compareTo(s.key))<0)s=s.left;else{if(!(o>0)){var a=s.value;return s.value=r,a}s=s.right}while(null!==s)var l={key:i,left:null,right:null,value:r,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return o<0?n.left=l:n.right=l,this.fixAfterInsertion(l),this.size_++,null},a_.prototype.fixAfterInsertion=function(i){for(i.color=1;null!=i&&i!==this.root_&&1===i.parent.color;)if(ad(i)===ag(ad(ad(i)))){var r=ay(ad(ad(i)));1===af(r)?(am(ad(i),0),am(r,0),am(ad(ad(i)),1),i=ad(ad(i))):(i===ay(ad(i))&&(i=ad(i),this.rotateLeft(i)),am(ad(i),0),am(ad(ad(i)),1),this.rotateRight(ad(ad(i))))}else{var n=ag(ad(ad(i)));1===af(n)?(am(ad(i),0),am(n,0),am(ad(ad(i)),1),i=ad(ad(i))):(i===ag(ad(i))&&(i=ad(i),this.rotateRight(i)),am(ad(i),0),am(ad(ad(i)),1),this.rotateLeft(ad(ad(i))))}this.root_.color=0},a_.prototype.values=function(){var i=new at,r=this.getFirstEntry();if(null!==r)for(i.add(r.value);null!==(r=a_.successor(r));)i.add(r.value);return i},a_.prototype.entrySet=function(){var i=new ac,r=this.getFirstEntry();if(null!==r)for(i.add(r);null!==(r=a_.successor(r));)i.add(r);return i},a_.prototype.rotateLeft=function(i){if(null!=i){var r=i.right;i.right=r.left,null!=r.left&&(r.left.parent=i),r.parent=i.parent,null===i.parent?this.root_=r:i.parent.left===i?i.parent.left=r:i.parent.right=r,r.left=i,i.parent=r}},a_.prototype.rotateRight=function(i){if(null!=i){var r=i.left;i.left=r.right,null!=r.right&&(r.right.parent=i),r.parent=i.parent,null===i.parent?this.root_=r:i.parent.right===i?i.parent.right=r:i.parent.left=r,r.right=i,i.parent=r}},a_.prototype.getFirstEntry=function(){var i=this.root_;if(null!=i)for(;null!=i.left;)i=i.left;return i},a_.successor=function(i){if(null===i)return null;if(null!==i.right){for(var r=i.right;null!==r.left;)r=r.left;return r}for(var n=i.parent,o=i;null!==n&&o===n.right;)o=n,n=n.parent;return n},a_.prototype.size=function(){return this.size_};var av=function(){};function ax(){}function ab(){this.array_=[],arguments[0]instanceof s4&&this.addAll(arguments[0])}av.prototype.interfaces_=function(){return[]},av.prototype.getClass=function(){return av},ax.prototype=new ah,ab.prototype=new ax,ab.prototype.contains=function(i){for(var r=0,n=this.array_.length;r<n;r++)if(0===this.array_[r].compareTo(i))return!0;return!1},ab.prototype.add=function(i){if(this.contains(i))return!1;for(var r=0,n=this.array_.length;r<n;r++)if(1===this.array_[r].compareTo(i))return this.array_.splice(r,0,i),!0;return this.array_.push(i),!0},ab.prototype.addAll=function(i){for(var r=i.iterator();r.hasNext();)this.add(r.next());return!0},ab.prototype.remove=function(i){throw new au},ab.prototype.size=function(){return this.array_.length},ab.prototype.isEmpty=function(){return 0===this.array_.length},ab.prototype.toArray=function(){for(var i=[],r=0,n=this.array_.length;r<n;r++)i.push(this.array_[r]);return i},ab.prototype.iterator=function(){return new aw(this)};var aw=function(i){this.treeSet_=i,this.position_=0};aw.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new s7;return this.treeSet_.array_[this.position_++]},aw.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},aw.prototype.remove=function(){throw new au};var aE=function(){};aE.sort=function(){var i,r,n,o,s=arguments[0];if(1==arguments.length)o=function(i,r){return i.compareTo(r)},s.sort(o);else if(2==arguments.length)n=arguments[1],o=function(i,r){return n.compare(i,r)},s.sort(o);else if(3==arguments.length){(r=s.slice(arguments[1],arguments[2])).sort();var a=s.slice(0,arguments[1]).concat(r,s.slice(arguments[2],s.length));for(s.splice(0,s.length),i=0;i<a.length;i++)s.push(a[i])}else if(4==arguments.length)for(r=s.slice(arguments[1],arguments[2]),n=arguments[3],o=function(i,r){return n.compare(i,r)},r.sort(o),a=s.slice(0,arguments[1]).concat(r,s.slice(arguments[2],s.length)),s.splice(0,s.length),i=0;i<a.length;i++)s.push(a[i])},aE.asList=function(i){for(var r=new at,n=0,o=i.length;n<o;n++)r.add(i[n]);return r};var aI=function(){},aS={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};aS.P.get=function(){return 0},aS.L.get=function(){return 1},aS.A.get=function(){return 2},aS.FALSE.get=function(){return -1},aS.TRUE.get=function(){return -2},aS.DONTCARE.get=function(){return -3},aS.SYM_FALSE.get=function(){return"F"},aS.SYM_TRUE.get=function(){return"T"},aS.SYM_DONTCARE.get=function(){return"*"},aS.SYM_P.get=function(){return"0"},aS.SYM_L.get=function(){return"1"},aS.SYM_A.get=function(){return"2"},aI.prototype.interfaces_=function(){return[]},aI.prototype.getClass=function(){return aI},aI.toDimensionSymbol=function(i){switch(i){case aI.FALSE:return aI.SYM_FALSE;case aI.TRUE:return aI.SYM_TRUE;case aI.DONTCARE:return aI.SYM_DONTCARE;case aI.P:return aI.SYM_P;case aI.L:return aI.SYM_L;case aI.A:return aI.SYM_A}throw new si("Unknown dimension value: "+i)},aI.toDimensionValue=function(i){switch(sx.toUpperCase(i)){case aI.SYM_FALSE:return aI.FALSE;case aI.SYM_TRUE:return aI.TRUE;case aI.SYM_DONTCARE:return aI.DONTCARE;case aI.SYM_P:return aI.P;case aI.SYM_L:return aI.L;case aI.SYM_A:return aI.A}throw new si("Unknown dimension symbol: "+i)},Object.defineProperties(aI,aS);var aM=function(){};aM.prototype.filter=function(i){},aM.prototype.interfaces_=function(){return[]},aM.prototype.getClass=function(){return aM};var aT=function(){};aT.prototype.filter=function(i,r){},aT.prototype.isDone=function(){},aT.prototype.isGeometryChanged=function(){},aT.prototype.interfaces_=function(){return[]},aT.prototype.getClass=function(){return aT};var aC=function(i){function r(r,n){if(i.call(this,n),this._geometries=r||[],i.hasNullElements(this._geometries))throw new si("geometries must not contain null elements")}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){for(var i=new sL,r=0;r<this._geometries.length;r++)i.expandToInclude(this._geometries[r].getEnvelopeInternal());return i},r.prototype.getGeometryN=function(i){return this._geometries[i]},r.prototype.getSortIndex=function(){return i.SORTINDEX_GEOMETRYCOLLECTION},r.prototype.getCoordinates=function(){for(var i=Array(this.getNumPoints()).fill(null),r=-1,n=0;n<this._geometries.length;n++)for(var o=this._geometries[n].getCoordinates(),s=0;s<o.length;s++)i[++r]=o[s];return i},r.prototype.getArea=function(){for(var i=0,r=0;r<this._geometries.length;r++)i+=this._geometries[r].getArea();return i},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r)||this._geometries.length!==r._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!this._geometries[o].equalsExact(r._geometries[o],n))return!1;return!0}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){for(var i=0;i<this._geometries.length;i++)this._geometries[i].normalize();aE.sort(this._geometries)},r.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},r.prototype.getBoundaryDimension=function(){for(var i=aI.FALSE,r=0;r<this._geometries.length;r++)i=Math.max(i,this._geometries[r].getBoundaryDimension());return i},r.prototype.getDimension=function(){for(var i=aI.FALSE,r=0;r<this._geometries.length;r++)i=Math.max(i,this._geometries[r].getDimension());return i},r.prototype.getLength=function(){for(var i=0,r=0;r<this._geometries.length;r++)i+=this._geometries[r].getLength();return i},r.prototype.getNumPoints=function(){for(var i=0,r=0;r<this._geometries.length;r++)i+=this._geometries[r].getNumPoints();return i},r.prototype.getNumGeometries=function(){return this._geometries.length},r.prototype.reverse=function(){for(var i=this._geometries.length,r=Array(i).fill(null),n=0;n<this._geometries.length;n++)r[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(r)},r.prototype.compareToSameClass=function(){if(1==arguments.length){var i=arguments[0],r=new ab(aE.asList(this._geometries)),n=new ab(aE.asList(i._geometries));return this.compare(r,n)}if(2==arguments.length){for(var o=arguments[0],s=arguments[1],a=this.getNumGeometries(),l=o.getNumGeometries(),u=0;u<a&&u<l;){var h=this.getGeometryN(u),c=o.getGeometryN(u),p=h.compareToSameClass(c,s);if(0!==p)return p;u++}return u<a?1:u<l?-1:0}},r.prototype.apply=function(){if(sm(arguments[0],sJ))for(var i=arguments[0],r=0;r<this._geometries.length;r++)this._geometries[r].apply(i);else if(sm(arguments[0],aT)){var n=arguments[0];if(0===this._geometries.length)return null;for(var o=0;o<this._geometries.length&&(this._geometries[o].apply(n),!n.isDone());o++);n.isGeometryChanged()&&this.geometryChanged()}else if(sm(arguments[0],aM)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}else if(sm(arguments[0],sW)){var l=arguments[0];l.filter(this);for(var u=0;u<this._geometries.length;u++)this._geometries[u].apply(l)}},r.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),sU.shouldNeverReachHere(),null},r.prototype.clone=function(){var r=i.prototype.clone.call(this);r._geometries=Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)r._geometries[n]=this._geometries[n].clone();return r},r.prototype.getGeometryType=function(){return"GeometryCollection"},r.prototype.copy=function(){for(var i=Array(this._geometries.length).fill(null),n=0;n<i.length;n++)i[n]=this._geometries[n].copy();return new r(i,this._factory)},r.prototype.isEmpty=function(){for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isEmpty())return!1;return!0},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return -0x4f07bcb1f857d800},Object.defineProperties(r,n),r}(sH),aP=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return sH.SORTINDEX_MULTILINESTRING},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];return!!this.isEquivalentClass(r)&&i.prototype.equalsExact.call(this,r,n)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return this.isClosed()?aI.FALSE:0},r.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isClosed())return!1;return!0},r.prototype.getDimension=function(){return 1},r.prototype.reverse=function(){for(var i=this._geometries.length,r=Array(i).fill(null),n=0;n<this._geometries.length;n++)r[i-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(r)},r.prototype.getBoundary=function(){return new aA(this).getBoundary()},r.prototype.getGeometryType=function(){return"MultiLineString"},r.prototype.copy=function(){for(var i=Array(this._geometries.length).fill(null),n=0;n<i.length;n++)i[n]=this._geometries[n].copy();return new r(i,this._factory)},r.prototype.interfaces_=function(){return[av]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(r,n),r}(aC),aA=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1==arguments.length){var i=arguments[0],r=sQ.MOD2_BOUNDARY_RULE;this._geom=i,this._geomFact=i.getFactory(),this._bnRule=r}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=o}};aA.prototype.boundaryMultiLineString=function(i){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var r=this.computeBoundaryCoordinates(i);return 1===r.length?this._geomFact.createPoint(r[0]):this._geomFact.createMultiPointFromCoords(r)},aA.prototype.getBoundary=function(){return this._geom instanceof aG?this.boundaryLineString(this._geom):this._geom instanceof aP?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},aA.prototype.boundaryLineString=function(i){return this._geom.isEmpty()?this.getEmptyMultiPoint():i.isClosed()?this._bnRule.isInBoundary(2)?i.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([i.getStartPoint(),i.getEndPoint()])},aA.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},aA.prototype.computeBoundaryCoordinates=function(i){var r=new at;this._endpointMap=new a_;for(var n=0;n<i.getNumGeometries();n++){var o=i.getGeometryN(n);0!==o.getNumPoints()&&(this.addEndpoint(o.getCoordinateN(0)),this.addEndpoint(o.getCoordinateN(o.getNumPoints()-1)))}for(var s=this._endpointMap.entrySet().iterator();s.hasNext();){var a=s.next(),l=a.getValue().count;this._bnRule.isInBoundary(l)&&r.add(a.getKey())}return ar.toCoordinateArray(r)},aA.prototype.addEndpoint=function(i){var r=this._endpointMap.get(i);null===r&&(r=new aL,this._endpointMap.put(i,r)),r.count++},aA.prototype.interfaces_=function(){return[]},aA.prototype.getClass=function(){return aA},aA.getBoundary=function(){if(1==arguments.length){var i=arguments[0];return new aA(i).getBoundary()}if(2==arguments.length){var r=arguments[0],n=arguments[1];return new aA(r,n).getBoundary()}};var aL=function(){this.count=null};function ak(){}function aR(){}aL.prototype.interfaces_=function(){return[]},aL.prototype.getClass=function(){return aL};var aD=function(){};function aN(){}function aO(){}function az(){}var aF=function(){},aB={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};aF.prototype.interfaces_=function(){return[]},aF.prototype.getClass=function(){return aF},aF.chars=function(i,r){for(var n=Array(r).fill(null),o=0;o<r;o++)n[o]=i;return String(n)},aF.getStackTrace=function(){if(1==arguments.length){var i=arguments[0],r=new aN,n=new ak(r);return i.printStackTrace(n),r.toString()}if(2==arguments.length){for(var o=arguments[0],s=arguments[1],a="",l=new aR(aF.getStackTrace(o)),u=new az(l),h=0;h<s;h++)try{a+=u.readLine()+aF.NEWLINE}catch(i){if(!(i instanceof aO))throw i;sU.shouldNeverReachHere()}return a}},aF.split=function(i,r){for(var n=r.length,o=new at,s=""+i,a=s.indexOf(r);a>=0;){var l=s.substring(0,a);o.add(l),a=(s=s.substring(a+n)).indexOf(r)}s.length>0&&o.add(s);for(var u=Array(o.size()).fill(null),h=0;h<u.length;h++)u[h]=o.get(h);return u},aF.toString=function(){if(1==arguments.length){var i=arguments[0];return aF.SIMPLE_ORDINATE_FORMAT.format(i)}},aF.spaces=function(i){return aF.chars(" ",i)},aB.NEWLINE.get=function(){return sP.getProperty("line.separator")},aB.SIMPLE_ORDINATE_FORMAT.get=function(){return new aD("0.#")},Object.defineProperties(aF,aB);var aU=function(){};aU.prototype.interfaces_=function(){return[]},aU.prototype.getClass=function(){return aU},aU.copyCoord=function(i,r,n,o){for(var s=Math.min(i.getDimension(),n.getDimension()),a=0;a<s;a++)n.setOrdinate(o,a,i.getOrdinate(r,a))},aU.isRing=function(i){var r=i.size();return 0===r||!(r<=3)&&i.getOrdinate(0,sS.X)===i.getOrdinate(r-1,sS.X)&&i.getOrdinate(0,sS.Y)===i.getOrdinate(r-1,sS.Y)},aU.isEqual=function(i,r){var n=i.size();if(n!==r.size())return!1;for(var o=Math.min(i.getDimension(),r.getDimension()),s=0;s<n;s++)for(var a=0;a<o;a++){var l=i.getOrdinate(s,a),u=r.getOrdinate(s,a);if(i.getOrdinate(s,a)!==r.getOrdinate(s,a)&&(!sr.isNaN(l)||!sr.isNaN(u)))return!1}return!0},aU.extend=function(i,r,n){var o=i.create(n,r.getDimension()),s=r.size();if(aU.copy(r,0,o,0,s),s>0)for(var a=s;a<n;a++)aU.copy(r,s-1,o,a,1);return o},aU.reverse=function(i){for(var r=i.size()-1,n=Math.trunc(r/2),o=0;o<=n;o++)aU.swap(i,o,r-o)},aU.swap=function(i,r,n){if(r===n)return null;for(var o=0;o<i.getDimension();o++){var s=i.getOrdinate(r,o);i.setOrdinate(r,o,i.getOrdinate(n,o)),i.setOrdinate(n,o,s)}},aU.copy=function(i,r,n,o,s){for(var a=0;a<s;a++)aU.copyCoord(i,r+a,n,o+a)},aU.toString=function(){if(1==arguments.length){var i=arguments[0],r=i.size();if(0===r)return"()";var n=i.getDimension(),o=new s_;o.append("(");for(var s=0;s<r;s++){s>0&&o.append(" ");for(var a=0;a<n;a++)a>0&&o.append(","),o.append(aF.toString(i.getOrdinate(s,a)))}return o.append(")"),o.toString()}},aU.ensureValidRing=function(i,r){var n=r.size();return 0===n?r:n<=3?aU.createClosedRing(i,r,4):r.getOrdinate(0,sS.X)===r.getOrdinate(n-1,sS.X)&&r.getOrdinate(0,sS.Y)===r.getOrdinate(n-1,sS.Y)?r:aU.createClosedRing(i,r,n+1)},aU.createClosedRing=function(i,r,n){var o=i.create(n,r.getDimension()),s=r.size();aU.copy(r,0,o,0,s);for(var a=s;a<n;a++)aU.copy(r,0,o,a,1);return o};var aG=function(i){function r(r,n){i.call(this,n),this._points=null,this.init(r)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new sL:this._points.expandEnvelope(new sL)},r.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},r.prototype.getSortIndex=function(){return i.SORTINDEX_LINESTRING},r.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r)||this._points.size()!==r._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!this.equal(this._points.getCoordinate(o),r._points.getCoordinate(o),n))return!1;return!0}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){for(var i=0;i<Math.trunc(this._points.size()/2);i++){var r=this._points.size()-1-i;if(!this._points.getCoordinate(i).equals(this._points.getCoordinate(r)))return this._points.getCoordinate(i).compareTo(this._points.getCoordinate(r))>0&&aU.reverse(this._points),null}},r.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},r.prototype.getBoundaryDimension=function(){return this.isClosed()?aI.FALSE:0},r.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},r.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},r.prototype.getDimension=function(){return 1},r.prototype.getLength=function(){return sX.computeLength(this._points)},r.prototype.getNumPoints=function(){return this._points.size()},r.prototype.reverse=function(){var i=this._points.copy();return aU.reverse(i),this.getFactory().createLineString(i)},r.prototype.compareToSameClass=function(){if(1==arguments.length){for(var i=arguments[0],r=0,n=0;r<this._points.size()&&n<i._points.size();){var o=this._points.getCoordinate(r).compareTo(i._points.getCoordinate(n));if(0!==o)return o;r++,n++}return r<this._points.size()?1:n<i._points.size()?-1:0}if(2==arguments.length){var s=arguments[0],a=arguments[1];return a.compare(this._points,s._points)}},r.prototype.apply=function(){if(sm(arguments[0],sJ))for(var i=arguments[0],r=0;r<this._points.size();r++)i.filter(this._points.getCoordinate(r));else if(sm(arguments[0],aT)){var n=arguments[0];if(0===this._points.size())return null;for(var o=0;o<this._points.size()&&(n.filter(this._points,o),!n.isDone());o++);n.isGeometryChanged()&&this.geometryChanged()}else if(sm(arguments[0],aM)){var s=arguments[0];s.filter(this)}else if(sm(arguments[0],sW)){var a=arguments[0];a.filter(this)}},r.prototype.getBoundary=function(){return new aA(this).getBoundary()},r.prototype.isEquivalentClass=function(i){return i instanceof r},r.prototype.clone=function(){var r=i.prototype.clone.call(this);return r._points=this._points.clone(),r},r.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},r.prototype.getGeometryType=function(){return"LineString"},r.prototype.copy=function(){return new r(this._points.copy(),this._factory)},r.prototype.getCoordinateSequence=function(){return this._points},r.prototype.isEmpty=function(){return 0===this._points.size()},r.prototype.init=function(i){if(null===i&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),1===i.size())throw new si("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},r.prototype.isCoordinate=function(i){for(var r=0;r<this._points.size();r++)if(this._points.getCoordinate(r).equals(i))return!0;return!1},r.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},r.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},r.prototype.interfaces_=function(){return[av]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(r,n),r}(sH),aV=function(){};aV.prototype.interfaces_=function(){return[]},aV.prototype.getClass=function(){return aV};var aq=function(i){function r(r,n){i.call(this,n),this._coordinates=r||null,this.init(this._coordinates)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new sL;var i=new sL;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},r.prototype.getSortIndex=function(){return i.SORTINDEX_POINT},r.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];return!!this.isEquivalentClass(r)&&(!(!this.isEmpty()||!r.isEmpty())||this.isEmpty()===r.isEmpty()&&this.equal(r.getCoordinate(),this.getCoordinate(),n))}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){},r.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},r.prototype.getBoundaryDimension=function(){return aI.FALSE},r.prototype.getDimension=function(){return 0},r.prototype.getNumPoints=function(){return+!this.isEmpty()},r.prototype.reverse=function(){return this.copy()},r.prototype.getX=function(){if(null===this.getCoordinate())throw Error("getX called on empty Point");return this.getCoordinate().x},r.prototype.compareToSameClass=function(){if(1==arguments.length){var i=arguments[0];return this.getCoordinate().compareTo(i.getCoordinate())}if(2==arguments.length){var r=arguments[0],n=arguments[1];return n.compare(this._coordinates,r._coordinates)}},r.prototype.apply=function(){if(sm(arguments[0],sJ)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(sm(arguments[0],aT)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this._coordinates,0),r.isGeometryChanged()&&this.geometryChanged()}else if(sm(arguments[0],aM)){var n=arguments[0];n.filter(this)}else if(sm(arguments[0],sW)){var o=arguments[0];o.filter(this)}},r.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},r.prototype.clone=function(){var r=i.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},r.prototype.getGeometryType=function(){return"Point"},r.prototype.copy=function(){return new r(this._coordinates.copy(),this._factory)},r.prototype.getCoordinateSequence=function(){return this._coordinates},r.prototype.getY=function(){if(null===this.getCoordinate())throw Error("getY called on empty Point");return this.getCoordinate().y},r.prototype.isEmpty=function(){return 0===this._coordinates.size()},r.prototype.init=function(i){null===i&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),sU.isTrue(1>=i.size()),this._coordinates=i},r.prototype.isSimple=function(){return!0},r.prototype.interfaces_=function(){return[aV]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(r,n),r}(sH),aj=function(){};aj.prototype.interfaces_=function(){return[]},aj.prototype.getClass=function(){return aj};var aZ=function(i){function r(r,n,o){if(i.call(this,o),this._shell=null,this._holes=null,null===r&&(r=this.getFactory().createLinearRing()),null===n&&(n=[]),i.hasNullElements(n))throw new si("holes must not contain null elements");if(r.isEmpty()&&i.hasNonEmptyElements(n))throw new si("shell is empty but holes are not");this._shell=r,this._holes=n}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},r.prototype.getSortIndex=function(){return i.SORTINDEX_POLYGON},r.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var i=Array(this.getNumPoints()).fill(null),r=-1,n=this._shell.getCoordinates(),o=0;o<n.length;o++)i[++r]=n[o];for(var s=0;s<this._holes.length;s++)for(var a=this._holes[s].getCoordinates(),l=0;l<a.length;l++)i[++r]=a[l];return i},r.prototype.getArea=function(){var i;i=0+Math.abs(sX.signedArea(this._shell.getCoordinateSequence()));for(var r=0;r<this._holes.length;r++)i-=Math.abs(sX.signedArea(this._holes[r].getCoordinateSequence()));return i},r.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var i=this._shell.getCoordinateSequence(),r=this.getEnvelopeInternal(),n=0;n<5;n++){var o=i.getX(n);if(o!==r.getMinX()&&o!==r.getMaxX())return!1;var s=i.getY(n);if(s!==r.getMinY()&&s!==r.getMaxY())return!1}for(var a=i.getX(0),l=i.getY(0),u=1;u<=4;u++){var h=i.getX(u),c=i.getY(u);if(h!==a==(c!==l))return!1;a=h,l=c}return!0},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];if(!this.isEquivalentClass(r))return!1;var o=this._shell,s=r._shell;if(!o.equalsExact(s,n)||this._holes.length!==r._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!this._holes[a].equalsExact(r._holes[a],n))return!1;return!0}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){if(0==arguments.length){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)this.normalize(this._holes[i],!1);aE.sort(this._holes)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(r.isEmpty())return null;var o=Array(r.getCoordinates().length-1).fill(null);sP.arraycopy(r.getCoordinates(),0,o,0,o.length);var s=ar.minCoordinate(r.getCoordinates());ar.scroll(o,s),sP.arraycopy(o,0,r.getCoordinates(),0,o.length),r.getCoordinates()[o.length]=o[0],sX.isCCW(r.getCoordinates())===n&&ar.reverse(r.getCoordinates())}},r.prototype.getCoordinate=function(){return this._shell.getCoordinate()},r.prototype.getNumInteriorRing=function(){return this._holes.length},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.getLength=function(){var i;i=0+this._shell.getLength();for(var r=0;r<this._holes.length;r++)i+=this._holes[r].getLength();return i},r.prototype.getNumPoints=function(){for(var i=this._shell.getNumPoints(),r=0;r<this._holes.length;r++)i+=this._holes[r].getNumPoints();return i},r.prototype.reverse=function(){var i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=Array(this._holes.length).fill(null);for(var r=0;r<this._holes.length;r++)i._holes[r]=this._holes[r].copy().reverse();return i},r.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},r.prototype.compareToSameClass=function(){if(1==arguments.length){var i=arguments[0],r=this._shell,n=i._shell;return r.compareToSameClass(n)}if(2==arguments.length){var o=arguments[0],s=arguments[1],a=this._shell,l=o._shell,u=a.compareToSameClass(l,s);if(0!==u)return u;for(var h=this.getNumInteriorRing(),c=o.getNumInteriorRing(),p=0;p<h&&p<c;){var f=this.getInteriorRingN(p),d=o.getInteriorRingN(p),m=f.compareToSameClass(d,s);if(0!==m)return m;p++}return p<h?1:p<c?-1:0}},r.prototype.apply=function(i){if(sm(i,sJ)){this._shell.apply(i);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(i)}else if(sm(i,aT)){if(this._shell.apply(i),!i.isDone())for(var n=0;n<this._holes.length&&(this._holes[n].apply(i),!i.isDone());n++);i.isGeometryChanged()&&this.geometryChanged()}else if(sm(i,aM))i.filter(this);else if(sm(i,sW)){i.filter(this),this._shell.apply(i);for(var o=0;o<this._holes.length;o++)this._holes[o].apply(i)}},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var i=Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var r=0;r<this._holes.length;r++)i[r+1]=this._holes[r];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},r.prototype.clone=function(){var r=i.prototype.clone.call(this);r._shell=this._shell.clone(),r._holes=Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)r._holes[n]=this._holes[n].clone();return r},r.prototype.getGeometryType=function(){return"Polygon"},r.prototype.copy=function(){for(var i=this._shell.copy(),n=Array(this._holes.length).fill(null),o=0;o<n.length;o++)n[o]=this._holes[o].copy();return new r(i,n,this._factory)},r.prototype.getExteriorRing=function(){return this._shell},r.prototype.isEmpty=function(){return this._shell.isEmpty()},r.prototype.getInteriorRingN=function(i){return this._holes[i]},r.prototype.interfaces_=function(){return[aj]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return -0x307ffefd8dc97200},Object.defineProperties(r,n),r}(sH),aX=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return sH.SORTINDEX_MULTIPOINT},r.prototype.isValid=function(){return!0},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];return!!this.isEquivalentClass(r)&&i.prototype.equalsExact.call(this,r,n)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getCoordinate=function(){if(1==arguments.length){var r=arguments[0];return this._geometries[r].getCoordinate()}return i.prototype.getCoordinate.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return aI.FALSE},r.prototype.getDimension=function(){return 0},r.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},r.prototype.getGeometryType=function(){return"MultiPoint"},r.prototype.copy=function(){for(var i=Array(this._geometries.length).fill(null),n=0;n<i.length;n++)i[n]=this._geometries[n].copy();return new r(i,this._factory)},r.prototype.interfaces_=function(){return[aV]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return -0x6fb1ed4162e0fc00},Object.defineProperties(r,n),r}(aC),a$=function(i){function r(r,n){r instanceof su&&n instanceof a7&&(r=n.getCoordinateSequenceFactory().create(r)),i.call(this,r,n),this.validateConstruction()}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return sH.SORTINDEX_LINEARRING},r.prototype.getBoundaryDimension=function(){return aI.FALSE},r.prototype.isClosed=function(){return!!this.isEmpty()||i.prototype.isClosed.call(this)},r.prototype.reverse=function(){var i=this._points.copy();return aU.reverse(i),this.getFactory().createLinearRing(i)},r.prototype.validateConstruction=function(){if(!this.isEmpty()&&!i.prototype.isClosed.call(this))throw new si("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<r.MINIMUM_VALID_SIZE)throw new si("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},r.prototype.getGeometryType=function(){return"LinearRing"},r.prototype.copy=function(){return new r(this._points.copy(),this._factory)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return -0x3b229e262367a600},Object.defineProperties(r,n),r}(aG),aW=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return sH.SORTINDEX_MULTIPOLYGON},r.prototype.equalsExact=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];return!!this.isEquivalentClass(r)&&i.prototype.equalsExact.call(this,r,n)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.reverse=function(){for(var i=this._geometries.length,r=Array(i).fill(null),n=0;n<this._geometries.length;n++)r[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(r)},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new at,r=0;r<this._geometries.length;r++)for(var n=this._geometries[r].getBoundary(),o=0;o<n.getNumGeometries();o++)i.add(n.getGeometryN(o));var s=Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(s))},r.prototype.getGeometryType=function(){return"MultiPolygon"},r.prototype.copy=function(){for(var i=Array(this._geometries.length).fill(null),n=0;n<i.length;n++)i[n]=this._geometries[n].copy();return new r(i,this._factory)},r.prototype.interfaces_=function(){return[aj]},r.prototype.getClass=function(){return r},n.serialVersionUID.get=function(){return -0x7a5aa1369171980},Object.defineProperties(r,n),r}(aC),aH=function(i){this._factory=i||null,this._isUserDataCopied=!1},aY={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};aH.prototype.setCopyUserData=function(i){this._isUserDataCopied=i},aH.prototype.edit=function(i,r){if(null===i)return null;var n=this.editInternal(i,r);return this._isUserDataCopied&&n.setUserData(i.getUserData()),n},aH.prototype.editInternal=function(i,r){return null===this._factory&&(this._factory=i.getFactory()),i instanceof aC?this.editGeometryCollection(i,r):i instanceof aZ?this.editPolygon(i,r):i instanceof aq||i instanceof aG?r.edit(i,this._factory):(sU.shouldNeverReachHere("Unsupported Geometry class: "+i.getClass().getName()),null)},aH.prototype.editGeometryCollection=function(i,r){for(var n=r.edit(i,this._factory),o=new at,s=0;s<n.getNumGeometries();s++){var a=this.edit(n.getGeometryN(s),r);null===a||a.isEmpty()||o.add(a)}return n.getClass()===aX?this._factory.createMultiPoint(o.toArray([])):n.getClass()===aP?this._factory.createMultiLineString(o.toArray([])):n.getClass()===aW?this._factory.createMultiPolygon(o.toArray([])):this._factory.createGeometryCollection(o.toArray([]))},aH.prototype.editPolygon=function(i,r){var n=r.edit(i,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var o=this.edit(n.getExteriorRing(),r);if(null===o||o.isEmpty())return this._factory.createPolygon();for(var s=new at,a=0;a<n.getNumInteriorRing();a++){var l=this.edit(n.getInteriorRingN(a),r);null===l||l.isEmpty()||s.add(l)}return this._factory.createPolygon(o,s.toArray([]))},aH.prototype.interfaces_=function(){return[]},aH.prototype.getClass=function(){return aH},aH.GeometryEditorOperation=function(){},aY.NoOpGeometryOperation.get=function(){return aK},aY.CoordinateOperation.get=function(){return aJ},aY.CoordinateSequenceOperation.get=function(){return aQ},Object.defineProperties(aH,aY);var aK=function(){};aK.prototype.edit=function(i,r){return i},aK.prototype.interfaces_=function(){return[aH.GeometryEditorOperation]},aK.prototype.getClass=function(){return aK};var aJ=function(){};aJ.prototype.edit=function(i,r){var n=this.editCoordinates(i.getCoordinates(),i);return null===n?i:i instanceof a$?r.createLinearRing(n):i instanceof aG?r.createLineString(n):i instanceof aq?n.length>0?r.createPoint(n[0]):r.createPoint():i},aJ.prototype.interfaces_=function(){return[aH.GeometryEditorOperation]},aJ.prototype.getClass=function(){return aJ};var aQ=function(){};aQ.prototype.edit=function(i,r){return i instanceof a$?r.createLinearRing(this.edit(i.getCoordinateSequence(),i)):i instanceof aG?r.createLineString(this.edit(i.getCoordinateSequence(),i)):i instanceof aq?r.createPoint(this.edit(i.getCoordinateSequence(),i)):i},aQ.prototype.interfaces_=function(){return[aH.GeometryEditorOperation]},aQ.prototype.getClass=function(){return aQ};var a0=function(){if(this._dimension=3,this._coordinates=null,1==arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var i=arguments[0];this._coordinates=Array(i).fill(null);for(var r=0;r<i;r++)this._coordinates[r]=new su}else if(sm(arguments[0],sS)){var n=arguments[0];if(null===n)return this._coordinates=[].fill(null),null;this._dimension=n.getDimension(),this._coordinates=Array(n.size()).fill(null);for(var o=0;o<this._coordinates.length;o++)this._coordinates[o]=n.getCoordinateCopy(o)}}else if(2==arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=s,this._dimension=a,null===s&&(this._coordinates=[].fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],u=arguments[1];this._coordinates=Array(l).fill(null),this._dimension=u;for(var h=0;h<l;h++)this._coordinates[h]=new su}}},a1={serialVersionUID:{configurable:!0}};a0.prototype.setOrdinate=function(i,r,n){switch(r){case sS.X:this._coordinates[i].x=n;break;case sS.Y:this._coordinates[i].y=n;break;case sS.Z:this._coordinates[i].z=n;break;default:throw new si("invalid ordinateIndex")}},a0.prototype.size=function(){return this._coordinates.length},a0.prototype.getOrdinate=function(i,r){switch(r){case sS.X:return this._coordinates[i].x;case sS.Y:return this._coordinates[i].y;case sS.Z:return this._coordinates[i].z}return sr.NaN},a0.prototype.getCoordinate=function(){if(1==arguments.length){var i=arguments[0];return this._coordinates[i]}if(2==arguments.length){var r=arguments[0],n=arguments[1];n.x=this._coordinates[r].x,n.y=this._coordinates[r].y,n.z=this._coordinates[r].z}},a0.prototype.getCoordinateCopy=function(i){return new su(this._coordinates[i])},a0.prototype.getDimension=function(){return this._dimension},a0.prototype.getX=function(i){return this._coordinates[i].x},a0.prototype.clone=function(){for(var i=Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)i[r]=this._coordinates[r].clone();return new a0(i,this._dimension)},a0.prototype.expandEnvelope=function(i){for(var r=0;r<this._coordinates.length;r++)i.expandToInclude(this._coordinates[r]);return i},a0.prototype.copy=function(){for(var i=Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)i[r]=this._coordinates[r].copy();return new a0(i,this._dimension)},a0.prototype.toString=function(){if(this._coordinates.length>0){var i=new s_(17*this._coordinates.length);i.append("("),i.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)i.append(", "),i.append(this._coordinates[r]);return i.append(")"),i.toString()}return"()"},a0.prototype.getY=function(i){return this._coordinates[i].y},a0.prototype.toCoordinateArray=function(){return this._coordinates},a0.prototype.interfaces_=function(){return[sS,sl]},a0.prototype.getClass=function(){return a0},a1.serialVersionUID.get=function(){return -0xcb44a778db18e00},Object.defineProperties(a0,a1);var a2=function(){},a3={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};a2.prototype.readResolve=function(){return a2.instance()},a2.prototype.create=function(){if(1==arguments.length){if(arguments[0]instanceof Array){var i=arguments[0];return new a0(i)}if(sm(arguments[0],sS)){var r=arguments[0];return new a0(r)}}else if(2==arguments.length){var n=arguments[0],o=arguments[1];return o>3&&(o=3),o<2?new a0(n):new a0(n,o)}},a2.prototype.interfaces_=function(){return[sp,sl]},a2.prototype.getClass=function(){return a2},a2.instance=function(){return a2.instanceObject},a3.serialVersionUID.get=function(){return -0x38e49fa6cf6f2e00},a3.instanceObject.get=function(){return new a2},Object.defineProperties(a2,a3);var a5=function(i){function r(){i.call(this),this.map_=new Map}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.get=function(i){return this.map_.get(i)||null},r.prototype.put=function(i,r){return this.map_.set(i,r),r},r.prototype.values=function(){for(var i=new at,r=this.map_.values(),n=r.next();!n.done;)i.add(n.value),n=r.next();return i},r.prototype.entrySet=function(){var i=new ac;return this.map_.entries().forEach(function(r){return i.add(r)}),i},r.prototype.size=function(){return this.map_.size()},r}(aa),a4=function i(){if(this._modelType=null,this._scale=null,0==arguments.length)this._modelType=i.FLOATING;else if(1==arguments.length){if(arguments[0]instanceof a8){var r=arguments[0];this._modelType=r,r===i.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=i.FIXED,this.setScale(n)}else if(arguments[0]instanceof i){var o=arguments[0];this._modelType=o._modelType,this._scale=o._scale}}},a6={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};a4.prototype.equals=function(i){return i instanceof a4&&this._modelType===i._modelType&&this._scale===i._scale},a4.prototype.compareTo=function(i){var r=this.getMaximumSignificantDigits(),n=i.getMaximumSignificantDigits();return new sv(r).compareTo(new sv(n))},a4.prototype.getScale=function(){return this._scale},a4.prototype.isFloating=function(){return this._modelType===a4.FLOATING||this._modelType===a4.FLOATING_SINGLE},a4.prototype.getType=function(){return this._modelType},a4.prototype.toString=function(){var i="UNKNOWN";return this._modelType===a4.FLOATING?i="Floating":this._modelType===a4.FLOATING_SINGLE?i="Floating-Single":this._modelType===a4.FIXED&&(i="Fixed (Scale="+this.getScale()+")"),i},a4.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var i=arguments[0];return sr.isNaN(i)||this._modelType===a4.FLOATING_SINGLE?i:this._modelType===a4.FIXED?Math.round(i*this._scale)/this._scale:i}if(arguments[0]instanceof su){var r=arguments[0];if(this._modelType===a4.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}},a4.prototype.getMaximumSignificantDigits=function(){var i=16;return this._modelType===a4.FLOATING?i=16:this._modelType===a4.FLOATING_SINGLE?i=6:this._modelType===a4.FIXED&&(i=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),i},a4.prototype.setScale=function(i){this._scale=Math.abs(i)},a4.prototype.interfaces_=function(){return[sl,so]},a4.prototype.getClass=function(){return a4},a4.mostPrecise=function(i,r){return i.compareTo(r)>=0?i:r},a6.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},a6.maximumPreciseValue.get=function(){return 0x20000000000000},Object.defineProperties(a4,a6);var a8=function i(r){this._name=r||null,i.nameToTypeMap.put(r,this)},a9={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};a8.prototype.readResolve=function(){return a8.nameToTypeMap.get(this._name)},a8.prototype.toString=function(){return this._name},a8.prototype.interfaces_=function(){return[sl]},a8.prototype.getClass=function(){return a8},a9.serialVersionUID.get=function(){return -0x4cb98acd40a6b400},a9.nameToTypeMap.get=function(){return new a5},Object.defineProperties(a8,a9),a4.Type=a8,a4.FIXED=new a8("FIXED"),a4.FLOATING=new a8("FLOATING"),a4.FLOATING_SINGLE=new a8("FLOATING SINGLE");var a7=function i(){this._precisionModel=new a4,this._SRID=0,this._coordinateSequenceFactory=i.getDefaultCoordinateSequenceFactory(),0==arguments.length||(1==arguments.length?sm(arguments[0],sp)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof a4&&(this._precisionModel=arguments[0]):2==arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3==arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},lt={serialVersionUID:{configurable:!0}};a7.prototype.toGeometry=function(i){return i.isNull()?this.createPoint(null):i.getMinX()===i.getMaxX()&&i.getMinY()===i.getMaxY()?this.createPoint(new su(i.getMinX(),i.getMinY())):i.getMinX()===i.getMaxX()||i.getMinY()===i.getMaxY()?this.createLineString([new su(i.getMinX(),i.getMinY()),new su(i.getMaxX(),i.getMaxY())]):this.createPolygon(this.createLinearRing([new su(i.getMinX(),i.getMinY()),new su(i.getMinX(),i.getMaxY()),new su(i.getMaxX(),i.getMaxY()),new su(i.getMaxX(),i.getMinY()),new su(i.getMinX(),i.getMinY())]),null)},a7.prototype.createLineString=function(i){return i?i instanceof Array?new aG(this.getCoordinateSequenceFactory().create(i),this):sm(i,sS)?new aG(i,this):void 0:new aG(this.getCoordinateSequenceFactory().create([]),this)},a7.prototype.createMultiLineString=function(){if(0==arguments.length)return new aP(null,this);if(1==arguments.length){var i=arguments[0];return new aP(i,this)}},a7.prototype.buildGeometry=function(i){for(var r=null,n=!1,o=!1,s=i.iterator();s.hasNext();){var a=s.next(),l=a.getClass();null===r&&(r=l),l!==r&&(n=!0),a.isGeometryCollectionOrDerived()&&(o=!0)}if(null===r)return this.createGeometryCollection();if(n||o)return this.createGeometryCollection(a7.toGeometryArray(i));var u=i.iterator().next();if(i.size()>1){if(u instanceof aZ)return this.createMultiPolygon(a7.toPolygonArray(i));if(u instanceof aG)return this.createMultiLineString(a7.toLineStringArray(i));if(u instanceof aq)return this.createMultiPoint(a7.toPointArray(i));sU.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u},a7.prototype.createMultiPointFromCoords=function(i){return this.createMultiPoint(null!==i?this.getCoordinateSequenceFactory().create(i):null)},a7.prototype.createPoint=function(){if(0==arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1==arguments.length){if(arguments[0]instanceof su){var i=arguments[0];return this.createPoint(null!==i?this.getCoordinateSequenceFactory().create([i]):null)}if(sm(arguments[0],sS)){var r=arguments[0];return new aq(r,this)}}},a7.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},a7.prototype.createPolygon=function(){if(0==arguments.length)return new aZ(null,null,this);if(1==arguments.length){if(sm(arguments[0],sS)){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof Array){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}if(arguments[0]instanceof a$){var n=arguments[0];return this.createPolygon(n,null)}}else if(2==arguments.length){var o=arguments[0],s=arguments[1];return new aZ(o,s,this)}},a7.prototype.getSRID=function(){return this._SRID},a7.prototype.createGeometryCollection=function(){if(0==arguments.length)return new aC(null,this);if(1==arguments.length){var i=arguments[0];return new aC(i,this)}},a7.prototype.createGeometry=function(i){return new aH(this).edit(i,{edit:function(){if(2==arguments.length){var i=arguments[0];return this._coordinateSequenceFactory.create(i)}}})},a7.prototype.getPrecisionModel=function(){return this._precisionModel},a7.prototype.createLinearRing=function(){if(0==arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1==arguments.length){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLinearRing(null!==i?this.getCoordinateSequenceFactory().create(i):null)}if(sm(arguments[0],sS)){var r=arguments[0];return new a$(r,this)}}},a7.prototype.createMultiPolygon=function(){if(0==arguments.length)return new aW(null,this);if(1==arguments.length){var i=arguments[0];return new aW(i,this)}},a7.prototype.createMultiPoint=function(){if(0==arguments.length)return new aX(null,this);if(1==arguments.length){if(arguments[0]instanceof Array){var i=arguments[0];return new aX(i,this)}if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(null!==r?this.getCoordinateSequenceFactory().create(r):null)}if(sm(arguments[0],sS)){var n=arguments[0];if(null===n)return this.createMultiPoint([].fill(null));for(var o=Array(n.size()).fill(null),s=0;s<n.size();s++){var a=this.getCoordinateSequenceFactory().create(1,n.getDimension());aU.copy(n,s,a,0,1),o[s]=this.createPoint(a)}return this.createMultiPoint(o)}}},a7.prototype.interfaces_=function(){return[sl]},a7.prototype.getClass=function(){return a7},a7.toMultiPolygonArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toGeometryArray=function(i){if(null===i)return null;var r=Array(i.size()).fill(null);return i.toArray(r)},a7.getDefaultCoordinateSequenceFactory=function(){return a2.instance()},a7.toMultiLineStringArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toLineStringArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toMultiPointArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toLinearRingArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toPointArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.toPolygonArray=function(i){var r=Array(i.size()).fill(null);return i.toArray(r)},a7.createPointFromInternalCoord=function(i,r){return r.getPrecisionModel().makePrecise(i),r.getFactory().createPoint(i)},lt.serialVersionUID.get=function(){return -0x5ea75f2051eeb400},Object.defineProperties(a7,lt);var le=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],li=function(i){this.geometryFactory=i||new a7};li.prototype.read=function(i){var r,n=(r="string"==typeof i?JSON.parse(i):i).type;if(!lr[n])throw Error("Unknown GeoJSON type: "+r.type);return -1!==le.indexOf(n)?lr[n].apply(this,[r.coordinates]):"GeometryCollection"===n?lr[n].apply(this,[r.geometries]):lr[n].apply(this,[r])},li.prototype.write=function(i){var r=i.getGeometryType();if(!ln[r])throw Error("Geometry is not supported");return ln[r].apply(this,[i])};var lr={Feature:function(i){var r={};for(var n in i)r[n]=i[n];if(i.geometry){if(!lr[i.geometry.type])throw Error("Unknown GeoJSON type: "+i.type);r.geometry=this.read(i.geometry)}return i.bbox&&(r.bbox=lr.bbox.apply(this,[i.bbox])),r},FeatureCollection:function(i){var r={};if(i.features){r.features=[];for(var n=0;n<i.features.length;++n)r.features.push(this.read(i.features[n]))}return i.bbox&&(r.bbox=this.parse.bbox.apply(this,[i.bbox])),r},coordinates:function(i){for(var r=[],n=0;n<i.length;++n){var o=i[n];r.push(new su(o[0],o[1]))}return r},bbox:function(i){return this.geometryFactory.createLinearRing([new su(i[0],i[1]),new su(i[2],i[1]),new su(i[2],i[3]),new su(i[0],i[3]),new su(i[0],i[1])])},Point:function(i){var r=new su(i[0],i[1]);return this.geometryFactory.createPoint(r)},MultiPoint:function(i){for(var r=[],n=0;n<i.length;++n)r.push(lr.Point.apply(this,[i[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(i){var r=lr.coordinates.apply(this,[i]);return this.geometryFactory.createLineString(r)},MultiLineString:function(i){for(var r=[],n=0;n<i.length;++n)r.push(lr.LineString.apply(this,[i[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(i){for(var r=lr.coordinates.apply(this,[i[0]]),n=this.geometryFactory.createLinearRing(r),o=[],s=1;s<i.length;++s){var a=i[s],l=lr.coordinates.apply(this,[a]),u=this.geometryFactory.createLinearRing(l);o.push(u)}return this.geometryFactory.createPolygon(n,o)},MultiPolygon:function(i){for(var r=[],n=0;n<i.length;++n){var o=i[n];r.push(lr.Polygon.apply(this,[o]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(i){for(var r=[],n=0;n<i.length;++n){var o=i[n];r.push(this.read(o))}return this.geometryFactory.createGeometryCollection(r)}},ln={coordinate:function(i){return[i.x,i.y]},Point:function(i){return{type:"Point",coordinates:ln.coordinate.apply(this,[i.getCoordinate()])}},MultiPoint:function(i){for(var r=[],n=0;n<i._geometries.length;++n){var o=i._geometries[n],s=ln.Point.apply(this,[o]);r.push(s.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(i){for(var r=[],n=i.getCoordinates(),o=0;o<n.length;++o){var s=n[o];r.push(ln.coordinate.apply(this,[s]))}return{type:"LineString",coordinates:r}},MultiLineString:function(i){for(var r=[],n=0;n<i._geometries.length;++n){var o=i._geometries[n],s=ln.LineString.apply(this,[o]);r.push(s.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(i){var r=[],n=ln.LineString.apply(this,[i._shell]);r.push(n.coordinates);for(var o=0;o<i._holes.length;++o){var s=i._holes[o],a=ln.LineString.apply(this,[s]);r.push(a.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(i){for(var r=[],n=0;n<i._geometries.length;++n){var o=i._geometries[n],s=ln.Polygon.apply(this,[o]);r.push(s.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(i){for(var r=[],n=0;n<i._geometries.length;++n){var o=i._geometries[n],s=o.getGeometryType();r.push(ln[s].apply(this,[o]))}return{type:"GeometryCollection",geometries:r}}},lo=function(i){this.geometryFactory=i||new a7,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new li(this.geometryFactory)};lo.prototype.read=function(i){var r=this.parser.read(i);return this.precisionModel.getType()===a4.FIXED&&this.reducePrecision(r),r},lo.prototype.reducePrecision=function(i){var r,n;if(i.coordinate)this.precisionModel.makePrecise(i.coordinate);else if(i.points)for(r=0,n=i.points.length;r<n;r++)this.precisionModel.makePrecise(i.points[r]);else if(i.geometries)for(r=0,n=i.geometries.length;r<n;r++)this.reducePrecision(i.geometries[r])};var ls=function(){this.parser=new li(this.geometryFactory)};ls.prototype.write=function(i){return this.parser.write(i)};var la=function(){},ll={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function lu(i){this.message=i||""}function lh(){this.array_=[]}la.prototype.interfaces_=function(){return[]},la.prototype.getClass=function(){return la},la.opposite=function(i){return i===la.LEFT?la.RIGHT:i===la.RIGHT?la.LEFT:i},ll.ON.get=function(){return 0},ll.LEFT.get=function(){return 1},ll.RIGHT.get=function(){return 2},Object.defineProperties(la,ll),lu.prototype=Error(),lu.prototype.name="EmptyStackException",lh.prototype=new s9,lh.prototype.add=function(i){return this.array_.push(i),!0},lh.prototype.get=function(i){if(i<0||i>=this.size())throw Error();return this.array_[i]},lh.prototype.push=function(i){return this.array_.push(i),i},lh.prototype.pop=function(i){if(0===this.array_.length)throw new lu;return this.array_.pop()},lh.prototype.peek=function(){if(0===this.array_.length)throw new lu;return this.array_[this.array_.length-1]},lh.prototype.empty=function(){return 0===this.array_.length},lh.prototype.isEmpty=function(){return this.empty()},lh.prototype.search=function(i){return this.array_.indexOf(i)},lh.prototype.size=function(){return this.array_.length},lh.prototype.toArray=function(){for(var i=[],r=0,n=this.array_.length;r<n;r++)i.push(this.array_[r]);return i};var lc=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};lc.prototype.getCoordinate=function(){return this._minCoord},lc.prototype.getRightmostSide=function(i,r){var n=this.getRightmostSideOfSegment(i,r);return n<0&&(n=this.getRightmostSideOfSegment(i,r-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(i)),n},lc.prototype.findRightmostEdgeAtVertex=function(){var i=this._minDe.getEdge().getCoordinates();sU.isTrue(this._minIndex>0&&this._minIndex<i.length,"rightmost point expected to be interior vertex of edge");var r=i[this._minIndex-1],n=i[this._minIndex+1],o=sX.computeOrientation(this._minCoord,n,r),s=!1;(r.y<this._minCoord.y&&n.y<this._minCoord.y&&o===sX.COUNTERCLOCKWISE||r.y>this._minCoord.y&&n.y>this._minCoord.y&&o===sX.CLOCKWISE)&&(s=!0),s&&(this._minIndex=this._minIndex-1)},lc.prototype.getRightmostSideOfSegment=function(i,r){var n=i.getEdge().getCoordinates();if(r<0||r+1>=n.length||n[r].y===n[r+1].y)return -1;var o=la.LEFT;return n[r].y<n[r+1].y&&(o=la.RIGHT),o},lc.prototype.getEdge=function(){return this._orientedDe},lc.prototype.checkForRightmostCoordinate=function(i){for(var r=i.getEdge().getCoordinates(),n=0;n<r.length-1;n++)(null===this._minCoord||r[n].x>this._minCoord.x)&&(this._minDe=i,this._minIndex=n,this._minCoord=r[n])},lc.prototype.findRightmostEdgeAtNode=function(){var i=this._minDe.getNode().getEdges();this._minDe=i.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},lc.prototype.findEdge=function(i){for(var r=i.iterator();r.hasNext();){var n=r.next();n.isForward()&&this.checkForRightmostCoordinate(n)}sU.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===la.LEFT&&(this._orientedDe=this._minDe.getSym())},lc.prototype.interfaces_=function(){return[]},lc.prototype.getClass=function(){return lc};var lp=function(i){function r(n,o){i.call(this,r.msgWithCoord(n,o)),this.pt=o?new su(o):null,this.name="TopologyException"}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getCoordinate=function(){return this.pt},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.msgWithCoord=function(i,r){return r?i:i+" [ "+r+" ]"},r}(sF),lf=function(){this.array_=[]};lf.prototype.addLast=function(i){this.array_.push(i)},lf.prototype.removeFirst=function(){return this.array_.shift()},lf.prototype.isEmpty=function(){return 0===this.array_.length};var ld=function(){this._finder=null,this._dirEdgeList=new at,this._nodes=new at,this._rightMostCoord=null,this._env=null,this._finder=new lc};ld.prototype.clearVisitedEdges=function(){for(var i=this._dirEdgeList.iterator();i.hasNext();)i.next().setVisited(!1)},ld.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},ld.prototype.computeNodeDepth=function(i){for(var r=null,n=i.getEdges().iterator();n.hasNext();){var o=n.next();if(o.isVisited()||o.getSym().isVisited()){r=o;break}}if(null===r)throw new lp("unable to find edge to compute depths at "+i.getCoordinate());i.getEdges().computeDepths(r);for(var s=i.getEdges().iterator();s.hasNext();){var a=s.next();a.setVisited(!0),this.copySymDepths(a)}},ld.prototype.computeDepth=function(i){this.clearVisitedEdges();var r=this._finder.getEdge();r.setEdgeDepths(la.RIGHT,i),this.copySymDepths(r),this.computeDepths(r)},ld.prototype.create=function(i){this.addReachable(i),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},ld.prototype.findResultEdges=function(){for(var i=this._dirEdgeList.iterator();i.hasNext();){var r=i.next();r.getDepth(la.RIGHT)>=1&&0>=r.getDepth(la.LEFT)&&!r.isInteriorAreaEdge()&&r.setInResult(!0)}},ld.prototype.computeDepths=function(i){var r=new ac,n=new lf,o=i.getNode();for(n.addLast(o),r.add(o),i.setVisited(!0);!n.isEmpty();){var s=n.removeFirst();r.add(s),this.computeNodeDepth(s);for(var a=s.getEdges().iterator();a.hasNext();){var l=a.next().getSym();if(!l.isVisited()){var u=l.getNode();r.contains(u)||(n.addLast(u),r.add(u))}}}},ld.prototype.compareTo=function(i){return this._rightMostCoord.x<i._rightMostCoord.x?-1:+(this._rightMostCoord.x>i._rightMostCoord.x)},ld.prototype.getEnvelope=function(){if(null===this._env){for(var i=new sL,r=this._dirEdgeList.iterator();r.hasNext();)for(var n=r.next().getEdge().getCoordinates(),o=0;o<n.length-1;o++)i.expandToInclude(n[o]);this._env=i}return this._env},ld.prototype.addReachable=function(i){var r=new lh;for(r.add(i);!r.empty();){var n=r.pop();this.add(n,r)}},ld.prototype.copySymDepths=function(i){var r=i.getSym();r.setDepth(la.LEFT,i.getDepth(la.RIGHT)),r.setDepth(la.RIGHT,i.getDepth(la.LEFT))},ld.prototype.add=function(i,r){i.setVisited(!0),this._nodes.add(i);for(var n=i.getEdges().iterator();n.hasNext();){var o=n.next();this._dirEdgeList.add(o);var s=o.getSym().getNode();s.isVisited()||r.push(s)}},ld.prototype.getNodes=function(){return this._nodes},ld.prototype.getDirectedEdges=function(){return this._dirEdgeList},ld.prototype.interfaces_=function(){return[so]},ld.prototype.getClass=function(){return ld};var lm=function i(){if(this.location=null,1==arguments.length){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[la.ON]=n}else if(arguments[0]instanceof i){var o=arguments[0];if(this.init(o.location.length),null!==o)for(var s=0;s<this.location.length;s++)this.location[s]=o.location[s]}}else if(3==arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2];this.init(3),this.location[la.ON]=a,this.location[la.LEFT]=l,this.location[la.RIGHT]=u}};lm.prototype.setAllLocations=function(i){for(var r=0;r<this.location.length;r++)this.location[r]=i},lm.prototype.isNull=function(){for(var i=0;i<this.location.length;i++)if(this.location[i]!==sf.NONE)return!1;return!0},lm.prototype.setAllLocationsIfNull=function(i){for(var r=0;r<this.location.length;r++)this.location[r]===sf.NONE&&(this.location[r]=i)},lm.prototype.isLine=function(){return 1===this.location.length},lm.prototype.merge=function(i){if(i.location.length>this.location.length){var r=[,,,].fill(null);r[la.ON]=this.location[la.ON],r[la.LEFT]=sf.NONE,r[la.RIGHT]=sf.NONE,this.location=r}for(var n=0;n<this.location.length;n++)this.location[n]===sf.NONE&&n<i.location.length&&(this.location[n]=i.location[n])},lm.prototype.getLocations=function(){return this.location},lm.prototype.flip=function(){if(this.location.length<=1)return null;var i=this.location[la.LEFT];this.location[la.LEFT]=this.location[la.RIGHT],this.location[la.RIGHT]=i},lm.prototype.toString=function(){var i=new s_;return this.location.length>1&&i.append(sf.toLocationSymbol(this.location[la.LEFT])),i.append(sf.toLocationSymbol(this.location[la.ON])),this.location.length>1&&i.append(sf.toLocationSymbol(this.location[la.RIGHT])),i.toString()},lm.prototype.setLocations=function(i,r,n){this.location[la.ON]=i,this.location[la.LEFT]=r,this.location[la.RIGHT]=n},lm.prototype.get=function(i){return i<this.location.length?this.location[i]:sf.NONE},lm.prototype.isArea=function(){return this.location.length>1},lm.prototype.isAnyNull=function(){for(var i=0;i<this.location.length;i++)if(this.location[i]===sf.NONE)return!0;return!1},lm.prototype.setLocation=function(){if(1==arguments.length){var i=arguments[0];this.setLocation(la.ON,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];this.location[r]=n}},lm.prototype.init=function(i){this.location=Array(i).fill(null),this.setAllLocations(sf.NONE)},lm.prototype.isEqualOnSide=function(i,r){return this.location[r]===i.location[r]},lm.prototype.allPositionsEqual=function(i){for(var r=0;r<this.location.length;r++)if(this.location[r]!==i)return!1;return!0},lm.prototype.interfaces_=function(){return[]},lm.prototype.getClass=function(){return lm};var lg=function i(){if(this.elt=[,,].fill(null),1==arguments.length){if(Number.isInteger(arguments[0])){var r=arguments[0];this.elt[0]=new lm(r),this.elt[1]=new lm(r)}else if(arguments[0]instanceof i){var n=arguments[0];this.elt[0]=new lm(n.elt[0]),this.elt[1]=new lm(n.elt[1])}}else if(2==arguments.length){var o=arguments[0],s=arguments[1];this.elt[0]=new lm(sf.NONE),this.elt[1]=new lm(sf.NONE),this.elt[o].setLocation(s)}else if(3==arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2];this.elt[0]=new lm(a,l,u),this.elt[1]=new lm(a,l,u)}else if(4==arguments.length){var h=arguments[0],c=arguments[1],p=arguments[2],f=arguments[3];this.elt[0]=new lm(sf.NONE,sf.NONE,sf.NONE),this.elt[1]=new lm(sf.NONE,sf.NONE,sf.NONE),this.elt[h].setLocations(c,p,f)}};lg.prototype.getGeometryCount=function(){var i=0;return this.elt[0].isNull()||i++,this.elt[1].isNull()||i++,i},lg.prototype.setAllLocations=function(i,r){this.elt[i].setAllLocations(r)},lg.prototype.isNull=function(i){return this.elt[i].isNull()},lg.prototype.setAllLocationsIfNull=function(){if(1==arguments.length){var i=arguments[0];this.setAllLocationsIfNull(0,i),this.setAllLocationsIfNull(1,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];this.elt[r].setAllLocationsIfNull(n)}},lg.prototype.isLine=function(i){return this.elt[i].isLine()},lg.prototype.merge=function(i){for(var r=0;r<2;r++)null===this.elt[r]&&null!==i.elt[r]?this.elt[r]=new lm(i.elt[r]):this.elt[r].merge(i.elt[r])},lg.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},lg.prototype.getLocation=function(){if(1==arguments.length){var i=arguments[0];return this.elt[i].get(la.ON)}if(2==arguments.length){var r=arguments[0],n=arguments[1];return this.elt[r].get(n)}},lg.prototype.toString=function(){var i=new s_;return null!==this.elt[0]&&(i.append("A:"),i.append(this.elt[0].toString())),null!==this.elt[1]&&(i.append(" B:"),i.append(this.elt[1].toString())),i.toString()},lg.prototype.isArea=function(){if(0==arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1==arguments.length){var i=arguments[0];return this.elt[i].isArea()}},lg.prototype.isAnyNull=function(i){return this.elt[i].isAnyNull()},lg.prototype.setLocation=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];this.elt[i].setLocation(la.ON,r)}else if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];this.elt[n].setLocation(o,s)}},lg.prototype.isEqualOnSide=function(i,r){return this.elt[0].isEqualOnSide(i.elt[0],r)&&this.elt[1].isEqualOnSide(i.elt[1],r)},lg.prototype.allPositionsEqual=function(i,r){return this.elt[i].allPositionsEqual(r)},lg.prototype.toLine=function(i){this.elt[i].isArea()&&(this.elt[i]=new lm(this.elt[i].location[0]))},lg.prototype.interfaces_=function(){return[]},lg.prototype.getClass=function(){return lg},lg.toLineLabel=function(i){for(var r=new lg(sf.NONE),n=0;n<2;n++)r.setLocation(n,i.getLocation(n));return r};var ly=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new at,this._pts=new at,this._label=new lg(sf.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new at,this._geometryFactory=null;var i=arguments[0],r=arguments[1];this._geometryFactory=r,this.computePoints(i),this.computeRing()};ly.prototype.computeRing=function(){if(null!==this._ring)return null;for(var i=Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)i[r]=this._pts.get(r);this._ring=this._geometryFactory.createLinearRing(i),this._isHole=sX.isCCW(this._ring.getCoordinates())},ly.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},ly.prototype.computePoints=function(i){this._startDe=i;var r=i,n=!0;do{if(null===r)throw new lp("Found null DirectedEdge");if(r.getEdgeRing()===this)throw new lp("Directed Edge visited twice during ring-building at "+r.getCoordinate());this._edges.add(r);var o=r.getLabel();sU.isTrue(o.isArea()),this.mergeLabel(o),this.addPoints(r.getEdge(),r.isForward(),n),n=!1,this.setEdgeRing(r,this),r=this.getNext(r)}while(r!==this._startDe)},ly.prototype.getLinearRing=function(){return this._ring},ly.prototype.getCoordinate=function(i){return this._pts.get(i)},ly.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var i=this._startDe;do{var r=i.getNode().getEdges().getOutgoingDegree(this);r>this._maxNodeDegree&&(this._maxNodeDegree=r),i=this.getNext(i)}while(i!==this._startDe)this._maxNodeDegree*=2},ly.prototype.addPoints=function(i,r,n){var o=i.getCoordinates();if(r){var s=1;n&&(s=0);for(var a=s;a<o.length;a++)this._pts.add(o[a])}else{var l=o.length-2;n&&(l=o.length-1);for(var u=l;u>=0;u--)this._pts.add(o[u])}},ly.prototype.isHole=function(){return this._isHole},ly.prototype.setInResult=function(){var i=this._startDe;do i.getEdge().setInResult(!0),i=i.getNext();while(i!==this._startDe)},ly.prototype.containsPoint=function(i){var r=this.getLinearRing();if(!r.getEnvelopeInternal().contains(i)||!sX.isPointInRing(i,r.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(i))return!1;return!0},ly.prototype.addHole=function(i){this._holes.add(i)},ly.prototype.isShell=function(){return null===this._shell},ly.prototype.getLabel=function(){return this._label},ly.prototype.getEdges=function(){return this._edges},ly.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},ly.prototype.getShell=function(){return this._shell},ly.prototype.mergeLabel=function(){if(1==arguments.length){var i=arguments[0];this.mergeLabel(i,0),this.mergeLabel(i,1)}else if(2==arguments.length){var r=arguments[0],n=arguments[1],o=r.getLocation(n,la.RIGHT);if(o===sf.NONE)return null;if(this._label.getLocation(n)===sf.NONE)return this._label.setLocation(n,o),null}},ly.prototype.setShell=function(i){this._shell=i,null!==i&&i.addHole(this)},ly.prototype.toPolygon=function(i){for(var r=Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)r[n]=this._holes.get(n).getLinearRing();return i.createPolygon(this.getLinearRing(),r)},ly.prototype.interfaces_=function(){return[]},ly.prototype.getClass=function(){return ly};var l_=function(i){function r(){var r=arguments[0],n=arguments[1];i.call(this,r,n)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.setEdgeRing=function(i,r){i.setMinEdgeRing(r)},r.prototype.getNext=function(i){return i.getNextMin()},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(ly),lv=function(i){function r(){var r=arguments[0],n=arguments[1];i.call(this,r,n)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.buildMinimalRings=function(){var i=new at,r=this._startDe;do{if(null===r.getMinEdgeRing()){var n=new l_(r,this._geometryFactory);i.add(n)}r=r.getNext()}while(r!==this._startDe)return i},r.prototype.setEdgeRing=function(i,r){i.setEdgeRing(r)},r.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var i=this._startDe;do i.getNode().getEdges().linkMinimalDirectedEdges(this),i=i.getNext();while(i!==this._startDe)},r.prototype.getNext=function(i){return i.getNext()},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(ly),lx=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0==arguments.length);else if(1==arguments.length){var i=arguments[0];this._label=i}};lx.prototype.setVisited=function(i){this._isVisited=i},lx.prototype.setInResult=function(i){this._isInResult=i},lx.prototype.isCovered=function(){return this._isCovered},lx.prototype.isCoveredSet=function(){return this._isCoveredSet},lx.prototype.setLabel=function(i){this._label=i},lx.prototype.getLabel=function(){return this._label},lx.prototype.setCovered=function(i){this._isCovered=i,this._isCoveredSet=!0},lx.prototype.updateIM=function(i){sU.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(i)},lx.prototype.isInResult=function(){return this._isInResult},lx.prototype.isVisited=function(){return this._isVisited},lx.prototype.interfaces_=function(){return[]},lx.prototype.getClass=function(){return lx};var lb=function(i){function r(){i.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new lg(0,sf.NONE)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.isIncidentEdgeInResult=function(){for(var i=this.getEdges().getEdges().iterator();i.hasNext();)if(i.next().getEdge().isInResult())return!0;return!1},r.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},r.prototype.getCoordinate=function(){return this._coord},r.prototype.print=function(i){i.println("node "+this._coord+" lbl: "+this._label)},r.prototype.computeIM=function(i){},r.prototype.computeMergedLocation=function(i,r){var n=sf.NONE;if(n=this._label.getLocation(r),!i.isNull(r)){var o=i.getLocation(r);n!==sf.BOUNDARY&&(n=o)}return n},r.prototype.setLabel=function(){if(2!=arguments.length)return i.prototype.setLabel.apply(this,arguments);var r=arguments[0],n=arguments[1];null===this._label?this._label=new lg(r,n):this._label.setLocation(r,n)},r.prototype.getEdges=function(){return this._edges},r.prototype.mergeLabel=function(){if(arguments[0]instanceof r){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof lg)for(var n=arguments[0],o=0;o<2;o++){var s=this.computeMergedLocation(n,o);this._label.getLocation(o)===sf.NONE&&this._label.setLocation(o,s)}},r.prototype.add=function(i){this._edges.insert(i),i.setNode(this)},r.prototype.setLabelBoundary=function(i){if(null===this._label)return null;var r=sf.NONE;null!==this._label&&(r=this._label.getLocation(i));var n=null;switch(r){case sf.BOUNDARY:n=sf.INTERIOR;break;case sf.INTERIOR:default:n=sf.BOUNDARY}this._label.setLocation(i,n)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(lx),lw=function(){this.nodeMap=new a_,this.nodeFact=null;var i=arguments[0];this.nodeFact=i};lw.prototype.find=function(i){return this.nodeMap.get(i)},lw.prototype.addNode=function(){if(arguments[0]instanceof su){var i=arguments[0],r=this.nodeMap.get(i);return null===r&&(r=this.nodeFact.createNode(i),this.nodeMap.put(i,r)),r}if(arguments[0]instanceof lb){var n=arguments[0],o=this.nodeMap.get(n.getCoordinate());return null===o?(this.nodeMap.put(n.getCoordinate(),n),n):(o.mergeLabel(n),o)}},lw.prototype.print=function(i){for(var r=this.iterator();r.hasNext();)r.next().print(i)},lw.prototype.iterator=function(){return this.nodeMap.values().iterator()},lw.prototype.values=function(){return this.nodeMap.values()},lw.prototype.getBoundaryNodes=function(i){for(var r=new at,n=this.iterator();n.hasNext();){var o=n.next();o.getLabel().getLocation(i)===sf.BOUNDARY&&r.add(o)}return r},lw.prototype.add=function(i){var r=i.getCoordinate();this.addNode(r).add(i)},lw.prototype.interfaces_=function(){return[]},lw.prototype.getClass=function(){return lw};var lE=function(){},lI={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};lE.prototype.interfaces_=function(){return[]},lE.prototype.getClass=function(){return lE},lE.isNorthern=function(i){return i===lE.NE||i===lE.NW},lE.isOpposite=function(i,r){return i!==r&&2==(i-r+4)%4},lE.commonHalfPlane=function(i,r){if(i===r)return i;if(2==(i-r+4)%4)return -1;var n=i<r?i:r;return 0===n&&3===(i>r?i:r)?3:n},lE.isInHalfPlane=function(i,r){return r===lE.SE?i===lE.SE||i===lE.SW:i===r||i===r+1},lE.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];if(0===i&&0===r)throw new si("Cannot compute the quadrant for point ( "+i+", "+r+" )");return i>=0?r>=0?lE.NE:lE.SE:r>=0?lE.NW:lE.SW}if(arguments[0]instanceof su&&arguments[1]instanceof su){var n=arguments[0],o=arguments[1];if(o.x===n.x&&o.y===n.y)throw new si("Cannot compute the quadrant for two identical points "+n);return o.x>=n.x?o.y>=n.y?lE.NE:lE.SE:o.y>=n.y?lE.NW:lE.SW}},lI.NE.get=function(){return 0},lI.NW.get=function(){return 1},lI.SW.get=function(){return 2},lI.SE.get=function(){return 3},Object.defineProperties(lE,lI);var lS=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1==arguments.length){var i=arguments[0];this._edge=i}else if(3==arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._edge=r,this.init(n,o),this._label=null}else if(4==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3];this._edge=s,this.init(a,l),this._label=u}};lS.prototype.compareDirection=function(i){return this._dx===i._dx&&this._dy===i._dy?0:this._quadrant>i._quadrant?1:this._quadrant<i._quadrant?-1:sX.computeOrientation(i._p0,i._p1,this._p1)},lS.prototype.getDy=function(){return this._dy},lS.prototype.getCoordinate=function(){return this._p0},lS.prototype.setNode=function(i){this._node=i},lS.prototype.print=function(i){var r=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),o=n.lastIndexOf("."),s=n.substring(o+1);i.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label)},lS.prototype.compareTo=function(i){return this.compareDirection(i)},lS.prototype.getDirectedCoordinate=function(){return this._p1},lS.prototype.getDx=function(){return this._dx},lS.prototype.getLabel=function(){return this._label},lS.prototype.getEdge=function(){return this._edge},lS.prototype.getQuadrant=function(){return this._quadrant},lS.prototype.getNode=function(){return this._node},lS.prototype.toString=function(){var i=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf(".");return"  "+r.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label},lS.prototype.computeLabel=function(i){},lS.prototype.init=function(i,r){this._p0=i,this._p1=r,this._dx=r.x-i.x,this._dy=r.y-i.y,this._quadrant=lE.quadrant(this._dx,this._dy),sU.isTrue(0!==this._dx||0!==this._dy,"EdgeEnd with identical endpoints found")},lS.prototype.interfaces_=function(){return[so]},lS.prototype.getClass=function(){return lS};var lM=function(i){function r(){var r=arguments[0],n=arguments[1];if(i.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var o=r.getNumPoints()-1;this.init(r.getCoordinate(o),r.getCoordinate(o-1))}this.computeDirectedLabel()}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getNextMin=function(){return this._nextMin},r.prototype.getDepth=function(i){return this._depth[i]},r.prototype.setVisited=function(i){this._isVisited=i},r.prototype.computeDirectedLabel=function(){this._label=new lg(this._edge.getLabel()),this._isForward||this._label.flip()},r.prototype.getNext=function(){return this._next},r.prototype.setDepth=function(i,r){if(-999!==this._depth[i]&&this._depth[i]!==r)throw new lp("assigned depths do not match",this.getCoordinate());this._depth[i]=r},r.prototype.isInteriorAreaEdge=function(){for(var i=!0,r=0;r<2;r++)this._label.isArea(r)&&this._label.getLocation(r,la.LEFT)===sf.INTERIOR&&this._label.getLocation(r,la.RIGHT)===sf.INTERIOR||(i=!1);return i},r.prototype.setNextMin=function(i){this._nextMin=i},r.prototype.print=function(r){i.prototype.print.call(this,r),r.print(" "+this._depth[la.LEFT]+"/"+this._depth[la.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},r.prototype.setMinEdgeRing=function(i){this._minEdgeRing=i},r.prototype.isLineEdge=function(){var i=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,sf.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,sf.EXTERIOR);return i&&r&&n},r.prototype.setEdgeRing=function(i){this._edgeRing=i},r.prototype.getMinEdgeRing=function(){return this._minEdgeRing},r.prototype.getDepthDelta=function(){var i=this._edge.getDepthDelta();return this._isForward||(i=-i),i},r.prototype.setInResult=function(i){this._isInResult=i},r.prototype.getSym=function(){return this._sym},r.prototype.isForward=function(){return this._isForward},r.prototype.getEdge=function(){return this._edge},r.prototype.printEdge=function(i){this.print(i),i.print(" "),this._isForward?this._edge.print(i):this._edge.printReverse(i)},r.prototype.setSym=function(i){this._sym=i},r.prototype.setVisitedEdge=function(i){this.setVisited(i),this._sym.setVisited(i)},r.prototype.setEdgeDepths=function(i,r){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var o=1;i===la.LEFT&&(o=-1);var s=la.opposite(i),a=r+n*o;this.setDepth(i,r),this.setDepth(s,a)},r.prototype.getEdgeRing=function(){return this._edgeRing},r.prototype.isInResult=function(){return this._isInResult},r.prototype.setNext=function(i){this._next=i},r.prototype.isVisited=function(){return this._isVisited},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.depthFactor=function(i,r){return i===sf.EXTERIOR&&r===sf.INTERIOR?1:i===sf.INTERIOR&&r===sf.EXTERIOR?-1:0},r}(lS),lT=function(){};lT.prototype.createNode=function(i){return new lb(i,null)},lT.prototype.interfaces_=function(){return[]},lT.prototype.getClass=function(){return lT};var lC=function(){if(this._edges=new at,this._nodes=null,this._edgeEndList=new at,0==arguments.length)this._nodes=new lw(new lT);else if(1==arguments.length){var i=arguments[0];this._nodes=new lw(i)}};lC.prototype.printEdges=function(i){i.println("Edges:");for(var r=0;r<this._edges.size();r++){i.println("edge "+r+":");var n=this._edges.get(r);n.print(i),n.eiList.print(i)}},lC.prototype.find=function(i){return this._nodes.find(i)},lC.prototype.addNode=function(){if(arguments[0]instanceof lb){var i=arguments[0];return this._nodes.addNode(i)}if(arguments[0]instanceof su){var r=arguments[0];return this._nodes.addNode(r)}},lC.prototype.getNodeIterator=function(){return this._nodes.iterator()},lC.prototype.linkResultDirectedEdges=function(){for(var i=this._nodes.iterator();i.hasNext();)i.next().getEdges().linkResultDirectedEdges()},lC.prototype.debugPrintln=function(i){sP.out.println(i)},lC.prototype.isBoundaryNode=function(i,r){var n=this._nodes.find(r);if(null===n)return!1;var o=n.getLabel();return null!==o&&o.getLocation(i)===sf.BOUNDARY},lC.prototype.linkAllDirectedEdges=function(){for(var i=this._nodes.iterator();i.hasNext();)i.next().getEdges().linkAllDirectedEdges()},lC.prototype.matchInSameDirection=function(i,r,n,o){return!!i.equals(n)&&sX.computeOrientation(i,r,o)===sX.COLLINEAR&&lE.quadrant(i,r)===lE.quadrant(n,o)},lC.prototype.getEdgeEnds=function(){return this._edgeEndList},lC.prototype.debugPrint=function(i){sP.out.print(i)},lC.prototype.getEdgeIterator=function(){return this._edges.iterator()},lC.prototype.findEdgeInSameDirection=function(i,r){for(var n=0;n<this._edges.size();n++){var o=this._edges.get(n),s=o.getCoordinates();if(this.matchInSameDirection(i,r,s[0],s[1])||this.matchInSameDirection(i,r,s[s.length-1],s[s.length-2]))return o}return null},lC.prototype.insertEdge=function(i){this._edges.add(i)},lC.prototype.findEdgeEnd=function(i){for(var r=this.getEdgeEnds().iterator();r.hasNext();){var n=r.next();if(n.getEdge()===i)return n}return null},lC.prototype.addEdges=function(i){for(var r=i.iterator();r.hasNext();){var n=r.next();this._edges.add(n);var o=new lM(n,!0),s=new lM(n,!1);o.setSym(s),s.setSym(o),this.add(o),this.add(s)}},lC.prototype.add=function(i){this._nodes.add(i),this._edgeEndList.add(i)},lC.prototype.getNodes=function(){return this._nodes.values()},lC.prototype.findEdge=function(i,r){for(var n=0;n<this._edges.size();n++){var o=this._edges.get(n),s=o.getCoordinates();if(i.equals(s[0])&&r.equals(s[1]))return o}return null},lC.prototype.interfaces_=function(){return[]},lC.prototype.getClass=function(){return lC},lC.linkResultDirectedEdges=function(i){for(var r=i.iterator();r.hasNext();)r.next().getEdges().linkResultDirectedEdges()};var lP=function(){this._geometryFactory=null,this._shellList=new at;var i=arguments[0];this._geometryFactory=i};lP.prototype.sortShellsAndHoles=function(i,r,n){for(var o=i.iterator();o.hasNext();){var s=o.next();s.isHole()?n.add(s):r.add(s)}},lP.prototype.computePolygons=function(i){for(var r=new at,n=i.iterator();n.hasNext();){var o=n.next().toPolygon(this._geometryFactory);r.add(o)}return r},lP.prototype.placeFreeHoles=function(i,r){for(var n=r.iterator();n.hasNext();){var o=n.next();if(null===o.getShell()){var s=this.findEdgeRingContaining(o,i);if(null===s)throw new lp("unable to assign hole to a shell",o.getCoordinate(0));o.setShell(s)}}},lP.prototype.buildMinimalEdgeRings=function(i,r,n){for(var o=new at,s=i.iterator();s.hasNext();){var a=s.next();if(a.getMaxNodeDegree()>2){a.linkDirectedEdgesForMinimalEdgeRings();var l=a.buildMinimalRings(),u=this.findShell(l);null!==u?(this.placePolygonHoles(u,l),r.add(u)):n.addAll(l)}else o.add(a)}return o},lP.prototype.containsPoint=function(i){for(var r=this._shellList.iterator();r.hasNext();)if(r.next().containsPoint(i))return!0;return!1},lP.prototype.buildMaximalEdgeRings=function(i){for(var r=new at,n=i.iterator();n.hasNext();){var o=n.next();if(o.isInResult()&&o.getLabel().isArea()&&null===o.getEdgeRing()){var s=new lv(o,this._geometryFactory);r.add(s),s.setInResult()}}return r},lP.prototype.placePolygonHoles=function(i,r){for(var n=r.iterator();n.hasNext();){var o=n.next();o.isHole()&&o.setShell(i)}},lP.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},lP.prototype.findEdgeRingContaining=function(i,r){for(var n=i.getLinearRing(),o=n.getEnvelopeInternal(),s=n.getCoordinateN(0),a=null,l=null,u=r.iterator();u.hasNext();){var h=u.next(),c=h.getLinearRing(),p=c.getEnvelopeInternal();null!==a&&(l=a.getLinearRing().getEnvelopeInternal());var f=!1;p.contains(o)&&sX.isPointInRing(s,c.getCoordinates())&&(f=!0),f&&(null===a||l.contains(p))&&(a=h)}return a},lP.prototype.findShell=function(i){for(var r=0,n=null,o=i.iterator();o.hasNext();){var s=o.next();s.isHole()||(n=s,r++)}return sU.isTrue(r<=1,"found two shells in MinimalEdgeRing list"),n},lP.prototype.add=function(){if(1==arguments.length){var i=arguments[0];this.add(i.getEdgeEnds(),i.getNodes())}else if(2==arguments.length){var r=arguments[0],n=arguments[1];lC.linkResultDirectedEdges(n);var o=this.buildMaximalEdgeRings(r),s=new at,a=this.buildMinimalEdgeRings(o,this._shellList,s);this.sortShellsAndHoles(a,this._shellList,s),this.placeFreeHoles(this._shellList,s)}},lP.prototype.interfaces_=function(){return[]},lP.prototype.getClass=function(){return lP};var lA=function(){};lA.prototype.getBounds=function(){},lA.prototype.interfaces_=function(){return[]},lA.prototype.getClass=function(){return lA};var lL=function(){this._bounds=null,this._item=null;var i=arguments[0],r=arguments[1];this._bounds=i,this._item=r};lL.prototype.getItem=function(){return this._item},lL.prototype.getBounds=function(){return this._bounds},lL.prototype.interfaces_=function(){return[lA,sl]},lL.prototype.getClass=function(){return lL};var lk=function(){this._size=null,this._items=null,this._size=0,this._items=new at,this._items.add(null)};lk.prototype.poll=function(){if(this.isEmpty())return null;var i=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),i},lk.prototype.size=function(){return this._size},lk.prototype.reorder=function(i){for(var r=null,n=this._items.get(i);2*i<=this._size&&((r=2*i)!==this._size&&0>this._items.get(r+1).compareTo(this._items.get(r))&&r++,0>this._items.get(r).compareTo(n));i=r)this._items.set(i,this._items.get(r));this._items.set(i,n)},lk.prototype.clear=function(){this._size=0,this._items.clear()},lk.prototype.isEmpty=function(){return 0===this._size},lk.prototype.add=function(i){this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,i);0>i.compareTo(this._items.get(Math.trunc(r/2)));r/=2)this._items.set(r,this._items.get(Math.trunc(r/2)));this._items.set(r,i)},lk.prototype.interfaces_=function(){return[]},lk.prototype.getClass=function(){return lk};var lR=function(){};lR.prototype.visitItem=function(i){},lR.prototype.interfaces_=function(){return[]},lR.prototype.getClass=function(){return lR};var lD=function(){};lD.prototype.insert=function(i,r){},lD.prototype.remove=function(i,r){},lD.prototype.query=function(){},lD.prototype.interfaces_=function(){return[]},lD.prototype.getClass=function(){return lD};var lN=function(){if(this._childBoundables=new at,this._bounds=null,this._level=null,0==arguments.length);else if(1==arguments.length){var i=arguments[0];this._level=i}},lO={serialVersionUID:{configurable:!0}};lN.prototype.getLevel=function(){return this._level},lN.prototype.size=function(){return this._childBoundables.size()},lN.prototype.getChildBoundables=function(){return this._childBoundables},lN.prototype.addChildBoundable=function(i){sU.isTrue(null===this._bounds),this._childBoundables.add(i)},lN.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},lN.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},lN.prototype.interfaces_=function(){return[lA,sl]},lN.prototype.getClass=function(){return lN},lO.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(lN,lO);var lz=function(){};lz.reverseOrder=function(){return{compare:function(i,r){return r.compareTo(i)}}},lz.min=function(i){return lz.sort(i),i.get(0)},lz.sort=function(i,r){var n=i.toArray();r?aE.sort(n,r):aE.sort(n);for(var o=i.iterator(),s=0,a=n.length;s<a;s++)o.next(),o.set(n[s])},lz.singletonList=function(i){var r=new at;return r.add(i),r};var lF=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var i=arguments[0],r=arguments[1],n=arguments[2];this._boundable1=i,this._boundable2=r,this._itemDistance=n,this._distance=this.distance()};lF.prototype.expandToQueue=function(i,r){var n=lF.isComposite(this._boundable1),o=lF.isComposite(this._boundable2);if(n&&o)return lF.area(this._boundable1)>lF.area(this._boundable2)?this.expand(this._boundable1,this._boundable2,i,r):this.expand(this._boundable2,this._boundable1,i,r),null;if(n)return this.expand(this._boundable1,this._boundable2,i,r),null;if(o)return this.expand(this._boundable2,this._boundable1,i,r),null;throw new si("neither boundable is composite")},lF.prototype.isLeaves=function(){return!(lF.isComposite(this._boundable1)||lF.isComposite(this._boundable2))},lF.prototype.compareTo=function(i){return this._distance<i._distance?-1:+(this._distance>i._distance)},lF.prototype.expand=function(i,r,n,o){for(var s=i.getChildBoundables().iterator();s.hasNext();){var a=new lF(s.next(),r,this._itemDistance);a.getDistance()<o&&n.add(a)}},lF.prototype.getBoundable=function(i){return 0===i?this._boundable1:this._boundable2},lF.prototype.getDistance=function(){return this._distance},lF.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},lF.prototype.interfaces_=function(){return[so]},lF.prototype.getClass=function(){return lF},lF.area=function(i){return i.getBounds().getArea()},lF.isComposite=function(i){return i instanceof lN};var lB=function i(){if(this._root=null,this._built=!1,this._itemBoundables=new at,this._nodeCapacity=null,0==arguments.length){var r=i.DEFAULT_NODE_CAPACITY;this._nodeCapacity=r}else if(1==arguments.length){var n=arguments[0];sU.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},lU={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};lB.prototype.getNodeCapacity=function(){return this._nodeCapacity},lB.prototype.lastNode=function(i){return i.get(i.size()-1)},lB.prototype.size=function(){if(0==arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1==arguments.length){for(var i=arguments[0],r=0,n=i.getChildBoundables().iterator();n.hasNext();){var o=n.next();o instanceof lN?r+=this.size(o):o instanceof lL&&(r+=1)}return r}},lB.prototype.removeItem=function(i,r){for(var n=null,o=i.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof lL&&s.getItem()===r&&(n=s)}return null!==n&&(i.getChildBoundables().remove(n),!0)},lB.prototype.itemsTree=function(){if(0==arguments.length){this.build();var i=this.itemsTree(this._root);return null===i?new at:i}if(1==arguments.length){for(var r=arguments[0],n=new at,o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();if(s instanceof lN){var a=this.itemsTree(s);null!==a&&n.add(a)}else s instanceof lL?n.add(s.getItem()):sU.shouldNeverReachHere()}return 0>=n.size()?null:n}},lB.prototype.insert=function(i,r){sU.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new lL(i,r))},lB.prototype.boundablesAtLevel=function(){if(1==arguments.length){var i=arguments[0],r=new at;return this.boundablesAtLevel(i,this._root,r),r}if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];if(sU.isTrue(n>-2),o.getLevel()===n)return s.add(o),null;for(var a=o.getChildBoundables().iterator();a.hasNext();){var l=a.next();l instanceof lN?this.boundablesAtLevel(n,l,s):(sU.isTrue(l instanceof lL),-1===n&&s.add(l))}return null}},lB.prototype.query=function(){if(1==arguments.length){var i=arguments[0];this.build();var r=new at;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r),r}if(2==arguments.length){var n=arguments[0],o=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,o)}else if(3==arguments.length){if(sm(arguments[2],lR)&&arguments[0]instanceof Object&&arguments[1]instanceof lN)for(var s=arguments[0],a=arguments[1],l=arguments[2],u=a.getChildBoundables(),h=0;h<u.size();h++){var c=u.get(h);this.getIntersectsOp().intersects(c.getBounds(),s)&&(c instanceof lN?this.query(s,c,l):c instanceof lL?l.visitItem(c.getItem()):sU.shouldNeverReachHere())}else if(sm(arguments[2],s9)&&arguments[0]instanceof Object&&arguments[1]instanceof lN)for(var p=arguments[0],f=arguments[1],d=arguments[2],m=f.getChildBoundables(),g=0;g<m.size();g++){var y=m.get(g);this.getIntersectsOp().intersects(y.getBounds(),p)&&(y instanceof lN?this.query(p,y,d):y instanceof lL?d.add(y.getItem()):sU.shouldNeverReachHere())}}},lB.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},lB.prototype.getRoot=function(){return this.build(),this._root},lB.prototype.remove=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.remove(i,this._root,r)}if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=this.removeItem(o,s);if(a)return!0;for(var l=null,u=o.getChildBoundables().iterator();u.hasNext();){var h=u.next();if(this.getIntersectsOp().intersects(h.getBounds(),n)&&h instanceof lN&&(a=this.remove(n,h,s))){l=h;break}}return null!==l&&l.getChildBoundables().isEmpty()&&o.getChildBoundables().remove(l),a}},lB.prototype.createHigherLevels=function(i,r){sU.isTrue(!i.isEmpty());var n=this.createParentBoundables(i,r+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,r+1)},lB.prototype.depth=function(){if(0==arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1==arguments.length){for(var i=arguments[0],r=0,n=i.getChildBoundables().iterator();n.hasNext();){var o=n.next();if(o instanceof lN){var s=this.depth(o);s>r&&(r=s)}}return r+1}},lB.prototype.createParentBoundables=function(i,r){sU.isTrue(!i.isEmpty());var n=new at;n.add(this.createNode(r));var o=new at(i);lz.sort(o,this.getComparator());for(var s=o.iterator();s.hasNext();){var a=s.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(r)),this.lastNode(n).addChildBoundable(a)}return n},lB.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},lB.prototype.interfaces_=function(){return[sl]},lB.prototype.getClass=function(){return lB},lB.compareDoubles=function(i,r){return i>r?1:i<r?-1:0},lU.IntersectsOp.get=function(){return lG},lU.serialVersionUID.get=function(){return -0x35ef64c82d4c5400},lU.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(lB,lU);var lG=function(){},lV=function(){};lV.prototype.distance=function(i,r){},lV.prototype.interfaces_=function(){return[]},lV.prototype.getClass=function(){return lV};var lq=function(i){function r(n){n=n||r.DEFAULT_NODE_CAPACITY,i.call(this,n)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return r.prototype.createParentBoundablesFromVerticalSlices=function(i,r){sU.isTrue(i.length>0);for(var n=new at,o=0;o<i.length;o++)n.addAll(this.createParentBoundablesFromVerticalSlice(i[o],r));return n},r.prototype.createNode=function(i){return new lj(i)},r.prototype.size=function(){return 0==arguments.length?i.prototype.size.call(this):i.prototype.size.apply(this,arguments)},r.prototype.insert=function(){if(2!=arguments.length)return i.prototype.insert.apply(this,arguments);var r=arguments[0],n=arguments[1];if(r.isNull())return null;i.prototype.insert.call(this,r,n)},r.prototype.getIntersectsOp=function(){return r.intersectsOp},r.prototype.verticalSlices=function(i,r){for(var n=Math.trunc(Math.ceil(i.size()/r)),o=Array(r).fill(null),s=i.iterator(),a=0;a<r;a++){o[a]=new at;for(var l=0;s.hasNext()&&l<n;){var u=s.next();o[a].add(u),l++}}return o},r.prototype.query=function(){if(1==arguments.length){var r=arguments[0];return i.prototype.query.call(this,r)}if(2==arguments.length){var n=arguments[0],o=arguments[1];i.prototype.query.call(this,n,o)}else if(3==arguments.length){if(sm(arguments[2],lR)&&arguments[0]instanceof Object&&arguments[1]instanceof lN){var s=arguments[0],a=arguments[1],l=arguments[2];i.prototype.query.call(this,s,a,l)}else if(sm(arguments[2],s9)&&arguments[0]instanceof Object&&arguments[1]instanceof lN){var u=arguments[0],h=arguments[1],c=arguments[2];i.prototype.query.call(this,u,h,c)}}},r.prototype.getComparator=function(){return r.yComparator},r.prototype.createParentBoundablesFromVerticalSlice=function(r,n){return i.prototype.createParentBoundables.call(this,r,n)},r.prototype.remove=function(){if(2==arguments.length){var r=arguments[0],n=arguments[1];return i.prototype.remove.call(this,r,n)}return i.prototype.remove.apply(this,arguments)},r.prototype.depth=function(){return 0==arguments.length?i.prototype.depth.call(this):i.prototype.depth.apply(this,arguments)},r.prototype.createParentBoundables=function(i,n){sU.isTrue(!i.isEmpty());var o=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),s=new at(i);lz.sort(s,r.xComparator);var a=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(o))));return this.createParentBoundablesFromVerticalSlices(a,n)},r.prototype.nearestNeighbour=function(){if(1==arguments.length){if(sm(arguments[0],lV)){var i=arguments[0],n=new lF(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(n)}if(arguments[0]instanceof lF){var o=arguments[0];return this.nearestNeighbour(o,sr.POSITIVE_INFINITY)}}else if(2==arguments.length){if(arguments[0]instanceof r&&sm(arguments[1],lV)){var s=arguments[0],a=arguments[1],l=new lF(this.getRoot(),s.getRoot(),a);return this.nearestNeighbour(l)}if(arguments[0]instanceof lF&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1],c=h,p=null,f=new lk;for(f.add(u);!f.isEmpty()&&c>0;){var d=f.poll(),m=d.getDistance();if(m>=c)break;d.isLeaves()?(c=m,p=d):d.expandToQueue(f,c)}return[p.getBoundable(0).getItem(),p.getBoundable(1).getItem()]}}else if(3==arguments.length){var g=arguments[0],y=arguments[1],_=arguments[2],v=new lL(g,y),x=new lF(this.getRoot(),v,_);return this.nearestNeighbour(x)[0]}},r.prototype.interfaces_=function(){return[lD,sl]},r.prototype.getClass=function(){return r},r.centreX=function(i){return r.avg(i.getMinX(),i.getMaxX())},r.avg=function(i,r){return(i+r)/2},r.centreY=function(i){return r.avg(i.getMinY(),i.getMaxY())},n.STRtreeNode.get=function(){return lj},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[sa]},compare:function(n,o){return i.compareDoubles(r.centreX(n.getBounds()),r.centreX(o.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[sa]},compare:function(n,o){return i.compareDoubles(r.centreY(n.getBounds()),r.centreY(o.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[i.IntersectsOp]},intersects:function(i,r){return i.intersects(r)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(r,n),r}(lB),lj=function(i){function r(){var r=arguments[0];i.call(this,r)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.computeBounds=function(){for(var i=null,r=this.getChildBoundables().iterator();r.hasNext();){var n=r.next();null===i?i=new sL(n.getBounds()):i.expandToInclude(n.getBounds())}return i},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(lN),lZ=function(){};lZ.prototype.interfaces_=function(){return[]},lZ.prototype.getClass=function(){return lZ},lZ.relativeSign=function(i,r){return i<r?-1:+(i>r)},lZ.compare=function(i,r,n){if(r.equals2D(n))return 0;var o=lZ.relativeSign(r.x,n.x),s=lZ.relativeSign(r.y,n.y);switch(i){case 0:return lZ.compareValue(o,s);case 1:return lZ.compareValue(s,o);case 2:return lZ.compareValue(s,-o);case 3:return lZ.compareValue(-o,s);case 4:return lZ.compareValue(-o,-s);case 5:return lZ.compareValue(-s,-o);case 6:return lZ.compareValue(-s,o);case 7:return lZ.compareValue(o,-s)}return sU.shouldNeverReachHere("invalid octant value"),0},lZ.compareValue=function(i,r){return i<0?-1:i>0?1:r<0?-1:+(r>0)};var lX=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this._segString=i,this.coord=new su(r),this.segmentIndex=n,this._segmentOctant=o,this._isInterior=!r.equals2D(i.getCoordinate(n))};lX.prototype.getCoordinate=function(){return this.coord},lX.prototype.print=function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex)},lX.prototype.compareTo=function(i){return this.segmentIndex<i.segmentIndex?-1:this.segmentIndex>i.segmentIndex?1:this.coord.equals2D(i.coord)?0:lZ.compare(this._segmentOctant,this.coord,i.coord)},lX.prototype.isEndPoint=function(i){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===i},lX.prototype.isInterior=function(){return this._isInterior},lX.prototype.interfaces_=function(){return[so]},lX.prototype.getClass=function(){return lX};var l$=function(){this._nodeMap=new a_,this._edge=null;var i=arguments[0];this._edge=i};l$.prototype.getSplitCoordinates=function(){var i=new ai;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var o=r.next();this.addEdgeCoordinates(n,o,i),n=o}return i.toCoordinateArray()},l$.prototype.addCollapsedNodes=function(){var i=new at;this.findCollapsesFromInsertedNodes(i),this.findCollapsesFromExistingVertices(i);for(var r=i.iterator();r.hasNext();){var n=r.next().intValue();this.add(this._edge.getCoordinate(n),n)}},l$.prototype.print=function(i){i.println("Intersections:");for(var r=this.iterator();r.hasNext();)r.next().print(i)},l$.prototype.findCollapsesFromExistingVertices=function(i){for(var r=0;r<this._edge.size()-2;r++){var n=this._edge.getCoordinate(r),o=this._edge.getCoordinate(r+2);n.equals2D(o)&&i.add(new sv(r+1))}},l$.prototype.addEdgeCoordinates=function(i,r,n){var o=this._edge.getCoordinate(r.segmentIndex),s=r.isInterior()||!r.coord.equals2D(o);n.add(new su(i.coord),!1);for(var a=i.segmentIndex+1;a<=r.segmentIndex;a++)n.add(this._edge.getCoordinate(a));s&&n.add(new su(r.coord))},l$.prototype.iterator=function(){return this._nodeMap.values().iterator()},l$.prototype.addSplitEdges=function(i){this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),n=r.next();r.hasNext();){var o=r.next(),s=this.createSplitEdge(n,o);i.add(s),n=o}},l$.prototype.findCollapseIndex=function(i,r,n){if(!i.coord.equals2D(r.coord))return!1;var o=r.segmentIndex-i.segmentIndex;return r.isInterior()||o--,1===o&&(n[0]=i.segmentIndex+1,!0)},l$.prototype.findCollapsesFromInsertedNodes=function(i){for(var r=[,].fill(null),n=this.iterator(),o=n.next();n.hasNext();){var s=n.next();this.findCollapseIndex(o,s,r)&&i.add(new sv(r[0])),o=s}},l$.prototype.getEdge=function(){return this._edge},l$.prototype.addEndpoints=function(){var i=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(i),i)},l$.prototype.createSplitEdge=function(i,r){var n=r.segmentIndex-i.segmentIndex+2,o=this._edge.getCoordinate(r.segmentIndex),s=r.isInterior()||!r.coord.equals2D(o);s||n--;var a=Array(n).fill(null),l=0;a[l++]=new su(i.coord);for(var u=i.segmentIndex+1;u<=r.segmentIndex;u++)a[l++]=this._edge.getCoordinate(u);return s&&(a[l]=new su(r.coord)),new lK(a,this._edge.getData())},l$.prototype.add=function(i,r){var n=new lX(this._edge,i,r,this._edge.getSegmentOctant(r)),o=this._nodeMap.get(n);return null!==o?(sU.isTrue(o.coord.equals2D(i),"Found equal nodes with different coordinates"),o):(this._nodeMap.put(n,n),n)},l$.prototype.checkSplitEdgesCorrectness=function(i){var r=this._edge.getCoordinates(),n=i.get(0).getCoordinate(0);if(!n.equals2D(r[0]))throw new sF("bad split edge start point at "+n);var o=i.get(i.size()-1).getCoordinates(),s=o[o.length-1];if(!s.equals2D(r[r.length-1]))throw new sF("bad split edge end point at "+s)},l$.prototype.interfaces_=function(){return[]},l$.prototype.getClass=function(){return l$};var lW=function(){};lW.prototype.interfaces_=function(){return[]},lW.prototype.getClass=function(){return lW},lW.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];if(0===i&&0===r)throw new si("Cannot compute the octant for point ( "+i+", "+r+" )");var n=Math.abs(i),o=Math.abs(r);return i>=0?r>=0?n>=o?0:1:n>=o?7:6:r>=0?n>=o?3:2:n>=o?4:5}if(arguments[0]instanceof su&&arguments[1]instanceof su){var s=arguments[0],a=arguments[1],l=a.x-s.x,u=a.y-s.y;if(0===l&&0===u)throw new si("Cannot compute the octant for two identical points "+s);return lW.octant(l,u)}};var lH=function(){};lH.prototype.getCoordinates=function(){},lH.prototype.size=function(){},lH.prototype.getCoordinate=function(i){},lH.prototype.isClosed=function(){},lH.prototype.setData=function(i){},lH.prototype.getData=function(){},lH.prototype.interfaces_=function(){return[]},lH.prototype.getClass=function(){return lH};var lY=function(){};lY.prototype.addIntersection=function(i,r){},lY.prototype.interfaces_=function(){return[lH]},lY.prototype.getClass=function(){return lY};var lK=function(){this._nodeList=new l$(this),this._pts=null,this._data=null;var i=arguments[0],r=arguments[1];this._pts=i,this._data=r};lK.prototype.getCoordinates=function(){return this._pts},lK.prototype.size=function(){return this._pts.length},lK.prototype.getCoordinate=function(i){return this._pts[i]},lK.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},lK.prototype.getSegmentOctant=function(i){return i===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(i),this.getCoordinate(i+1))},lK.prototype.setData=function(i){this._data=i},lK.prototype.safeOctant=function(i,r){return i.equals2D(r)?0:lW.octant(i,r)},lK.prototype.getData=function(){return this._data},lK.prototype.addIntersection=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];this.addIntersectionNode(i,r)}else if(4==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[3],a=new su(n.getIntersection(s));this.addIntersection(a,o)}},lK.prototype.toString=function(){return sz.toLineString(new a0(this._pts))},lK.prototype.getNodeList=function(){return this._nodeList},lK.prototype.addIntersectionNode=function(i,r){var n=r,o=n+1;if(o<this._pts.length){var s=this._pts[o];i.equals2D(s)&&(n=o)}return this._nodeList.add(i,n)},lK.prototype.addIntersections=function(i,r,n){for(var o=0;o<i.getIntersectionNum();o++)this.addIntersection(i,r,n,o)},lK.prototype.interfaces_=function(){return[lY]},lK.prototype.getClass=function(){return lK},lK.getNodedSubstrings=function(){if(1==arguments.length){var i=arguments[0],r=new at;return lK.getNodedSubstrings(i,r),r}if(2==arguments.length)for(var n=arguments[0],o=arguments[1],s=n.iterator();s.hasNext();)s.next().getNodeList().addSplitEdges(o)};var lJ=function(){if(this.p0=null,this.p1=null,0==arguments.length)this.p0=new su,this.p1=new su;else if(1==arguments.length){var i=arguments[0];this.p0=new su(i.p0),this.p1=new su(i.p1)}else if(2==arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4==arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3];this.p0=new su(r,n),this.p1=new su(o,s)}},lQ={serialVersionUID:{configurable:!0}};lJ.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},lJ.prototype.orientationIndex=function(){if(arguments[0]instanceof lJ){var i=arguments[0],r=sX.orientationIndex(this.p0,this.p1,i.p0),n=sX.orientationIndex(this.p0,this.p1,i.p1);return r>=0&&n>=0||r<=0&&n<=0?Math.max(r,n):0}if(arguments[0]instanceof su){var o=arguments[0];return sX.orientationIndex(this.p0,this.p1,o)}},lJ.prototype.toGeometry=function(i){return i.createLineString([this.p0,this.p1])},lJ.prototype.isVertical=function(){return this.p0.x===this.p1.x},lJ.prototype.equals=function(i){return i instanceof lJ&&this.p0.equals(i.p0)&&this.p1.equals(i.p1)},lJ.prototype.intersection=function(i){var r=new sq;return r.computeIntersection(this.p0,this.p1,i.p0,i.p1),r.hasIntersection()?r.getIntersection(0):null},lJ.prototype.project=function(){if(arguments[0]instanceof su){var i=arguments[0];if(i.equals(this.p0)||i.equals(this.p1))return new su(i);var r=this.projectionFactor(i),n=new su;return n.x=this.p0.x+r*(this.p1.x-this.p0.x),n.y=this.p0.y+r*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof lJ){var o=arguments[0],s=this.projectionFactor(o.p0),a=this.projectionFactor(o.p1);if(s>=1&&a>=1||s<=0&&a<=0)return null;var l=this.project(o.p0);s<0&&(l=this.p0),s>1&&(l=this.p1);var u=this.project(o.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new lJ(l,u)}},lJ.prototype.normalize=function(){0>this.p1.compareTo(this.p0)&&this.reverse()},lJ.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},lJ.prototype.getCoordinate=function(i){return 0===i?this.p0:this.p1},lJ.prototype.distancePerpendicular=function(i){return sX.distancePointLinePerpendicular(i,this.p0,this.p1)},lJ.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},lJ.prototype.midPoint=function(){return lJ.midPoint(this.p0,this.p1)},lJ.prototype.projectionFactor=function(i){if(i.equals(this.p0))return 0;if(i.equals(this.p1))return 1;var r=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,o=r*r+n*n;return o<=0?sr.NaN:((i.x-this.p0.x)*r+(i.y-this.p0.y)*n)/o},lJ.prototype.closestPoints=function(i){var r=this.intersection(i);if(null!==r)return[r,r];var n=[,,].fill(null),o=sr.MAX_VALUE,s=null,a=this.closestPoint(i.p0);o=a.distance(i.p0),n[0]=a,n[1]=i.p0;var l=this.closestPoint(i.p1);(s=l.distance(i.p1))<o&&(o=s,n[0]=l,n[1]=i.p1);var u=i.closestPoint(this.p0);(s=u.distance(this.p0))<o&&(o=s,n[0]=this.p0,n[1]=u);var h=i.closestPoint(this.p1);return(s=h.distance(this.p1))<o&&(o=s,n[0]=this.p1,n[1]=h),n},lJ.prototype.closestPoint=function(i){var r=this.projectionFactor(i);return r>0&&r<1?this.project(i):this.p0.distance(i)<this.p1.distance(i)?this.p0:this.p1},lJ.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},lJ.prototype.getLength=function(){return this.p0.distance(this.p1)},lJ.prototype.compareTo=function(i){var r=this.p0.compareTo(i.p0);return 0!==r?r:this.p1.compareTo(i.p1)},lJ.prototype.reverse=function(){var i=this.p0;this.p0=this.p1,this.p1=i},lJ.prototype.equalsTopo=function(i){return this.p0.equals(i.p0)&&(this.p1.equals(i.p1)||this.p0.equals(i.p1))&&this.p1.equals(i.p0)},lJ.prototype.lineIntersection=function(i){try{return sA.intersection(this.p0,this.p1,i.p0,i.p1)}catch(i){if(!(i instanceof sC))throw i}return null},lJ.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},lJ.prototype.pointAlongOffset=function(i,r){var n=this.p0.x+i*(this.p1.x-this.p0.x),o=this.p0.y+i*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,l=Math.sqrt(s*s+a*a),u=0,h=0;if(0!==r){if(l<=0)throw Error("Cannot compute offset from zero-length line segment");u=r*s/l,h=r*a/l}return new su(n-h,o+u)},lJ.prototype.setCoordinates=function(){if(1==arguments.length){var i=arguments[0];this.setCoordinates(i.p0,i.p1)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];this.p0.x=r.x,this.p0.y=r.y,this.p1.x=n.x,this.p1.y=n.y}},lJ.prototype.segmentFraction=function(i){var r=this.projectionFactor(i);return r<0?r=0:(r>1||sr.isNaN(r))&&(r=1),r},lJ.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},lJ.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},lJ.prototype.distance=function(){if(arguments[0]instanceof lJ){var i=arguments[0];return sX.distanceLineLine(this.p0,this.p1,i.p0,i.p1)}if(arguments[0]instanceof su){var r=arguments[0];return sX.distancePointLine(r,this.p0,this.p1)}},lJ.prototype.pointAlong=function(i){var r=new su;return r.x=this.p0.x+i*(this.p1.x-this.p0.x),r.y=this.p0.y+i*(this.p1.y-this.p0.y),r},lJ.prototype.hashCode=function(){var i=sr.doubleToLongBits(this.p0.x),r=Math.trunc(i^=31*sr.doubleToLongBits(this.p0.y))^Math.trunc(i>>32),n=sr.doubleToLongBits(this.p1.x);return Math.trunc(n^=31*sr.doubleToLongBits(this.p1.y))^Math.trunc(n>>32)^r},lJ.prototype.interfaces_=function(){return[so,sl]},lJ.prototype.getClass=function(){return lJ},lJ.midPoint=function(i,r){return new su((i.x+r.x)/2,(i.y+r.y)/2)},lQ.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(lJ,lQ);var l0=function(){this.tempEnv1=new sL,this.tempEnv2=new sL,this._overlapSeg1=new lJ,this._overlapSeg2=new lJ};l0.prototype.overlap=function(){if(2==arguments.length);else if(4==arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];i.getLineSegment(r,this._overlapSeg1),n.getLineSegment(o,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},l0.prototype.interfaces_=function(){return[]},l0.prototype.getClass=function(){return l0};var l1=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this._pts=i,this._start=r,this._end=n,this._context=o};l1.prototype.getLineSegment=function(i,r){r.p0=this._pts[i],r.p1=this._pts[i+1]},l1.prototype.computeSelect=function(i,r,n,o){var s=this._pts[r],a=this._pts[n];if(o.tempEnv1.init(s,a),n-r==1)return o.select(this,r),null;if(!i.intersects(o.tempEnv1))return null;var l=Math.trunc((r+n)/2);r<l&&this.computeSelect(i,r,l,o),l<n&&this.computeSelect(i,l,n,o)},l1.prototype.getCoordinates=function(){for(var i=Array(this._end-this._start+1).fill(null),r=0,n=this._start;n<=this._end;n++)i[r++]=this._pts[n];return i},l1.prototype.computeOverlaps=function(i,r){this.computeOverlapsInternal(this._start,this._end,i,i._start,i._end,r)},l1.prototype.setId=function(i){this._id=i},l1.prototype.select=function(i,r){this.computeSelect(i,this._start,this._end,r)},l1.prototype.getEnvelope=function(){if(null===this._env){var i=this._pts[this._start],r=this._pts[this._end];this._env=new sL(i,r)}return this._env},l1.prototype.getEndIndex=function(){return this._end},l1.prototype.getStartIndex=function(){return this._start},l1.prototype.getContext=function(){return this._context},l1.prototype.getId=function(){return this._id},l1.prototype.computeOverlapsInternal=function(i,r,n,o,s,a){var l=this._pts[i],u=this._pts[r],h=n._pts[o],c=n._pts[s];if(r-i==1&&s-o==1)return a.overlap(this,i,n,o),null;if(a.tempEnv1.init(l,u),a.tempEnv2.init(h,c),!a.tempEnv1.intersects(a.tempEnv2))return null;var p=Math.trunc((i+r)/2),f=Math.trunc((o+s)/2);i<p&&(o<f&&this.computeOverlapsInternal(i,p,n,o,f,a),f<s&&this.computeOverlapsInternal(i,p,n,f,s,a)),p<r&&(o<f&&this.computeOverlapsInternal(p,r,n,o,f,a),f<s&&this.computeOverlapsInternal(p,r,n,f,s,a))},l1.prototype.interfaces_=function(){return[]},l1.prototype.getClass=function(){return l1};var l2=function(){};l2.prototype.interfaces_=function(){return[]},l2.prototype.getClass=function(){return l2},l2.getChainStartIndices=function(i){var r=0,n=new at;n.add(new sv(r));do{var o=l2.findChainEnd(i,r);n.add(new sv(o)),r=o}while(r<i.length-1)return l2.toIntArray(n)},l2.findChainEnd=function(i,r){for(var n=r;n<i.length-1&&i[n].equals2D(i[n+1]);)n++;if(n>=i.length-1)return i.length-1;for(var o=lE.quadrant(i[n],i[n+1]),s=r+1;s<i.length&&(i[s-1].equals2D(i[s])||lE.quadrant(i[s-1],i[s])===o);)s++;return s-1},l2.getChains=function(){if(1==arguments.length){var i=arguments[0];return l2.getChains(i,null)}if(2==arguments.length){for(var r=arguments[0],n=arguments[1],o=new at,s=l2.getChainStartIndices(r),a=0;a<s.length-1;a++){var l=new l1(r,s[a],s[a+1],n);o.add(l)}return o}},l2.toIntArray=function(i){for(var r=Array(i.size()).fill(null),n=0;n<r.length;n++)r[n]=i.get(n).intValue();return r};var l3=function(){};l3.prototype.computeNodes=function(i){},l3.prototype.getNodedSubstrings=function(){},l3.prototype.interfaces_=function(){return[]},l3.prototype.getClass=function(){return l3};var l5=function(){if(this._segInt=null,0==arguments.length);else if(1==arguments.length){var i=arguments[0];this.setSegmentIntersector(i)}};l5.prototype.setSegmentIntersector=function(i){this._segInt=i},l5.prototype.interfaces_=function(){return[l3]},l5.prototype.getClass=function(){return l5};var l4=function(i){function r(r){r?i.call(this,r):i.call(this),this._monoChains=new at,this._index=new lq,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var n={SegmentOverlapAction:{configurable:!0}};return r.prototype.getMonotoneChains=function(){return this._monoChains},r.prototype.getNodedSubstrings=function(){return lK.getNodedSubstrings(this._nodedSegStrings)},r.prototype.getIndex=function(){return this._index},r.prototype.add=function(i){for(var r=l2.getChains(i.getCoordinates(),i).iterator();r.hasNext();){var n=r.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},r.prototype.computeNodes=function(i){this._nodedSegStrings=i;for(var r=i.iterator();r.hasNext();)this.add(r.next());this.intersectChains()},r.prototype.intersectChains=function(){for(var i=new l6(this._segInt),r=this._monoChains.iterator();r.hasNext();)for(var n=r.next(),o=this._index.query(n.getEnvelope()).iterator();o.hasNext();){var s=o.next();if(s.getId()>n.getId()&&(n.computeOverlaps(s,i),this._nOverlaps++),this._segInt.isDone())return null}},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},n.SegmentOverlapAction.get=function(){return l6},Object.defineProperties(r,n),r}(l5),l6=function(i){function r(){i.call(this),this._si=null;var r=arguments[0];this._si=r}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.overlap=function(){if(4!=arguments.length)return i.prototype.overlap.apply(this,arguments);var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=r.getContext(),l=o.getContext();this._si.processIntersections(a,n,l,s)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(l0),l8=function i(){if(this._quadrantSegments=i.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=i.CAP_ROUND,this._joinStyle=i.JOIN_ROUND,this._mitreLimit=i.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=i.DEFAULT_SIMPLIFY_FACTOR,0==arguments.length);else if(1==arguments.length){var r=arguments[0];this.setQuadrantSegments(r)}else if(2==arguments.length){var n=arguments[0],o=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(o)}else if(4==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3];this.setQuadrantSegments(s),this.setEndCapStyle(a),this.setJoinStyle(l),this.setMitreLimit(u)}},l9={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};l8.prototype.getEndCapStyle=function(){return this._endCapStyle},l8.prototype.isSingleSided=function(){return this._isSingleSided},l8.prototype.setQuadrantSegments=function(i){this._quadrantSegments=i,0===this._quadrantSegments&&(this._joinStyle=l8.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=l8.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),i<=0&&(this._quadrantSegments=1),this._joinStyle!==l8.JOIN_ROUND&&(this._quadrantSegments=l8.DEFAULT_QUADRANT_SEGMENTS)},l8.prototype.getJoinStyle=function(){return this._joinStyle},l8.prototype.setJoinStyle=function(i){this._joinStyle=i},l8.prototype.setSimplifyFactor=function(i){this._simplifyFactor=i<0?0:i},l8.prototype.getSimplifyFactor=function(){return this._simplifyFactor},l8.prototype.getQuadrantSegments=function(){return this._quadrantSegments},l8.prototype.setEndCapStyle=function(i){this._endCapStyle=i},l8.prototype.getMitreLimit=function(){return this._mitreLimit},l8.prototype.setMitreLimit=function(i){this._mitreLimit=i},l8.prototype.setSingleSided=function(i){this._isSingleSided=i},l8.prototype.interfaces_=function(){return[]},l8.prototype.getClass=function(){return l8},l8.bufferDistanceError=function(i){return 1-Math.cos(Math.PI/2/i/2)},l9.CAP_ROUND.get=function(){return 1},l9.CAP_FLAT.get=function(){return 2},l9.CAP_SQUARE.get=function(){return 3},l9.JOIN_ROUND.get=function(){return 1},l9.JOIN_MITRE.get=function(){return 2},l9.JOIN_BEVEL.get=function(){return 3},l9.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},l9.DEFAULT_MITRE_LIMIT.get=function(){return 5},l9.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01},Object.defineProperties(l8,l9);var l7=function(i){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=sX.COUNTERCLOCKWISE,this._inputLine=i||null},ut={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};l7.prototype.isDeletable=function(i,r,n,o){var s=this._inputLine[i],a=this._inputLine[r],l=this._inputLine[n];return!!this.isConcave(s,a,l)&&!!this.isShallow(s,a,l,o)&&this.isShallowSampled(s,a,i,n,o)},l7.prototype.deleteShallowConcavities=function(){for(var i=1,r=this.findNextNonDeletedIndex(i),n=this.findNextNonDeletedIndex(r),o=!1;n<this._inputLine.length;){var s=!1;this.isDeletable(i,r,n,this._distanceTol)&&(this._isDeleted[r]=l7.DELETE,s=!0,o=!0),i=s?n:r,r=this.findNextNonDeletedIndex(i),n=this.findNextNonDeletedIndex(r)}return o},l7.prototype.isShallowConcavity=function(i,r,n,o){return sX.computeOrientation(i,r,n)===this._angleOrientation&&sX.distancePointLine(r,i,n)<o},l7.prototype.isShallowSampled=function(i,r,n,o,s){var a=Math.trunc((o-n)/l7.NUM_PTS_TO_CHECK);a<=0&&(a=1);for(var l=n;l<o;l+=a)if(!this.isShallow(i,r,this._inputLine[l],s))return!1;return!0},l7.prototype.isConcave=function(i,r,n){return sX.computeOrientation(i,r,n)===this._angleOrientation},l7.prototype.simplify=function(i){this._distanceTol=Math.abs(i),i<0&&(this._angleOrientation=sX.CLOCKWISE),this._isDeleted=Array(this._inputLine.length).fill(null);var r=!1;do r=this.deleteShallowConcavities();while(r)return this.collapseLine()},l7.prototype.findNextNonDeletedIndex=function(i){for(var r=i+1;r<this._inputLine.length&&this._isDeleted[r]===l7.DELETE;)r++;return r},l7.prototype.isShallow=function(i,r,n,o){return sX.distancePointLine(r,i,n)<o},l7.prototype.collapseLine=function(){for(var i=new ai,r=0;r<this._inputLine.length;r++)this._isDeleted[r]!==l7.DELETE&&i.add(this._inputLine[r]);return i.toCoordinateArray()},l7.prototype.interfaces_=function(){return[]},l7.prototype.getClass=function(){return l7},l7.simplify=function(i,r){return new l7(i).simplify(r)},ut.INIT.get=function(){return 0},ut.DELETE.get=function(){return 1},ut.KEEP.get=function(){return 1},ut.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(l7,ut);var ue=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new at},ui={COORDINATE_ARRAY_TYPE:{configurable:!0}};ue.prototype.getCoordinates=function(){return this._ptList.toArray(ue.COORDINATE_ARRAY_TYPE)},ue.prototype.setPrecisionModel=function(i){this._precisionModel=i},ue.prototype.addPt=function(i){var r=new su(i);if(this._precisionModel.makePrecise(r),this.isRedundant(r))return null;this._ptList.add(r)},ue.prototype.revere=function(){},ue.prototype.addPts=function(i,r){if(r)for(var n=0;n<i.length;n++)this.addPt(i[n]);else for(var o=i.length-1;o>=0;o--)this.addPt(i[o])},ue.prototype.isRedundant=function(i){if(1>this._ptList.size())return!1;var r=this._ptList.get(this._ptList.size()-1);return i.distance(r)<this._minimimVertexDistance},ue.prototype.toString=function(){return(new a7).createLineString(this.getCoordinates()).toString()},ue.prototype.closeRing=function(){if(1>this._ptList.size())return null;var i=new su(this._ptList.get(0)),r=this._ptList.get(this._ptList.size()-1);if(i.equals(r))return null;this._ptList.add(i)},ue.prototype.setMinimumVertexDistance=function(i){this._minimimVertexDistance=i},ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue},ui.COORDINATE_ARRAY_TYPE.get=function(){return[].fill(null)},Object.defineProperties(ue,ui);var ur=function(){},un={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur},ur.toDegrees=function(i){return 180*i/Math.PI},ur.normalize=function(i){for(;i>Math.PI;)i-=ur.PI_TIMES_2;for(;i<=-Math.PI;)i+=ur.PI_TIMES_2;return i},ur.angle=function(){if(1==arguments.length){var i=arguments[0];return Math.atan2(i.y,i.x)}if(2==arguments.length){var r=arguments[0],n=arguments[1],o=n.x-r.x;return Math.atan2(n.y-r.y,o)}},ur.isAcute=function(i,r,n){var o=i.x-r.x,s=i.y-r.y;return o*(n.x-r.x)+s*(n.y-r.y)>0},ur.isObtuse=function(i,r,n){var o=i.x-r.x,s=i.y-r.y;return o*(n.x-r.x)+s*(n.y-r.y)<0},ur.interiorAngle=function(i,r,n){var o=ur.angle(r,i);return Math.abs(ur.angle(r,n)-o)},ur.normalizePositive=function(i){if(i<0){for(;i<0;)i+=ur.PI_TIMES_2;i>=ur.PI_TIMES_2&&(i=0)}else{for(;i>=ur.PI_TIMES_2;)i-=ur.PI_TIMES_2;i<0&&(i=0)}return i},ur.angleBetween=function(i,r,n){var o=ur.angle(r,i),s=ur.angle(r,n);return ur.diff(o,s)},ur.diff=function(i,r){var n=null;return(n=i<r?r-i:i-r)>Math.PI&&(n=2*Math.PI-n),n},ur.toRadians=function(i){return i*Math.PI/180},ur.getTurn=function(i,r){var n=Math.sin(r-i);return n>0?ur.COUNTERCLOCKWISE:n<0?ur.CLOCKWISE:ur.NONE},ur.angleBetweenOriented=function(i,r,n){var o=ur.angle(r,i),s=ur.angle(r,n)-o;return s<=-Math.PI?s+ur.PI_TIMES_2:s>Math.PI?s-ur.PI_TIMES_2:s},un.PI_TIMES_2.get=function(){return 2*Math.PI},un.PI_OVER_2.get=function(){return Math.PI/2},un.PI_OVER_4.get=function(){return Math.PI/4},un.COUNTERCLOCKWISE.get=function(){return sX.COUNTERCLOCKWISE},un.CLOCKWISE.get=function(){return sX.CLOCKWISE},un.NONE.get=function(){return sX.COLLINEAR},Object.defineProperties(ur,un);var uo=function i(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new lJ,this._seg1=new lJ,this._offset0=new lJ,this._offset1=new lJ,this._side=0,this._hasNarrowConcaveAngle=!1;var r=arguments[0],n=arguments[1],o=arguments[2];this._precisionModel=r,this._bufParams=n,this._li=new sq,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===l8.JOIN_ROUND&&(this._closingSegLengthFactor=i.MAX_CLOSING_SEG_LEN_FACTOR),this.init(o)},us={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};uo.prototype.addNextSegment=function(i,r){if(this._s0=this._s1,this._s1=this._s2,this._s2=i,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=sX.computeOrientation(this._s0,this._s1,this._s2),o=n===sX.CLOCKWISE&&this._side===la.LEFT||n===sX.COUNTERCLOCKWISE&&this._side===la.RIGHT;0===n?this.addCollinear(r):o?this.addOutsideTurn(n,r):this.addInsideTurn(n,r)},uo.prototype.addLineEndCap=function(i,r){var n=new lJ(i,r),o=new lJ;this.computeOffsetSegment(n,la.LEFT,this._distance,o);var s=new lJ;this.computeOffsetSegment(n,la.RIGHT,this._distance,s);var a=r.x-i.x,l=Math.atan2(r.y-i.y,a);switch(this._bufParams.getEndCapStyle()){case l8.CAP_ROUND:this._segList.addPt(o.p1),this.addFilletArc(r,l+Math.PI/2,l-Math.PI/2,sX.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case l8.CAP_FLAT:this._segList.addPt(o.p1),this._segList.addPt(s.p1);break;case l8.CAP_SQUARE:var u=new su;u.x=Math.abs(this._distance)*Math.cos(l),u.y=Math.abs(this._distance)*Math.sin(l);var h=new su(o.p1.x+u.x,o.p1.y+u.y),c=new su(s.p1.x+u.x,s.p1.y+u.y);this._segList.addPt(h),this._segList.addPt(c)}},uo.prototype.getCoordinates=function(){return this._segList.getCoordinates()},uo.prototype.addMitreJoin=function(i,r,n,o){var s=!0,a=null;try{a=sA.intersection(r.p0,r.p1,n.p0,n.p1),(o<=0?1:a.distance(i)/Math.abs(o))>this._bufParams.getMitreLimit()&&(s=!1)}catch(i){if(!(i instanceof sC))throw i;a=new su(0,0),s=!1}s?this._segList.addPt(a):this.addLimitedMitreJoin(r,n,o,this._bufParams.getMitreLimit())},uo.prototype.addFilletCorner=function(i,r,n,o,s){var a=r.x-i.x,l=Math.atan2(r.y-i.y,a),u=n.x-i.x,h=Math.atan2(n.y-i.y,u);o===sX.CLOCKWISE?l<=h&&(l+=2*Math.PI):l>=h&&(l-=2*Math.PI),this._segList.addPt(r),this.addFilletArc(i,l,h,o,s),this._segList.addPt(n)},uo.prototype.addOutsideTurn=function(i,r){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*uo.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===l8.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===l8.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(r&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,i,this._distance),this._segList.addPt(this._offset1.p0))},uo.prototype.createSquare=function(i){this._segList.addPt(new su(i.x+this._distance,i.y+this._distance)),this._segList.addPt(new su(i.x+this._distance,i.y-this._distance)),this._segList.addPt(new su(i.x-this._distance,i.y-this._distance)),this._segList.addPt(new su(i.x-this._distance,i.y+this._distance)),this._segList.closeRing()},uo.prototype.addSegments=function(i,r){this._segList.addPts(i,r)},uo.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},uo.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},uo.prototype.initSideSegments=function(i,r,n){this._s1=i,this._s2=r,this._side=n,this._seg1.setCoordinates(i,r),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},uo.prototype.addLimitedMitreJoin=function(i,r,n,o){var s=this._seg0.p1,a=ur.angle(s,this._seg0.p0),l=ur.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1)/2,u=ur.normalize(a+l),h=ur.normalize(u+Math.PI),c=o*n,p=n-c*Math.abs(Math.sin(l)),f=new su(s.x+c*Math.cos(h),s.y+c*Math.sin(h)),d=new lJ(s,f),m=d.pointAlongOffset(1,p),g=d.pointAlongOffset(1,-p);this._side===la.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},uo.prototype.computeOffsetSegment=function(i,r,n,o){var s=r===la.LEFT?1:-1,a=i.p1.x-i.p0.x,l=i.p1.y-i.p0.y,u=Math.sqrt(a*a+l*l),h=s*n*a/u,c=s*n*l/u;o.p0.x=i.p0.x-c,o.p0.y=i.p0.y+h,o.p1.x=i.p1.x-c,o.p1.y=i.p1.y+h},uo.prototype.addFilletArc=function(i,r,n,o,s){var a=o===sX.CLOCKWISE?-1:1,l=Math.abs(r-n),u=Math.trunc(l/this._filletAngleQuantum+.5);if(u<1)return null;for(var h=l/u,c=0,p=new su;c<l;){var f=r+a*c;p.x=i.x+s*Math.cos(f),p.y=i.y+s*Math.sin(f),this._segList.addPt(p),c+=h}},uo.prototype.addInsideTurn=function(i,r){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*uo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new su((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var o=new su((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(o)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},uo.prototype.createCircle=function(i){var r=new su(i.x+this._distance,i.y);this._segList.addPt(r),this.addFilletArc(i,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},uo.prototype.addBevelJoin=function(i,r){this._segList.addPt(i.p1),this._segList.addPt(r.p0)},uo.prototype.init=function(i){this._distance=i,this._maxCurveSegmentError=i*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ue,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(i*uo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},uo.prototype.addCollinear=function(i){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===l8.JOIN_BEVEL||this._bufParams.getJoinStyle()===l8.JOIN_MITRE?(i&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,sX.CLOCKWISE,this._distance))},uo.prototype.closeRing=function(){this._segList.closeRing()},uo.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},uo.prototype.interfaces_=function(){return[]},uo.prototype.getClass=function(){return uo},us.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001},us.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001},us.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},us.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(uo,us);var ua=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var i=arguments[0],r=arguments[1];this._precisionModel=i,this._bufParams=r};ua.prototype.getOffsetCurve=function(i,r){if(this._distance=r,0===r)return null;var n=r<0,o=Math.abs(r),s=this.getSegGen(o);i.length<=1?this.computePointCurve(i[0],s):this.computeOffsetCurve(i,n,s);var a=s.getCoordinates();return n&&ar.reverse(a),a},ua.prototype.computeSingleSidedBufferCurve=function(i,r,n){var o=this.simplifyTolerance(this._distance);if(r){n.addSegments(i,!0);var s=l7.simplify(i,-o),a=s.length-1;n.initSideSegments(s[a],s[a-1],la.LEFT),n.addFirstSegment();for(var l=a-2;l>=0;l--)n.addNextSegment(s[l],!0)}else{n.addSegments(i,!1);var u=l7.simplify(i,o),h=u.length-1;n.initSideSegments(u[0],u[1],la.LEFT),n.addFirstSegment();for(var c=2;c<=h;c++)n.addNextSegment(u[c],!0)}n.addLastSegment(),n.closeRing()},ua.prototype.computeRingBufferCurve=function(i,r,n){var o=this.simplifyTolerance(this._distance);r===la.RIGHT&&(o=-o);var s=l7.simplify(i,o),a=s.length-1;n.initSideSegments(s[a-1],s[0],r);for(var l=1;l<=a;l++){var u=1!==l;n.addNextSegment(s[l],u)}n.closeRing()},ua.prototype.computeLineBufferCurve=function(i,r){var n=this.simplifyTolerance(this._distance),o=l7.simplify(i,n),s=o.length-1;r.initSideSegments(o[0],o[1],la.LEFT);for(var a=2;a<=s;a++)r.addNextSegment(o[a],!0);r.addLastSegment(),r.addLineEndCap(o[s-1],o[s]);var l=l7.simplify(i,-n),u=l.length-1;r.initSideSegments(l[u],l[u-1],la.LEFT);for(var h=u-2;h>=0;h--)r.addNextSegment(l[h],!0);r.addLastSegment(),r.addLineEndCap(l[1],l[0]),r.closeRing()},ua.prototype.computePointCurve=function(i,r){switch(this._bufParams.getEndCapStyle()){case l8.CAP_ROUND:r.createCircle(i);break;case l8.CAP_SQUARE:r.createSquare(i)}},ua.prototype.getLineCurve=function(i,r){if(this._distance=r,r<0&&!this._bufParams.isSingleSided()||0===r)return null;var n=Math.abs(r),o=this.getSegGen(n);return i.length<=1?this.computePointCurve(i[0],o):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(i,r<0,o):this.computeLineBufferCurve(i,o),o.getCoordinates()},ua.prototype.getBufferParameters=function(){return this._bufParams},ua.prototype.simplifyTolerance=function(i){return i*this._bufParams.getSimplifyFactor()},ua.prototype.getRingCurve=function(i,r,n){if(this._distance=n,i.length<=2)return this.getLineCurve(i,n);if(0===n)return ua.copyCoordinates(i);var o=this.getSegGen(n);return this.computeRingBufferCurve(i,r,o),o.getCoordinates()},ua.prototype.computeOffsetCurve=function(i,r,n){var o=this.simplifyTolerance(this._distance);if(r){var s=l7.simplify(i,-o),a=s.length-1;n.initSideSegments(s[a],s[a-1],la.LEFT),n.addFirstSegment();for(var l=a-2;l>=0;l--)n.addNextSegment(s[l],!0)}else{var u=l7.simplify(i,o),h=u.length-1;n.initSideSegments(u[0],u[1],la.LEFT),n.addFirstSegment();for(var c=2;c<=h;c++)n.addNextSegment(u[c],!0)}n.addLastSegment()},ua.prototype.getSegGen=function(i){return new uo(this._precisionModel,this._bufParams,i)},ua.prototype.interfaces_=function(){return[]},ua.prototype.getClass=function(){return ua},ua.copyCoordinates=function(i){for(var r=Array(i.length).fill(null),n=0;n<r.length;n++)r[n]=new su(i[n]);return r};var ul=function(){this._subgraphs=null,this._seg=new lJ,this._cga=new sX;var i=arguments[0];this._subgraphs=i},uu={DepthSegment:{configurable:!0}};ul.prototype.findStabbedSegments=function(){if(1==arguments.length){for(var i=arguments[0],r=new at,n=this._subgraphs.iterator();n.hasNext();){var o=n.next(),s=o.getEnvelope();i.y<s.getMinY()||i.y>s.getMaxY()||this.findStabbedSegments(i,o.getDirectedEdges(),r)}return r}if(3==arguments.length){if(sm(arguments[2],s9)&&arguments[0]instanceof su&&arguments[1]instanceof lM){for(var a=arguments[0],l=arguments[1],u=arguments[2],h=l.getEdge().getCoordinates(),c=0;c<h.length-1;c++)if(this._seg.p0=h[c],this._seg.p1=h[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<a.x)&&!(this._seg.isHorizontal()||a.y<this._seg.p0.y||a.y>this._seg.p1.y||sX.computeOrientation(this._seg.p0,this._seg.p1,a)===sX.RIGHT)){var p=l.getDepth(la.LEFT);this._seg.p0.equals(h[c])||(p=l.getDepth(la.RIGHT));var f=new uh(this._seg,p);u.add(f)}}else if(sm(arguments[2],s9)&&arguments[0]instanceof su&&sm(arguments[1],s9))for(var d=arguments[0],m=arguments[1],g=arguments[2],y=m.iterator();y.hasNext();){var _=y.next();_.isForward()&&this.findStabbedSegments(d,_,g)}}},ul.prototype.getDepth=function(i){var r=this.findStabbedSegments(i);return 0===r.size()?0:lz.min(r)._leftDepth},ul.prototype.interfaces_=function(){return[]},ul.prototype.getClass=function(){return ul},uu.DepthSegment.get=function(){return uh},Object.defineProperties(ul,uu);var uh=function(){this._upwardSeg=null,this._leftDepth=null;var i=arguments[0],r=arguments[1];this._upwardSeg=new lJ(i),this._leftDepth=r};uh.prototype.compareTo=function(i){if(this._upwardSeg.minX()>=i._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=i._upwardSeg.minX())return -1;var r=this._upwardSeg.orientationIndex(i._upwardSeg);return 0!==r||0!=(r=-1*i._upwardSeg.orientationIndex(this._upwardSeg))?r:this._upwardSeg.compareTo(i._upwardSeg)},uh.prototype.compareX=function(i,r){var n=i.p0.compareTo(r.p0);return 0!==n?n:i.p1.compareTo(r.p1)},uh.prototype.toString=function(){return this._upwardSeg.toString()},uh.prototype.interfaces_=function(){return[so]},uh.prototype.getClass=function(){return uh};var uc=function(i,r,n){this.p0=i||null,this.p1=r||null,this.p2=n||null};uc.prototype.area=function(){return uc.area(this.p0,this.p1,this.p2)},uc.prototype.signedArea=function(){return uc.signedArea(this.p0,this.p1,this.p2)},uc.prototype.interpolateZ=function(i){if(null===i)throw new si("Supplied point is null.");return uc.interpolateZ(i,this.p0,this.p1,this.p2)},uc.prototype.longestSideLength=function(){return uc.longestSideLength(this.p0,this.p1,this.p2)},uc.prototype.isAcute=function(){return uc.isAcute(this.p0,this.p1,this.p2)},uc.prototype.circumcentre=function(){return uc.circumcentre(this.p0,this.p1,this.p2)},uc.prototype.area3D=function(){return uc.area3D(this.p0,this.p1,this.p2)},uc.prototype.centroid=function(){return uc.centroid(this.p0,this.p1,this.p2)},uc.prototype.inCentre=function(){return uc.inCentre(this.p0,this.p1,this.p2)},uc.prototype.interfaces_=function(){return[]},uc.prototype.getClass=function(){return uc},uc.area=function(i,r,n){return Math.abs(((n.x-i.x)*(r.y-i.y)-(r.x-i.x)*(n.y-i.y))/2)},uc.signedArea=function(i,r,n){return((n.x-i.x)*(r.y-i.y)-(r.x-i.x)*(n.y-i.y))/2},uc.det=function(i,r,n,o){return i*o-r*n},uc.interpolateZ=function(i,r,n,o){var s=r.x,a=r.y,l=n.x-s,u=o.x-s,h=n.y-a,c=o.y-a,p=l*c-u*h,f=i.x-s,d=i.y-a;return r.z+(c*f-u*d)/p*(n.z-r.z)+(-h*f+l*d)/p*(o.z-r.z)},uc.longestSideLength=function(i,r,n){var o=i.distance(r),s=r.distance(n),a=n.distance(i),l=o;return s>l&&(l=s),a>l&&(l=a),l},uc.isAcute=function(i,r,n){return!!ur.isAcute(i,r,n)&&!!ur.isAcute(r,n,i)&&!!ur.isAcute(n,i,r)},uc.circumcentre=function(i,r,n){var o=n.x,s=n.y,a=i.x-o,l=i.y-s,u=r.x-o,h=r.y-s,c=2*uc.det(a,l,u,h);return new su(o-uc.det(l,a*a+l*l,h,u*u+h*h)/c,s+uc.det(a,a*a+l*l,u,u*u+h*h)/c)},uc.perpendicularBisector=function(i,r){var n=r.x-i.x,o=r.y-i.y,s=new sA(i.x+n/2,i.y+o/2,1),a=new sA(i.x-o+n/2,i.y+n+o/2,1);return new sA(s,a)},uc.angleBisector=function(i,r,n){var o=r.distance(i),s=o/(o+r.distance(n)),a=n.x-i.x,l=n.y-i.y;return new su(i.x+s*a,i.y+s*l)},uc.area3D=function(i,r,n){var o=r.x-i.x,s=r.y-i.y,a=r.z-i.z,l=n.x-i.x,u=n.y-i.y,h=n.z-i.z,c=s*h-a*u,p=a*l-o*h,f=o*u-s*l;return Math.sqrt(c*c+p*p+f*f)/2},uc.centroid=function(i,r,n){return new su((i.x+r.x+n.x)/3,(i.y+r.y+n.y)/3)},uc.inCentre=function(i,r,n){var o=r.distance(n),s=i.distance(n),a=i.distance(r),l=o+s+a;return new su((o*i.x+s*r.x+a*n.x)/l,(o*i.y+s*r.y+a*n.y)/l)};var up=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new at;var i=arguments[0],r=arguments[1],n=arguments[2];this._inputGeom=i,this._distance=r,this._curveBuilder=n};up.prototype.addPoint=function(i){if(this._distance<=0)return null;var r=i.getCoordinates(),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,sf.EXTERIOR,sf.INTERIOR)},up.prototype.addPolygon=function(i){var r=this._distance,n=la.LEFT;this._distance<0&&(r=-this._distance,n=la.RIGHT);var o=i.getExteriorRing(),s=ar.removeRepeatedPoints(o.getCoordinates());if(this._distance<0&&this.isErodedCompletely(o,this._distance)||this._distance<=0&&s.length<3)return null;this.addPolygonRing(s,r,n,sf.EXTERIOR,sf.INTERIOR);for(var a=0;a<i.getNumInteriorRing();a++){var l=i.getInteriorRingN(a),u=ar.removeRepeatedPoints(l.getCoordinates());this._distance>0&&this.isErodedCompletely(l,-this._distance)||this.addPolygonRing(u,r,la.opposite(n),sf.INTERIOR,sf.EXTERIOR)}},up.prototype.isTriangleErodedCompletely=function(i,r){var n=new uc(i[0],i[1],i[2]),o=n.inCentre();return sX.distancePointLine(o,n.p0,n.p1)<Math.abs(r)},up.prototype.addLineString=function(i){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var r=ar.removeRepeatedPoints(i.getCoordinates()),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,sf.EXTERIOR,sf.INTERIOR)},up.prototype.addCurve=function(i,r,n){if(null===i||i.length<2)return null;var o=new lK(i,new lg(0,sf.BOUNDARY,r,n));this._curveList.add(o)},up.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},up.prototype.addPolygonRing=function(i,r,n,o,s){if(0===r&&i.length<a$.MINIMUM_VALID_SIZE)return null;var a=o,l=s;i.length>=a$.MINIMUM_VALID_SIZE&&sX.isCCW(i)&&(a=s,l=o,n=la.opposite(n));var u=this._curveBuilder.getRingCurve(i,n,r);this.addCurve(u,a,l)},up.prototype.add=function(i){if(i.isEmpty())return null;i instanceof aZ?this.addPolygon(i):i instanceof aG?this.addLineString(i):i instanceof aq?this.addPoint(i):(i instanceof aX||i instanceof aP||i instanceof aW||i instanceof aC)&&this.addCollection(i)},up.prototype.isErodedCompletely=function(i,r){var n=i.getCoordinates();if(n.length<4)return r<0;if(4===n.length)return this.isTriangleErodedCompletely(n,r);var o=i.getEnvelopeInternal(),s=Math.min(o.getHeight(),o.getWidth());return r<0&&2*Math.abs(r)>s},up.prototype.addCollection=function(i){for(var r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.add(n)}},up.prototype.interfaces_=function(){return[]},up.prototype.getClass=function(){return up};var uf=function(){};uf.prototype.locate=function(i){},uf.prototype.interfaces_=function(){return[]},uf.prototype.getClass=function(){return uf};var ud=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var i=arguments[0];this._parent=i,this._atStart=!0,this._index=0,this._max=i.getNumGeometries()};ud.prototype.next=function(){if(this._atStart)return this._atStart=!1,ud.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new s7;var i=this._parent.getGeometryN(this._index++);return i instanceof aC?(this._subcollectionIterator=new ud(i),this._subcollectionIterator.next()):i},ud.prototype.remove=function(){throw Error(this.getClass().getName())},ud.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},ud.prototype.interfaces_=function(){return[s8]},ud.prototype.getClass=function(){return ud},ud.isAtomic=function(i){return!(i instanceof aC)};var um=function(){this._geom=null;var i=arguments[0];this._geom=i};um.prototype.locate=function(i){return um.locate(i,this._geom)},um.prototype.interfaces_=function(){return[uf]},um.prototype.getClass=function(){return um},um.isPointInRing=function(i,r){return!!r.getEnvelopeInternal().intersects(i)&&sX.isPointInRing(i,r.getCoordinates())},um.containsPointInPolygon=function(i,r){if(r.isEmpty())return!1;var n=r.getExteriorRing();if(!um.isPointInRing(i,n))return!1;for(var o=0;o<r.getNumInteriorRing();o++){var s=r.getInteriorRingN(o);if(um.isPointInRing(i,s))return!1}return!0},um.containsPoint=function(i,r){if(r instanceof aZ)return um.containsPointInPolygon(i,r);if(r instanceof aC)for(var n=new ud(r);n.hasNext();){var o=n.next();if(o!==r&&um.containsPoint(i,o))return!0}return!1},um.locate=function(i,r){return r.isEmpty()?sf.EXTERIOR:um.containsPoint(i,r)?sf.INTERIOR:sf.EXTERIOR};var ug=function(){this._edgeMap=new a_,this._edgeList=null,this._ptInAreaLocation=[sf.NONE,sf.NONE]};ug.prototype.getNextCW=function(i){this.getEdges();var r=this._edgeList.indexOf(i),n=r-1;return 0===r&&(n=this._edgeList.size()-1),this._edgeList.get(n)},ug.prototype.propagateSideLabels=function(i){for(var r=sf.NONE,n=this.iterator();n.hasNext();){var o=n.next().getLabel();o.isArea(i)&&o.getLocation(i,la.LEFT)!==sf.NONE&&(r=o.getLocation(i,la.LEFT))}if(r===sf.NONE)return null;for(var s=r,a=this.iterator();a.hasNext();){var l=a.next(),u=l.getLabel();if(u.getLocation(i,la.ON)===sf.NONE&&u.setLocation(i,la.ON,s),u.isArea(i)){var h=u.getLocation(i,la.LEFT),c=u.getLocation(i,la.RIGHT);if(c!==sf.NONE){if(c!==s)throw new lp("side location conflict",l.getCoordinate());h===sf.NONE&&sU.shouldNeverReachHere("found single null side (at "+l.getCoordinate()+")"),s=h}else sU.isTrue(u.getLocation(i,la.LEFT)===sf.NONE,"found single null side"),u.setLocation(i,la.RIGHT,s),u.setLocation(i,la.LEFT,s)}}},ug.prototype.getCoordinate=function(){var i=this.iterator();return i.hasNext()?i.next().getCoordinate():null},ug.prototype.print=function(i){sP.out.println("EdgeEndStar:   "+this.getCoordinate());for(var r=this.iterator();r.hasNext();)r.next().print(i)},ug.prototype.isAreaLabelsConsistent=function(i){return this.computeEdgeEndLabels(i.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ug.prototype.checkAreaLabelsConsistent=function(i){var r=this.getEdges();if(0>=r.size())return!0;var n=r.size()-1,o=r.get(n).getLabel().getLocation(i,la.LEFT);sU.isTrue(o!==sf.NONE,"Found unlabelled area edge");for(var s=o,a=this.iterator();a.hasNext();){var l=a.next().getLabel();sU.isTrue(l.isArea(i),"Found non-area edge");var u=l.getLocation(i,la.LEFT),h=l.getLocation(i,la.RIGHT);if(u===h||h!==s)return!1;s=u}return!0},ug.prototype.findIndex=function(i){this.iterator();for(var r=0;r<this._edgeList.size();r++)if(this._edgeList.get(r)===i)return r;return -1},ug.prototype.iterator=function(){return this.getEdges().iterator()},ug.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new at(this._edgeMap.values())),this._edgeList},ug.prototype.getLocation=function(i,r,n){return this._ptInAreaLocation[i]===sf.NONE&&(this._ptInAreaLocation[i]=um.locate(r,n[i].getGeometry())),this._ptInAreaLocation[i]},ug.prototype.toString=function(){var i=new s_;i.append("EdgeEndStar:   "+this.getCoordinate()),i.append("\n");for(var r=this.iterator();r.hasNext();){var n=r.next();i.append(n),i.append("\n")}return i.toString()},ug.prototype.computeEdgeEndLabels=function(i){for(var r=this.iterator();r.hasNext();)r.next().computeLabel(i)},ug.prototype.computeLabelling=function(i){this.computeEdgeEndLabels(i[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],n=this.iterator();n.hasNext();)for(var o=n.next().getLabel(),s=0;s<2;s++)o.isLine(s)&&o.getLocation(s)===sf.BOUNDARY&&(r[s]=!0);for(var a=this.iterator();a.hasNext();)for(var l=a.next(),u=l.getLabel(),h=0;h<2;h++)if(u.isAnyNull(h)){var c=sf.NONE;if(r[h])c=sf.EXTERIOR;else{var p=l.getCoordinate();c=this.getLocation(h,p,i)}u.setAllLocationsIfNull(h,c)}},ug.prototype.getDegree=function(){return this._edgeMap.size()},ug.prototype.insertEdgeEnd=function(i,r){this._edgeMap.put(i,r),this._edgeList=null},ug.prototype.interfaces_=function(){return[]},ug.prototype.getClass=function(){return ug};var uy=function(i){function r(){i.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var i=null,r=null,n=this._SCANNING_FOR_INCOMING,o=0;o<this._resultAreaEdgeList.size();o++){var s=this._resultAreaEdgeList.get(o),a=s.getSym();if(s.getLabel().isArea())switch(null===i&&s.isInResult()&&(i=s),n){case this._SCANNING_FOR_INCOMING:if(!a.isInResult())continue;r=a,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!s.isInResult())continue;r.setNext(s),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===i)throw new lp("no outgoing dirEdge found",this.getCoordinate());sU.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),r.setNext(i)}},r.prototype.insert=function(i){this.insertEdgeEnd(i,i)},r.prototype.getRightmostEdge=function(){var i=this.getEdges(),r=i.size();if(r<1)return null;var n=i.get(0);if(1===r)return n;var o=i.get(r-1),s=n.getQuadrant(),a=o.getQuadrant();return lE.isNorthern(s)&&lE.isNorthern(a)?n:lE.isNorthern(s)||lE.isNorthern(a)?0!==n.getDy()?n:0!==o.getDy()?o:(sU.shouldNeverReachHere("found two horizontal edges incident on node"),null):o},r.prototype.print=function(i){sP.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var n=r.next();i.print("out "),n.print(i),i.println(),i.print("in "),n.getSym().print(i),i.println()}},r.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new at;for(var i=this.iterator();i.hasNext();){var r=i.next();(r.isInResult()||r.getSym().isInResult())&&this._resultAreaEdgeList.add(r)}return this._resultAreaEdgeList},r.prototype.updateLabelling=function(i){for(var r=this.iterator();r.hasNext();){var n=r.next().getLabel();n.setAllLocationsIfNull(0,i.getLocation(0)),n.setAllLocationsIfNull(1,i.getLocation(1))}},r.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var i=null,r=null,n=this._edgeList.size()-1;n>=0;n--){var o=this._edgeList.get(n),s=o.getSym();null===r&&(r=s),null!==i&&s.setNext(i),i=o}r.setNext(i)},r.prototype.computeDepths=function(){if(1==arguments.length){var i=arguments[0],r=this.findIndex(i),n=i.getDepth(la.LEFT),o=i.getDepth(la.RIGHT),s=this.computeDepths(r+1,this._edgeList.size(),n);if(this.computeDepths(0,r,s)!==o)throw new lp("depth mismatch at "+i.getCoordinate())}else if(3==arguments.length){for(var a=arguments[0],l=arguments[1],u=arguments[2],h=u,c=a;c<l;c++){var p=this._edgeList.get(c);p.setEdgeDepths(la.RIGHT,h),h=p.getDepth(la.LEFT)}return h}},r.prototype.mergeSymLabels=function(){for(var i=this.iterator();i.hasNext();){var r=i.next();r.getLabel().merge(r.getSym().getLabel())}},r.prototype.linkMinimalDirectedEdges=function(i){for(var r=null,n=null,o=this._SCANNING_FOR_INCOMING,s=this._resultAreaEdgeList.size()-1;s>=0;s--){var a=this._resultAreaEdgeList.get(s),l=a.getSym();switch(null===r&&a.getEdgeRing()===i&&(r=a),o){case this._SCANNING_FOR_INCOMING:if(l.getEdgeRing()!==i)continue;n=l,o=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(a.getEdgeRing()!==i)continue;n.setNextMin(a),o=this._SCANNING_FOR_INCOMING}}o===this._LINKING_TO_OUTGOING&&(sU.isTrue(null!==r,"found null for first outgoing dirEdge"),sU.isTrue(r.getEdgeRing()===i,"unable to link last incoming dirEdge"),n.setNextMin(r))},r.prototype.getOutgoingDegree=function(){if(0==arguments.length){for(var i=0,r=this.iterator();r.hasNext();)r.next().isInResult()&&i++;return i}if(1==arguments.length){for(var n=arguments[0],o=0,s=this.iterator();s.hasNext();)s.next().getEdgeRing()===n&&o++;return o}},r.prototype.getLabel=function(){return this._label},r.prototype.findCoveredLineEdges=function(){for(var i=sf.NONE,r=this.iterator();r.hasNext();){var n=r.next(),o=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){i=sf.INTERIOR;break}if(o.isInResult()){i=sf.EXTERIOR;break}}}if(i===sf.NONE)return null;for(var s=i,a=this.iterator();a.hasNext();){var l=a.next(),u=l.getSym();l.isLineEdge()?l.getEdge().setCovered(s===sf.INTERIOR):(l.isInResult()&&(s=sf.EXTERIOR),u.isInResult()&&(s=sf.INTERIOR))}},r.prototype.computeLabelling=function(r){i.prototype.computeLabelling.call(this,r),this._label=new lg(sf.NONE);for(var n=this.iterator();n.hasNext();)for(var o=n.next().getEdge().getLabel(),s=0;s<2;s++){var a=o.getLocation(s);a!==sf.INTERIOR&&a!==sf.BOUNDARY||this._label.setLocation(s,sf.INTERIOR)}},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(ug),u_=function(i){function r(){i.apply(this,arguments)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.createNode=function(i){return new lb(i,new uy)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(lT),uv=function i(){this._pts=null,this._orientation=null;var r=arguments[0];this._pts=r,this._orientation=i.orientation(r)};uv.prototype.compareTo=function(i){return uv.compareOriented(this._pts,this._orientation,i._pts,i._orientation)},uv.prototype.interfaces_=function(){return[so]},uv.prototype.getClass=function(){return uv},uv.orientation=function(i){return 1===ar.increasingDirection(i)},uv.compareOriented=function(i,r,n,o){for(var s=r?1:-1,a=o?1:-1,l=r?i.length:-1,u=o?n.length:-1,h=r?0:i.length-1,c=o?0:n.length-1;;){var p=i[h].compareTo(n[c]);if(0!==p)return p;var f=(h+=s)===l,d=(c+=a)===u;if(f&&!d)return -1;if(!f&&d)return 1;if(f&&d)return 0}};var ux=function(){this._edges=new at,this._ocaMap=new a_};ux.prototype.print=function(i){i.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r);r>0&&i.print(","),i.print("(");for(var o=n.getCoordinates(),s=0;s<o.length;s++)s>0&&i.print(","),i.print(o[s].x+" "+o[s].y);i.println(")")}i.print(")  ")},ux.prototype.addAll=function(i){for(var r=i.iterator();r.hasNext();)this.add(r.next())},ux.prototype.findEdgeIndex=function(i){for(var r=0;r<this._edges.size();r++)if(this._edges.get(r).equals(i))return r;return -1},ux.prototype.iterator=function(){return this._edges.iterator()},ux.prototype.getEdges=function(){return this._edges},ux.prototype.get=function(i){return this._edges.get(i)},ux.prototype.findEqualEdge=function(i){var r=new uv(i.getCoordinates());return this._ocaMap.get(r)},ux.prototype.add=function(i){this._edges.add(i);var r=new uv(i.getCoordinates());this._ocaMap.put(r,i)},ux.prototype.interfaces_=function(){return[]},ux.prototype.getClass=function(){return ux};var ub=function(){};ub.prototype.processIntersections=function(i,r,n,o){},ub.prototype.isDone=function(){},ub.prototype.interfaces_=function(){return[]},ub.prototype.getClass=function(){return ub};var uw=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var i=arguments[0];this._li=i};uw.prototype.isTrivialIntersection=function(i,r,n,o){if(i===n&&1===this._li.getIntersectionNum()){if(uw.isAdjacentSegments(r,o))return!0;if(i.isClosed()){var s=i.size()-1;if(0===r&&o===s||0===o&&r===s)return!0}}return!1},uw.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},uw.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},uw.prototype.getLineIntersector=function(){return this._li},uw.prototype.hasProperIntersection=function(){return this._hasProper},uw.prototype.processIntersections=function(i,r,n,o){if(i===n&&r===o)return null;this.numTests++;var s=i.getCoordinates()[r],a=i.getCoordinates()[r+1],l=n.getCoordinates()[o],u=n.getCoordinates()[o+1];this._li.computeIntersection(s,a,l,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(i,r,n,o)||(this._hasIntersection=!0,i.addIntersections(this._li,r,0),n.addIntersections(this._li,o,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},uw.prototype.hasIntersection=function(){return this._hasIntersection},uw.prototype.isDone=function(){return!1},uw.prototype.hasInteriorIntersection=function(){return this._hasInterior},uw.prototype.interfaces_=function(){return[ub]},uw.prototype.getClass=function(){return uw},uw.isAdjacentSegments=function(i,r){return 1===Math.abs(i-r)};var uE=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var i=arguments[0],r=arguments[1],n=arguments[2];this.coord=new su(i),this.segmentIndex=r,this.dist=n};uE.prototype.getSegmentIndex=function(){return this.segmentIndex},uE.prototype.getCoordinate=function(){return this.coord},uE.prototype.print=function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex),i.println(" dist = "+this.dist)},uE.prototype.compareTo=function(i){return this.compare(i.segmentIndex,i.dist)},uE.prototype.isEndPoint=function(i){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===i},uE.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},uE.prototype.getDistance=function(){return this.dist},uE.prototype.compare=function(i,r){return this.segmentIndex<i?-1:this.segmentIndex>i?1:this.dist<r?-1:+(this.dist>r)},uE.prototype.interfaces_=function(){return[so]},uE.prototype.getClass=function(){return uE};var uI=function(){this._nodeMap=new a_,this.edge=null;var i=arguments[0];this.edge=i};uI.prototype.print=function(i){i.println("Intersections:");for(var r=this.iterator();r.hasNext();)r.next().print(i)},uI.prototype.iterator=function(){return this._nodeMap.values().iterator()},uI.prototype.addSplitEdges=function(i){this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var o=r.next(),s=this.createSplitEdge(n,o);i.add(s),n=o}},uI.prototype.addEndpoints=function(){var i=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[i],i,0)},uI.prototype.createSplitEdge=function(i,r){var n=r.segmentIndex-i.segmentIndex+2,o=this.edge.pts[r.segmentIndex],s=r.dist>0||!r.coord.equals2D(o);s||n--;var a=Array(n).fill(null),l=0;a[l++]=new su(i.coord);for(var u=i.segmentIndex+1;u<=r.segmentIndex;u++)a[l++]=this.edge.pts[u];return s&&(a[l]=r.coord),new uP(a,new lg(this.edge._label))},uI.prototype.add=function(i,r,n){var o=new uE(i,r,n),s=this._nodeMap.get(o);return null!==s?s:(this._nodeMap.put(o,o),o)},uI.prototype.isIntersection=function(i){for(var r=this.iterator();r.hasNext();)if(r.next().coord.equals(i))return!0;return!1},uI.prototype.interfaces_=function(){return[]},uI.prototype.getClass=function(){return uI};var uS=function(){};uS.prototype.getChainStartIndices=function(i){var r=0,n=new at;n.add(new sv(r));do{var o=this.findChainEnd(i,r);n.add(new sv(o)),r=o}while(r<i.length-1)return uS.toIntArray(n)},uS.prototype.findChainEnd=function(i,r){for(var n=lE.quadrant(i[r],i[r+1]),o=r+1;o<i.length&&lE.quadrant(i[o-1],i[o])===n;)o++;return o-1},uS.prototype.interfaces_=function(){return[]},uS.prototype.getClass=function(){return uS},uS.toIntArray=function(i){for(var r=Array(i.size()).fill(null),n=0;n<r.length;n++)r[n]=i.get(n).intValue();return r};var uM=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new sL,this.env2=new sL;var i=arguments[0];this.e=i,this.pts=i.getCoordinates();var r=new uS;this.startIndex=r.getChainStartIndices(this.pts)};uM.prototype.getCoordinates=function(){return this.pts},uM.prototype.getMaxX=function(i){var r=this.pts[this.startIndex[i]].x,n=this.pts[this.startIndex[i+1]].x;return r>n?r:n},uM.prototype.getMinX=function(i){var r=this.pts[this.startIndex[i]].x,n=this.pts[this.startIndex[i+1]].x;return r<n?r:n},uM.prototype.computeIntersectsForChain=function(){if(4==arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this.computeIntersectsForChain(this.startIndex[i],this.startIndex[i+1],r,r.startIndex[n],r.startIndex[n+1],o)}else if(6==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3],h=arguments[4],c=arguments[5],p=this.pts[s],f=this.pts[a],d=l.pts[u],m=l.pts[h];if(a-s==1&&h-u==1)return c.addIntersections(this.e,s,l.e,u),null;if(this.env1.init(p,f),this.env2.init(d,m),!this.env1.intersects(this.env2))return null;var g=Math.trunc((s+a)/2),y=Math.trunc((u+h)/2);s<g&&(u<y&&this.computeIntersectsForChain(s,g,l,u,y,c),y<h&&this.computeIntersectsForChain(s,g,l,y,h,c)),g<a&&(u<y&&this.computeIntersectsForChain(g,a,l,u,y,c),y<h&&this.computeIntersectsForChain(g,a,l,y,h,c))}},uM.prototype.getStartIndexes=function(){return this.startIndex},uM.prototype.computeIntersects=function(i,r){for(var n=0;n<this.startIndex.length-1;n++)for(var o=0;o<i.startIndex.length-1;o++)this.computeIntersectsForChain(n,i,o,r)},uM.prototype.interfaces_=function(){return[]},uM.prototype.getClass=function(){return uM};var uT=function i(){this._depth=[,,].fill().map(function(){return[,,,]});for(var r=0;r<2;r++)for(var n=0;n<3;n++)this._depth[r][n]=i.NULL_VALUE},uC={NULL_VALUE:{configurable:!0}};uT.prototype.getDepth=function(i,r){return this._depth[i][r]},uT.prototype.setDepth=function(i,r,n){this._depth[i][r]=n},uT.prototype.isNull=function(){if(0==arguments.length){for(var i=0;i<2;i++)for(var r=0;r<3;r++)if(this._depth[i][r]!==uT.NULL_VALUE)return!1;return!0}if(1==arguments.length){var n=arguments[0];return this._depth[n][1]===uT.NULL_VALUE}if(2==arguments.length){var o=arguments[0],s=arguments[1];return this._depth[o][s]===uT.NULL_VALUE}},uT.prototype.normalize=function(){for(var i=0;i<2;i++)if(!this.isNull(i)){var r=this._depth[i][1];this._depth[i][2]<r&&(r=this._depth[i][2]),r<0&&(r=0);for(var n=1;n<3;n++){var o=0;this._depth[i][n]>r&&(o=1),this._depth[i][n]=o}}},uT.prototype.getDelta=function(i){return this._depth[i][la.RIGHT]-this._depth[i][la.LEFT]},uT.prototype.getLocation=function(i,r){return this._depth[i][r]<=0?sf.EXTERIOR:sf.INTERIOR},uT.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},uT.prototype.add=function(){if(1==arguments.length)for(var i=arguments[0],r=0;r<2;r++)for(var n=1;n<3;n++){var o=i.getLocation(r,n);o!==sf.EXTERIOR&&o!==sf.INTERIOR||(this.isNull(r,n)?this._depth[r][n]=uT.depthAtLocation(o):this._depth[r][n]+=uT.depthAtLocation(o))}else if(3==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2];l===sf.INTERIOR&&this._depth[s][a]++}},uT.prototype.interfaces_=function(){return[]},uT.prototype.getClass=function(){return uT},uT.depthAtLocation=function(i){return i===sf.EXTERIOR?0:i===sf.INTERIOR?1:uT.NULL_VALUE},uC.NULL_VALUE.get=function(){return -1},Object.defineProperties(uT,uC);var uP=function(i){function r(){if(i.call(this),this.pts=null,this._env=null,this.eiList=new uI(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new uT,this._depthDelta=0,1==arguments.length){var n=arguments[0];r.call(this,n,null)}else if(2==arguments.length){var o=arguments[0],s=arguments[1];this.pts=o,this._label=s}}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getDepth=function(){return this._depth},r.prototype.getCollapsedEdge=function(){var i=[,,].fill(null);return i[0]=this.pts[0],i[1]=this.pts[1],new r(i,lg.toLineLabel(this._label))},r.prototype.isIsolated=function(){return this._isIsolated},r.prototype.getCoordinates=function(){return this.pts},r.prototype.setIsolated=function(i){this._isIsolated=i},r.prototype.setName=function(i){this._name=i},r.prototype.equals=function(i){if(!(i instanceof r)||this.pts.length!==i.pts.length)return!1;for(var n=!0,o=!0,s=this.pts.length,a=0;a<this.pts.length;a++)if(this.pts[a].equals2D(i.pts[a])||(n=!1),this.pts[a].equals2D(i.pts[--s])||(o=!1),!n&&!o)return!1;return!0},r.prototype.getCoordinate=function(){if(0==arguments.length)return this.pts.length>0?this.pts[0]:null;if(1==arguments.length){var i=arguments[0];return this.pts[i]}},r.prototype.print=function(i){i.print("edge "+this._name+": "),i.print("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&i.print(","),i.print(this.pts[r].x+" "+this.pts[r].y);i.print(")  "+this._label+" "+this._depthDelta)},r.prototype.computeIM=function(i){r.updateIM(this._label,i)},r.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},r.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},r.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},r.prototype.getDepthDelta=function(){return this._depthDelta},r.prototype.getNumPoints=function(){return this.pts.length},r.prototype.printReverse=function(i){i.print("edge "+this._name+": ");for(var r=this.pts.length-1;r>=0;r--)i.print(this.pts[r]+" ");i.println("")},r.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new uM(this)),this._mce},r.prototype.getEnvelope=function(){if(null===this._env){this._env=new sL;for(var i=0;i<this.pts.length;i++)this._env.expandToInclude(this.pts[i])}return this._env},r.prototype.addIntersection=function(i,r,n,o){var s=new su(i.getIntersection(o)),a=r,l=i.getEdgeDistance(n,o),u=a+1;if(u<this.pts.length){var h=this.pts[u];s.equals2D(h)&&(a=u,l=0)}this.eiList.add(s,a,l)},r.prototype.toString=function(){var i=new s_;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&i.append(","),i.append(this.pts[r].x+" "+this.pts[r].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},r.prototype.isPointwiseEqual=function(i){if(this.pts.length!==i.pts.length)return!1;for(var r=0;r<this.pts.length;r++)if(!this.pts[r].equals2D(i.pts[r]))return!1;return!0},r.prototype.setDepthDelta=function(i){this._depthDelta=i},r.prototype.getEdgeIntersectionList=function(){return this.eiList},r.prototype.addIntersections=function(i,r,n){for(var o=0;o<i.getIntersectionNum();o++)this.addIntersection(i,r,n,o)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.updateIM=function(){if(2!=arguments.length)return i.prototype.updateIM.apply(this,arguments);var r=arguments[0],n=arguments[1];n.setAtLeastIfValid(r.getLocation(0,la.ON),r.getLocation(1,la.ON),1),r.isArea()&&(n.setAtLeastIfValid(r.getLocation(0,la.LEFT),r.getLocation(1,la.LEFT),2),n.setAtLeastIfValid(r.getLocation(0,la.RIGHT),r.getLocation(1,la.RIGHT),2))},r}(lx),uA=function(i){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ux,this._bufParams=i||null};uA.prototype.setWorkingPrecisionModel=function(i){this._workingPrecisionModel=i},uA.prototype.insertUniqueEdge=function(i){var r=this._edgeList.findEqualEdge(i);if(null!==r){var n=r.getLabel(),o=i.getLabel();r.isPointwiseEqual(i)||(o=new lg(i.getLabel())).flip(),n.merge(o);var s=uA.depthDelta(o),a=r.getDepthDelta()+s;r.setDepthDelta(a)}else this._edgeList.add(i),i.setDepthDelta(uA.depthDelta(i.getLabel()))},uA.prototype.buildSubgraphs=function(i,r){for(var n=new at,o=i.iterator();o.hasNext();){var s=o.next(),a=s.getRightmostCoordinate(),l=new ul(n).getDepth(a);s.computeDepth(l),s.findResultEdges(),n.add(s),r.add(s.getDirectedEdges(),s.getNodes())}},uA.prototype.createSubgraphs=function(i){for(var r=new at,n=i.getNodes().iterator();n.hasNext();){var o=n.next();if(!o.isVisited()){var s=new ld;s.create(o),r.add(s)}}return lz.sort(r,lz.reverseOrder()),r},uA.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},uA.prototype.getNoder=function(i){if(null!==this._workingNoder)return this._workingNoder;var r=new l4,n=new sq;return n.setPrecisionModel(i),r.setSegmentIntersector(new uw(n)),r},uA.prototype.buffer=function(i,r){var n=this._workingPrecisionModel;null===n&&(n=i.getPrecisionModel()),this._geomFact=i.getFactory();var o=new up(i,r,new ua(n,this._bufParams)).getCurves();if(0>=o.size())return this.createEmptyResultGeometry();this.computeNodedEdges(o,n),this._graph=new lC(new u_),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),a=new lP(this._geomFact);this.buildSubgraphs(s,a);var l=a.getPolygons();return 0>=l.size()?this.createEmptyResultGeometry():this._geomFact.buildGeometry(l)},uA.prototype.computeNodedEdges=function(i,r){var n=this.getNoder(r);n.computeNodes(i);for(var o=n.getNodedSubstrings().iterator();o.hasNext();){var s=o.next(),a=s.getCoordinates();if(2!==a.length||!a[0].equals2D(a[1])){var l=s.getData(),u=new uP(s.getCoordinates(),new lg(l));this.insertUniqueEdge(u)}}},uA.prototype.setNoder=function(i){this._workingNoder=i},uA.prototype.interfaces_=function(){return[]},uA.prototype.getClass=function(){return uA},uA.depthDelta=function(i){var r=i.getLocation(0,la.LEFT),n=i.getLocation(0,la.RIGHT);return r===sf.INTERIOR&&n===sf.EXTERIOR?1:r===sf.EXTERIOR&&n===sf.INTERIOR?-1:0},uA.convertSegStrings=function(i){for(var r=new a7,n=new at;i.hasNext();){var o=i.next(),s=r.createLineString(o.getCoordinates());n.add(s)}return r.buildGeometry(n)};var uL=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2==arguments.length){var i=arguments[0],r=arguments[1];this._noder=i,this._scaleFactor=r,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=o,this._offsetX=s,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};uL.prototype.rescale=function(){if(sm(arguments[0],s4))for(var i=arguments[0],r=i.iterator();r.hasNext();){var n=r.next();this.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var o=arguments[0],s=0;s<o.length;s++)o[s].x=o[s].x/this._scaleFactor+this._offsetX,o[s].y=o[s].y/this._scaleFactor+this._offsetY;2===o.length&&o[0].equals2D(o[1])&&sP.out.println(o)}},uL.prototype.scale=function(){if(sm(arguments[0],s4)){for(var i=arguments[0],r=new at,n=i.iterator();n.hasNext();){var o=n.next();r.add(new lK(this.scale(o.getCoordinates()),o.getData()))}return r}if(arguments[0]instanceof Array){for(var s=arguments[0],a=Array(s.length).fill(null),l=0;l<s.length;l++)a[l]=new su(Math.round((s[l].x-this._offsetX)*this._scaleFactor),Math.round((s[l].y-this._offsetY)*this._scaleFactor),s[l].z);return ar.removeRepeatedPoints(a)}},uL.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},uL.prototype.getNodedSubstrings=function(){var i=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(i),i},uL.prototype.computeNodes=function(i){var r=i;this._isScaled&&(r=this.scale(i)),this._noder.computeNodes(r)},uL.prototype.interfaces_=function(){return[l3]},uL.prototype.getClass=function(){return uL};var uk=function(){this._li=new sq,this._segStrings=null;var i=arguments[0];this._segStrings=i},uR={fact:{configurable:!0}};uk.prototype.checkEndPtVertexIntersections=function(){if(0==arguments.length)for(var i=this._segStrings.iterator();i.hasNext();){var r=i.next().getCoordinates();this.checkEndPtVertexIntersections(r[0],this._segStrings),this.checkEndPtVertexIntersections(r[r.length-1],this._segStrings)}else if(2==arguments.length){for(var n=arguments[0],o=arguments[1],s=o.iterator();s.hasNext();)for(var a=s.next(),l=a.getCoordinates(),u=1;u<l.length-1;u++)if(l[u].equals(n))throw new sF("found endpt/interior pt intersection at index "+u+" :pt "+n)}},uk.prototype.checkInteriorIntersections=function(){if(0==arguments.length)for(var i=this._segStrings.iterator();i.hasNext();)for(var r=i.next(),n=this._segStrings.iterator();n.hasNext();){var o=n.next();this.checkInteriorIntersections(r,o)}else if(2==arguments.length)for(var s=arguments[0],a=arguments[1],l=s.getCoordinates(),u=a.getCoordinates(),h=0;h<l.length-1;h++)for(var c=0;c<u.length-1;c++)this.checkInteriorIntersections(s,h,a,c);else if(4==arguments.length){var p=arguments[0],f=arguments[1],d=arguments[2],m=arguments[3];if(p===d&&f===m)return null;var g=p.getCoordinates()[f],y=p.getCoordinates()[f+1],_=d.getCoordinates()[m],v=d.getCoordinates()[m+1];if(this._li.computeIntersection(g,y,_,v),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,g,y)||this.hasInteriorIntersection(this._li,_,v)))throw new sF("found non-noded intersection at "+g+"-"+y+" and "+_+"-"+v)}},uk.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},uk.prototype.checkCollapses=function(){if(0==arguments.length)for(var i=this._segStrings.iterator();i.hasNext();){var r=i.next();this.checkCollapses(r)}else if(1==arguments.length)for(var n=arguments[0],o=n.getCoordinates(),s=0;s<o.length-2;s++)this.checkCollapse(o[s],o[s+1],o[s+2])},uk.prototype.hasInteriorIntersection=function(i,r,n){for(var o=0;o<i.getIntersectionNum();o++){var s=i.getIntersection(o);if(!s.equals(r)&&!s.equals(n))return!0}return!1},uk.prototype.checkCollapse=function(i,r,n){if(i.equals(n))throw new sF("found non-noded collapse at "+uk.fact.createLineString([i,r,n]))},uk.prototype.interfaces_=function(){return[]},uk.prototype.getClass=function(){return uk},uR.fact.get=function(){return new a7},Object.defineProperties(uk,uR);var uD=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=[,,,,].fill(null),this._safeEnv=null;var i=arguments[0],r=arguments[1],n=arguments[2];if(this._originalPt=i,this._pt=i,this._scaleFactor=r,this._li=n,r<=0)throw new si("Scale factor must be non-zero");1!==r&&(this._pt=new su(this.scale(i.x),this.scale(i.y)),this._p0Scaled=new su,this._p1Scaled=new su),this.initCorners(this._pt)},uN={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};uD.prototype.intersectsScaled=function(i,r){var n=Math.min(i.x,r.x),o=Math.max(i.x,r.x),s=Math.min(i.y,r.y),a=Math.max(i.y,r.y),l=this._maxx<n||this._minx>o||this._maxy<s||this._miny>a;if(l)return!1;var u=this.intersectsToleranceSquare(i,r);return sU.isTrue(!(l&&u),"Found bad envelope test"),u},uD.prototype.initCorners=function(i){this._minx=i.x-.5,this._maxx=i.x+.5,this._miny=i.y-.5,this._maxy=i.y+.5,this._corner[0]=new su(this._maxx,this._maxy),this._corner[1]=new su(this._minx,this._maxy),this._corner[2]=new su(this._minx,this._miny),this._corner[3]=new su(this._maxx,this._miny)},uD.prototype.intersects=function(i,r){return 1===this._scaleFactor?this.intersectsScaled(i,r):(this.copyScaled(i,this._p0Scaled),this.copyScaled(r,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},uD.prototype.scale=function(i){return Math.round(i*this._scaleFactor)},uD.prototype.getCoordinate=function(){return this._originalPt},uD.prototype.copyScaled=function(i,r){r.x=this.scale(i.x),r.y=this.scale(i.y)},uD.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var i=uD.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new sL(this._originalPt.x-i,this._originalPt.x+i,this._originalPt.y-i,this._originalPt.y+i)}return this._safeEnv},uD.prototype.intersectsPixelClosure=function(i,r){return this._li.computeIntersection(i,r,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,r,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,r,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,r,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},uD.prototype.intersectsToleranceSquare=function(i,r){var n=!1,o=!1;return this._li.computeIntersection(i,r,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(i,r,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(i,r,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(o=!0),this._li.computeIntersection(i,r,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!n||!o)||!!i.equals(this._pt)||!!r.equals(this._pt))))},uD.prototype.addSnappedNode=function(i,r){var n=i.getCoordinate(r),o=i.getCoordinate(r+1);return!!this.intersects(n,o)&&(i.addIntersection(this.getCoordinate(),r),!0)},uD.prototype.interfaces_=function(){return[]},uD.prototype.getClass=function(){return uD},uN.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75},Object.defineProperties(uD,uN);var uO=function(){this.tempEnv1=new sL,this.selectedSegment=new lJ};uO.prototype.select=function(){if(1==arguments.length);else if(2==arguments.length){var i=arguments[0],r=arguments[1];i.getLineSegment(r,this.selectedSegment),this.select(this.selectedSegment)}},uO.prototype.interfaces_=function(){return[]},uO.prototype.getClass=function(){return uO};var uz=function(){this._index=null;var i=arguments[0];this._index=i},uF={HotPixelSnapAction:{configurable:!0}};uz.prototype.snap=function(){if(1==arguments.length){var i=arguments[0];return this.snap(i,null,-1)}if(3==arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=r.getSafeEnvelope(),a=new uB(r,n,o);return this._index.query(s,{interfaces_:function(){return[lR]},visitItem:function(i){i.select(s,a)}}),a.isNodeAdded()}},uz.prototype.interfaces_=function(){return[]},uz.prototype.getClass=function(){return uz},uF.HotPixelSnapAction.get=function(){return uB},Object.defineProperties(uz,uF);var uB=function(i){function r(){i.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],o=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=o}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.isNodeAdded=function(){return this._isNodeAdded},r.prototype.select=function(){if(2!=arguments.length)return i.prototype.select.apply(this,arguments);var r=arguments[0],n=arguments[1],o=r.getContext();if(null!==this._parentEdge&&o===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(o,n)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(uO),uU=function(){this._li=null,this._interiorIntersections=null;var i=arguments[0];this._li=i,this._interiorIntersections=new at};uU.prototype.processIntersections=function(i,r,n,o){if(i===n&&r===o)return null;var s=i.getCoordinates()[r],a=i.getCoordinates()[r+1],l=n.getCoordinates()[o],u=n.getCoordinates()[o+1];if(this._li.computeIntersection(s,a,l,u),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var h=0;h<this._li.getIntersectionNum();h++)this._interiorIntersections.add(this._li.getIntersection(h));i.addIntersections(this._li,r,0),n.addIntersections(this._li,o,1)}},uU.prototype.isDone=function(){return!1},uU.prototype.getInteriorIntersections=function(){return this._interiorIntersections},uU.prototype.interfaces_=function(){return[ub]},uU.prototype.getClass=function(){return uU};var uG=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var i=arguments[0];this._pm=i,this._li=new sq,this._li.setPrecisionModel(i),this._scaleFactor=i.getScale()};uG.prototype.checkCorrectness=function(i){var r=new uk(lK.getNodedSubstrings(i));try{r.checkValid()}catch(i){if(!(i instanceof sT))throw i;i.printStackTrace()}},uG.prototype.getNodedSubstrings=function(){return lK.getNodedSubstrings(this._nodedSegStrings)},uG.prototype.snapRound=function(i,r){var n=this.findInteriorIntersections(i,r);this.computeIntersectionSnaps(n),this.computeVertexSnaps(i)},uG.prototype.findInteriorIntersections=function(i,r){var n=new uU(r);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(i),n.getInteriorIntersections()},uG.prototype.computeVertexSnaps=function(){if(sm(arguments[0],s4))for(var i=arguments[0],r=i.iterator();r.hasNext();){var n=r.next();this.computeVertexSnaps(n)}else if(arguments[0]instanceof lK)for(var o=arguments[0],s=o.getCoordinates(),a=0;a<s.length;a++){var l=new uD(s[a],this._scaleFactor,this._li);this._pointSnapper.snap(l,o,a)&&o.addIntersection(s[a],a)}},uG.prototype.computeNodes=function(i){this._nodedSegStrings=i,this._noder=new l4,this._pointSnapper=new uz(this._noder.getIndex()),this.snapRound(i,this._li)},uG.prototype.computeIntersectionSnaps=function(i){for(var r=i.iterator();r.hasNext();){var n=new uD(r.next(),this._scaleFactor,this._li);this._pointSnapper.snap(n)}},uG.prototype.interfaces_=function(){return[l3]},uG.prototype.getClass=function(){return uG};var uV=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new l8,this._resultGeometry=null,this._saveException=null,1==arguments.length){var i=arguments[0];this._argGeom=i}else if(2==arguments.length){var r=arguments[0],n=arguments[1];this._argGeom=r,this._bufParams=n}},uq={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};uV.prototype.bufferFixedPrecision=function(i){var r=new uL(new uG(new a4(1)),i.getScale()),n=new uA(this._bufParams);n.setWorkingPrecisionModel(i),n.setNoder(r),this._resultGeometry=n.buffer(this._argGeom,this._distance)},uV.prototype.bufferReducedPrecision=function(){if(0==arguments.length){for(var i=uV.MAX_PRECISION_DIGITS;i>=0;i--){try{this.bufferReducedPrecision(i)}catch(i){if(!(i instanceof lp))throw i;this._saveException=i}if(null!==this._resultGeometry)return null}throw this._saveException}if(1==arguments.length){var r=arguments[0],n=new a4(uV.precisionScaleFactor(this._argGeom,this._distance,r));this.bufferFixedPrecision(n)}},uV.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var i=this._argGeom.getFactory().getPrecisionModel();i.getType()===a4.FIXED?this.bufferFixedPrecision(i):this.bufferReducedPrecision()},uV.prototype.setQuadrantSegments=function(i){this._bufParams.setQuadrantSegments(i)},uV.prototype.bufferOriginalPrecision=function(){try{var i=new uA(this._bufParams);this._resultGeometry=i.buffer(this._argGeom,this._distance)}catch(i){if(!(i instanceof sF))throw i;this._saveException=i}},uV.prototype.getResultGeometry=function(i){return this._distance=i,this.computeGeometry(),this._resultGeometry},uV.prototype.setEndCapStyle=function(i){this._bufParams.setEndCapStyle(i)},uV.prototype.interfaces_=function(){return[]},uV.prototype.getClass=function(){return uV},uV.bufferOp=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];return new uV(i).getResultGeometry(r)}if(3==arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof sH&&"number"==typeof arguments[1]){var n=arguments[0],o=arguments[1],s=arguments[2],a=new uV(n);return a.setQuadrantSegments(s),a.getResultGeometry(o)}if(arguments[2]instanceof l8&&arguments[0]instanceof sH&&"number"==typeof arguments[1]){var l=arguments[0],u=arguments[1],h=arguments[2];return new uV(l,h).getResultGeometry(u)}}else if(4==arguments.length){var c=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3],m=new uV(c);return m.setQuadrantSegments(f),m.setEndCapStyle(d),m.getResultGeometry(p)}},uV.precisionScaleFactor=function(i,r,n){var o=i.getEnvelopeInternal();return Math.pow(10,n-Math.trunc(Math.log(sg.max(Math.abs(o.getMaxX()),Math.abs(o.getMaxY()),Math.abs(o.getMinX()),Math.abs(o.getMinY()))+2*(r>0?r:0))/Math.log(10)+1))},uq.CAP_ROUND.get=function(){return l8.CAP_ROUND},uq.CAP_BUTT.get=function(){return l8.CAP_FLAT},uq.CAP_FLAT.get=function(){return l8.CAP_FLAT},uq.CAP_SQUARE.get=function(){return l8.CAP_SQUARE},uq.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(uV,uq);var uj=function(){this._pt=[new su,new su],this._distance=sr.NaN,this._isNull=!0};uj.prototype.getCoordinates=function(){return this._pt},uj.prototype.getCoordinate=function(i){return this._pt[i]},uj.prototype.setMinimum=function(){if(1==arguments.length){var i=arguments[0];this.setMinimum(i._pt[0],i._pt[1])}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var o=r.distance(n);o<this._distance&&this.initialize(r,n,o)}},uj.prototype.initialize=function(){if(0==arguments.length)this._isNull=!0;else if(2==arguments.length){var i=arguments[0],r=arguments[1];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=i.distance(r),this._isNull=!1}else if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(o),this._distance=s,this._isNull=!1}},uj.prototype.getDistance=function(){return this._distance},uj.prototype.setMaximum=function(){if(1==arguments.length){var i=arguments[0];this.setMaximum(i._pt[0],i._pt[1])}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var o=r.distance(n);o>this._distance&&this.initialize(r,n,o)}},uj.prototype.interfaces_=function(){return[]},uj.prototype.getClass=function(){return uj};var uZ=function(){};uZ.prototype.interfaces_=function(){return[]},uZ.prototype.getClass=function(){return uZ},uZ.computeDistance=function(){if(arguments[2]instanceof uj&&arguments[0]instanceof aG&&arguments[1]instanceof su)for(var i=arguments[0],r=arguments[1],n=arguments[2],o=i.getCoordinates(),s=new lJ,a=0;a<o.length-1;a++){s.setCoordinates(o[a],o[a+1]);var l=s.closestPoint(r);n.setMinimum(l,r)}else if(arguments[2]instanceof uj&&arguments[0]instanceof aZ&&arguments[1]instanceof su){var u=arguments[0],h=arguments[1],c=arguments[2];uZ.computeDistance(u.getExteriorRing(),h,c);for(var p=0;p<u.getNumInteriorRing();p++)uZ.computeDistance(u.getInteriorRingN(p),h,c)}else if(arguments[2]instanceof uj&&arguments[0]instanceof sH&&arguments[1]instanceof su){var f=arguments[0],d=arguments[1],m=arguments[2];if(f instanceof aG)uZ.computeDistance(f,d,m);else if(f instanceof aZ)uZ.computeDistance(f,d,m);else if(f instanceof aC)for(var g=0;g<f.getNumGeometries();g++){var y=f.getGeometryN(g);uZ.computeDistance(y,d,m)}else m.setMinimum(f.getCoordinate(),d)}else if(arguments[2]instanceof uj&&arguments[0]instanceof lJ&&arguments[1]instanceof su){var _=arguments[0],v=arguments[1],x=arguments[2],b=_.closestPoint(v);x.setMinimum(b,v)}};var uX=function(i){this._maxPtDist=new uj,this._inputGeom=i||null},u$={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};uX.prototype.computeMaxMidpointDistance=function(i){var r=new uH(this._inputGeom);i.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())},uX.prototype.computeMaxVertexDistance=function(i){var r=new uW(this._inputGeom);i.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())},uX.prototype.findDistance=function(i){return this.computeMaxVertexDistance(i),this.computeMaxMidpointDistance(i),this._maxPtDist.getDistance()},uX.prototype.getDistancePoints=function(){return this._maxPtDist},uX.prototype.interfaces_=function(){return[]},uX.prototype.getClass=function(){return uX},u$.MaxPointDistanceFilter.get=function(){return uW},u$.MaxMidpointDistanceFilter.get=function(){return uH},Object.defineProperties(uX,u$);var uW=function(i){this._maxPtDist=new uj,this._minPtDist=new uj,this._geom=i||null};uW.prototype.filter=function(i){this._minPtDist.initialize(),uZ.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},uW.prototype.getMaxPointDistance=function(){return this._maxPtDist},uW.prototype.interfaces_=function(){return[sJ]},uW.prototype.getClass=function(){return uW};var uH=function(i){this._maxPtDist=new uj,this._minPtDist=new uj,this._geom=i||null};uH.prototype.filter=function(i,r){if(0===r)return null;var n=i.getCoordinate(r-1),o=i.getCoordinate(r),s=new su((n.x+o.x)/2,(n.y+o.y)/2);this._minPtDist.initialize(),uZ.computeDistance(this._geom,s,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},uH.prototype.isDone=function(){return!1},uH.prototype.isGeometryChanged=function(){return!1},uH.prototype.getMaxPointDistance=function(){return this._maxPtDist},uH.prototype.interfaces_=function(){return[aT]},uH.prototype.getClass=function(){return uH};var uY=function(i){this._comps=i||null};uY.prototype.filter=function(i){i instanceof aZ&&this._comps.add(i)},uY.prototype.interfaces_=function(){return[aM]},uY.prototype.getClass=function(){return uY},uY.getPolygons=function(){if(1==arguments.length){var i=arguments[0];return uY.getPolygons(i,new at)}if(2==arguments.length){var r=arguments[0],n=arguments[1];return r instanceof aZ?n.add(r):r instanceof aC&&r.apply(new uY(n)),n}};var uK=function(){if(this._lines=null,this._isForcedToLineString=!1,1==arguments.length){var i=arguments[0];this._lines=i}else if(2==arguments.length){var r=arguments[0],n=arguments[1];this._lines=r,this._isForcedToLineString=n}};uK.prototype.filter=function(i){if(this._isForcedToLineString&&i instanceof a$){var r=i.getFactory().createLineString(i.getCoordinateSequence());return this._lines.add(r),null}i instanceof aG&&this._lines.add(i)},uK.prototype.setForceToLineString=function(i){this._isForcedToLineString=i},uK.prototype.interfaces_=function(){return[sW]},uK.prototype.getClass=function(){return uK},uK.getGeometry=function(){if(1==arguments.length){var i=arguments[0];return i.getFactory().buildGeometry(uK.getLines(i))}if(2==arguments.length){var r=arguments[0],n=arguments[1];return r.getFactory().buildGeometry(uK.getLines(r,n))}},uK.getLines=function(){if(1==arguments.length){var i=arguments[0];return uK.getLines(i,!1)}if(2==arguments.length){if(sm(arguments[0],s4)&&sm(arguments[1],s4)){for(var r=arguments[0],n=arguments[1],o=r.iterator();o.hasNext();){var s=o.next();uK.getLines(s,n)}return n}if(arguments[0]instanceof sH&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1],u=new at;return a.apply(new uK(u,l)),u}if(arguments[0]instanceof sH&&sm(arguments[1],s4)){var h=arguments[0],c=arguments[1];return h instanceof aG?c.add(h):h.apply(new uK(c)),c}}else if(3==arguments.length){if("boolean"==typeof arguments[2]&&sm(arguments[0],s4)&&sm(arguments[1],s4)){for(var p=arguments[0],f=arguments[1],d=arguments[2],m=p.iterator();m.hasNext();){var g=m.next();uK.getLines(g,f,d)}return f}if("boolean"==typeof arguments[2]&&arguments[0]instanceof sH&&sm(arguments[1],s4)){var y=arguments[0],_=arguments[1],v=arguments[2];return y.apply(new uK(_,v)),_}}};var uJ=function(){if(this._boundaryRule=sQ.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0==arguments.length);else if(1==arguments.length){var i=arguments[0];if(null===i)throw new si("Rule must be non-null");this._boundaryRule=i}};uJ.prototype.locateInternal=function(){if(arguments[0]instanceof su&&arguments[1]instanceof aZ){var i=arguments[0],r=arguments[1];if(r.isEmpty())return sf.EXTERIOR;var n=r.getExteriorRing(),o=this.locateInPolygonRing(i,n);if(o===sf.EXTERIOR)return sf.EXTERIOR;if(o===sf.BOUNDARY)return sf.BOUNDARY;for(var s=0;s<r.getNumInteriorRing();s++){var a=r.getInteriorRingN(s),l=this.locateInPolygonRing(i,a);if(l===sf.INTERIOR)return sf.EXTERIOR;if(l===sf.BOUNDARY)return sf.BOUNDARY}return sf.INTERIOR}if(arguments[0]instanceof su&&arguments[1]instanceof aG){var u=arguments[0],h=arguments[1];if(!h.getEnvelopeInternal().intersects(u))return sf.EXTERIOR;var c=h.getCoordinates();return!h.isClosed()&&(u.equals(c[0])||u.equals(c[c.length-1]))?sf.BOUNDARY:sX.isOnLine(u,c)?sf.INTERIOR:sf.EXTERIOR}if(arguments[0]instanceof su&&arguments[1]instanceof aq){var p=arguments[0],f=arguments[1];return f.getCoordinate().equals2D(p)?sf.INTERIOR:sf.EXTERIOR}},uJ.prototype.locateInPolygonRing=function(i,r){return r.getEnvelopeInternal().intersects(i)?sX.locatePointInRing(i,r.getCoordinates()):sf.EXTERIOR},uJ.prototype.intersects=function(i,r){return this.locate(i,r)!==sf.EXTERIOR},uJ.prototype.updateLocationInfo=function(i){i===sf.INTERIOR&&(this._isIn=!0),i===sf.BOUNDARY&&this._numBoundaries++},uJ.prototype.computeLocation=function(i,r){if(r instanceof aq&&this.updateLocationInfo(this.locateInternal(i,r)),r instanceof aG)this.updateLocationInfo(this.locateInternal(i,r));else if(r instanceof aZ)this.updateLocationInfo(this.locateInternal(i,r));else if(r instanceof aP)for(var n=0;n<r.getNumGeometries();n++){var o=r.getGeometryN(n);this.updateLocationInfo(this.locateInternal(i,o))}else if(r instanceof aW)for(var s=0;s<r.getNumGeometries();s++){var a=r.getGeometryN(s);this.updateLocationInfo(this.locateInternal(i,a))}else if(r instanceof aC)for(var l=new ud(r);l.hasNext();){var u=l.next();u!==r&&this.computeLocation(i,u)}},uJ.prototype.locate=function(i,r){return r.isEmpty()?sf.EXTERIOR:r instanceof aG||r instanceof aZ?this.locateInternal(i,r):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(i,r),this._boundaryRule.isInBoundary(this._numBoundaries)?sf.BOUNDARY:this._numBoundaries>0||this._isIn?sf.INTERIOR:sf.EXTERIOR)},uJ.prototype.interfaces_=function(){return[]},uJ.prototype.getClass=function(){return uJ};var uQ=function i(){if(this._component=null,this._segIndex=null,this._pt=null,2==arguments.length){var r=arguments[0],n=arguments[1];i.call(this,r,i.INSIDE_AREA,n)}else if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this._component=o,this._segIndex=s,this._pt=a}},u0={INSIDE_AREA:{configurable:!0}};uQ.prototype.isInsideArea=function(){return this._segIndex===uQ.INSIDE_AREA},uQ.prototype.getCoordinate=function(){return this._pt},uQ.prototype.getGeometryComponent=function(){return this._component},uQ.prototype.getSegmentIndex=function(){return this._segIndex},uQ.prototype.interfaces_=function(){return[]},uQ.prototype.getClass=function(){return uQ},u0.INSIDE_AREA.get=function(){return -1},Object.defineProperties(uQ,u0);var u1=function(i){this._pts=i||null};u1.prototype.filter=function(i){i instanceof aq&&this._pts.add(i)},u1.prototype.interfaces_=function(){return[aM]},u1.prototype.getClass=function(){return u1},u1.getPoints=function(){if(1==arguments.length){var i=arguments[0];return i instanceof aq?lz.singletonList(i):u1.getPoints(i,new at)}if(2==arguments.length){var r=arguments[0],n=arguments[1];return r instanceof aq?n.add(r):r instanceof aC&&r.apply(new u1(n)),n}};var u2=function(){this._locations=null;var i=arguments[0];this._locations=i};u2.prototype.filter=function(i){(i instanceof aq||i instanceof aG||i instanceof aZ)&&this._locations.add(new uQ(i,0,i.getCoordinate()))},u2.prototype.interfaces_=function(){return[aM]},u2.prototype.getClass=function(){return u2},u2.getLocations=function(i){var r=new at;return i.apply(new u2(r)),r};var u3=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new uJ,this._minDistanceLocation=null,this._minDistance=sr.MAX_VALUE,2==arguments.length){var i=arguments[0],r=arguments[1];this._geom=[i,r],this._terminateDistance=0}else if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];this._geom=[,,].fill(null),this._geom[0]=n,this._geom[1]=o,this._terminateDistance=s}};u3.prototype.computeContainmentDistance=function(){if(0==arguments.length){var i=[,,].fill(null);if(this.computeContainmentDistance(0,i),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1],o=1-r,s=uY.getPolygons(this._geom[r]);if(s.size()>0){var a=u2.getLocations(this._geom[o]);if(this.computeContainmentDistance(a,s,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[o]=n[0],this._minDistanceLocation[r]=n[1],null}}else if(3==arguments.length){if(arguments[2]instanceof Array&&sm(arguments[0],s9)&&sm(arguments[1],s9)){for(var l=arguments[0],u=arguments[1],h=arguments[2],c=0;c<l.size();c++)for(var p=l.get(c),f=0;f<u.size();f++)if(this.computeContainmentDistance(p,u.get(f),h),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof uQ&&arguments[1]instanceof aZ){var d=arguments[0],m=arguments[1],g=arguments[2],y=d.getCoordinate();if(sf.EXTERIOR!==this._ptLocator.locate(y,m))return this._minDistance=0,g[0]=d,g[1]=new uQ(m,y),null}}},u3.prototype.computeMinDistanceLinesPoints=function(i,r,n){for(var o=0;o<i.size();o++)for(var s=i.get(o),a=0;a<r.size();a++){var l=r.get(a);if(this.computeMinDistance(s,l,n),this._minDistance<=this._terminateDistance)return null}},u3.prototype.computeFacetDistance=function(){var i=[,,].fill(null),r=uK.getLines(this._geom[0]),n=uK.getLines(this._geom[1]),o=u1.getPoints(this._geom[0]),s=u1.getPoints(this._geom[1]);return this.computeMinDistanceLines(r,n,i),this.updateMinDistance(i,!1),this._minDistance<=this._terminateDistance?null:(i[0]=null,i[1]=null,this.computeMinDistanceLinesPoints(r,s,i),this.updateMinDistance(i,!1),this._minDistance<=this._terminateDistance?null:(i[0]=null,i[1]=null,this.computeMinDistanceLinesPoints(n,o,i),this.updateMinDistance(i,!0),this._minDistance<=this._terminateDistance?null:(i[0]=null,i[1]=null,this.computeMinDistancePoints(o,s,i),void this.updateMinDistance(i,!1))))},u3.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},u3.prototype.updateMinDistance=function(i,r){if(null===i[0])return null;r?(this._minDistanceLocation[0]=i[1],this._minDistanceLocation[1]=i[0]):(this._minDistanceLocation[0]=i[0],this._minDistanceLocation[1]=i[1])},u3.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},u3.prototype.computeMinDistance=function(){if(0==arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=[,,].fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3==arguments.length){if(arguments[2]instanceof Array&&arguments[0]instanceof aG&&arguments[1]instanceof aq){var i=arguments[0],r=arguments[1],n=arguments[2];if(i.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var o=i.getCoordinates(),s=r.getCoordinate(),a=0;a<o.length-1;a++){var l=sX.distancePointLine(s,o[a],o[a+1]);if(l<this._minDistance){this._minDistance=l;var u=new lJ(o[a],o[a+1]).closestPoint(s);n[0]=new uQ(i,a,u),n[1]=new uQ(r,0,s)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof aG&&arguments[1]instanceof aG){var h=arguments[0],c=arguments[1],p=arguments[2];if(h.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var f=h.getCoordinates(),d=c.getCoordinates(),m=0;m<f.length-1;m++)for(var g=0;g<d.length-1;g++){var y=sX.distanceLineLine(f[m],f[m+1],d[g],d[g+1]);if(y<this._minDistance){this._minDistance=y;var _=new lJ(f[m],f[m+1]),v=new lJ(d[g],d[g+1]),x=_.closestPoints(v);p[0]=new uQ(h,m,x[0]),p[1]=new uQ(c,g,x[1])}if(this._minDistance<=this._terminateDistance)return null}}}},u3.prototype.computeMinDistancePoints=function(i,r,n){for(var o=0;o<i.size();o++)for(var s=i.get(o),a=0;a<r.size();a++){var l=r.get(a),u=s.getCoordinate().distance(l.getCoordinate());if(u<this._minDistance&&(this._minDistance=u,n[0]=new uQ(s,0,s.getCoordinate()),n[1]=new uQ(l,0,l.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},u3.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new si("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},u3.prototype.computeMinDistanceLines=function(i,r,n){for(var o=0;o<i.size();o++)for(var s=i.get(o),a=0;a<r.size();a++){var l=r.get(a);if(this.computeMinDistance(s,l,n),this._minDistance<=this._terminateDistance)return null}},u3.prototype.interfaces_=function(){return[]},u3.prototype.getClass=function(){return u3},u3.distance=function(i,r){return new u3(i,r).distance()},u3.isWithinDistance=function(i,r,n){return new u3(i,r,n).distance()<=n},u3.nearestPoints=function(i,r){return new u3(i,r).nearestPoints()};var u5=function(){this._pt=[new su,new su],this._distance=sr.NaN,this._isNull=!0};u5.prototype.getCoordinates=function(){return this._pt},u5.prototype.getCoordinate=function(i){return this._pt[i]},u5.prototype.setMinimum=function(){if(1==arguments.length){var i=arguments[0];this.setMinimum(i._pt[0],i._pt[1])}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var o=r.distance(n);o<this._distance&&this.initialize(r,n,o)}},u5.prototype.initialize=function(){if(0==arguments.length)this._isNull=!0;else if(2==arguments.length){var i=arguments[0],r=arguments[1];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=i.distance(r),this._isNull=!1}else if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(o),this._distance=s,this._isNull=!1}},u5.prototype.toString=function(){return sz.toLineString(this._pt[0],this._pt[1])},u5.prototype.getDistance=function(){return this._distance},u5.prototype.setMaximum=function(){if(1==arguments.length){var i=arguments[0];this.setMaximum(i._pt[0],i._pt[1])}else if(2==arguments.length){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var o=r.distance(n);o>this._distance&&this.initialize(r,n,o)}},u5.prototype.interfaces_=function(){return[]},u5.prototype.getClass=function(){return u5};var u4=function(){};u4.prototype.interfaces_=function(){return[]},u4.prototype.getClass=function(){return u4},u4.computeDistance=function(){if(arguments[2]instanceof u5&&arguments[0]instanceof aG&&arguments[1]instanceof su)for(var i=arguments[0],r=arguments[1],n=arguments[2],o=new lJ,s=i.getCoordinates(),a=0;a<s.length-1;a++){o.setCoordinates(s[a],s[a+1]);var l=o.closestPoint(r);n.setMinimum(l,r)}else if(arguments[2]instanceof u5&&arguments[0]instanceof aZ&&arguments[1]instanceof su){var u=arguments[0],h=arguments[1],c=arguments[2];u4.computeDistance(u.getExteriorRing(),h,c);for(var p=0;p<u.getNumInteriorRing();p++)u4.computeDistance(u.getInteriorRingN(p),h,c)}else if(arguments[2]instanceof u5&&arguments[0]instanceof sH&&arguments[1]instanceof su){var f=arguments[0],d=arguments[1],m=arguments[2];if(f instanceof aG)u4.computeDistance(f,d,m);else if(f instanceof aZ)u4.computeDistance(f,d,m);else if(f instanceof aC)for(var g=0;g<f.getNumGeometries();g++){var y=f.getGeometryN(g);u4.computeDistance(y,d,m)}else m.setMinimum(f.getCoordinate(),d)}else if(arguments[2]instanceof u5&&arguments[0]instanceof lJ&&arguments[1]instanceof su){var _=arguments[0],v=arguments[1],x=arguments[2],b=_.closestPoint(v);x.setMinimum(b,v)}};var u6=function(){this._g0=null,this._g1=null,this._ptDist=new u5,this._densifyFrac=0;var i=arguments[0],r=arguments[1];this._g0=i,this._g1=r},u8={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};u6.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},u6.prototype.setDensifyFraction=function(i){if(i>1||i<=0)throw new si("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=i},u6.prototype.compute=function(i,r){this.computeOrientedDistance(i,r,this._ptDist),this.computeOrientedDistance(r,i,this._ptDist)},u6.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},u6.prototype.computeOrientedDistance=function(i,r,n){var o=new u9(r);if(i.apply(o),n.setMaximum(o.getMaxPointDistance()),this._densifyFrac>0){var s=new u7(r,this._densifyFrac);i.apply(s),n.setMaximum(s.getMaxPointDistance())}},u6.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},u6.prototype.interfaces_=function(){return[]},u6.prototype.getClass=function(){return u6},u6.distance=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];return new u6(i,r).distance()}if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=new u6(n,o);return a.setDensifyFraction(s),a.distance()}},u8.MaxPointDistanceFilter.get=function(){return u9},u8.MaxDensifiedByFractionDistanceFilter.get=function(){return u7},Object.defineProperties(u6,u8);var u9=function(){this._maxPtDist=new u5,this._minPtDist=new u5,this._euclideanDist=new u4,this._geom=null;var i=arguments[0];this._geom=i};u9.prototype.filter=function(i){this._minPtDist.initialize(),u4.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},u9.prototype.getMaxPointDistance=function(){return this._maxPtDist},u9.prototype.interfaces_=function(){return[sJ]},u9.prototype.getClass=function(){return u9};var u7=function(){this._maxPtDist=new u5,this._minPtDist=new u5,this._geom=null,this._numSubSegs=0;var i=arguments[0],r=arguments[1];this._geom=i,this._numSubSegs=Math.trunc(Math.round(1/r))};u7.prototype.filter=function(i,r){if(0===r)return null;for(var n=i.getCoordinate(r-1),o=i.getCoordinate(r),s=(o.x-n.x)/this._numSubSegs,a=(o.y-n.y)/this._numSubSegs,l=0;l<this._numSubSegs;l++){var u=new su(n.x+l*s,n.y+l*a);this._minPtDist.initialize(),u4.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},u7.prototype.isDone=function(){return!1},u7.prototype.isGeometryChanged=function(){return!1},u7.prototype.getMaxPointDistance=function(){return this._maxPtDist},u7.prototype.interfaces_=function(){return[aT]},u7.prototype.getClass=function(){return u7};var ht=function(i,r,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=i||null,this._bufDistance=r||null,this._result=n||null},he={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ht.prototype.checkMaximumDistance=function(i,r,n){var o=new u6(r,i);if(o.setDensifyFraction(.25),this._maxDistanceFound=o.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var s=o.getCoordinates();this._errorLocation=s[1],this._errorIndicator=i.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+sz.toLineString(s[0],s[1])+")"}},ht.prototype.isValid=function(){var i=Math.abs(this._bufDistance),r=ht.MAX_DISTANCE_DIFF_FRAC*i;return this._minValidDistance=i-r,this._maxValidDistance=i+r,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ht.VERBOSE&&sP.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},ht.prototype.checkNegativeValid=function(){if(!(this._input instanceof aZ||this._input instanceof aW||this._input instanceof aC))return null;var i=this.getPolygonLines(this._input);if(this.checkMinimumDistance(i,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(i,this._result,this._maxValidDistance)},ht.prototype.getErrorIndicator=function(){return this._errorIndicator},ht.prototype.checkMinimumDistance=function(i,r,n){var o=new u3(i,r,n);if(this._minDistanceFound=o.distance(),this._minDistanceFound<n){this._isValid=!1;var s=o.nearestPoints();this._errorLocation=o.nearestPoints()[1],this._errorIndicator=i.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+sz.toLineString(s[0],s[1])+" )"}},ht.prototype.checkPositiveValid=function(){var i=this._result.getBoundary();if(this.checkMinimumDistance(this._input,i,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,i,this._maxValidDistance)},ht.prototype.getErrorLocation=function(){return this._errorLocation},ht.prototype.getPolygonLines=function(i){for(var r=new at,n=new uK(r),o=uY.getPolygons(i).iterator();o.hasNext();)o.next().apply(n);return i.getFactory().buildGeometry(r)},ht.prototype.getErrorMessage=function(){return this._errMsg},ht.prototype.interfaces_=function(){return[]},ht.prototype.getClass=function(){return ht},he.VERBOSE.get=function(){return!1},he.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012},Object.defineProperties(ht,he);var hi=function(i,r,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=i||null,this._distance=r||null,this._result=n||null},hr={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};hi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid&&(this.checkExpectedEmpty(),this._isValid&&(this.checkEnvelope(),this._isValid&&(this.checkArea(),this._isValid&&this.checkDistance()))),this._isValid},hi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var i=this._distance*hi.MAX_ENV_DIFF_FRAC;0===i&&(i=.001);var r=new sL(this._input.getEnvelopeInternal());r.expandBy(this._distance);var n=new sL(this._result.getEnvelopeInternal());n.expandBy(i),n.contains(r)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},hi.prototype.checkDistance=function(){var i=new ht(this._input,this._distance,this._result);i.isValid()||(this._isValid=!1,this._errorMsg=i.getErrorMessage(),this._errorLocation=i.getErrorLocation(),this._errorIndicator=i.getErrorIndicator()),this.report("Distance")},hi.prototype.checkArea=function(){var i=this._input.getArea(),r=this._result.getArea();this._distance>0&&i>r&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&i<r&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},hi.prototype.checkPolygonal=function(){this._result instanceof aZ||this._result instanceof aW||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},hi.prototype.getErrorIndicator=function(){return this._errorIndicator},hi.prototype.getErrorLocation=function(){return this._errorLocation},hi.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},hi.prototype.report=function(i){if(!hi.VERBOSE)return null;sP.out.println("Check "+i+": "+(this._isValid?"passed":"FAILED"))},hi.prototype.getErrorMessage=function(){return this._errorMsg},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi},hi.isValidMsg=function(i,r,n){var o=new hi(i,r,n);return o.isValid()?null:o.getErrorMessage()},hi.isValid=function(i,r,n){return!!new hi(i,r,n).isValid()},hr.VERBOSE.get=function(){return!1},hr.MAX_ENV_DIFF_FRAC.get=function(){return .012},Object.defineProperties(hi,hr);var hn=function(){this._pts=null,this._data=null;var i=arguments[0],r=arguments[1];this._pts=i,this._data=r};hn.prototype.getCoordinates=function(){return this._pts},hn.prototype.size=function(){return this._pts.length},hn.prototype.getCoordinate=function(i){return this._pts[i]},hn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},hn.prototype.getSegmentOctant=function(i){return i===this._pts.length-1?-1:lW.octant(this.getCoordinate(i),this.getCoordinate(i+1))},hn.prototype.setData=function(i){this._data=i},hn.prototype.getData=function(){return this._data},hn.prototype.toString=function(){return sz.toLineString(new a0(this._pts))},hn.prototype.interfaces_=function(){return[lH]},hn.prototype.getClass=function(){return hn};var ho=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new at,this._intersectionCount=0,this._keepIntersections=!0;var i=arguments[0];this._li=i,this._interiorIntersection=null};ho.prototype.getInteriorIntersection=function(){return this._interiorIntersection},ho.prototype.setCheckEndSegmentsOnly=function(i){this._isCheckEndSegmentsOnly=i},ho.prototype.getIntersectionSegments=function(){return this._intSegments},ho.prototype.count=function(){return this._intersectionCount},ho.prototype.getIntersections=function(){return this._intersections},ho.prototype.setFindAllIntersections=function(i){this._findAllIntersections=i},ho.prototype.setKeepIntersections=function(i){this._keepIntersections=i},ho.prototype.processIntersections=function(i,r,n,o){if(!this._findAllIntersections&&this.hasIntersection()||i===n&&r===o||this._isCheckEndSegmentsOnly&&!(this.isEndSegment(i,r)||this.isEndSegment(n,o)))return null;var s=i.getCoordinates()[r],a=i.getCoordinates()[r+1],l=n.getCoordinates()[o],u=n.getCoordinates()[o+1];this._li.computeIntersection(s,a,l,u),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=[,,,,].fill(null),this._intSegments[0]=s,this._intSegments[1]=a,this._intSegments[2]=l,this._intSegments[3]=u,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},ho.prototype.isEndSegment=function(i,r){return 0===r||r>=i.size()-2},ho.prototype.hasIntersection=function(){return null!==this._interiorIntersection},ho.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},ho.prototype.interfaces_=function(){return[ub]},ho.prototype.getClass=function(){return ho},ho.createAllIntersectionsFinder=function(i){var r=new ho(i);return r.setFindAllIntersections(!0),r},ho.createAnyIntersectionFinder=function(i){return new ho(i)},ho.createIntersectionCounter=function(i){var r=new ho(i);return r.setFindAllIntersections(!0),r.setKeepIntersections(!1),r};var hs=function(){this._li=new sq,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var i=arguments[0];this._segStrings=i};hs.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},hs.prototype.getIntersections=function(){return this._segInt.getIntersections()},hs.prototype.isValid=function(){return this.execute(),this._isValid},hs.prototype.setFindAllIntersections=function(i){this._findAllIntersections=i},hs.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new ho(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var i=new l4;if(i.setSegmentIntersector(this._segInt),i.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},hs.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new lp(this.getErrorMessage(),this._segInt.getInteriorIntersection())},hs.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var i=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+sz.toLineString(i[0],i[1])+" and "+sz.toLineString(i[2],i[3])},hs.prototype.interfaces_=function(){return[]},hs.prototype.getClass=function(){return hs},hs.computeIntersections=function(i){var r=new hs(i);return r.setFindAllIntersections(!0),r.isValid(),r.getIntersections()};var ha=function i(){this._nv=null;var r=arguments[0];this._nv=new hs(i.toSegmentStrings(r))};ha.prototype.checkValid=function(){this._nv.checkValid()},ha.prototype.interfaces_=function(){return[]},ha.prototype.getClass=function(){return ha},ha.toSegmentStrings=function(i){for(var r=new at,n=i.iterator();n.hasNext();){var o=n.next();r.add(new hn(o.getCoordinates(),o))}return r},ha.checkValid=function(i){new ha(i).checkValid()};var hl=function(i){this._mapOp=i};hl.prototype.map=function(i){for(var r=new at,n=0;n<i.getNumGeometries();n++){var o=this._mapOp.map(i.getGeometryN(n));o.isEmpty()||r.add(o)}return i.getFactory().createGeometryCollection(a7.toGeometryArray(r))},hl.prototype.interfaces_=function(){return[]},hl.prototype.getClass=function(){return hl},hl.map=function(i,r){return new hl(r).map(i)};var hu=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new at,this._resultLineList=new at;var i=arguments[0],r=arguments[1],n=arguments[2];this._op=i,this._geometryFactory=r,this._ptLocator=n};hu.prototype.collectLines=function(i){for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next();this.collectLineEdge(n,i,this._lineEdgesList),this.collectBoundaryTouchEdge(n,i,this._lineEdgesList)}},hu.prototype.labelIsolatedLine=function(i,r){var n=this._ptLocator.locate(i.getCoordinate(),this._op.getArgGeometry(r));i.getLabel().setLocation(r,n)},hu.prototype.build=function(i){return this.findCoveredLineEdges(),this.collectLines(i),this.buildLines(i),this._resultLineList},hu.prototype.collectLineEdge=function(i,r,n){var o=i.getLabel(),s=i.getEdge();i.isLineEdge()&&(i.isVisited()||!hq.isResultOfOp(o,r)||s.isCovered()||(n.add(s),i.setVisitedEdge(!0)))},hu.prototype.findCoveredLineEdges=function(){for(var i=this._op.getGraph().getNodes().iterator();i.hasNext();)i.next().getEdges().findCoveredLineEdges();for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next(),o=n.getEdge();if(n.isLineEdge()&&!o.isCoveredSet()){var s=this._op.isCoveredByA(n.getCoordinate());o.setCovered(s)}}},hu.prototype.labelIsolatedLines=function(i){for(var r=i.iterator();r.hasNext();){var n=r.next(),o=n.getLabel();n.isIsolated()&&(o.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},hu.prototype.buildLines=function(i){for(var r=this._lineEdgesList.iterator();r.hasNext();){var n=r.next(),o=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(o),n.setInResult(!0)}},hu.prototype.collectBoundaryTouchEdge=function(i,r,n){var o=i.getLabel();return i.isLineEdge()||i.isVisited()||i.isInteriorAreaEdge()||i.getEdge().isInResult()?null:(sU.isTrue(!(i.isInResult()||i.getSym().isInResult())||!i.getEdge().isInResult()),void(hq.isResultOfOp(o,r)&&r===hq.INTERSECTION&&(n.add(i.getEdge()),i.setVisitedEdge(!0))))},hu.prototype.interfaces_=function(){return[]},hu.prototype.getClass=function(){return hu};var hh=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new at;var i=arguments[0],r=arguments[1];this._op=i,this._geometryFactory=r};hh.prototype.filterCoveredNodeToPoint=function(i){var r=i.getCoordinate();if(!this._op.isCoveredByLA(r)){var n=this._geometryFactory.createPoint(r);this._resultPointList.add(n)}},hh.prototype.extractNonCoveredResultNodes=function(i){for(var r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(0===n.getEdges().getDegree()||i===hq.INTERSECTION)){var o=n.getLabel();hq.isResultOfOp(o,i)&&this.filterCoveredNodeToPoint(n)}}},hh.prototype.build=function(i){return this.extractNonCoveredResultNodes(i),this._resultPointList},hh.prototype.interfaces_=function(){return[]},hh.prototype.getClass=function(){return hh};var hc=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};hc.prototype.transformPoint=function(i,r){return this._factory.createPoint(this.transformCoordinates(i.getCoordinateSequence(),i))},hc.prototype.transformPolygon=function(i,r){var n=!0,o=this.transformLinearRing(i.getExteriorRing(),i);null!==o&&o instanceof a$&&!o.isEmpty()||(n=!1);for(var s=new at,a=0;a<i.getNumInteriorRing();a++){var l=this.transformLinearRing(i.getInteriorRingN(a),i);null===l||l.isEmpty()||(l instanceof a$||(n=!1),s.add(l))}if(n)return this._factory.createPolygon(o,s.toArray([]));var u=new at;return null!==o&&u.add(o),u.addAll(s),this._factory.buildGeometry(u)},hc.prototype.createCoordinateSequence=function(i){return this._factory.getCoordinateSequenceFactory().create(i)},hc.prototype.getInputGeometry=function(){return this._inputGeom},hc.prototype.transformMultiLineString=function(i,r){for(var n=new at,o=0;o<i.getNumGeometries();o++){var s=this.transformLineString(i.getGeometryN(o),i);null!==s&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)},hc.prototype.transformCoordinates=function(i,r){return this.copy(i)},hc.prototype.transformLineString=function(i,r){return this._factory.createLineString(this.transformCoordinates(i.getCoordinateSequence(),i))},hc.prototype.transformMultiPoint=function(i,r){for(var n=new at,o=0;o<i.getNumGeometries();o++){var s=this.transformPoint(i.getGeometryN(o),i);null!==s&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)},hc.prototype.transformMultiPolygon=function(i,r){for(var n=new at,o=0;o<i.getNumGeometries();o++){var s=this.transformPolygon(i.getGeometryN(o),i);null!==s&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)},hc.prototype.copy=function(i){return i.copy()},hc.prototype.transformGeometryCollection=function(i,r){for(var n=new at,o=0;o<i.getNumGeometries();o++){var s=this.transform(i.getGeometryN(o));null!==s&&(this._pruneEmptyGeometry&&s.isEmpty()||n.add(s))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(a7.toGeometryArray(n)):this._factory.buildGeometry(n)},hc.prototype.transform=function(i){if(this._inputGeom=i,this._factory=i.getFactory(),i instanceof aq)return this.transformPoint(i,null);if(i instanceof aX)return this.transformMultiPoint(i,null);if(i instanceof a$)return this.transformLinearRing(i,null);if(i instanceof aG)return this.transformLineString(i,null);if(i instanceof aP)return this.transformMultiLineString(i,null);if(i instanceof aZ)return this.transformPolygon(i,null);if(i instanceof aW)return this.transformMultiPolygon(i,null);if(i instanceof aC)return this.transformGeometryCollection(i,null);throw new si("Unknown Geometry subtype: "+i.getClass().getName())},hc.prototype.transformLinearRing=function(i,r){var n=this.transformCoordinates(i.getCoordinateSequence(),i);if(null===n)return this._factory.createLinearRing(null);var o=n.size();return o>0&&o<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},hc.prototype.interfaces_=function(){return[]},hc.prototype.getClass=function(){return hc};var hp=function i(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new lJ,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof aG&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];i.call(this,r.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var o=arguments[0],s=arguments[1];this._srcPts=o,this._isClosed=i.isClosed(o),this._snapTolerance=s}};hp.prototype.snapVertices=function(i,r){for(var n=this._isClosed?i.size()-1:i.size(),o=0;o<n;o++){var s=i.get(o),a=this.findSnapForVertex(s,r);null!==a&&(i.set(o,new su(a)),0===o&&this._isClosed&&i.set(i.size()-1,new su(a)))}},hp.prototype.findSnapForVertex=function(i,r){for(var n=0;n<r.length&&!i.equals2D(r[n]);n++)if(i.distance(r[n])<this._snapTolerance)return r[n];return null},hp.prototype.snapTo=function(i){var r=new ai(this._srcPts);return this.snapVertices(r,i),this.snapSegments(r,i),r.toCoordinateArray()},hp.prototype.snapSegments=function(i,r){if(0===r.length)return null;var n=r.length;r[0].equals2D(r[r.length-1])&&(n=r.length-1);for(var o=0;o<n;o++){var s=r[o],a=this.findSegmentIndexToSnap(s,i);a>=0&&i.add(a+1,new su(s),!1)}},hp.prototype.findSegmentIndexToSnap=function(i,r){for(var n=sr.MAX_VALUE,o=-1,s=0;s<r.size()-1;s++){if(this._seg.p0=r.get(s),this._seg.p1=r.get(s+1),this._seg.p0.equals2D(i)||this._seg.p1.equals2D(i)){if(this._allowSnappingToSourceVertices)continue;return -1}var a=this._seg.distance(i);a<this._snapTolerance&&a<n&&(n=a,o=s)}return o},hp.prototype.setAllowSnappingToSourceVertices=function(i){this._allowSnappingToSourceVertices=i},hp.prototype.interfaces_=function(){return[]},hp.prototype.getClass=function(){return hp},hp.isClosed=function(i){return!(i.length<=1)&&i[0].equals2D(i[i.length-1])};var hf=function(i){this._srcGeom=i||null},hd={SNAP_PRECISION_FACTOR:{configurable:!0}};hf.prototype.snapTo=function(i,r){return new hm(r,this.extractTargetCoordinates(i)).transform(this._srcGeom)},hf.prototype.snapToSelf=function(i,r){var n=new hm(i,this.extractTargetCoordinates(this._srcGeom),!0).transform(this._srcGeom),o=n;return r&&sm(o,aj)&&(o=n.buffer(0)),o},hf.prototype.computeSnapTolerance=function(i){return this.computeMinimumSegmentLength(i)/10},hf.prototype.extractTargetCoordinates=function(i){for(var r=new ab,n=i.getCoordinates(),o=0;o<n.length;o++)r.add(n[o]);return r.toArray([].fill(null))},hf.prototype.computeMinimumSegmentLength=function(i){for(var r=sr.MAX_VALUE,n=0;n<i.length-1;n++){var o=i[n].distance(i[n+1]);o<r&&(r=o)}return r},hf.prototype.interfaces_=function(){return[]},hf.prototype.getClass=function(){return hf},hf.snap=function(i,r,n){var o=[,,].fill(null),s=new hf(i);o[0]=s.snapTo(r,n);var a=new hf(r);return o[1]=a.snapTo(o[0],n),o},hf.computeOverlaySnapTolerance=function(){if(1==arguments.length){var i=arguments[0],r=hf.computeSizeBasedSnapTolerance(i),n=i.getPrecisionModel();if(n.getType()===a4.FIXED){var o=1/n.getScale()*2/1.415;o>r&&(r=o)}return r}if(2==arguments.length){var s=arguments[0],a=arguments[1];return Math.min(hf.computeOverlaySnapTolerance(s),hf.computeOverlaySnapTolerance(a))}},hf.computeSizeBasedSnapTolerance=function(i){var r=i.getEnvelopeInternal();return Math.min(r.getHeight(),r.getWidth())*hf.SNAP_PRECISION_FACTOR},hf.snapToSelf=function(i,r,n){return new hf(i).snapToSelf(r,n)},hd.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(hf,hd);var hm=function(i){function r(r,n,o){i.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=void 0!==o&&o}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.snapLine=function(i,r){var n=new hp(i,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(r)},r.prototype.transformCoordinates=function(i,r){var n=i.toCoordinateArray(),o=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(o)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(hc),hg=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};hg.prototype.getCommon=function(){return sr.longBitsToDouble(this._commonBits)},hg.prototype.add=function(i){var r=sr.doubleToLongBits(i);return this._isFirst?(this._commonBits=r,this._commonSignExp=hg.signExpBits(this._commonBits),this._isFirst=!1,null):hg.signExpBits(r)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=hg.numCommonMostSigMantissaBits(this._commonBits,r),void(this._commonBits=hg.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},hg.prototype.toString=function(){if(1==arguments.length){var i=arguments[0],r=sr.longBitsToDouble(i),n="0000000000000000000000000000000000000000000000000000000000000000"+sr.toBinaryString(i),o=n.substring(n.length-64);return o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+r+" ]"}},hg.prototype.interfaces_=function(){return[]},hg.prototype.getClass=function(){return hg},hg.getBit=function(i,r){return+(0!=(i&1<<r))},hg.signExpBits=function(i){return i>>52},hg.zeroLowerBits=function(i,r){return i&~((1<<r)-1)},hg.numCommonMostSigMantissaBits=function(i,r){for(var n=0,o=52;o>=0;o--){if(hg.getBit(i,o)!==hg.getBit(r,o))return n;n++}return 52};var hy=function(){this._commonCoord=null,this._ccFilter=new hv},h_={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};hy.prototype.addCommonBits=function(i){var r=new hx(this._commonCoord);i.apply(r),i.geometryChanged()},hy.prototype.removeCommonBits=function(i){if(0===this._commonCoord.x&&0===this._commonCoord.y)return i;var r=new su(this._commonCoord);r.x=-r.x,r.y=-r.y;var n=new hx(r);return i.apply(n),i.geometryChanged(),i},hy.prototype.getCommonCoordinate=function(){return this._commonCoord},hy.prototype.add=function(i){i.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},hy.prototype.interfaces_=function(){return[]},hy.prototype.getClass=function(){return hy},h_.CommonCoordinateFilter.get=function(){return hv},h_.Translater.get=function(){return hx},Object.defineProperties(hy,h_);var hv=function(){this._commonBitsX=new hg,this._commonBitsY=new hg};hv.prototype.filter=function(i){this._commonBitsX.add(i.x),this._commonBitsY.add(i.y)},hv.prototype.getCommonCoordinate=function(){return new su(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},hv.prototype.interfaces_=function(){return[sJ]},hv.prototype.getClass=function(){return hv};var hx=function(){this.trans=null;var i=arguments[0];this.trans=i};hx.prototype.filter=function(i,r){var n=i.getOrdinate(r,0)+this.trans.x,o=i.getOrdinate(r,1)+this.trans.y;i.setOrdinate(r,0,n),i.setOrdinate(r,1,o)},hx.prototype.isDone=function(){return!1},hx.prototype.isGeometryChanged=function(){return!0},hx.prototype.interfaces_=function(){return[aT]},hx.prototype.getClass=function(){return hx};var hb=function(i,r){this._geom=[,,].fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=i,this._geom[1]=r,this.computeSnapTolerance()};hb.prototype.selfSnap=function(i){return new hf(i).snapTo(i,this._snapTolerance)},hb.prototype.removeCommonBits=function(i){this._cbr=new hy,this._cbr.add(i[0]),this._cbr.add(i[1]);var r=[,,].fill(null);return r[0]=this._cbr.removeCommonBits(i[0].copy()),r[1]=this._cbr.removeCommonBits(i[1].copy()),r},hb.prototype.prepareResult=function(i){return this._cbr.addCommonBits(i),i},hb.prototype.getResultGeometry=function(i){var r=this.snap(this._geom),n=hq.overlayOp(r[0],r[1],i);return this.prepareResult(n)},hb.prototype.checkValid=function(i){i.isValid()||sP.out.println("Snapped geometry is invalid")},hb.prototype.computeSnapTolerance=function(){this._snapTolerance=hf.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},hb.prototype.snap=function(i){var r=this.removeCommonBits(i);return hf.snap(r[0],r[1],this._snapTolerance)},hb.prototype.interfaces_=function(){return[]},hb.prototype.getClass=function(){return hb},hb.overlayOp=function(i,r,n){return new hb(i,r).getResultGeometry(n)},hb.union=function(i,r){return hb.overlayOp(i,r,hq.UNION)},hb.intersection=function(i,r){return hb.overlayOp(i,r,hq.INTERSECTION)},hb.symDifference=function(i,r){return hb.overlayOp(i,r,hq.SYMDIFFERENCE)},hb.difference=function(i,r){return hb.overlayOp(i,r,hq.DIFFERENCE)};var hw=function(i,r){this._geom=[,,].fill(null),this._geom[0]=i,this._geom[1]=r};hw.prototype.getResultGeometry=function(i){var r=null,n=!1,o=null;try{r=hq.overlayOp(this._geom[0],this._geom[1],i),n=!0}catch(i){if(!(i instanceof sF))throw i;o=i}if(!n)try{r=hb.overlayOp(this._geom[0],this._geom[1],i)}catch(i){throw i instanceof sF?o:i}return r},hw.prototype.interfaces_=function(){return[]},hw.prototype.getClass=function(){return hw},hw.overlayOp=function(i,r,n){return new hw(i,r).getResultGeometry(n)},hw.union=function(i,r){return hw.overlayOp(i,r,hq.UNION)},hw.intersection=function(i,r){return hw.overlayOp(i,r,hq.INTERSECTION)},hw.symDifference=function(i,r){return hw.overlayOp(i,r,hq.SYMDIFFERENCE)},hw.difference=function(i,r){return hw.overlayOp(i,r,hq.DIFFERENCE)};var hE=function(){this.mce=null,this.chainIndex=null;var i=arguments[0],r=arguments[1];this.mce=i,this.chainIndex=r};hE.prototype.computeIntersections=function(i,r){this.mce.computeIntersectsForChain(this.chainIndex,i.mce,i.chainIndex,r)},hE.prototype.interfaces_=function(){return[]},hE.prototype.getClass=function(){return hE};var hI=function i(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2==arguments.length){var r=arguments[0],n=arguments[1];this._eventType=i.DELETE,this._xValue=r,this._insertEvent=n}else if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this._eventType=i.INSERT,this._label=o,this._xValue=s,this._obj=a}},hS={INSERT:{configurable:!0},DELETE:{configurable:!0}};hI.prototype.isDelete=function(){return this._eventType===hI.DELETE},hI.prototype.setDeleteEventIndex=function(i){this._deleteEventIndex=i},hI.prototype.getObject=function(){return this._obj},hI.prototype.compareTo=function(i){return this._xValue<i._xValue?-1:this._xValue>i._xValue?1:this._eventType<i._eventType?-1:+(this._eventType>i._eventType)},hI.prototype.getInsertEvent=function(){return this._insertEvent},hI.prototype.isInsert=function(){return this._eventType===hI.INSERT},hI.prototype.isSameLabel=function(i){return null!==this._label&&this._label===i._label},hI.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},hI.prototype.interfaces_=function(){return[so]},hI.prototype.getClass=function(){return hI},hS.INSERT.get=function(){return 1},hS.DELETE.get=function(){return 2},Object.defineProperties(hI,hS);var hM=function(){};hM.prototype.interfaces_=function(){return[]},hM.prototype.getClass=function(){return hM};var hT=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var i=arguments[0],r=arguments[1],n=arguments[2];this._li=i,this._includeProper=r,this._recordIsolated=n};hT.prototype.isTrivialIntersection=function(i,r,n,o){if(i===n&&1===this._li.getIntersectionNum()){if(hT.isAdjacentSegments(r,o))return!0;if(i.isClosed()){var s=i.getNumPoints()-1;if(0===r&&o===s||0===o&&r===s)return!0}}return!1},hT.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},hT.prototype.setIsDoneIfProperInt=function(i){this._isDoneWhenProperInt=i},hT.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},hT.prototype.isBoundaryPointInternal=function(i,r){for(var n=r.iterator();n.hasNext();){var o=n.next().getCoordinate();if(i.isIntersection(o))return!0}return!1},hT.prototype.hasProperIntersection=function(){return this._hasProper},hT.prototype.hasIntersection=function(){return this._hasIntersection},hT.prototype.isDone=function(){return this._isDone},hT.prototype.isBoundaryPoint=function(i,r){return null!==r&&(!!this.isBoundaryPointInternal(i,r[0])||!!this.isBoundaryPointInternal(i,r[1]))},hT.prototype.setBoundaryNodes=function(i,r){this._bdyNodes=[,,].fill(null),this._bdyNodes[0]=i,this._bdyNodes[1]=r},hT.prototype.addIntersections=function(i,r,n,o){if(i===n&&r===o)return null;this.numTests++;var s=i.getCoordinates()[r],a=i.getCoordinates()[r+1],l=n.getCoordinates()[o],u=n.getCoordinates()[o+1];this._li.computeIntersection(s,a,l,u),this._li.hasIntersection()&&(this._recordIsolated&&(i.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(i,r,n,o)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(i.addIntersections(this._li,r,0),n.addIntersections(this._li,o,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},hT.prototype.interfaces_=function(){return[]},hT.prototype.getClass=function(){return hT},hT.isAdjacentSegments=function(i,r){return 1===Math.abs(i-r)};var hC=function(i){function r(){i.call(this),this.events=new at,this.nOverlaps=null}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.prepareEvents=function(){lz.sort(this.events);for(var i=0;i<this.events.size();i++){var r=this.events.get(i);r.isDelete()&&r.getInsertEvent().setDeleteEventIndex(i)}},r.prototype.computeIntersections=function(){if(1==arguments.length){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var n=this.events.get(r);if(n.isInsert()&&this.processOverlaps(r,n.getDeleteEventIndex(),n,i),i.isDone())break}}else if(3==arguments.length){if(arguments[2]instanceof hT&&sm(arguments[0],s9)&&sm(arguments[1],s9)){var o=arguments[0],s=arguments[1],a=arguments[2];this.addEdges(o,o),this.addEdges(s,s),this.computeIntersections(a)}else if("boolean"==typeof arguments[2]&&sm(arguments[0],s9)&&arguments[1]instanceof hT){var l=arguments[0],u=arguments[1],h=arguments[2];h?this.addEdges(l,null):this.addEdges(l),this.computeIntersections(u)}}},r.prototype.addEdge=function(i,r){for(var n=i.getMonotoneChainEdge(),o=n.getStartIndexes(),s=0;s<o.length-1;s++){var a=new hE(n,s),l=new hI(r,n.getMinX(s),a);this.events.add(l),this.events.add(new hI(n.getMaxX(s),l))}},r.prototype.processOverlaps=function(i,r,n,o){for(var s=n.getObject(),a=i;a<r;a++){var l=this.events.get(a);if(l.isInsert()){var u=l.getObject();n.isSameLabel(l)||(s.computeIntersections(u,o),this.nOverlaps++)}}},r.prototype.addEdges=function(){if(1==arguments.length)for(var i=arguments[0],r=i.iterator();r.hasNext();){var n=r.next();this.addEdge(n,n)}else if(2==arguments.length)for(var o=arguments[0],s=arguments[1],a=o.iterator();a.hasNext();){var l=a.next();this.addEdge(l,s)}},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(hM),hP=function(){this._min=sr.POSITIVE_INFINITY,this._max=sr.NEGATIVE_INFINITY},hA={NodeComparator:{configurable:!0}};hP.prototype.getMin=function(){return this._min},hP.prototype.intersects=function(i,r){return!(this._min>r||this._max<i)},hP.prototype.getMax=function(){return this._max},hP.prototype.toString=function(){return sz.toLineString(new su(this._min,0),new su(this._max,0))},hP.prototype.interfaces_=function(){return[]},hP.prototype.getClass=function(){return hP},hA.NodeComparator.get=function(){return hL},Object.defineProperties(hP,hA);var hL=function(){};hL.prototype.compare=function(i,r){var n=(i._min+i._max)/2,o=(r._min+r._max)/2;return n<o?-1:+(n>o)},hL.prototype.interfaces_=function(){return[sa]},hL.prototype.getClass=function(){return hL};var hk=function(i){function r(){i.call(this),this._item=null;var r=arguments[0],n=arguments[1],o=arguments[2];this._min=r,this._max=n,this._item=o}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.query=function(i,r,n){if(!this.intersects(i,r))return null;n.visitItem(this._item)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(hP),hR=function(i){function r(){i.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.buildExtent=function(i,r){this._min=Math.min(i._min,r._min),this._max=Math.max(i._max,r._max)},r.prototype.query=function(i,r,n){if(!this.intersects(i,r))return null;null!==this._node1&&this._node1.query(i,r,n),null!==this._node2&&this._node2.query(i,r,n)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(hP),hD=function(){this._leaves=new at,this._root=null,this._level=0};hD.prototype.buildTree=function(){lz.sort(this._leaves,new hP.NodeComparator);for(var i=this._leaves,r=null,n=new at;;){if(this.buildLevel(i,n),1===n.size())return n.get(0);r=i,i=n,n=r}},hD.prototype.insert=function(i,r,n){if(null!==this._root)throw Error("Index cannot be added to once it has been queried");this._leaves.add(new hk(i,r,n))},hD.prototype.query=function(i,r,n){this.init(),this._root.query(i,r,n)},hD.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},hD.prototype.printNode=function(i){sP.out.println(sz.toLineString(new su(i._min,this._level),new su(i._max,this._level)))},hD.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},hD.prototype.buildLevel=function(i,r){this._level++,r.clear();for(var n=0;n<i.size();n+=2){var o=i.get(n);if(null===(n+1<i.size()?i.get(n):null))r.add(o);else{var s=new hR(i.get(n),i.get(n+1));r.add(s)}}},hD.prototype.interfaces_=function(){return[]},hD.prototype.getClass=function(){return hD};var hN=function(){this._items=new at};hN.prototype.visitItem=function(i){this._items.add(i)},hN.prototype.getItems=function(){return this._items},hN.prototype.interfaces_=function(){return[lR]},hN.prototype.getClass=function(){return hN};var hO=function(){this._index=null;var i=arguments[0];if(!sm(i,aj))throw new si("Argument must be Polygonal");this._index=new hB(i)},hz={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};hO.prototype.locate=function(i){var r=new sZ(i),n=new hF(r);return this._index.query(i.y,i.y,n),r.getLocation()},hO.prototype.interfaces_=function(){return[uf]},hO.prototype.getClass=function(){return hO},hz.SegmentVisitor.get=function(){return hF},hz.IntervalIndexedGeometry.get=function(){return hB},Object.defineProperties(hO,hz);var hF=function(){this._counter=null;var i=arguments[0];this._counter=i};hF.prototype.visitItem=function(i){this._counter.countSegment(i.getCoordinate(0),i.getCoordinate(1))},hF.prototype.interfaces_=function(){return[lR]},hF.prototype.getClass=function(){return hF};var hB=function(){this._index=new hD;var i=arguments[0];this.init(i)};hB.prototype.init=function(i){for(var r=uK.getLines(i).iterator();r.hasNext();){var n=r.next().getCoordinates();this.addLine(n)}},hB.prototype.addLine=function(i){for(var r=1;r<i.length;r++){var n=new lJ(i[r-1],i[r]),o=Math.min(n.p0.y,n.p1.y),s=Math.max(n.p0.y,n.p1.y);this._index.insert(o,s,n)}},hB.prototype.query=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1],n=new hN;return this._index.query(i,r,n),n.getItems()}if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this._index.query(o,s,a)}},hB.prototype.interfaces_=function(){return[]},hB.prototype.getClass=function(){return hB};var hU=function(i){function r(){if(i.call(this),this._parentGeom=null,this._lineEdgeMap=new a5,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new uJ,2==arguments.length){var r=arguments[0],n=arguments[1],o=sQ.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=o,null!==n&&this.add(n)}else if(3==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2];this._argIndex=s,this._parentGeom=a,this._boundaryNodeRule=l,null!==a&&this.add(a)}}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.insertBoundaryPoint=function(i,n){var o=this._nodes.addNode(n).getLabel(),s=1;o.getLocation(i,la.ON)===sf.BOUNDARY&&s++;var a=r.determineBoundary(this._boundaryNodeRule,s);o.setLocation(i,a)},r.prototype.computeSelfNodes=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1];return this.computeSelfNodes(i,r,!1)}if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=new hT(n,!0,!1);a.setIsDoneIfProperInt(s);var l=this.createEdgeSetIntersector(),u=this._parentGeom instanceof a$||this._parentGeom instanceof aZ||this._parentGeom instanceof aW;return l.computeIntersections(this._edges,a,o||!u),this.addSelfIntersectionNodes(this._argIndex),a}},r.prototype.computeSplitEdges=function(i){for(var r=this._edges.iterator();r.hasNext();)r.next().eiList.addSplitEdges(i)},r.prototype.computeEdgeIntersections=function(i,r,n){var o=new hT(r,n,!0);return o.setBoundaryNodes(this.getBoundaryNodes(),i.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,i._edges,o),o},r.prototype.getGeometry=function(){return this._parentGeom},r.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},r.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},r.prototype.addPoint=function(){if(arguments[0]instanceof aq){var i=arguments[0],r=i.getCoordinate();this.insertPoint(this._argIndex,r,sf.INTERIOR)}else if(arguments[0]instanceof su){var n=arguments[0];this.insertPoint(this._argIndex,n,sf.INTERIOR)}},r.prototype.addPolygon=function(i){this.addPolygonRing(i.getExteriorRing(),sf.EXTERIOR,sf.INTERIOR);for(var r=0;r<i.getNumInteriorRing();r++){var n=i.getInteriorRingN(r);this.addPolygonRing(n,sf.INTERIOR,sf.EXTERIOR)}},r.prototype.addEdge=function(i){this.insertEdge(i);var r=i.getCoordinates();this.insertPoint(this._argIndex,r[0],sf.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],sf.BOUNDARY)},r.prototype.addLineString=function(i){var r=ar.removeRepeatedPoints(i.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var n=new uP(r,new lg(this._argIndex,sf.INTERIOR));this._lineEdgeMap.put(i,n),this.insertEdge(n),sU.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},r.prototype.getInvalidPoint=function(){return this._invalidPoint},r.prototype.getBoundaryPoints=function(){for(var i=this.getBoundaryNodes(),r=Array(i.size()).fill(null),n=0,o=i.iterator();o.hasNext();){var s=o.next();r[n++]=s.getCoordinate().copy()}return r},r.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},r.prototype.addSelfIntersectionNode=function(i,r,n){if(this.isBoundaryNode(i,r))return null;n===sf.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(i,r):this.insertPoint(i,r,n)},r.prototype.addPolygonRing=function(i,r,n){if(i.isEmpty())return null;var o=ar.removeRepeatedPoints(i.getCoordinates());if(o.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=o[0],null;var s=r,a=n;sX.isCCW(o)&&(s=n,a=r);var l=new uP(o,new lg(this._argIndex,sf.BOUNDARY,s,a));this._lineEdgeMap.put(i,l),this.insertEdge(l),this.insertPoint(this._argIndex,o[0],sf.BOUNDARY)},r.prototype.insertPoint=function(i,r,n){var o=this._nodes.addNode(r),s=o.getLabel();null===s?o._label=new lg(i,n):s.setLocation(i,n)},r.prototype.createEdgeSetIntersector=function(){return new hC},r.prototype.addSelfIntersectionNodes=function(i){for(var r=this._edges.iterator();r.hasNext();)for(var n=r.next(),o=n.getLabel().getLocation(i),s=n.eiList.iterator();s.hasNext();){var a=s.next();this.addSelfIntersectionNode(i,a.coord,o)}},r.prototype.add=function(){if(1!=arguments.length)return i.prototype.add.apply(this,arguments);var r=arguments[0];if(r.isEmpty())return null;if(r instanceof aW&&(this._useBoundaryDeterminationRule=!1),r instanceof aZ)this.addPolygon(r);else if(r instanceof aG)this.addLineString(r);else if(r instanceof aq)this.addPoint(r);else if(r instanceof aX)this.addCollection(r);else if(r instanceof aP)this.addCollection(r);else if(r instanceof aW)this.addCollection(r);else{if(!(r instanceof aC))throw Error(r.getClass().getName());this.addCollection(r)}},r.prototype.addCollection=function(i){for(var r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.add(n)}},r.prototype.locate=function(i){return sm(this._parentGeom,aj)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new hO(this._parentGeom)),this._areaPtLocator.locate(i)):this._ptLocator.locate(i,this._parentGeom)},r.prototype.findEdge=function(){if(1==arguments.length){var r=arguments[0];return this._lineEdgeMap.get(r)}return i.prototype.findEdge.apply(this,arguments)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.determineBoundary=function(i,r){return i.isInBoundary(r)?sf.BOUNDARY:sf.INTERIOR},r}(lC),hG=function(){if(this._li=new sq,this._resultPrecisionModel=null,this._arg=null,1==arguments.length){var i=arguments[0];this.setComputationPrecision(i.getPrecisionModel()),this._arg=[,].fill(null),this._arg[0]=new hU(0,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1],o=sQ.OGC_SFS_BOUNDARY_RULE;r.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=[,,].fill(null),this._arg[0]=new hU(0,r,o),this._arg[1]=new hU(1,n,o)}else if(3==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2];s.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=[,,].fill(null),this._arg[0]=new hU(0,s,l),this._arg[1]=new hU(1,a,l)}};hG.prototype.getArgGeometry=function(i){return this._arg[i].getGeometry()},hG.prototype.setComputationPrecision=function(i){this._resultPrecisionModel=i,this._li.setPrecisionModel(this._resultPrecisionModel)},hG.prototype.interfaces_=function(){return[]},hG.prototype.getClass=function(){return hG};var hV=function(){};hV.prototype.interfaces_=function(){return[]},hV.prototype.getClass=function(){return hV},hV.map=function(){if(arguments[0]instanceof sH&&sm(arguments[1],hV.MapOp)){for(var i=arguments[0],r=arguments[1],n=new at,o=0;o<i.getNumGeometries();o++){var s=r.map(i.getGeometryN(o));null!==s&&n.add(s)}return i.getFactory().buildGeometry(n)}if(sm(arguments[0],s4)&&sm(arguments[1],hV.MapOp)){for(var a=arguments[0],l=arguments[1],u=new at,h=a.iterator();h.hasNext();){var c=h.next(),p=l.map(c);null!==p&&u.add(p)}return u}},hV.MapOp=function(){};var hq=function(i){function r(){var r=arguments[0],n=arguments[1];i.call(this,r,n),this._ptLocator=new uJ,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new ux,this._resultPolyList=new at,this._resultLineList=new at,this._resultPointList=new at,this._graph=new lC(new u_),this._geomFact=r.getFactory()}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.insertUniqueEdge=function(i){var r=this._edgeList.findEqualEdge(i);if(null!==r){var n=r.getLabel(),o=i.getLabel();r.isPointwiseEqual(i)||(o=new lg(i.getLabel())).flip();var s=r.getDepth();s.isNull()&&s.add(n),s.add(o),n.merge(o)}else this._edgeList.add(i)},r.prototype.getGraph=function(){return this._graph},r.prototype.cancelDuplicateResultEdges=function(){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var r=i.next(),n=r.getSym();r.isInResult()&&n.isInResult()&&(r.setInResult(!1),n.setInResult(!1))}},r.prototype.isCoveredByLA=function(i){return!!this.isCovered(i,this._resultLineList)||!!this.isCovered(i,this._resultPolyList)},r.prototype.computeGeometry=function(i,n,o,s){var a=new at;return a.addAll(i),a.addAll(n),a.addAll(o),a.isEmpty()?r.createEmptyResult(s,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(a)},r.prototype.mergeSymLabels=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();)i.next().getEdges().mergeSymLabels()},r.prototype.isCovered=function(i,r){for(var n=r.iterator();n.hasNext();){var o=n.next();if(this._ptLocator.locate(i,o)!==sf.EXTERIOR)return!0}return!1},r.prototype.replaceCollapsedEdges=function(){for(var i=new at,r=this._edgeList.iterator();r.hasNext();){var n=r.next();n.isCollapsed()&&(r.remove(),i.add(n.getCollapsedEdge()))}this._edgeList.addAll(i)},r.prototype.updateNodeLabelling=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next(),n=r.getEdges().getLabel();r.getLabel().merge(n)}},r.prototype.getResultGeometry=function(i){return this.computeOverlay(i),this._resultGeom},r.prototype.insertUniqueEdges=function(i){for(var r=i.iterator();r.hasNext();){var n=r.next();this.insertUniqueEdge(n)}},r.prototype.computeOverlay=function(i){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new at;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ha.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(i),this.cancelDuplicateResultEdges();var n=new lP(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var o=new hu(this,this._geomFact,this._ptLocator);this._resultLineList=o.build(i);var s=new hh(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(i),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,i)},r.prototype.labelIncompleteNode=function(i,r){var n=this._ptLocator.locate(i.getCoordinate(),this._arg[r].getGeometry());i.getLabel().setLocation(r,n)},r.prototype.copyPoints=function(i){for(var r=this._arg[i].getNodeIterator();r.hasNext();){var n=r.next();this._graph.addNode(n.getCoordinate()).setLabel(i,n.getLabel().getLocation(i))}},r.prototype.findResultAreaEdges=function(i){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var o=n.next(),s=o.getLabel();s.isArea()&&!o.isInteriorAreaEdge()&&r.isResultOfOp(s.getLocation(0,la.RIGHT),s.getLocation(1,la.RIGHT),i)&&o.setInResult(!0)}},r.prototype.computeLabelsFromDepths=function(){for(var i=this._edgeList.iterator();i.hasNext();){var r=i.next(),n=r.getLabel(),o=r.getDepth();if(!o.isNull()){o.normalize();for(var s=0;s<2;s++)n.isNull(s)||!n.isArea()||o.isNull(s)||(0===o.getDelta(s)?n.toLine(s):(sU.isTrue(!o.isNull(s,la.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(s,la.LEFT,o.getLocation(s,la.LEFT)),sU.isTrue(!o.isNull(s,la.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(s,la.RIGHT,o.getLocation(s,la.RIGHT))))}}},r.prototype.computeLabelling=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();)i.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},r.prototype.labelIncompleteNodes=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next(),n=r.getLabel();r.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(r,0):this.labelIncompleteNode(r,1)),r.getEdges().updateLabelling(n)}},r.prototype.isCoveredByA=function(i){return!!this.isCovered(i,this._resultPolyList)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(hG);hq.overlayOp=function(i,r,n){return new hq(i,r).getResultGeometry(n)},hq.intersection=function(i,r){return i.isEmpty()||r.isEmpty()?hq.createEmptyResult(hq.INTERSECTION,i,r,i.getFactory()):i.isGeometryCollection()?hl.map(i,{interfaces_:function(){return[hV.MapOp]},map:function(i){return i.intersection(r)}}):(i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(r),hw.overlayOp(i,r,hq.INTERSECTION))},hq.symDifference=function(i,r){if(i.isEmpty()||r.isEmpty()){if(i.isEmpty()&&r.isEmpty())return hq.createEmptyResult(hq.SYMDIFFERENCE,i,r,i.getFactory());if(i.isEmpty())return r.copy();if(r.isEmpty())return i.copy()}return i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(r),hw.overlayOp(i,r,hq.SYMDIFFERENCE)},hq.resultDimension=function(i,r,n){var o=r.getDimension(),s=n.getDimension(),a=-1;switch(i){case hq.INTERSECTION:a=Math.min(o,s);break;case hq.UNION:a=Math.max(o,s);break;case hq.DIFFERENCE:a=o;break;case hq.SYMDIFFERENCE:a=Math.max(o,s)}return a},hq.createEmptyResult=function(i,r,n,o){var s=null;switch(hq.resultDimension(i,r,n)){case -1:s=o.createGeometryCollection([].fill(null));break;case 0:s=o.createPoint();break;case 1:s=o.createLineString();break;case 2:s=o.createPolygon()}return s},hq.difference=function(i,r){return i.isEmpty()?hq.createEmptyResult(hq.DIFFERENCE,i,r,i.getFactory()):r.isEmpty()?i.copy():(i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(r),hw.overlayOp(i,r,hq.DIFFERENCE))},hq.isResultOfOp=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1],n=i.getLocation(0),o=i.getLocation(1);return hq.isResultOfOp(n,o,r)}if(3==arguments.length){var s=arguments[0],a=arguments[1],l=arguments[2];switch(s===sf.BOUNDARY&&(s=sf.INTERIOR),a===sf.BOUNDARY&&(a=sf.INTERIOR),l){case hq.INTERSECTION:return s===sf.INTERIOR&&a===sf.INTERIOR;case hq.UNION:return s===sf.INTERIOR||a===sf.INTERIOR;case hq.DIFFERENCE:return s===sf.INTERIOR&&a!==sf.INTERIOR;case hq.SYMDIFFERENCE:return s===sf.INTERIOR&&a!==sf.INTERIOR||s!==sf.INTERIOR&&a===sf.INTERIOR}return!1}},hq.INTERSECTION=1,hq.UNION=2,hq.DIFFERENCE=3,hq.SYMDIFFERENCE=4;var hj=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new uJ,this._seg=new lJ;var i=arguments[0],r=arguments[1];this._g=i,this._boundaryDistanceTolerance=r,this._linework=this.extractLinework(i)};hj.prototype.isWithinToleranceOfBoundary=function(i){for(var r=0;r<this._linework.getNumGeometries();r++)for(var n=this._linework.getGeometryN(r).getCoordinateSequence(),o=0;o<n.size()-1;o++)if(n.getCoordinate(o,this._seg.p0),n.getCoordinate(o+1,this._seg.p1),this._seg.distance(i)<=this._boundaryDistanceTolerance)return!0;return!1},hj.prototype.getLocation=function(i){return this.isWithinToleranceOfBoundary(i)?sf.BOUNDARY:this._ptLocator.locate(i,this._g)},hj.prototype.extractLinework=function(i){var r=new hZ;i.apply(r);var n=r.getLinework(),o=a7.toLineStringArray(n);return i.getFactory().createMultiLineString(o)},hj.prototype.interfaces_=function(){return[]},hj.prototype.getClass=function(){return hj};var hZ=function(){this._linework=null,this._linework=new at};hZ.prototype.getLinework=function(){return this._linework},hZ.prototype.filter=function(i){if(i instanceof aZ){this._linework.add(i.getExteriorRing());for(var r=0;r<i.getNumInteriorRing();r++)this._linework.add(i.getInteriorRingN(r))}},hZ.prototype.interfaces_=function(){return[aM]},hZ.prototype.getClass=function(){return hZ};var hX=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var i=arguments[0];this._g=i};hX.prototype.extractPoints=function(i,r,n){for(var o=i.getCoordinates(),s=0;s<o.length-1;s++)this.computeOffsetPoints(o[s],o[s+1],r,n)},hX.prototype.setSidesToGenerate=function(i,r){this._doLeft=i,this._doRight=r},hX.prototype.getPoints=function(i){for(var r=new at,n=uK.getLines(this._g).iterator();n.hasNext();){var o=n.next();this.extractPoints(o,i,r)}return r},hX.prototype.computeOffsetPoints=function(i,r,n,o){var s=r.x-i.x,a=r.y-i.y,l=Math.sqrt(s*s+a*a),u=n*s/l,h=n*a/l,c=(r.x+i.x)/2,p=(r.y+i.y)/2;if(this._doLeft){var f=new su(c-h,p+u);o.add(f)}if(this._doRight){var d=new su(c+h,p-u);o.add(d)}},hX.prototype.interfaces_=function(){return[]},hX.prototype.getClass=function(){return hX};var h$=function i(){this._geom=null,this._locFinder=null,this._location=[,,,].fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=i.TOLERANCE,this._testCoords=new at;var r=arguments[0],n=arguments[1],o=arguments[2];this._boundaryDistanceTolerance=i.computeBoundaryDistanceTolerance(r,n),this._geom=[r,n,o],this._locFinder=[new hj(this._geom[0],this._boundaryDistanceTolerance),new hj(this._geom[1],this._boundaryDistanceTolerance),new hj(this._geom[2],this._boundaryDistanceTolerance)]},hW={TOLERANCE:{configurable:!0}};h$.prototype.reportResult=function(i,r,n){sP.out.println("Overlay result invalid - A:"+sf.toLocationSymbol(r[0])+" B:"+sf.toLocationSymbol(r[1])+" expected:"+(n?"i":"e")+" actual:"+sf.toLocationSymbol(r[2]))},h$.prototype.isValid=function(i){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(i)},h$.prototype.checkValid=function(){if(1==arguments.length){for(var i=arguments[0],r=0;r<this._testCoords.size();r++){var n=this._testCoords.get(r);if(!this.checkValid(i,n))return this._invalidLocation=n,!1}return!0}if(2==arguments.length){var o=arguments[0],s=arguments[1];return this._location[0]=this._locFinder[0].getLocation(s),this._location[1]=this._locFinder[1].getLocation(s),this._location[2]=this._locFinder[2].getLocation(s),!!h$.hasLocation(this._location,sf.BOUNDARY)||this.isValidResult(o,this._location)}},h$.prototype.addTestPts=function(i){var r=new hX(i);this._testCoords.addAll(r.getPoints(5*this._boundaryDistanceTolerance))},h$.prototype.isValidResult=function(i,r){var n=hq.isResultOfOp(r[0],r[1],i),o=!(n^r[2]===sf.INTERIOR);return o||this.reportResult(i,r,n),o},h$.prototype.getInvalidLocation=function(){return this._invalidLocation},h$.prototype.interfaces_=function(){return[]},h$.prototype.getClass=function(){return h$},h$.hasLocation=function(i,r){for(var n=0;n<3;n++)if(i[n]===r)return!0;return!1},h$.computeBoundaryDistanceTolerance=function(i,r){return Math.min(hf.computeSizeBasedSnapTolerance(i),hf.computeSizeBasedSnapTolerance(r))},h$.isValid=function(i,r,n,o){return new h$(i,r,o).isValid(n)},hW.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(h$,hW);var hH=function i(r){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=i.extractFactory(r),this._inputGeoms=r};hH.prototype.extractElements=function(i,r){if(null===i)return null;for(var n=0;n<i.getNumGeometries();n++){var o=i.getGeometryN(n);this._skipEmpty&&o.isEmpty()||r.add(o)}},hH.prototype.combine=function(){for(var i=new at,r=this._inputGeoms.iterator();r.hasNext();){var n=r.next();this.extractElements(n,i)}return 0===i.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(i)},hH.prototype.interfaces_=function(){return[]},hH.prototype.getClass=function(){return hH},hH.combine=function(){if(1==arguments.length){var i=arguments[0];return new hH(i).combine()}if(2==arguments.length){var r=arguments[0],n=arguments[1];return new hH(hH.createList(r,n)).combine()}if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];return new hH(hH.createList(o,s,a)).combine()}},hH.extractFactory=function(i){return i.isEmpty()?null:i.iterator().next().getFactory()},hH.createList=function(){if(2==arguments.length){var i=arguments[0],r=arguments[1],n=new at;return n.add(i),n.add(r),n}if(3==arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=new at;return l.add(o),l.add(s),l.add(a),l}};var hY=function(){this._inputPolys=null,this._geomFactory=null;var i=arguments[0];this._inputPolys=i,null===this._inputPolys&&(this._inputPolys=new at)},hK={STRTREE_NODE_CAPACITY:{configurable:!0}};hY.prototype.reduceToGeometries=function(i){for(var r=new at,n=i.iterator();n.hasNext();){var o=n.next(),s=null;sm(o,s9)?s=this.unionTree(o):o instanceof sH&&(s=o),r.add(s)}return r},hY.prototype.extractByEnvelope=function(i,r,n){for(var o=new at,s=0;s<r.getNumGeometries();s++){var a=r.getGeometryN(s);a.getEnvelopeInternal().intersects(i)?o.add(a):n.add(a)}return this._geomFactory.buildGeometry(o)},hY.prototype.unionOptimized=function(i,r){var n=i.getEnvelopeInternal(),o=r.getEnvelopeInternal();if(!n.intersects(o))return hH.combine(i,r);if(1>=i.getNumGeometries()&&1>=r.getNumGeometries())return this.unionActual(i,r);var s=n.intersection(o);return this.unionUsingEnvelopeIntersection(i,r,s)},hY.prototype.union=function(){if(null===this._inputPolys)throw Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var i=new lq(hY.STRTREE_NODE_CAPACITY),r=this._inputPolys.iterator();r.hasNext();){var n=r.next();i.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var o=i.itemsTree();return this.unionTree(o)},hY.prototype.binaryUnion=function(){if(1==arguments.length){var i=arguments[0];return this.binaryUnion(i,0,i.size())}if(3==arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];if(o-n<=1){var s=hY.getGeometry(r,n);return this.unionSafe(s,null)}if(o-n==2)return this.unionSafe(hY.getGeometry(r,n),hY.getGeometry(r,n+1));var a=Math.trunc((o+n)/2),l=this.binaryUnion(r,n,a),u=this.binaryUnion(r,a,o);return this.unionSafe(l,u)}},hY.prototype.repeatedUnion=function(i){for(var r=null,n=i.iterator();n.hasNext();){var o=n.next();r=null===r?o.copy():r.union(o)}return r},hY.prototype.unionSafe=function(i,r){return null===i&&null===r?null:null===i?r.copy():null===r?i.copy():this.unionOptimized(i,r)},hY.prototype.unionActual=function(i,r){return hY.restrictToPolygons(i.union(r))},hY.prototype.unionTree=function(i){var r=this.reduceToGeometries(i);return this.binaryUnion(r)},hY.prototype.unionUsingEnvelopeIntersection=function(i,r,n){var o=new at,s=this.extractByEnvelope(n,i,o),a=this.extractByEnvelope(n,r,o),l=this.unionActual(s,a);return o.add(l),hH.combine(o)},hY.prototype.bufferUnion=function(){if(1==arguments.length){var i=arguments[0];return i.get(0).getFactory().buildGeometry(i).buffer(0)}if(2==arguments.length){var r=arguments[0],n=arguments[1];return r.getFactory().createGeometryCollection([r,n]).buffer(0)}},hY.prototype.interfaces_=function(){return[]},hY.prototype.getClass=function(){return hY},hY.restrictToPolygons=function(i){if(sm(i,aj))return i;var r=uY.getPolygons(i);return 1===r.size()?r.get(0):i.getFactory().createMultiPolygon(a7.toPolygonArray(r))},hY.getGeometry=function(i,r){return r>=i.size()?null:i.get(r)},hY.union=function(i){return new hY(i).union()},hK.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(hY,hK);var hJ=function(){};function hQ(){return new h0}function h0(){this.reset()}hJ.prototype.interfaces_=function(){return[]},hJ.prototype.getClass=function(){return hJ},hJ.union=function(i,r){if(i.isEmpty()||r.isEmpty()){if(i.isEmpty()&&r.isEmpty())return hq.createEmptyResult(hq.UNION,i,r,i.getFactory());if(i.isEmpty())return r.copy();if(r.isEmpty())return i.copy()}return i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(r),hw.overlayOp(i,r,hq.UNION)},h0.prototype={constructor:h0,reset:function(){this.s=this.t=0},add:function(i){h2(h1,i,this.t),h2(this,h1.s,this.s),this.s?this.t+=h1.t:this.s=h1.t},valueOf:function(){return this.s}};var h1=new h0;function h2(i,r,n){var o=i.s=r+n,s=o-r;i.t=r-(o-s)+(n-s)}var h3=Math.PI,h5=h3/2,h4=h3/4,h6=2*h3,h8=180/h3,h9=h3/180,h7=Math.abs,ct=Math.atan,ce=Math.atan2,ci=Math.cos,cr=Math.sin,cn=Math.sqrt;function co(i){return i>1?0:i<-1?h3:Math.acos(i)}function cs(i){return i>1?h5:i<-1?-h5:Math.asin(i)}function ca(){}function cl(i,r){i&&ch.hasOwnProperty(i.type)&&ch[i.type](i,r)}var cu={Feature:function(i,r){cl(i.geometry,r)},FeatureCollection:function(i,r){for(var n=i.features,o=-1,s=n.length;++o<s;)cl(n[o].geometry,r)}},ch={Sphere:function(i,r){r.sphere()},Point:function(i,r){i=i.coordinates,r.point(i[0],i[1],i[2])},MultiPoint:function(i,r){for(var n=i.coordinates,o=-1,s=n.length;++o<s;)i=n[o],r.point(i[0],i[1],i[2])},LineString:function(i,r){cc(i.coordinates,r,0)},MultiLineString:function(i,r){for(var n=i.coordinates,o=-1,s=n.length;++o<s;)cc(n[o],r,0)},Polygon:function(i,r){cp(i.coordinates,r)},MultiPolygon:function(i,r){for(var n=i.coordinates,o=-1,s=n.length;++o<s;)cp(n[o],r)},GeometryCollection:function(i,r){for(var n=i.geometries,o=-1,s=n.length;++o<s;)cl(n[o],r)}};function cc(i,r,n){var o,s=-1,a=i.length-n;for(r.lineStart();++s<a;)o=i[s],r.point(o[0],o[1],o[2]);r.lineEnd()}function cp(i,r){var n=-1,o=i.length;for(r.polygonStart();++n<o;)cc(i[n],r,1);r.polygonEnd()}function cf(i){return[ce(i[1],i[0]),cs(i[2])]}function cd(i){var r=i[0],n=i[1],o=ci(n);return[o*ci(r),o*cr(r),cr(n)]}function cm(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]}function cg(i,r){return[i[1]*r[2]-i[2]*r[1],i[2]*r[0]-i[0]*r[2],i[0]*r[1]-i[1]*r[0]]}function cy(i,r){i[0]+=r[0],i[1]+=r[1],i[2]+=r[2]}function c_(i,r){return[i[0]*r,i[1]*r,i[2]*r]}function cv(i){var r=cn(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]/=r,i[1]/=r,i[2]/=r}function cx(i,r){function n(n,o){return r((n=i(n,o))[0],n[1])}return i.invert&&r.invert&&(n.invert=function(n,o){return(n=r.invert(n,o))&&i.invert(n[0],n[1])}),n}function cb(i,r){return[i>h3?i-h6:i<-h3?i+h6:i,r]}function cw(i){return function(r,n){return[(r+=i)>h3?r-h6:r<-h3?r+h6:r,n]}}function cE(i){var r=cw(i);return r.invert=cw(-i),r}function cI(i,r){var n=ci(i),o=cr(i),s=ci(r),a=cr(r);function l(i,r){var l=ci(r),u=ci(i)*l,h=cr(i)*l,c=cr(r),p=c*n+u*o;return[ce(h*s-p*a,u*n-c*o),cs(p*s+h*a)]}return l.invert=function(i,r){var l=ci(r),u=ci(i)*l,h=cr(i)*l,c=cr(r),p=c*s-h*a;return[ce(h*s+c*a,u*n+p*o),cs(p*n-u*o)]},l}function cS(i,r){(r=cd(r))[0]-=i,cv(r);var n=co(-r[1]);return((0>-r[2]?-n:n)+h6-1e-6)%h6}function cM(){var i,r=[];return{point:function(r,n){i.push([r,n])},lineStart:function(){r.push(i=[])},lineEnd:ca,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var n=r;return r=[],i=null,n}}}function cT(i,r){return 1e-6>h7(i[0]-r[0])&&1e-6>h7(i[1]-r[1])}function cC(i,r,n,o){this.x=i,this.z=r,this.o=n,this.e=o,this.v=!1,this.n=this.p=null}function cP(i,r,n,o,s){var a,l,u=[],h=[];if(i.forEach(function(i){if(!((r=i.length-1)<=0)){var r,n,o=i[0],l=i[r];if(cT(o,l)){for(s.lineStart(),a=0;a<r;++a)s.point((o=i[a])[0],o[1]);s.lineEnd()}else u.push(n=new cC(o,i,null,!0)),h.push(n.o=new cC(o,null,n,!1)),u.push(n=new cC(l,i,null,!1)),h.push(n.o=new cC(l,null,n,!0))}}),u.length){for(h.sort(r),cA(u),cA(h),a=0,l=h.length;a<l;++a)h[a].e=n=!n;for(var c,p,f=u[0];;){for(var d=f,m=!0;d.v;)if((d=d.n)===f)return;c=d.z,s.lineStart();do{if(d.v=d.o.v=!0,d.e){if(m)for(a=0,l=c.length;a<l;++a)s.point((p=c[a])[0],p[1]);else o(d.x,d.n.x,1,s);d=d.n}else{if(m)for(a=(c=d.p.z).length-1;a>=0;--a)s.point((p=c[a])[0],p[1]);else o(d.x,d.p.x,-1,s);d=d.p}c=(d=d.o).z,m=!m}while(!d.v)s.lineEnd()}}}function cA(i){if(r=i.length){for(var r,n,o=0,s=i[0];++o<r;)s.n=n=i[o],n.p=s,s=n;s.n=n=i[0],n.p=s}}function cL(i,r){return i<r?-1:i>r?1:i>=r?0:NaN}function ck(i){for(var r,n,o,s=i.length,a=-1,l=0;++a<s;)l+=i[a].length;for(n=Array(l);--s>=0;)for(r=(o=i[s]).length;--r>=0;)n[--l]=o[r];return n}hQ(),hQ(),hQ(),cb.invert=cb,1===(o=cL).length&&(s=o,o=function(i,r){return cL(s(i),r)});var cR=hQ();function cD(i){return i}hQ(),hQ(),hQ();var cN=1/0,cO=1/0,cz=-1/0,cF=cz,cB={point:function(i,r){i<cN&&(cN=i),i>cz&&(cz=i),r<cO&&(cO=r),r>cF&&(cF=r)},lineStart:ca,lineEnd:ca,polygonStart:ca,polygonEnd:ca,result:function(){var i=[[cN,cO],[cz,cF]];return cz=cF=-(cO=cN=1/0),i}};function cU(i,r,n,o){return function(s,a){var l,u,h,c=r(a),p=s.invert(o[0],o[1]),f=cM(),d=r(f),m=!1,g={point:y,lineStart:v,lineEnd:x,polygonStart:function(){g.point=b,g.lineStart=w,g.lineEnd=E,u=[],l=[]},polygonEnd:function(){g.point=y,g.lineStart=v,g.lineEnd=x,u=ck(u);var i=function(i,r){var n=r[0],o=r[1],s=[cr(n),-ci(n),0],a=0,l=0;cR.reset();for(var u=0,h=i.length;u<h;++u)if(p=(c=i[u]).length)for(var c,p,f=c[p-1],d=f[0],m=f[1]/2+h4,g=cr(m),y=ci(m),_=0;_<p;++_,d=x,g=w,y=E,f=v){var v=c[_],x=v[0],b=v[1]/2+h4,w=cr(b),E=ci(b),I=x-d,S=I>=0?1:-1,M=S*I,T=M>h3,C=g*w;if(cR.add(ce(C*S*cr(M),y*E+C*ci(M))),a+=T?I+S*h6:I,T^d>=n^x>=n){var P=cg(cd(f),cd(v));cv(P);var A=cg(s,P);cv(A);var L=(T^I>=0?-1:1)*cs(A[2]);(o>L||o===L&&(P[0]||P[1]))&&(l+=T^I>=0?1:-1)}}return(a<-1e-6||a<1e-6&&cR<-1e-6)^1&l}(l,p);u.length?(m||(a.polygonStart(),m=!0),cP(u,cV,i,n,a)):i&&(m||(a.polygonStart(),m=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),m&&(a.polygonEnd(),m=!1),u=l=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function y(r,n){var o=s(r,n);i(r=o[0],n=o[1])&&a.point(r,n)}function _(i,r){var n=s(i,r);c.point(n[0],n[1])}function v(){g.point=_,c.lineStart()}function x(){g.point=y,c.lineEnd()}function b(i,r){h.push([i,r]);var n=s(i,r);d.point(n[0],n[1])}function w(){d.lineStart(),h=[]}function E(){b(h[0][0],h[0][1]),d.lineEnd();var i,r,n,o,s=d.clean(),c=f.result(),p=c.length;if(h.pop(),l.push(h),h=null,p){if(1&s){if((r=(n=c[0]).length-1)>0){for(m||(a.polygonStart(),m=!0),a.lineStart(),i=0;i<r;++i)a.point((o=n[i])[0],o[1]);a.lineEnd()}}else p>1&&2&s&&c.push(c.pop().concat(c.shift())),u.push(c.filter(cG))}}return g}}function cG(i){return i.length>1}function cV(i,r){return((i=i.x)[0]<0?i[1]-h5-1e-6:h5-i[1])-((r=r.x)[0]<0?r[1]-h5-1e-6:h5-r[1])}hQ();var cq=cU(function(){return!0},function(i){var r,n=NaN,o=NaN,s=NaN;return{lineStart:function(){i.lineStart(),r=1},point:function(a,l){var u,h,c,p,f,d,m=a>0?h3:-h3,g=h7(a-n);1e-6>h7(g-h3)?(i.point(n,o=(o+l)/2>0?h5:-h5),i.point(s,o),i.lineEnd(),i.lineStart(),i.point(m,o),i.point(a,o),r=0):s!==m&&g>=h3&&(1e-6>h7(n-s)&&(n-=1e-6*s),1e-6>h7(a-m)&&(a-=1e-6*m),u=n,h=o,o=h7(d=cr(u-(c=a)))>1e-6?ct((cr(h)*(f=ci(l))*cr(c)-cr(l)*(p=ci(h))*cr(u))/(p*f*d)):(h+l)/2,i.point(s,o),i.lineEnd(),i.lineStart(),i.point(m,o),r=0),i.point(n=a,o=l),s=m},lineEnd:function(){i.lineEnd(),n=o=NaN},clean:function(){return 2-r}}},function(i,r,n,o){var s;if(null==i)s=n*h5,o.point(-h3,s),o.point(0,s),o.point(h3,s),o.point(h3,0),o.point(h3,-s),o.point(0,-s),o.point(-h3,-s),o.point(-h3,0),o.point(-h3,s);else if(h7(i[0]-r[0])>1e-6){var a=i[0]<r[0]?h3:-h3;s=n*a/2,o.point(-a,s),o.point(0,s),o.point(a,s)}else o.point(r[0],r[1])},[-h3,-h5]);function cj(i){return function(r){var n=new cZ;for(var o in i)n[o]=i[o];return n.stream=r,n}}function cZ(){}function cX(i,r,n){var o,s=r[1][0]-r[0][0],a=r[1][1]-r[0][1],l=i.clipExtent&&i.clipExtent();i.scale(150).translate([0,0]),null!=l&&i.clipExtent(null),o=i.stream(cB),n&&cu.hasOwnProperty(n.type)?cu[n.type](n,o):cl(n,o);var u=cB.result(),h=Math.min(s/(u[1][0]-u[0][0]),a/(u[1][1]-u[0][1])),c=+r[0][0]+(s-h*(u[1][0]+u[0][0]))/2,p=+r[0][1]+(a-h*(u[1][1]+u[0][1]))/2;return null!=l&&i.clipExtent(l),i.scale(150*h).translate([c,p])}cZ.prototype={constructor:cZ,point:function(i,r){this.stream.point(i,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var c$=ci(30*h9);function cW(i,r){return+r?function(i,r){function n(o,s,a,l,u,h,c,p,f,d,m,g,y,_){var v=c-o,x=p-s,b=v*v+x*x;if(b>4*r&&y--){var w=l+d,E=u+m,I=h+g,S=cn(w*w+E*E+I*I),M=cs(I/=S),T=1e-6>h7(h7(I)-1)||1e-6>h7(a-f)?(a+f)/2:ce(E,w),C=i(T,M),P=C[0],A=C[1],L=P-o,k=A-s,R=x*L-v*k;(R*R/b>r||h7((v*L+x*k)/b-.5)>.3||l*d+u*m+h*g<c$)&&(n(o,s,a,l,u,h,P,A,T,w/=S,E/=S,I,y,_),_.point(P,A),n(P,A,T,w,E,I,c,p,f,d,m,g,y,_))}}return function(r){var o,s,a,l,u,h,c,p,f,d,m,g,y={point:_,lineStart:v,lineEnd:b,polygonStart:function(){r.polygonStart(),y.lineStart=w},polygonEnd:function(){r.polygonEnd(),y.lineStart=v}};function _(n,o){n=i(n,o),r.point(n[0],n[1])}function v(){p=NaN,y.point=x,r.lineStart()}function x(o,s){var a=cd([o,s]),l=i(o,s);n(p,f,c,d,m,g,p=l[0],f=l[1],c=o,d=a[0],m=a[1],g=a[2],16,r),r.point(p,f)}function b(){y.point=_,r.lineEnd()}function w(){v(),y.point=E,y.lineEnd=I}function E(i,r){x(o=i,r),s=p,a=f,l=d,u=m,h=g,y.point=x}function I(){n(p,f,c,d,m,g,s,a,o,l,u,h,16,r),y.lineEnd=b,b()}return y}}(i,r):cj({point:function(r,n){r=i(r,n),this.stream.point(r[0],r[1])}})}var cH=cj({point:function(i,r){this.stream.point(i*h9,r*h9)}}),cY=(r=function(i){return(i=co(i))&&i/cr(i)},function(i,n){var o=ci(i),s=ci(n),a=r(o*s);return[a*s*cr(i),a*cr(n)]});function cK(i,r,n,o){var s,a,l=i.properties||{},u="Feature"===i.type?i.geometry:i;if("GeometryCollection"===u.type){var c=[];return j(i,function(i){var s=cK(i,r,n,o);s&&c.push(s)}),_(c)}var p=(a=[-(s=eB(u).geometry.coordinates)[0],-s[1]],(function(i){var r,n,o,s,a,l,u,h,c,p,f=150,d=480,m=250,g=0,y=0,_=0,v=0,x=0,b=null,w=cq,E=null,I=cD,S=.5,M=cW(P,.5);function T(i){return[(i=a(i[0]*h9,i[1]*h9))[0]*f+n,o-i[1]*f]}function C(i){return(i=a.invert((i[0]-n)/f,(o-i[1])/f))&&[i[0]*h8,i[1]*h8]}function P(i,s){return[(i=r(i,s))[0]*f+n,o-i[1]*f]}function A(){a=cx((i=_,l=v,u=x,s=(i%=h6)?l||u?cx(cE(i),cI(l,u)):cE(i):l||u?cI(l,u):cb),r);var i,l,u,h=r(g,y);return n=d-h[0]*f,o=m+h[1]*f,L()}function L(){return c=p=null,T}return T.stream=function(i){return c&&p===i?c:c=cH(w(s,M(I(p=i))))},T.clipAngle=function(i){return arguments.length?(w=+i?function(i,r){var n=ci(i),o=n>0,s=h7(n)>1e-6;function a(i,r){return ci(i)*ci(r)>n}function l(i,r,o){var s=[1,0,0],a=cg(cd(i),cd(r)),l=cm(a,a),u=a[0],h=l-u*u;if(!h)return!o&&i;var c=cg(s,a),p=c_(s,n*l/h);cy(p,c_(a,-n*u/h));var f=cm(p,c),d=cm(c,c),m=f*f-d*(cm(p,p)-1);if(!(m<0)){var g=cn(m),y=c_(c,(-f-g)/d);if(cy(y,p),y=cf(y),!o)return y;var _,v=i[0],x=r[0],b=i[1],w=r[1];x<v&&(_=v,v=x,x=_);var E=x-v,I=1e-6>h7(E-h3);if(!I&&w<b&&(_=b,b=w,w=_),I||E<1e-6?I?b+w>0^y[1]<(1e-6>h7(y[0]-v)?b:w):b<=y[1]&&y[1]<=w:E>h3^(v<=y[0]&&y[0]<=x)){var S=c_(c,(-f+g)/d);return cy(S,p),[y,cf(S)]}}}function u(r,n){var s=o?i:h3-i,a=0;return r<-s?a|=1:r>s&&(a|=2),n<-s?a|=4:n>s&&(a|=8),a}return cU(a,function(i){var r,n,h,c,p;return{lineStart:function(){c=h=!1,p=1},point:function(f,d){var m,g,y=[f,d],_=a(f,d),v=o?_?0:u(f,d):_?u(f+(f<0?h3:-h3),d):0;(!r&&(c=h=_)&&i.lineStart(),_!==h&&(!(g=l(r,y))||cT(r,g)||cT(y,g))&&(y[0]+=1e-6,y[1]+=1e-6,_=a(y[0],y[1])),_!==h)?(p=0,_?(i.lineStart(),g=l(y,r),i.point(g[0],g[1])):(g=l(r,y),i.point(g[0],g[1]),i.lineEnd()),r=g):s&&r&&o^_&&!(v&n)&&(m=l(y,r,!0))&&(p=0,o?(i.lineStart(),i.point(m[0][0],m[0][1]),i.point(m[1][0],m[1][1]),i.lineEnd()):(i.point(m[1][0],m[1][1]),i.lineEnd(),i.lineStart(),i.point(m[0][0],m[0][1]))),!_||r&&cT(r,y)||i.point(y[0],y[1]),r=y,h=_,n=v},lineEnd:function(){h&&i.lineEnd(),r=null},clean:function(){return p|(c&&h)<<1}}},function(n,o,s,a){!function(i,r,n,o,s,a){if(n){var l=ci(r),u=cr(r),h=o*n;null==s?(s=r+o*h6,a=r-h/2):(s=cS(l,s),a=cS(l,a),(o>0?s<a:s>a)&&(s+=o*h6));for(var c,p=s;o>0?p>a:p<a;p-=h)c=cf([l,-u*ci(p),-u*cr(p)]),i.point(c[0],c[1])}}(a,i,r,s,n,o)},o?[0,-i]:[-h3,i-h3])}(b=i*h9,6*h9):(b=null,cq),L()):b*h8},T.clipExtent=function(i){return arguments.length?(I=null==i?(E=l=u=h=null,cD):function(i,r,n,o){function s(s,a){return i<=s&&s<=n&&r<=a&&a<=o}function a(s,a,u,c){var p=0,f=0;if(null==s||(p=l(s,u))!==(f=l(a,u))||0>h(s,a)^u>0)do c.point(0===p||3===p?i:n,p>1?o:r);while((p=(p+u+4)%4)!==f)else c.point(a[0],a[1])}function l(o,s){return 1e-6>h7(o[0]-i)?s>0?0:3:1e-6>h7(o[0]-n)?s>0?2:1:1e-6>h7(o[1]-r)?+(s>0):s>0?3:2}function u(i,r){return h(i.x,r.x)}function h(i,r){var n=l(i,1),o=l(r,1);return n!==o?n-o:0===n?r[1]-i[1]:1===n?i[0]-r[0]:2===n?i[1]-r[1]:r[0]-i[0]}return function(l){var h,c,p,f,d,m,g,y,_,v,x,b=l,w=cM(),E={point:I,lineStart:function(){E.point=S,c&&c.push(p=[]),v=!0,_=!1,g=y=NaN},lineEnd:function(){h&&(S(f,d),m&&_&&w.rejoin(),h.push(w.result())),E.point=I,_&&b.lineEnd()},polygonStart:function(){b=w,h=[],c=[],x=!0},polygonEnd:function(){var r=function(){for(var r=0,n=0,s=c.length;n<s;++n)for(var a,l,u=c[n],h=1,p=u.length,f=u[0],d=f[0],m=f[1];h<p;++h)a=d,l=m,d=(f=u[h])[0],m=f[1],l<=o?m>o&&(d-a)*(o-l)>(m-l)*(i-a)&&++r:m<=o&&(d-a)*(o-l)<(m-l)*(i-a)&&--r;return r}(),n=x&&r,s=(h=ck(h)).length;(n||s)&&(l.polygonStart(),n&&(l.lineStart(),a(null,null,1,l),l.lineEnd()),s&&cP(h,u,r,a,l),l.polygonEnd()),b=l,h=c=p=null}};function I(i,r){s(i,r)&&b.point(i,r)}function S(a,l){var u=s(a,l);if(c&&p.push([a,l]),v)f=a,d=l,m=u,v=!1,u&&(b.lineStart(),b.point(a,l));else if(u&&_)b.point(a,l);else{var h=[g=Math.max(-1e9,Math.min(1e9,g)),y=Math.max(-1e9,Math.min(1e9,y))],w=[a=Math.max(-1e9,Math.min(1e9,a)),l=Math.max(-1e9,Math.min(1e9,l))];(function(i,r,n,o,s,a){var l,u=i[0],h=i[1],c=0,p=1,f=r[0]-u,d=r[1]-h;if(l=n-u,f||!(l>0)){if(l/=f,f<0){if(l<c)return;l<p&&(p=l)}else if(f>0){if(l>p)return;l>c&&(c=l)}if(l=s-u,f||!(l<0)){if(l/=f,f<0){if(l>p)return;l>c&&(c=l)}else if(f>0){if(l<c)return;l<p&&(p=l)}if(l=o-h,d||!(l>0)){if(l/=d,d<0){if(l<c)return;l<p&&(p=l)}else if(d>0){if(l>p)return;l>c&&(c=l)}if(l=a-h,d||!(l<0)){if(l/=d,d<0){if(l>p)return;l>c&&(c=l)}else if(d>0){if(l<c)return;l<p&&(p=l)}return c>0&&(i[0]=u+c*f,i[1]=h+c*d),p<1&&(r[0]=u+p*f,r[1]=h+p*d),!0}}}}})(h,w,i,r,n,o)?(_||(b.lineStart(),b.point(h[0],h[1])),b.point(w[0],w[1]),u||b.lineEnd(),x=!1):u&&(b.lineStart(),b.point(a,l),x=!1)}g=a,y=l,_=u}return E}}(E=+i[0][0],l=+i[0][1],u=+i[1][0],h=+i[1][1]),L()):null==E?null:[[E,l],[u,h]]},T.scale=function(i){return arguments.length?(f=+i,A()):f},T.translate=function(i){return arguments.length?(d=+i[0],m=+i[1],A()):[d,m]},T.center=function(i){return arguments.length?(g=i[0]%360*h9,y=i[1]%360*h9,A()):[g*h8,y*h8]},T.rotate=function(i){return arguments.length?(_=i[0]%360*h9,v=i[1]%360*h9,x=i.length>2?i[2]%360*h9:0,A()):[_*h8,v*h8,x*h8]},T.precision=function(i){return arguments.length?(M=cW(P,S=i*i),L()):cn(S)},T.fitExtent=function(i,r){return cX(T,i,r)},T.fitSize=function(i,r){return cX(T,[[0,0],i],r)},function(){return r=i.apply(this,arguments),T.invert=r.invert&&C,A()}})(function(){return cY})().scale(79.4188).clipAngle(179.999).rotate(a).scale(6371008.8)),f={type:u.type,coordinates:function i(r,n){return"object"!=typeof r[0]?n(r):r.map(function(r){return i(r,n)})}(u.coordinates,p)},d=(new lo).read(f),m=I(S(r,n),"meters"),g=uV.bufferOp(d,m,o);if(!function i(r){return Array.isArray(r[0])?i(r[0]):isNaN(r[0])}((g=(new ls).write(g)).coordinates))return h({type:g.type,coordinates:function i(r,n){return"object"!=typeof r[0]?n.invert(r):r.map(function(r){return i(r,n)})}(g.coordinates,p)},l)}function cJ(i,r,n){void 0===n&&(n={});var o=tl(i),s=tl(r),a=st.intersection(o.coordinates,s.coordinates);return 0===a.length?null:1===a.length?d(a[0],n.properties):b(a,n.properties)}function cQ(i,r,n){void 0===n&&(n={});var o=JSON.stringify(n.properties||{}),s=i[0],a=i[1],l=i[2],u=i[3],h=(a+u)/2,c=(s+l)/2,p=2*r/ee([s,h],[l,h],n)*(l-s),f=2*r/ee([c,a],[c,u],n)*(u-a),m=p/2,g=2*m,y=Math.sqrt(3)/2*f,v=l-s,x=u-a,b=3/4*g,w=Math.floor((v-g)/(g-m/2)),E=(w*b-m/2-v)/2-m/2+b/2,I=Math.floor((x-y)/y),S=(x-I*y)/2,M=I*y-x>y/2;M&&(S-=y/4);for(var T=[],C=[],P=0;P<6;P++){var A=2*Math.PI/6*P;T.push(Math.cos(A)),C.push(Math.sin(A))}for(var L=[],k=0;k<=w;k++)for(var R=0;R<=I;R++){var D=k%2==1;if((0!==R||!D)&&(0!==R||!M)){var N=k*b+s-E,O=R*y+a+S;if(D&&(O-=y/2),!0===n.triangles)(function(i,r,n,o,s,a){for(var l=[],u=0;u<6;u++){var h=[];h.push(i),h.push([i[0]+r*s[u],i[1]+n*a[u]]),h.push([i[0]+r*s[(u+1)%6],i[1]+n*a[(u+1)%6]]),h.push(i),l.push(d([h],o))}return l})([N,O],p/2,f/2,JSON.parse(o),T,C).forEach(function(i){n.mask?cJ(n.mask,i)&&L.push(i):L.push(i)});else{var z=function(i,r,n,o,s,a){for(var l=[],u=0;u<6;u++){var h=i[0]+r*s[u],c=i[1]+n*a[u];l.push([h,c])}return l.push(l[0].slice()),d([l],o)}([N,O],p/2,f/2,JSON.parse(o),T,C);n.mask?cJ(n.mask,z)&&L.push(z):L.push(z)}}}return _(L)}function c0(i,r,n){return void 0===n&&(n={}),function(i,r,n,o){void 0===o&&(o={});for(var s=[],a=i[0],l=i[1],u=i[2],h=i[3],c=r/ee([a,l],[u,l],o)*(u-a),p=n/ee([a,l],[a,h],o)*(h-l),f=u-a,m=h-l,g=Math.floor(f/c),y=Math.floor(m/p),v=(m-y*p)/2,x=a+(f-g*c)/2,b=0;b<g;b++){for(var w=l+v,E=0;E<y;E++){var I=d([[[x,w],[x,w+p],[x+c,w+p],[x+c,w],[x,w]]],o.properties);o.mask?ny(o.mask,I)&&s.push(I):s.push(I),w+=p}x+=c}return _(s)}(i,r,r,n)}function c1(i,r,n){void 0===n&&(n={});for(var o=[],s=r/ee([i[0],i[1]],[i[2],i[1]],n)*(i[2]-i[0]),a=r/ee([i[0],i[1]],[i[0],i[3]],n)*(i[3]-i[1]),l=0,u=i[0];u<=i[2];){for(var h=0,c=i[1];c<=i[3];){var p=null,f=null;l%2==0&&h%2==0?(p=d([[[u,c],[u,c+a],[u+s,c],[u,c]]],n.properties),f=d([[[u,c+a],[u+s,c+a],[u+s,c],[u,c+a]]],n.properties)):l%2==0&&h%2==1?(p=d([[[u,c],[u+s,c+a],[u+s,c],[u,c]]],n.properties),f=d([[[u,c],[u,c+a],[u+s,c+a],[u,c]]],n.properties)):h%2==0&&l%2==1?(p=d([[[u,c],[u,c+a],[u+s,c+a],[u,c]]],n.properties),f=d([[[u,c],[u+s,c+a],[u+s,c],[u,c]]],n.properties)):h%2==1&&l%2==1&&(p=d([[[u,c],[u,c+a],[u+s,c],[u,c]]],n.properties),f=d([[[u,c+a],[u+s,c+a],[u+s,c],[u,c+a]]],n.properties)),n.mask?(cJ(n.mask,p)&&o.push(p),cJ(n.mask,f)&&o.push(f)):(o.push(p),o.push(f)),c+=a,h++}l++,u+=s}return _(o)}cY.invert=(n=function(i){return i},function(i,r){var o=cn(i*i+r*r),s=n(o),a=cr(s);return[ce(i*a,o*ci(s)),cs(o&&r*a/o)]}),i.along=function(i,r,n){void 0===n&&(n={});for(var o=tl(i).coordinates,s=0,a=0;a<o.length&&!(r>=s&&a===o.length-1);a++){if(s>=r){var l=r-s;if(l){var u=eF(o[a],o[a-1])-180;return eO(o[a],l,u,n)}return p(o[a])}s+=ee(o[a],o[a+1],n)}return p(o[o.length-1])},i.angle=function(i,r,n,o){if(void 0===o&&(o={}),!R(o))throw Error("options is invalid");if(!i)throw Error("startPoint is required");if(!r)throw Error("midPoint is required");if(!n)throw Error("endPoint is required");var s=Math.abs(T(!0!==o.mercator?eF(i,r):rr(i,r))-T(!0!==o.mercator?eF(n,r):rr(n,r)));return!0===o.explementary?360-s:s},i.applyFilter=oS,i.area=iw,i.areaFactors=u,i.bbox=te,i.bboxClip=function(i,r){var n=tl(i),o=n.type,s="Feature"===i.type?i.properties:{},a=n.coordinates;switch(o){case"LineString":case"MultiLineString":var l=[];return"LineString"===o&&(a=[a]),a.forEach(function(i){!function(i,r,n){var o,s,a,l,u,h=i.length,c=i4(i[0],r),p=[];for(n||(n=[]),o=1;o<h;o++){for(l=i[o-1],s=a=i4(u=i[o],r);;){if(!(c|s)){p.push(l),s!==a?(p.push(u),o<h-1&&(n.push(p),p=[])):o===h-1&&p.push(u);break}if(c&s)break;c?c=i4(l=i5(l,u,c,r),r):s=i4(u=i5(l,u,s,r),r)}c=a}p.length&&n.push(p)}(i,r,l)}),1===l.length?g(l[0],s):v(l,s);case"Polygon":return d(i6(a,r),s);case"MultiPolygon":return b(a.map(function(i){return i6(i,r)}),s);default:throw Error("geometry "+o+" not supported")}},i.bboxPolygon=eR,i.bearing=eF,i.bearingToAngle=T,i.bearingToAzimuth=T,i.bezier=ek,i.bezierSpline=ek,i.booleanClockwise=rl,i.booleanContains=function(i,r){var n=tl(i),o=tl(r),s=n.type,a=o.type,l=n.coordinates,u=o.coordinates;switch(s){case"Point":if("Point"===a)return nl(l,u);throw Error("feature2 "+a+" geometry not supported");case"MultiPoint":switch(a){case"Point":return function(i,r){var n,o=!1;for(n=0;n<i.coordinates.length;n++)if(nl(i.coordinates[n],r.coordinates)){o=!0;break}return o}(n,o);case"MultiPoint":return function(i,r){for(var n=0,o=r.coordinates;n<o.length;n++){for(var s=o[n],a=!1,l=0,u=i.coordinates;l<u.length;l++)if(nl(s,u[l])){a=!0;break}if(!a)return!1}return!0}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return iC(o,n,{ignoreEndVertices:!0});case"LineString":return function(i,r){for(var n=!1,o=0,s=r.coordinates;o<s.length;o++){var a=s[o];if(iC({type:"Point",coordinates:a},i,{ignoreEndVertices:!0})&&(n=!0),!iC({type:"Point",coordinates:a},i,{ignoreEndVertices:!1}))return!1}return n}(n,o);case"MultiPoint":return function(i,r){for(var n=!1,o=0,s=r.coordinates;o<s.length;o++){var a=s[o];if(iC(a,i,{ignoreEndVertices:!0})&&(n=!0),!iC(a,i))return!1}return!!n}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return t9(o,n,{ignoreBoundary:!0});case"LineString":return function(i,r){var n,o,s=!1,a=0;if(!na(te(i),te(r)))return!1;for(;a<r.coordinates.length-1;a++)if(t9({type:"Point",coordinates:(n=r.coordinates[a],o=r.coordinates[a+1],[(n[0]+o[0])/2,(n[1]+o[1])/2])},i,{ignoreBoundary:!0})){s=!0;break}return s}(n,o);case"Polygon":return function(i,r){if("Feature"===i.type&&null===i.geometry||"Feature"===r.type&&null===r.geometry||!na(te(i),te(r)))return!1;for(var n=tl(r).coordinates,o=0;o<n.length;o++)for(var s=0,a=n[o];s<a.length;s++)if(!t9(a[s],i))return!1;return!0}(n,o);case"MultiPoint":return function(i,r){for(var n=0,o=r.coordinates;n<o.length;n++)if(!t9(o[n],i,{ignoreBoundary:!0}))return!1;return!0}(n,o);default:throw Error("feature2 "+a+" geometry not supported")}default:throw Error("feature1 "+s+" geometry not supported")}},i.booleanCrosses=function(i,r){var n=tl(i),o=tl(r),s=n.type,a=o.type;switch(s){case"MultiPoint":switch(a){case"LineString":return nu(n,o);case"Polygon":return nc(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"MultiPoint":return nu(o,n);case"LineString":return function(i,r){if(ip(i,r).features.length>0)for(var n=0;n<i.coordinates.length-1;n++)for(var o=0;o<r.coordinates.length-1;o++){var s=!0;if(0!==o&&o!==r.coordinates.length-2||(s=!1),np(i.coordinates[n],i.coordinates[n+1],r.coordinates[o],s))return!0}return!1}(n,o);case"Polygon":return nh(n,o);default:throw Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"MultiPoint":return nc(o,n);case"LineString":return nh(o,n);default:throw Error("feature2 "+a+" geometry not supported")}default:throw Error("feature1 "+s+" geometry not supported")}},i.booleanDisjoint=nn,i.booleanEqual=function(i,r){return tl(i).type===tl(r).type&&new nf({precision:6}).compare(eI(i),eI(r))},i.booleanIntersects=ny,i.booleanOverlap=function(i,r){var n=tl(i),o=tl(r),s=n.type,a=o.type;if("MultiPoint"===s&&"MultiPoint"!==a||("LineString"===s||"MultiLineString"===s)&&"LineString"!==a&&"MultiLineString"!==a||("Polygon"===s||"MultiPolygon"===s)&&"Polygon"!==a&&"MultiPolygon"!==a)throw Error("features must be of the same type");if("Point"===s)throw Error("Point geometry not supported");if(new nf({precision:6}).compare(i,r))return!1;var l=0;switch(s){case"MultiPoint":for(var u=0;u<n.coordinates.length;u++)for(var h=0;h<o.coordinates.length;h++){var c=n.coordinates[u],p=o.coordinates[h];if(c[0]===p[0]&&c[1]===p[1])return!0}return!1;case"LineString":case"MultiLineString":W(i,function(i){W(r,function(r){rt(i,r).features.length&&l++})});break;case"Polygon":case"MultiPolygon":W(i,function(i){W(r,function(r){ip(i,r).features.length&&l++})})}return l>0},i.booleanParallel=function(i,r){if(!i)throw Error("line1 is required");if(!r)throw Error("line2 is required");if("LineString"!==nP(i,"line1"))throw Error("line1 must be a LineString");if("LineString"!==nP(r,"line2"))throw Error("line2 must be a LineString");for(var n=e6(eI(i)).features,o=e6(eI(r)).features,s=0;s<n.length;s++){var a,l=n[s].geometry.coordinates;if(!o[s])break;if(a=o[s].geometry.coordinates,T(rr(l[0],l[1]))!==T(rr(a[0],a[1])))return!1}return!0},i.booleanPointInPolygon=t9,i.booleanPointOnLine=iC,i.booleanWithin=iP,i.buffer=function(i,r,n){var o=(n=n||{}).units||"kilometers",s=n.steps||8;if(!i)throw Error("geojson is required");if("object"!=typeof n)throw Error("options must be an object");if("number"!=typeof s)throw Error("steps must be an number");if(void 0===r)throw Error("radius is required");if(s<=0)throw Error("steps must be greater than 0");var a=[];switch(i.type){case"GeometryCollection":return j(i,function(i){var n=cK(i,r,o,s);n&&a.push(n)}),_(a);case"FeatureCollection":return G(i,function(i){var n=cK(i,r,o,s);n&&G(n,function(i){i&&a.push(i)})}),_(a)}return cK(i,r,o,s)},i.center=eB,i.centerMean=or,i.centerMedian=function(i,r){if(void 0===r&&(r={}),!R(r=r||{}))throw Error("options is invalid");var n=r.counter||10;if(!k(n))throw Error("counter must be a number");var o=r.weight,s=or(i,{weight:r.weight}),a=_([]);G(i,function(i){var r;a.features.push(eU(i,{properties:{weight:null===(r=i.properties)||void 0===r?void 0:r[o]}}))});var l={tolerance:r.tolerance,medianCandidates:[]};return function i(r,n,o,s,a){var l=s.tolerance||.001,u=0,h=0,c=0,f=0;if(G(o,function(i){var n,o=null===(n=i.properties)||void 0===n?void 0:n.weight,s=null==o?1:o;if(!k(s=Number(s)))throw Error("weight value must be a number");if(s>0){f+=1;var a=s*ee(i,r);0===a&&(a=1);var l=s/a;u+=i.geometry.coordinates[0]*l,h+=i.geometry.coordinates[1]*l,c+=l}}),f<1)throw Error("no features to measure");var d=u/c,m=h/c;return 1===f||0===a||Math.abs(d-n[0])<l&&Math.abs(m-n[1])<l?p([d,m],{medianCandidates:s.medianCandidates}):(s.medianCandidates.push([d,m]),i([d,m],r,o,s,a-1))}(s.geometry.coordinates,[0,0],a,l,n)},i.centerOfMass=function i(r,n){switch(void 0===n&&(n={}),tu(r)){case"Point":return p(ti(r),n.properties);case"Polygon":var o=[];z(r,function(i){o.push(i)});var s,a,l,u,h,c,f,d,m=eU(r,{properties:n.properties}),g=m.geometry.coordinates,y=0,_=0,v=0,x=o.map(function(i){return[i[0]-g[0],i[1]-g[1]]});for(s=0;s<o.length-1;s++)u=(a=x[s])[0],c=a[1],h=(l=x[s+1])[0],v+=d=u*(f=l[1])-h*c,y+=(u+h)*d,_+=(c+f)*d;if(0===v)return m;var b=1/(.5*v*6);return p([g[0]+b*y,g[1]+b*_],n.properties);default:var w=t8(r);return w?i(w,{properties:n.properties}):eU(r,{properties:n.properties})}},i.centroid=eU,i.circle=ez,i.cleanCoords=eI,i.clone=eo,i.clusterEach=ow,i.clusterReduce=oE,i.clusters=oC,i.clustersDbscan=function(i,r,n){void 0===n&&(n={}),!0!==n.mutate&&(i=eo(i)),n.minPoints=n.minPoints||3;var o=new nw.DBSCAN,s=o.run(q(i),A(r,n.units),n.minPoints,ee),a=-1;return s.forEach(function(r){a++,r.forEach(function(r){var n=i.features[r];n.properties||(n.properties={}),n.properties.cluster=a,n.properties.dbscan="core"})}),o.noise.forEach(function(r){var n=i.features[r];n.properties||(n.properties={}),n.properties.cluster?n.properties.dbscan="edge":n.properties.dbscan="noise"}),i},i.clustersKmeans=function(i,r){void 0===r&&(r={});var n=i.features.length;r.numberOfClusters=r.numberOfClusters||Math.round(Math.sqrt(n/2)),r.numberOfClusters>n&&(r.numberOfClusters=n),!0!==r.mutate&&(i=eo(i));var o=q(i),s=o.slice(0,r.numberOfClusters),a=nC(o,r.numberOfClusters,s),l={};return a.centroids.forEach(function(i,r){l[r]=i}),G(i,function(i,r){var n=a.idxs[r];i.properties.cluster=n,i.properties.centroid=l[n]}),i},i.collect=function(i,r,n,o){var s=tI(6),a=r.features.map(function(i){var r;return{minX:i.geometry.coordinates[0],minY:i.geometry.coordinates[1],maxX:i.geometry.coordinates[0],maxY:i.geometry.coordinates[1],property:null===(r=i.properties)||void 0===r?void 0:r[n]}});return s.load(a),i.features.forEach(function(i){i.properties||(i.properties={});var r=te(i),n=s.search({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}),a=[];n.forEach(function(r){t9([r.minX,r.minY],i)&&a.push(r.property)}),i.properties[o]=a}),i},i.collectionOf=ta,i.combine=function(i){var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return G(i,function(i){var n,o,s,a;switch(null===(a=i.geometry)||void 0===a?void 0:a.type){case"Point":r.MultiPoint.coordinates.push(i.geometry.coordinates),r.MultiPoint.properties.push(i.properties);break;case"MultiPoint":(n=r.MultiPoint.coordinates).push.apply(n,i.geometry.coordinates),r.MultiPoint.properties.push(i.properties);break;case"LineString":r.MultiLineString.coordinates.push(i.geometry.coordinates),r.MultiLineString.properties.push(i.properties);break;case"MultiLineString":(o=r.MultiLineString.coordinates).push.apply(o,i.geometry.coordinates),r.MultiLineString.properties.push(i.properties);break;case"Polygon":r.MultiPolygon.coordinates.push(i.geometry.coordinates),r.MultiPolygon.properties.push(i.properties);break;case"MultiPolygon":(s=r.MultiPolygon.coordinates).push.apply(s,i.geometry.coordinates),r.MultiPolygon.properties.push(i.properties)}}),_(Object.keys(r).filter(function(i){return r[i].coordinates.length}).sort().map(function(i){return h({type:i,coordinates:r[i].coordinates},{collectedProperties:r[i].properties})}))},i.concave=function(i,r){void 0===r&&(r={});var n,o,s=r.maxEdge||1/0,a=ei((n=[],o={},G(i,function(i){if(i.geometry){var r=i.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(o,r)||(n.push(i),o[r]=!0)}}),_(n)));if(a.features=a.features.filter(function(i){var n=i.geometry.coordinates[0][0],o=i.geometry.coordinates[0][1],a=i.geometry.coordinates[0][2],l=ee(n,o,r),u=ee(o,a,r),h=ee(n,a,r);return l<=s&&u<=s&&h<=s}),a.features.length<1)return null;var l=function(i,r){if(void 0===r&&(r={}),!R(r=r||{}))throw Error("options is invalid");var n,o,s=r.mutate;if("FeatureCollection"!==tu(i))throw Error("geojson must be a FeatureCollection");if(!i.features.length)throw Error("geojson is empty");!1!==s&&void 0!==s||(i=eo(i));var a=(n={},X(i,function(i){n[i.geometry.type]=!0}),1===(o=Object.keys(n)).length?o[0]:null);if(!a)throw Error("geojson must be homogenous");var l=i;switch(a){case"LineString":return function(i,r){if(void 0===r&&(r={}),!R(r=r||{}))throw Error("options is invalid");var n=r.mutate;if("FeatureCollection"!==tu(i))throw Error("geojson must be a FeatureCollection");if(!i.features.length)throw Error("geojson is empty");!1!==n&&void 0!==n||(i=eo(i));var o=[],s=K(i,function(i,r){return function(i,r){var n,o=i.geometry.coordinates,s=r.geometry.coordinates,a=el(o[0]),l=el(o[o.length-1]),u=el(s[0]),h=el(s[s.length-1]);if(a===h)n=s.concat(o.slice(1));else if(u===l)n=o.concat(s.slice(1));else if(a===u)n=o.slice(1).reverse().concat(s);else{if(l!==h)return null;n=o.concat(s.reverse().slice(1))}return g(n)}(i,r)||(o.push(i),r)});return s&&o.push(s),o.length?1===o.length?o[0]:v(o.map(function(i){return i.coordinates})):null}(l,r);case"Polygon":return function(i,r){if(void 0===r&&(r={}),"FeatureCollection"!==tu(i))throw Error("geojson must be a FeatureCollection");if(!i.features.length)throw Error("geojson is empty");!1!==r.mutate&&void 0!==r.mutate||(i=eo(i));var n=[];X(i,function(i){n.push(i.geometry)});var o=function(i,r){var n=function(i){var r=1/0,n=1/0,o=-1/0,s=-1/0;function a(i){null!=i&&ep.call(l,i.type)&&l[i.type](i)}var l={GeometryCollection:function(i){i.geometries.forEach(a)},Point:function(i){u(i.coordinates)},MultiPoint:function(i){i.coordinates.forEach(u)},LineString:function(i){h(i.arcs)},MultiLineString:function(i){i.arcs.forEach(h)},Polygon:function(i){i.arcs.forEach(h)},MultiPolygon:function(i){i.arcs.forEach(c)}};function u(i){var a=i[0],l=i[1];a<r&&(r=a),a>o&&(o=a),l<n&&(n=l),l>s&&(s=l)}function h(i){i.forEach(u)}function c(i){i.forEach(h)}for(var p in i)a(i[p]);return o>=r&&s>=n?[r,n,o,s]:void 0}(i=function(i){var r,n,o={};for(r in i)o[r]=null==(n=i[r])?{type:null}:("FeatureCollection"===n.type?function(i){var r={type:"GeometryCollection",geometries:i.features.map(ex)};return null!=i.bbox&&(r.bbox=i.bbox),r}:"Feature"===n.type?ex:eb)(n);return o}(i)),o=function(i){var r,n,o,s,a=i.coordinates,l=i.lines,u=i.rings,h=l.length+u.length;for(delete i.lines,delete i.rings,o=0,s=l.length;o<s;++o)for(r=l[o];r=r.next;)++h;for(o=0,s=u.length;o<s;++o)for(n=u[o];n=n.next;)++h;var c=ef(2*h*1.4,e_,ed),p=i.arcs=[];for(o=0,s=l.length;o<s;++o){r=l[o];do f(r);while(r=r.next)}for(o=0,s=u.length;o<s;++o)if((n=u[o]).next)do f(n);while(n=n.next)else(function(i){var r,n,o,s,l;if(n=c.get(a[i[0]]))for(s=0,l=n.length;s<l;++s){if(d(o=n[s],i))return i[0]=o[0],void(i[1]=o[1]);if(m(o,i))return i[0]=o[1],void(i[1]=o[0])}if(n=c.get(r=a[i[0]+g(i)]))for(s=0,l=n.length;s<l;++s){if(d(o=n[s],i))return i[0]=o[0],void(i[1]=o[1]);if(m(o,i))return i[0]=o[1],void(i[1]=o[0])}n?n.push(i):c.set(r,[i]),p.push(i)})(n);function f(i){var r,n,o,s,l,u,h,f;if(o=c.get(r=a[i[0]])){for(h=0,f=o.length;h<f;++h)if(function(i,r){var n=i[0],o=r[0],s=i[1];if(n-s!=o-r[1])return!1;for(;n<=s;++n,++o)if(!ed(a[n],a[o]))return!1;return!0}(s=o[h],i))return i[0]=s[0],void(i[1]=s[1])}if(l=c.get(n=a[i[1]])){for(h=0,f=l.length;h<f;++h)if(function(i,r){var n=i[0],o=r[0],s=i[1],l=r[1];if(n-s!=o-l)return!1;for(;n<=s;++n,--l)if(!ed(a[n],a[l]))return!1;return!0}(u=l[h],i))return i[1]=u[0],void(i[0]=u[1])}o?o.push(i):c.set(r,[i]),l?l.push(i):c.set(n,[i]),p.push(i)}function d(i,r){var n=i[0],o=r[0],s=i[1]-n;if(s!==r[1]-o)return!1;for(var l=g(i),u=g(r),h=0;h<s;++h)if(!ed(a[n+(h+l)%s],a[o+(h+u)%s]))return!1;return!0}function m(i,r){var n=i[0],o=r[0],s=i[1],l=r[1],u=s-n;if(u!==l-o)return!1;for(var h=g(i),c=u-g(r),p=0;p<u;++p)if(!ed(a[n+(p+h)%u],a[l-(p+c)%u]))return!1;return!0}function g(i){for(var r=i[0],n=i[1],o=r,s=o,l=a[o];++o<n;){var u=a[o];(u[0]<l[0]||u[0]===l[0]&&u[1]<l[1])&&(s=o,l=u)}return s-r}return i}(function(i){var r,n,o,s,a=function(i){var r,n,o,s,a=i.coordinates,l=i.lines,u=i.rings,h=function(){for(var i=ef(1.4*a.length,E,I,Int32Array,-1,Int32Array),r=new Int32Array(a.length),n=0,o=a.length;n<o;++n)r[n]=i.maybeSet(n,n);return r}(),c=new Int32Array(a.length),p=new Int32Array(a.length),f=new Int32Array(a.length),d=new Int8Array(a.length),m=0;for(r=0,n=a.length;r<n;++r)c[r]=p[r]=f[r]=-1;for(r=0,n=l.length;r<n;++r){var g=l[r],y=g[0],_=g[1];for(o=h[y],s=h[++y],++m,d[o]=1;++y<=_;)w(r,o,o=s,s=h[y]);++m,d[s]=1}for(r=0,n=a.length;r<n;++r)c[r]=-1;for(r=0,n=u.length;r<n;++r){var v=u[r],x=v[0]+1,b=v[1];for(w(r,h[b-1],o=h[x-1],s=h[x]);++x<=b;)w(r,o,o=s,s=h[x])}function w(i,r,n,o){if(c[n]!==i){c[n]=i;var s=p[n];if(s>=0){var a=f[n];s===r&&a===o||s===o&&a===r||(++m,d[n]=1)}else p[n]=r,f[n]=o}}function E(i){return e_(a[i])}function I(i,r){return ed(a[i],a[r])}c=p=f=null;var S,M=function(i,r,n,o,s){3==arguments.length&&(o=Array,s=null);for(var a=new o(i=1<<Math.max(4,Math.ceil(Math.log(i)/Math.LN2))),l=i-1,u=0;u<i;++u)a[u]=s;return{add:function(o){for(var u=r(o)&l,h=a[u],c=0;h!=s;){if(n(h,o))return!0;if(++c>=i)throw Error("full hashset");h=a[u=u+1&l]}return a[u]=o,!0},has:function(o){for(var u=r(o)&l,h=a[u],c=0;h!=s;){if(n(h,o))return!0;if(++c>=i)break;h=a[u=u+1&l]}return!1},values:function(){for(var i=[],r=0,n=a.length;r<n;++r){var o=a[r];o!=s&&i.push(o)}return i}}}(1.4*m,e_,ed);for(r=0,n=a.length;r<n;++r)d[S=h[r]]&&M.add(a[S]);return M}(i),l=i.coordinates,u=i.lines,h=i.rings;for(o=0,s=u.length;o<s;++o)for(var c=u[o],p=c[0],f=c[1];++p<f;)a.has(l[p])&&(n={0:p,1:c[1]},c[1]=p,c=c.next=n);for(o=0,s=h.length;o<s;++o)for(var d=h[o],m=d[0],g=m,y=d[1],_=a.has(l[m]);++g<y;)a.has(l[g])&&(_?(n={0:g,1:d[1]},d[1]=g,d=d.next=n):(r=y-g,ev(l,m,y),ev(l,m,m+r),ev(l,m+r,y),l[y]=l[m],_=!0,g=m));return i}(function(i){var r=-1,n=[],o=[],s=[];function a(i){i&&ep.call(l,i.type)&&l[i.type](i)}var l={GeometryCollection:function(i){i.geometries.forEach(a)},LineString:function(i){i.arcs=u(i.arcs)},MultiLineString:function(i){i.arcs=i.arcs.map(u)},Polygon:function(i){i.arcs=i.arcs.map(h)},MultiPolygon:function(i){i.arcs=i.arcs.map(c)}};function u(i){for(var o=0,a=i.length;o<a;++o)s[++r]=i[o];var l={0:r-a+1,1:r};return n.push(l),l}function h(i){for(var n=0,a=i.length;n<a;++n)s[++r]=i[n];var l={0:r-a+1,1:r};return o.push(l),l}function c(i){return i.map(h)}for(var p in i)a(i[p]);return{type:"Topology",coordinates:s,lines:n,rings:o,objects:i}}(i))),s=o.coordinates,a=ef(1.4*o.arcs.length,ew,eE);function l(i){i&&ep.call(u,i.type)&&u[i.type](i)}i=o.objects,o.bbox=n,o.arcs=o.arcs.map(function(i,r){return a.set(i,r),s.slice(i[0],i[1]+1)}),delete o.coordinates,s=null;var u={GeometryCollection:function(i){i.geometries.forEach(l)},LineString:function(i){i.arcs=h(i.arcs)},MultiLineString:function(i){i.arcs=i.arcs.map(h)},Polygon:function(i){i.arcs=i.arcs.map(h)},MultiPolygon:function(i){i.arcs=i.arcs.map(c)}};function h(i){var r=[];do{var n=a.get(i);r.push(i[0]<i[1]?n:~n)}while(i=i.next)return r}function c(i){return i.map(h)}for(var p in i)l(i[p]);return o}({geoms:w(n).geometry});return function(i){return eh(i,ec.apply(this,arguments))}(o,o.objects.geoms.geometries)}(l,r);default:throw Error(a+" is not supported")}}(a);return 1===l.coordinates.length&&(l.coordinates=l.coordinates[0],l.type="Polygon"),h(l)},i.containsNumber=tn,i.convertArea=L,i.convertDistance=A,i.convertLength=A,i.convex=t8,i.coordAll=q,i.coordEach=z,i.coordReduce=F,i.createBins=oI,i.degrees2radians=P,i.degreesToRadians=P,i.destination=eO,i.difference=function(i,r){var n=tl(i),o=tl(r),s=i.properties||{},a=st.difference(n.coordinates,o.coordinates);return 0===a.length?null:1===a.length?d(a[0],s):b(a,s)},i.dissolve=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=r.propertyName;ta(i,"Polygon","dissolve");var o=[];if(!r.propertyName)return iD(b(st.union.apply(null,i.features.map(function(i){return i.geometry.coordinates}))));var s={};G(i,function(i){Object.prototype.hasOwnProperty.call(s,i.properties[n])||(s[i.properties[n]]=[]),s[i.properties[n]].push(i)});for(var a=Object.keys(s),l=0;l<a.length;l++){var u=b(st.union.apply(null,s[a[l]].map(function(i){return i.geometry.coordinates})));u.properties[n]=a[l],o.push(u)}return iD(_(o))},i.distance=ee,i.distanceToDegrees=M,i.distanceToRadians=S,i.distanceWeight=oo,i.earthRadius=6371008.8,i.ellipse=oe,i.envelope=eD,i.explode=eG,i.factors=a,i.feature=h,i.featureCollection=_,i.featureEach=G,i.featureOf=ts,i.featureReduce=V,i.filterProperties=oT,i.findPoint=Q,i.findSegment=J,i.flatten=iD,i.flattenEach=X,i.flattenReduce=$,i.flip=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=r.mutate;if(!i)throw Error("geojson is required");return!1!==n&&void 0!==n||(i=eo(i)),z(i,function(i){var r=i[0],n=i[1];i[0]=n,i[1]=r}),i},i.geojsonType=to,i.geomEach=j,i.geomReduce=Z,i.geometry=c,i.geometryCollection=w,i.getCluster=ob,i.getCoord=ti,i.getCoords=tr,i.getGeom=tl,i.getType=tu,i.greatCircle=function(i,r,n){if("object"!=typeof(n=n||{}))throw Error("options is invalid");var o=n.properties,s=n.npoints,a=n.offset;return i=ti(i),r=ti(r),o=o||{},s=s||100,a=a||10,new iZ({x:i[0],y:i[1]},{x:r[0],y:r[1]},o).Arc(s,{offset:a}).json()},i.helpers=O,i.hexGrid=cQ,i.inside=t9,i.interpolate=function(i,r,n){if("object"!=typeof(n=n||{}))throw Error("options is invalid");var o=n.gridType,s=n.property,a=n.weight;if(!i)throw Error("points is required");if(ta(i,"Point","input must contain Points"),!r)throw Error("cellSize is required");if(void 0!==a&&"number"!=typeof a)throw Error("weight must be a number");s=s||"elevation",o=o||"square",a=a||1;var l,u=te(i);switch(o){case"point":case"points":l=ik(u,r,n);break;case"square":case"squares":l=c0(u,r,n);break;case"hex":case"hexes":l=cQ(u,r,n);break;case"triangle":case"triangles":l=c1(u,r,n);break;default:throw Error("invalid gridType")}var h=[];return G(l,function(r){var l=0,u=0;G(i,function(i){var h,c=ee("point"===o?r:eU(r),i,n);if(void 0!==s&&(h=i.properties[s]),void 0===h&&(h=i.geometry.coordinates[2]),void 0===h)throw Error("zValue is missing");0===c&&(l=h);var p=1/Math.pow(c,a);u+=p,l+=p*h});var c=eo(r);c.properties[s]=l/u,h.push(c)}),_(h)},i.intersect=cJ,i.invariant=th,i.isNumber=k,i.isObject=R,i.isobands=function(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o,s,a,l,u,h,c,p,f,m,g,y=n.zProperty||"elevation",v=n.commonProperties||{},x=n.breaksProperties||[];if(ta(i,"Point","Input must contain Points"),!r)throw Error("breaks is required");if(!Array.isArray(r))throw Error("breaks is not an Array");if(!R(v))throw Error("commonProperties is not an Object");if(!Array.isArray(x))throw Error("breaksProperties is not an Array");var w=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n,o=r.zProperty||"elevation",s=r.flip,a=r.flags;ta(i,"Point","input must contain Points");for(var l=(n={},G(i,function(i){var r=tr(i)[1];n[r]||(n[r]=[]),n[r].push(i)}),Object.keys(n).map(function(i){return n[i].sort(function(i,r){return tr(i)[0]-tr(r)[0]})}).sort(function(i,r){return s?tr(i[0])[1]-tr(r[0])[1]:tr(r[0])[1]-tr(i[0])[1]})),u=[],h=0;h<l.length;h++){for(var c=l[h],p=[],f=0;f<c.length;f++){var d=c[f];d.properties[o]?p.push(d.properties[o]):p.push(0),!0===a&&(d.properties.matrixPosition=[h,f])}u.push(p)}return u}(i,{zProperty:y,flip:!0}),E=function(i,r,n){for(var o=[],s=1;s<r.length;s++){var a=+r[s-1],l=+r[s],u=function(i){for(var r=i.map(function(i){return{lrCoordinates:i,grouped:!1}}),n=[];!function(i){for(var r=0;r<i.length;r++)if(!1===i[r].grouped)return!1;return!0}(r);)for(var o=0;o<r.length;o++)if(!r[o].grouped){var s=[];s.push(r[o].lrCoordinates),r[o].grouped=!0;for(var a=d([r[o].lrCoordinates]),l=o+1;l<r.length;l++)!r[l].grouped&&function(i,r){for(var n=eG(i),o=0;o<n.features.length;o++)if(!t9(n.features[o],r))return!1;return!0}(d([r[l].lrCoordinates]),a)&&(s.push(r[l].lrCoordinates),r[l].grouped=!0);n.push(s)}return n}(function(i){var r=[],n=[];i.forEach(function(i){var o=iw(d([i]));n.push(o),r.push({ring:i,area:o})}),n.sort(function(i,r){return r-i});var o=[];return n.forEach(function(i){for(var n=0;n<r.length;n++)if(r[n].area===i){o.push(r[n].ring),r.splice(n,1);break}}),o}(function(i,r,n,o){o=o||{};for(var s,a,l=Object.keys(rp),u=0;u<l.length;u++){var h=l[u],c=o[h];c=null!=c?c:rp[h],rf[h]=c}rf.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+r+":"+(r+n)+"]");var p,f=function(i,r,n){for(var o=i.length-1,s=i[0].length-1,a={rows:o,cols:s,cells:[]},l=r+Math.abs(n),u=0;u<o;++u){a.cells[u]=[];for(var h=0;h<s;++h){var c=0,p=i[u+1][h],f=i[u+1][h+1],d=i[u][h+1],m=i[u][h];if(!(isNaN(p)||isNaN(f)||isNaN(d)||isNaN(m))){c|=p<r?0:p>l?128:64,c|=f<r?0:f>l?32:16,c|=d<r?0:d>l?8:4;var g=+(c|=m<r?0:m>l?2:1),y=0;if(17===c||18===c||33===c||34===c||38===c||68===c||72===c||98===c||102===c||132===c||136===c||137===c||152===c||153===c){var _=(p+f+d+m)/4;y=_>l?2:_<r?0:1,34===c?1===y?c=35:0===y&&(c=136):136===c?1===y?(c=35,y=4):0===y&&(c=34):17===c?1===y?(c=155,y=4):0===y&&(c=153):68===c?1===y?(c=103,y=4):0===y&&(c=102):153===c?1===y&&(c=155):102===c?1===y&&(c=103):152===c?y<2&&(c=156,y=1):137===c?y<2&&(c=139,y=1):98===c?y<2&&(c=99,y=1):38===c?y<2&&(c=39,y=1):18===c?y>0?(c=156,y=4):c=152:33===c?y>0?(c=139,y=4):c=137:72===c?y>0?(c=99,y=4):c=98:132===c&&(y>0?(c=39,y=4):c=38)}if(0!=c&&170!=c){v=x=b=w=E=I=S=M=.5;var v,x,b,w,E,I,S,M,T=[];1===c?(b=1-(r-d)/(m-d),M=1-(r-p)/(m-p),T.push(rH[c])):169===c?(b=(l-m)/(d-m),M=(l-m)/(p-m),T.push(rH[c])):4===c?(I=1-(r-f)/(d-f),w=(r-m)/(d-m),T.push(r$[c])):166===c?(I=(l-d)/(f-d),w=1-(l-d)/(m-d),T.push(r$[c])):16===c?(E=(r-d)/(f-d),x=(r-p)/(f-p),T.push(rX[c])):154===c?(E=1-(l-f)/(d-f),x=1-(l-f)/(p-f),T.push(rX[c])):64===c?(S=(r-m)/(p-m),v=1-(r-f)/(p-f),T.push(rK[c])):106===c?(S=1-(l-p)/(m-p),v=(l-p)/(f-p),T.push(rK[c])):168===c?(w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),T.push(rW[c]),T.push(rH[c])):2===c?(w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),T.push(rW[c]),T.push(rH[c])):162===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),T.push(rW[c]),T.push(rH[c])):8===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),T.push(rX[c]),T.push(r$[c])):138===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(rX[c]),T.push(r$[c])):32===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(rX[c]),T.push(r$[c])):42===c?(M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(rY[c]),T.push(rK[c])):128===c&&(M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(rY[c]),T.push(rK[c])),5===c?(I=1-(r-f)/(d-f),M=1-(r-p)/(m-p),T.push(r$[c])):165===c?(I=(l-d)/(f-d),M=(l-m)/(p-m),T.push(r$[c])):20===c?(w=(r-m)/(d-m),x=(r-p)/(f-p),T.push(rW[c])):150===c?(w=1-(l-d)/(m-d),x=1-(l-f)/(p-f),T.push(rW[c])):80===c?(E=(r-d)/(f-d),S=(r-m)/(p-m),T.push(rX[c])):90===c?(E=1-(l-f)/(d-f),S=1-(l-p)/(m-p),T.push(rX[c])):65===c?(b=1-(r-d)/(m-d),v=1-(r-f)/(p-f),T.push(rH[c])):105===c?(b=(l-m)/(d-m),v=(l-p)/(f-p),T.push(rH[c])):160===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),M=(r-m)/(p-m),S=(l-m)/(p-m),T.push(rX[c]),T.push(r$[c])):10===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),T.push(rX[c]),T.push(r$[c])):130===c?(w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(rW[c]),T.push(rH[c])):40===c?(w=(l-m)/(d-m),b=(r-m)/(d-m),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(rW[c]),T.push(rH[c])):101===c?(I=(l-d)/(f-d),v=(l-p)/(f-p),T.push(r$[c])):69===c?(I=1-(r-f)/(d-f),v=1-(r-f)/(p-f),T.push(r$[c])):149===c?(M=(l-m)/(p-m),x=1-(l-f)/(p-f),T.push(rY[c])):21===c?(M=1-(r-p)/(m-p),x=(r-p)/(f-p),T.push(rY[c])):86===c?(w=1-(l-d)/(m-d),S=1-(l-p)/(m-p),T.push(rW[c])):84===c?(w=(r-m)/(d-m),S=(r-m)/(p-m),T.push(rW[c])):89===c?(E=1-(l-f)/(d-f),b=(l-m)/(d-m),T.push(rH[c])):81===c?(E=(r-d)/(f-d),b=1-(r-d)/(m-d),T.push(rH[c])):96===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),S=(r-m)/(p-m),v=(l-p)/(f-p),T.push(rX[c]),T.push(r$[c])):74===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),S=1-(l-p)/(m-p),v=1-(r-f)/(p-f),T.push(rX[c]),T.push(r$[c])):24===c?(E=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),x=(r-p)/(f-p),T.push(rX[c]),T.push(rH[c])):146===c?(E=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),x=1-(l-f)/(p-f),T.push(rX[c]),T.push(rH[c])):6===c?(I=1-(r-f)/(d-f),w=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),T.push(r$[c]),T.push(rW[c])):164===c?(I=(l-d)/(f-d),w=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),T.push(r$[c]),T.push(rW[c])):129===c?(b=1-(r-d)/(m-d),M=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(rH[c]),T.push(rY[c])):41===c?(b=(l-m)/(d-m),M=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(rH[c]),T.push(rY[c])):66===c?(w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=1-(r-f)/(p-f),T.push(rW[c]),T.push(rH[c])):104===c?(w=(l-m)/(d-m),b=(r-m)/(d-m),S=(r-m)/(p-m),v=(l-p)/(f-p),T.push(rH[c]),T.push(rJ[c])):144===c?(E=(r-d)/(f-d),M=(r-m)/(p-m),S=(l-m)/(p-m),x=1-(l-f)/(p-f),T.push(rX[c]),T.push(rK[c])):26===c?(E=1-(l-f)/(d-f),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),x=(r-p)/(f-p),T.push(rX[c]),T.push(rK[c])):36===c?(I=(l-d)/(f-d),w=(r-m)/(d-m),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(r$[c]),T.push(rW[c])):134===c?(I=1-(r-f)/(d-f),w=1-(l-d)/(m-d),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(r$[c]),T.push(rW[c])):9===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),b=(l-m)/(d-m),M=1-(r-p)/(m-p),T.push(rX[c]),T.push(r$[c])):161===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),b=1-(r-d)/(m-d),M=(l-m)/(p-m),T.push(rX[c]),T.push(r$[c])):37===c?(I=(l-d)/(f-d),M=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p),T.push(r$[c]),T.push(rY[c])):133===c?(I=1-(r-f)/(d-f),M=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f),T.push(r$[c]),T.push(rY[c])):148===c?(w=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),x=1-(l-f)/(p-f),T.push(rW[c]),T.push(rK[c])):22===c?(w=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),x=(r-p)/(f-p),T.push(rW[c]),T.push(rK[c])):82===c?(E=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),S=1-(l-p)/(m-p),T.push(rX[c]),T.push(rH[c])):88===c?(E=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),S=(r-m)/(p-m),T.push(rX[c]),T.push(rH[c])):73===c?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),b=(l-m)/(d-m),v=1-(r-f)/(p-f),T.push(rX[c]),T.push(r$[c])):97===c?(E=(l-d)/(f-d),I=(r-d)/(f-d),b=1-(r-d)/(m-d),v=(l-p)/(f-p),T.push(rX[c]),T.push(r$[c])):145===c?(E=(r-d)/(f-d),b=1-(r-d)/(m-d),M=(l-m)/(p-m),x=1-(l-f)/(p-f),T.push(rX[c]),T.push(rY[c])):25===c?(E=1-(l-f)/(d-f),b=(l-m)/(d-m),M=1-(r-p)/(m-p),x=(r-p)/(f-p),T.push(rX[c]),T.push(rY[c])):70===c?(I=1-(r-f)/(d-f),w=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=1-(r-f)/(p-f),T.push(r$[c]),T.push(rW[c])):100===c?(I=(l-d)/(f-d),w=(r-m)/(d-m),S=(r-m)/(p-m),v=(l-p)/(f-p),T.push(r$[c]),T.push(rW[c])):34===c?(0===y?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)):(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)),T.push(rX[c]),T.push(r$[c]),T.push(rY[c]),T.push(rK[c])):35===c?(4===y?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)):(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)),T.push(rX[c]),T.push(r$[c]),T.push(rH[c]),T.push(rK[c])):136===c?(0===y?(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)):(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)),T.push(rX[c]),T.push(r$[c]),T.push(rY[c]),T.push(rK[c])):153===c?(0===y?(E=(r-d)/(f-d),b=1-(r-d)/(m-d),M=1-(r-p)/(m-p),x=(r-p)/(f-p)):(E=1-(l-f)/(d-f),b=(l-m)/(d-m),M=(l-m)/(p-m),x=1-(l-f)/(p-f)),T.push(rX[c]),T.push(rH[c])):102===c?(0===y?(I=1-(r-f)/(d-f),w=(r-m)/(d-m),S=(r-m)/(p-m),v=1-(r-f)/(p-f)):(I=(l-d)/(f-d),w=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=(l-p)/(f-p)),T.push(r$[c]),T.push(rK[c])):155===c?(4===y?(E=(r-d)/(f-d),b=1-(r-d)/(m-d),M=1-(r-p)/(m-p),x=(r-p)/(f-p)):(E=1-(l-f)/(d-f),b=(l-m)/(d-m),M=(l-m)/(p-m),x=1-(l-f)/(p-f)),T.push(rX[c]),T.push(rY[c])):103===c?(4===y?(I=1-(r-f)/(d-f),w=(r-m)/(d-m),S=(r-m)/(p-m),v=1-(r-f)/(p-f)):(I=(l-d)/(f-d),w=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=(l-p)/(f-p)),T.push(r$[c]),T.push(rW[c])):152===c?(0===y?(E=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),x=(r-p)/(f-p)):(E=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),x=1-(l-f)/(p-f)),T.push(rX[c]),T.push(rW[c]),T.push(rH[c])):156===c?(4===y?(E=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),x=(r-p)/(f-p)):(E=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),x=1-(l-f)/(p-f)),T.push(rX[c]),T.push(rH[c]),T.push(rK[c])):137===c?(0===y?(E=(l-d)/(f-d),I=(r-d)/(f-d),b=1-(r-d)/(m-d),M=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)):(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),b=(l-m)/(d-m),M=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)),T.push(rX[c]),T.push(r$[c]),T.push(rH[c])):139===c?(4===y?(E=(l-d)/(f-d),I=(r-d)/(f-d),b=1-(r-d)/(m-d),M=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)):(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),b=(l-m)/(d-m),M=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)),T.push(rX[c]),T.push(r$[c]),T.push(rY[c])):98===c?(0===y?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),S=(r-m)/(p-m),v=1-(r-f)/(p-f)):(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=(l-p)/(f-p)),T.push(rX[c]),T.push(r$[c]),T.push(rK[c])):99===c?(4===y?(E=1-(r-f)/(d-f),I=1-(l-f)/(d-f),w=(l-m)/(d-m),b=(r-m)/(d-m),S=(r-m)/(p-m),v=1-(r-f)/(p-f)):(E=(l-d)/(f-d),I=(r-d)/(f-d),w=1-(r-d)/(m-d),b=1-(l-d)/(m-d),S=1-(l-p)/(m-p),v=(l-p)/(f-p)),T.push(rX[c]),T.push(r$[c]),T.push(rH[c])):38===c?(0===y?(I=1-(r-f)/(d-f),w=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)):(I=(l-d)/(f-d),w=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)),T.push(r$[c]),T.push(rY[c]),T.push(rK[c])):39===c?(4===y?(I=1-(r-f)/(d-f),w=(r-m)/(d-m),M=(r-m)/(p-m),S=(l-m)/(p-m),v=1-(l-f)/(p-f),x=1-(r-f)/(p-f)):(I=(l-d)/(f-d),w=1-(l-d)/(m-d),M=1-(l-p)/(m-p),S=1-(r-p)/(m-p),v=(r-p)/(f-p),x=(l-p)/(f-p)),T.push(r$[c]),T.push(rW[c]),T.push(rK[c])):85===c&&(E=1,I=0,w=1,b=0,M=0,S=1,v=0,x=1),(v<0||v>1||x<0||x>1||E<0||E>1||w<0||w>1||M<0||M>1||S<0||S>1)&&console.log("MarchingSquaresJS-isoBands: "+c+" "+g+" "+p+","+f+","+d+","+m+" "+y+" "+v+" "+x+" "+E+" "+I+" "+w+" "+b+" "+M+" "+S),a.cells[u][h]={cval:c,cval_real:g,flipped:y,topleft:v,topright:x,righttop:E,rightbottom:I,bottomright:w,bottomleft:b,leftbottom:M,lefttop:S,edges:T}}}}}return a}(i,r,n);return rf.polygons?(rf.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),s=[],a=0,f.cells.forEach(function(i,r){i.forEach(function(i,n){if(void 0!==i){var o=r0[i.cval](i);"object"==typeof o&&r1(o)?"object"==typeof o[0]&&r1(o[0])?"object"==typeof o[0][0]&&r1(o[0][0])?o.forEach(function(i){i.forEach(function(i){i[0]+=n,i[1]+=r}),s[a++]=i}):(o.forEach(function(i){i[0]+=n,i[1]+=r}),s[a++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),p=s):(rf.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),p=function(i){for(var r=[],n=i.rows,o=i.cols,s=[],a=0;a<n;a++)for(var l=0;l<o;l++)if(void 0!==i.cells[a][l]&&i.cells[a][l].edges.length>0){var u=function(i){if(i.edges.length>0){var r=i.edges[i.edges.length-1],n=i.cval_real;switch(r){case 0:return 16&n?{p:[1,i.righttop],x:-1,y:0,o:1}:{p:[i.topleft,1],x:0,y:-1,o:0};case 1:return 4&n?{p:[i.topleft,1],x:0,y:-1,o:0}:{p:[1,i.rightbottom],x:-1,y:0,o:0};case 2:return 4&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[i.topleft,1],x:0,y:-1,o:0};case 3:return 1&n?{p:[i.topleft,1],x:0,y:-1,o:0}:{p:[i.bottomleft,0],x:0,y:1,o:0};case 4:return 16&n?{p:[1,i.righttop],x:-1,y:0,o:1}:{p:[i.topright,1],x:0,y:-1,o:1};case 5:return 4&n?{p:[i.topright,1],x:0,y:-1,o:1}:{p:[1,i.rightbottom],x:-1,y:0,o:0};case 6:return 4&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[i.topright,1],x:0,y:-1,o:1};case 7:return 1&n?{p:[i.topright,1],x:0,y:-1,o:1}:{p:[i.bottomleft,0],x:0,y:1,o:0};case 8:return 4&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[1,i.righttop],x:-1,y:0,o:1};case 9:return 1&n?{p:[1,i.righttop],x:-1,y:0,o:1}:{p:[i.bottomleft,0],x:0,y:1,o:0};case 10:return 1&n?{p:[0,i.leftbottom],x:1,y:0,o:0}:{p:[1,i.righttop],x:-1,y:0,o:1};case 11:return 64&n?{p:[1,i.righttop],x:-1,y:0,o:1}:{p:[0,i.lefttop],x:1,y:0,o:1};case 12:return 4&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[1,i.rightbottom],x:-1,y:0,o:0};case 13:return 1&n?{p:[1,i.rightbottom],x:-1,y:0,o:0}:{p:[i.bottomleft,0],x:0,y:1,o:0};case 14:return 1&n?{p:[0,i.leftbottom],x:1,y:0,o:0}:{p:[1,i.rightbottom],x:-1,y:0,o:0};case 15:return 64&n?{p:[1,i.rightbottom],x:-1,y:0,o:0}:{p:[0,i.lefttop],x:1,y:0,o:1};case 16:return 4&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[0,i.leftbottom],x:1,y:0,o:0};case 17:return 64&n?{p:[i.bottomright,0],x:0,y:1,o:1}:{p:[0,i.lefttop],x:1,y:0,o:1};case 18:return 1&n?{p:[0,i.leftbottom],x:1,y:0,o:0}:{p:[i.bottomleft,0],x:0,y:1,o:0};case 19:return 64&n?{p:[i.bottomleft,0],x:0,y:1,o:0}:{p:[0,i.lefttop],x:1,y:0,o:1};case 20:return 64&n?{p:[i.topleft,1],x:0,y:-1,o:0}:{p:[0,i.leftbottom],x:1,y:0,o:0};case 21:return 16&n?{p:[0,i.leftbottom],x:1,y:0,o:0}:{p:[i.topright,1],x:0,y:-1,o:1};case 22:return 64&n?{p:[i.topleft,1],x:0,y:-1,o:0}:{p:[0,i.lefttop],x:1,y:0,o:1};case 23:return 16&n?{p:[0,i.lefttop],x:1,y:0,o:1}:{p:[i.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(i)}}return null}(i.cells[a][l]),h=null,c=l,p=a;null!==u&&s.push([u.p[0]+c,u.p[1]+p]);do{if(null===(h=function(i,r,n,o){var s,a,l,u,h,c=i.cval;switch(r){case -1:0===o?(s=r$[c],l=rE[c],u=rI[c],h=rS[c]):(s=rX[c],l=rx[c],u=rb[c],h=rw[c]);break;case 1:0===o?(s=rY[c],l=rN[c],u=rO[c],h=rz[c]):(s=rK[c],l=rk[c],u=rR[c],h=rD[c]);break;default:switch(n){case -1:0===o?(s=rJ[c],l=rd[c],u=rm[c],h=rg[c]):(s=rQ[c],l=ry[c],u=r_[c],h=rv[c]);break;case 1:0===o?(s=rH[c],l=rM[c],u=rT[c],h=rC[c]):(s=rW[c],l=rP[c],u=rA[c],h=rL[c])}}if(a=i.edges.indexOf(s),void 0===i.edges[a])return null;switch(function(i,r){delete i.edges[r];for(var n=r+1;n<i.edges.length;n++)i.edges[n-1]=i.edges[n];i.edges.pop()}(i,a),c=i.cval_real,s){case 0:16&c?(r=i.topleft,n=1):(r=1,n=i.righttop);break;case 1:4&c?(r=1,n=i.rightbottom):(r=i.topleft,n=1);break;case 2:4&c?(r=i.topleft,n=1):(r=i.bottomright,n=0);break;case 3:1&c?(r=i.bottomleft,n=0):(r=i.topleft,n=1);break;case 4:16&c?(r=i.topright,n=1):(r=1,n=i.righttop);break;case 5:4&c?(r=1,n=i.rightbottom):(r=i.topright,n=1);break;case 6:4&c?(r=i.topright,n=1):(r=i.bottomright,n=0);break;case 7:1&c?(r=i.bottomleft,n=0):(r=i.topright,n=1);break;case 8:4&c?(r=1,n=i.righttop):(r=i.bottomright,n=0);break;case 9:1&c?(r=i.bottomleft,n=0):(r=1,n=i.righttop);break;case 10:1&c?(r=1,n=i.righttop):(r=0,n=i.leftbottom);break;case 11:64&c?(r=0,n=i.lefttop):(r=1,n=i.righttop);break;case 12:4&c?(r=1,n=i.rightbottom):(r=i.bottomright,n=0);break;case 13:1&c?(r=i.bottomleft,n=0):(r=1,n=i.rightbottom);break;case 14:1&c?(r=1,n=i.rightbottom):(r=0,n=i.leftbottom);break;case 15:64&c?(r=0,n=i.lefttop):(r=1,n=i.rightbottom);break;case 16:4&c?(r=0,n=i.leftbottom):(r=i.bottomright,n=0);break;case 17:64&c?(r=0,n=i.lefttop):(r=i.bottomright,n=0);break;case 18:1&c?(r=i.bottomleft,n=0):(r=0,n=i.leftbottom);break;case 19:64&c?(r=0,n=i.lefttop):(r=i.bottomleft,n=0);break;case 20:64&c?(r=0,n=i.leftbottom):(r=i.topleft,n=1);break;case 21:16&c?(r=i.topright,n=1):(r=0,n=i.leftbottom);break;case 22:64&c?(r=0,n=i.lefttop):(r=i.topleft,n=1);break;case 23:16&c?(r=i.topright,n=1):(r=0,n=i.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(i),null}return void 0!==r&&void 0!==n&&void 0!==l&&void 0!==u&&void 0!==h||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(i),console.log(r+" "+n+" "+l+" "+u+" "+h)),{p:[r,n],x:l,y:u,o:h}}(i.cells[p][c],u.x,u.y,u.o)))break;if(s.push([h.p[0]+c,h.p[1]+p]),c+=h.x,u=h,(p+=h.y)<0||p>=n||c<0||c>=o||void 0===i.cells[p][c]){var f=function(i,r,n,o,s,a){for(var l=i.cells[n][r],u=l.cval_real,h=r+o,c=n+s,p=[],f=!1;!f;){if(void 0===i.cells[c]||void 0===i.cells[c][h]){if(c-=s,h-=o,u=(l=i.cells[c][h]).cval_real,-1===s){if(0===a){if(1&u)p.push([h,c]),o=-1,s=0,a=0;else{if(!(4&u)){p.push([h+l.bottomright,c]),o=0,s=1,a=1,f=!0;break}p.push([h+1,c]),o=1,s=0,a=0}}else{if(!(1&u)){if(4&u){p.push([h+l.bottomright,c]),o=0,s=1,a=1,f=!0;break}p.push([h+l.bottomleft,c]),o=0,s=1,a=0,f=!0;break}p.push([h,c]),o=-1,s=0,a=0}}else if(1===s){if(0===a){if(!(16&u)){if(64&u){p.push([h+l.topleft,c+1]),o=0,s=-1,a=0,f=!0;break}p.push([h+l.topright,c+1]),o=0,s=-1,a=1,f=!0;break}p.push([h+1,c+1]),o=1,s=0,a=1}else p.push([h+1,c+1]),o=1,s=0,a=1}else if(-1===o){if(0===a){if(!(64&u)){if(1&u){p.push([h,c+l.leftbottom]),o=1,s=0,a=0,f=!0;break}p.push([h,c+l.lefttop]),o=1,s=0,a=1,f=!0;break}p.push([h,c+1]),o=0,s=1,a=0}else{if(!(64&u)){console.log("MarchingSquaresJS-isoBands: wtf");break}p.push([h,c+1]),o=0,s=1,a=0}}else{if(1!==o){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===a){if(!(4&u)){p.push([h+1,c+l.rightbottom]),o=-1,s=0,a=0,f=!0;break}p.push([h+1,c]),o=0,s=-1,a=1}else{if(!(4&u)){if(16&u){p.push([h+1,c+l.righttop]),o=-1,s=0,a=1;break}p.push([h+1,c+l.rightbottom]),o=-1,s=0,a=0,f=!0;break}p.push([h+1,c]),o=0,s=-1,a=1}}}else if(u=(l=i.cells[c][h]).cval_real,-1===o){if(0===a){if(void 0!==i.cells[c-1]&&void 0!==i.cells[c-1][h])o=0,s=-1,a=1;else{if(!(1&u)){p.push([h+l.bottomright,c]),o=0,s=1,a=1,f=!0;break}p.push([h,c])}}else{if(!(64&u)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+h+","+c);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}}else if(1===o){if(0===a){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==i.cells[c+1]&&void 0!==i.cells[c+1][h])o=0,s=1,a=0;else{if(!(16&u)){p.push([h+l.topleft,c+1]),o=0,s=-1,a=0,f=!0;break}p.push([h+1,c+1]),o=1,s=0,a=1}}else if(-1===s){if(1!==a){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==i.cells[c][h+1])o=1,s=0,a=1;else{if(!(4&u)){p.push([h+1,c+l.righttop]),o=-1,s=0,a=1,f=!0;break}p.push([h+1,c]),o=0,s=-1,a=1}}else{if(1!==s){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==a){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==i.cells[c][h-1])o=-1,s=0,a=0;else{if(!(64&u)){p.push([h,c+l.leftbottom]),o=1,s=0,a=0,f=!0;break}p.push([h,c+1]),o=0,s=1,a=0}}if(c+=s,(h+=o)===r&&c===n)break}return{path:p,i:h,j:c,x:o,y:s,o:a}}(i,c-=h.x,p-=h.y,h.x,h.y,h.o);if(null===f)break;f.path.forEach(function(i){s.push(i)}),c=f.i,p=f.j,u=f}}while(void 0!==i.cells[p][c]&&i.cells[p][c].edges.length>0)r.push(s),s=[],i.cells[a][l].edges.length>0&&l--}return r}(f)),"function"==typeof rf.successCallback&&rf.successCallback(p),p}(i,a,l-a))),h={};h.groupedRings=u,h[n]=a+"-"+l,o.push(h)}return o}(w,r,y);return _((o=E,a=(s=te(i))[2]-s[0],l=s[3]-s[1],u=s[0],h=s[1],c=w[0].length-1,p=w.length-1,f=a/c,m=l/p,g=function(i){i[0]=i[0]*f+u,i[1]=i[1]*m+h},o.forEach(function(i){i.groupedRings.forEach(function(i){i.forEach(function(i){i.forEach(g)})})}),E=o).map(function(i,r){if(x[r]&&!R(x[r]))throw Error("Each mappedProperty is required to be an Object");var n=td({},v,x[r]);return n[y]=i[y],b(i.groupedRings,n)}))},i.isolines=function(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o,s,a,l,u,h,c,p,f,d,m,g=n.zProperty||"elevation",y=n.commonProperties||{},x=n.breaksProperties||[];if(ta(i,"Point","Input must contain Points"),!r)throw Error("breaks is required");if(!Array.isArray(r))throw Error("breaks must be an Array");if(!R(y))throw Error("commonProperties must be an Object");if(!Array.isArray(x))throw Error("breaksProperties must be an Array");var b=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n,o=r.zProperty||"elevation",s=r.flip,a=r.flags;ta(i,"Point","input must contain Points");for(var l=(n={},G(i,function(i){var r=tr(i)[1];n[r]||(n[r]=[]),n[r].push(i)}),Object.keys(n).map(function(i){return n[i].sort(function(i,r){return tr(i)[0]-tr(r)[0]})}).sort(function(i,r){return s?tr(i[0])[1]-tr(r[0])[1]:tr(r[0])[1]-tr(i[0])[1]})),u=[],h=0;h<l.length;h++){for(var c=l[h],p=[],f=0;f<c.length;f++){var d=c[f];d.properties[o]?p.push(d.properties[o]):p.push(0),!0===a&&(d.properties.matrixPosition=[h,f])}u.push(p)}return u}(i,{zProperty:g,flip:!0});return _((o=function(i,r,n,o,s){for(var a=[],l=1;l<r.length;l++){var u=+r[l],h=td({},o,s[l]);h[n]=u;var c=v(/**
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */function(i,r,n){n=n||{};for(var o,s,a,l=Object.keys(tm),u=0;u<l.length;u++){var h=l[u],c=n[h];c=null!=c?c:tm[h],tg[h]=c}tg.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+r);var p=(o=function(i,r){for(var n=i.length-1,o=i[0].length-1,s={rows:n,cols:o,cells:[]},a=0;a<n;++a){s.cells[a]=[];for(var l=0;l<o;++l){var u=0,h=i[a+1][l],c=i[a+1][l+1],p=i[a][l+1],f=i[a][l];if(!(isNaN(h)||isNaN(c)||isNaN(p)||isNaN(f))){u|=8*(h>=r),u|=4*(c>=r),u|=2*(p>=r);var d,m,g,y,_=!1;if(5==(u|=+(f>=r))||10===u){var v=(h+c+p+f)/4;5===u&&v<r?(u=10,_=!0):10===u&&v<r&&(u=5,_=!0)}0!==u&&15!==u&&(d=m=g=y=.5,1===u?(g=1-(r-h)/(f-h),m=1-(r-p)/(f-p)):2===u?(m=(r-f)/(p-f),y=1-(r-c)/(p-c)):3===u?(g=1-(r-h)/(f-h),y=1-(r-c)/(p-c)):4===u?(d=(r-h)/(c-h),y=(r-p)/(c-p)):5===u?(d=(r-h)/(c-h),y=(r-p)/(c-p),m=1-(r-p)/(f-p),g=1-(r-h)/(f-h)):6===u?(m=(r-f)/(p-f),d=(r-h)/(c-h)):7===u?(g=1-(r-h)/(f-h),d=(r-h)/(c-h)):8===u?(g=(r-f)/(h-f),d=1-(r-c)/(h-c)):9===u?(m=1-(r-p)/(f-p),d=1-(r-c)/(h-c)):10===u?(d=1-(r-c)/(h-c),y=1-(r-c)/(p-c),m=(r-f)/(p-f),g=(r-f)/(h-f)):11===u?(d=1-(r-c)/(h-c),y=1-(r-c)/(p-c)):12===u?(g=(r-f)/(h-f),y=(r-p)/(c-p)):13===u?(m=1-(r-p)/(f-p),y=(r-p)/(c-p)):14===u?(g=(r-f)/(h-f),m=(r-f)/(p-f)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+u),s.cells[a][l]={cval:u,flipped:_,top:d,right:y,bottom:m,left:g})}}}return s}(i,r),s=[],a=0,o.cells.forEach(function(i,r){i.forEach(function(i,n){if(void 0!==i&&5!==(l=i).cval&&10!==l.cval&&!ty(i)){var l,u=function(i,r,n){var o,s,a=i.length,l=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],h=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],p=i[r][n],f=p.cval,d=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][f],m=tv(p,d);l.push([n+m[0],r+m[1]]),m=tv(p,d=c[f]),l.push([n+m[0],r+m[1]]),t_(p);for(var g=n+u[f],y=r+h[f],_=f;g>=0&&y>=0&&y<a&&(g!=n||y!=r)&&void 0!==(p=i[y][g]);){if(0===(f=p.cval)||15===f)return{path:l,info:"mergeable"};d=c[f],o=u[f],s=h[f],5!==f&&10!==f||(5===f?p.flipped?(-1===h[_]?(d="left",o=-1):(d="right",o=1),s=0):-1===u[_]&&(d="bottom",o=0,s=-1):10===f&&(p.flipped?-1===u[_]?(d="top",o=0,s=1):(d="bottom",o=0,s=-1):1===h[_]&&(d="left",o=-1,s=0))),m=tv(p,d),l.push([g+m[0],y+m[1]]),t_(p),g+=o,y+=s,_=f}return{path:l,info:"closed"}}(o.cells,r,n),h=!1;if("mergeable"===u.info){for(var c=u.path[u.path.length-1][0],p=u.path[u.path.length-1][1],f=a-1;f>=0;f--)if(1e-7>=Math.abs(s[f][0][0]-c)&&1e-7>=Math.abs(s[f][0][1]-p)){for(var d=u.path.length-2;d>=0;--d)s[f].unshift(u.path[d]);h=!0;break}}h||(s[a++]=u.path)}})}),s);return"function"==typeof tg.successCallback&&tg.successCallback(p),p}(i,u),h);a.push(c)}return a}(b,r,g,y,x),a=(s=te(i))[2]-s[0],l=s[3]-s[1],u=s[0],h=s[1],c=b[0].length-1,p=b.length-1,f=a/c,d=l/p,m=function(i){i[0]=i[0]*f+u,i[1]=i[1]*d+h},o.forEach(function(i){z(i,m)}),o))},i.kinks=function(i){var r,n,o={type:"FeatureCollection",features:[]};if("LineString"===(n="Feature"===i.type?i.geometry:i).type)r=[n.coordinates];else if("MultiLineString"===n.type)r=n.coordinates;else if("MultiPolygon"===n.type)r=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");r=n.coordinates}return r.forEach(function(i){r.forEach(function(r){for(var n=0;n<i.length-1;n++)for(var s=n;s<r.length-1;s++)if(i!==r||1!==Math.abs(n-s)&&(0!==n||s!==i.length-2||i[n][0]!==i[i.length-1][0]||i[n][1]!==i[i.length-1][1])){var a=function(i,r,n,o,s,a,l,u){var h,c,p,f,d={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(h=(u-a)*(n-i)-(l-s)*(o-r))?null!==d.x&&null!==d.y&&d:(f=(n-i)*(c=r-a)-(o-r)*(p=i-s),c=((l-s)*c-(u-a)*p)/h,p=f/h,d.x=i+c*(n-i),d.y=r+c*(o-r),c>=0&&c<=1&&(d.onLine1=!0),p>=0&&p<=1&&(d.onLine2=!0),!(!d.onLine1||!d.onLine2)&&[d.x,d.y])}(i[n][0],i[n][1],i[n+1][0],i[n+1][1],r[s][0],r[s][1],r[s+1][0],r[s+1][1]);a&&o.features.push(p([a[0],a[1]]))}})}),o},i.length=iM,i.lengthToDegrees=M,i.lengthToRadians=S,i.lineArc=iY,i.lineChunk=function(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o=n.units,s=n.reverse;if(!i)throw Error("geojson is required");if(r<=0)throw Error("segmentLength must be greater than 0");var a=[];return X(i,function(i){s&&(i.geometry.coordinates=i.geometry.coordinates.reverse()),function(i,r,n,o){var s=iM(i,{units:n});if(s<=r)return o(i);var a=s/r;Number.isInteger(a)||(a=Math.floor(a)+1);for(var l=0;l<a;l++)o(iT(i,r*l,r*(l+1),{units:n}),l)}(i,r,o,function(i){a.push(i)})}),_(a)},i.lineDistance=iM,i.lineEach=Y,i.lineIntersect=ip,i.lineOffset=function(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o=n.units;if(!i)throw Error("geojson is required");if(null==r||isNaN(r))throw Error("distance is required");var s=tu(i),a=i.properties;switch(s){case"LineString":return r8(i,r,o);case"MultiLineString":var l=[];return X(i,function(i){l.push(r8(i,r,o).geometry.coordinates)}),v(l,a);default:throw Error("geometry "+s+" is not supported")}},i.lineOverlap=rt,i.lineReduce=K,i.lineSegment=e6,i.lineSlice=function(i,r,n){var o=tr(n);if("LineString"!==tu(n))throw Error("line must be a LineString");for(var s,a=im(n,i),l=im(n,r),u=[(s=a.properties.index<=l.properties.index?[a,l]:[l,a])[0].geometry.coordinates],h=s[0].properties.index+1;h<s[1].properties.index+1;h++)u.push(o[h]);return u.push(s[1].geometry.coordinates),g(u,n.properties)},i.lineSliceAlong=iT,i.lineSplit=function(i,r){if(!i)throw Error("line is required");if(!r)throw Error("splitter is required");var n=tu(i),o=tu(r);if("LineString"!==n)throw Error("line must be LineString");if("FeatureCollection"===o)throw Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===o)throw Error("splitter cannot be a GeometryCollection");var s=iR(r,{precision:7});switch(o){case"Point":return i$(i,s);case"MultiPoint":return iX(i,s);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return iX(i,ip(i,s))}},i.lineString=g,i.lineStringToPolygon=i1,i.lineStrings=y,i.lineToPolygon=i1,i.mask=function(i,r){var n=d(r&&r.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]);return("FeatureCollection"===i.type?b(2===i.features.length?st.union(i.features[0].geometry.coordinates,i.features[1].geometry.coordinates):st.union.apply(st,i.features.map(function(i){return i.geometry.coordinates}))):b(st.union(i.geometry.coordinates))).geometry.coordinates.forEach(function(i){n.geometry.coordinates.push(i[0])}),n},i.meta=tt,i.midpoint=function(i,r){return eO(i,ee(i,r)/2,eF(i,r))},i.moranIndex=function(i,r){var n=r.inputField,o=r.threshold||1e5,s=r.p||2,a=r.binary||!1,l=oo(i,{alpha:r.alpha||-1,binary:a,p:s,standardization:r.standardization||!0,threshold:o}),u=[];G(i,function(i){var r=i.properties||{};u.push(r[n])});for(var h=os(u),c=function(i){for(var r=os(i),n=0,o=0;o<i.length;o++)n+=Math.pow(i[o]-r,2);return n/i.length}(u),p=0,f=0,d=0,m=0,g=l.length,y=0;y<g;y++){for(var _=0,v=0;v<g;v++)p+=l[y][v]*(u[y]-h)*(u[v]-h),f+=l[y][v],d+=Math.pow(l[y][v]+l[v][y],2),_+=l[y][v]+l[v][y];m+=Math.pow(_,2)}var x=p/f/c,b=-1/(g-1),w=Math.sqrt((g*g*(d*=.5)-g*m+f*f*3)/((g-1)*(g+1)*(f*f))-b*b);return{expectedMoranIndex:b,moranIndex:x,stdNorm:w,zNorm:(x-b)/w}},i.multiLineString=v,i.multiPoint=x,i.multiPolygon=b,i.nearest=e4,i.nearestPoint=e4,i.nearestPointOnLine=im,i.nearestPointToLine=function(i,r,n){void 0===n&&(n={});var o=n.units,s=n.properties||{},a=function(i){var r=[];switch(i.geometry?i.geometry.type:i.type){case"GeometryCollection":return j(i,function(i){"Point"===i.type&&r.push({type:"Feature",properties:{},geometry:i})}),{type:"FeatureCollection",features:r};case"FeatureCollection":return i.features=i.features.filter(function(i){return"Point"===i.geometry.type}),i;default:throw Error("points must be a Point Collection")}}(i);if(!a.features.length)throw Error("points must contain features");if(!r)throw Error("line is required");if("LineString"!==tu(r))throw Error("line must be a LineString");var l=1/0,u=null;return G(a,function(i){var n=iy(i,r,{units:o});n<l&&(l=n,u=i)}),u&&(u.properties=td({dist:l},u.properties,s)),u},i.planepoint=function(i,r){var n=ti(i),o=tl(r).coordinates[0];if(o.length<4)throw Error("OuterRing of a Polygon must have 4 or more Positions.");var s=r.properties||{},a=s.a,l=s.b,u=s.c,h=n[0],c=n[1],p=o[0][0],f=o[0][1],d=void 0!==a?a:o[0][2],m=o[1][0],g=o[1][1],y=void 0!==l?l:o[1][2],_=o[2][0],v=o[2][1],x=void 0!==u?u:o[2][2];return(x*(h-p)*(c-g)+d*(h-m)*(c-v)+y*(h-_)*(c-f)-y*(h-p)*(c-v)-x*(h-m)*(c-f)-d*(h-_)*(c-g))/((h-p)*(c-g)+(h-m)*(c-v)+(h-_)*(c-f)-(h-p)*(c-v)-(h-m)*(c-f)-(h-_)*(c-g))},i.point=p,i.pointGrid=ik,i.pointOnFeature=ix,i.pointOnLine=im,i.pointOnSurface=ix,i.pointToLineDistance=iy,i.points=f,i.pointsWithinPolygon=et,i.polygon=d,i.polygonSmooth=function(i,r){var n=[],o=r.iterations||1;if(!i)throw Error("inputPolys is required");return j(i,function(i,r,s){var a,l,u;switch(i.type){case"Polygon":a=[[]];for(var h=0;h<o;h++)u=[[]],l=i,h>0&&(l=d(a).geometry),function(i,r){var n=0,o=0;z(i,function(s,a,l,u,h){h>n&&(n=h,o=a,r.push([]));var c=a-o,p=i.coordinates[h][c+1],f=s[0],d=s[1],m=p[0],g=p[1];r[h].push([.75*f+.25*m,.75*d+.25*g]),r[h].push([.25*f+.75*m,.25*d+.75*g])},!0),r.forEach(function(i){i.push(i[0])})}(l,u),a=u.slice(0);n.push(d(a,s));break;case"MultiPolygon":a=[[[]]];for(var c=0;c<o;c++)u=[[[]]],l=i,c>0&&(l=b(a).geometry),function(i,r){var n=0,o=0,s=0;z(i,function(a,l,u,h,c){h>s&&(s=h,o=l,r.push([[]])),c>n&&(n=c,o=l,r[h].push([]));var p=l-o,f=i.coordinates[h][c][p+1],d=a[0],m=a[1],g=f[0],y=f[1];r[h][c].push([.75*d+.25*g,.75*m+.25*y]),r[h][c].push([.25*d+.75*g,.25*m+.75*y])},!0),r.forEach(function(i){i.forEach(function(i){i.push(i[0])})})}(l,u),a=u.slice(0);n.push(b(a,s));break;default:throw Error("geometry is invalid, must be Polygon or MultiPolygon")}}),_(n)},i.polygonTangents=function(i,r){var n,o,s,a,l=tr(i),u=tr(r),h=te(r),c=0,f=null;switch(l[0]>h[0]&&l[0]<h[2]&&l[1]>h[1]&&l[1]<h[3]&&(c=(f=e4(i,eG(r))).properties.featureIndex),tu(r)){case"Polygon":n=u[0][c],o=u[0][0],null!==f&&f.geometry.coordinates[1]<l[1]&&(o=u[0][c]),a=ra(u[0][0],u[0][u[0].length-1],l);var d=rs(u[0],l,a,s,n,o);n=d[0],o=d[1];break;case"MultiPolygon":for(var m=0,g=0,y=0,v=0;v<u[0].length;v++){m=v;for(var x=!1,b=0;b<u[0][v].length;b++){if(g=b,y===c){x=!0;break}y++}if(x)break}n=u[0][m][g],o=u[0][m][g],a=ra(u[0][0][0],u[0][0][u[0][0].length-1],l),u.forEach(function(i){var r=rs(i[0],l,a,s,n,o);n=r[0],o=r[1]})}return _([p(n),p(o)])},i.polygonToLine=iJ,i.polygonToLineString=iJ,i.polygonize=function(i){var r=nr.fromGeoJson(i);r.deleteDangles(),r.deleteCutEdges();var n=[],o=[];return r.getEdgeRings().filter(function(i){return i.isValid()}).forEach(function(i){i.isHole()?n.push(i):o.push(i)}),n.forEach(function(i){ni.findEdgeRingContaining(i,o)&&o.push(i)}),_(o.map(function(i){return i.toPolygon()}))},i.polygons=m,i.projection=op,i.propEach=B,i.propReduce=U,i.propertiesContainsFilter=oM,i.radians2degrees=C,i.radiansToDegrees=C,i.radiansToDistance=I,i.radiansToLength=I,i.random=ox,i.randomLineString=oy,i.randomPoint=om,i.randomPolygon=og,i.randomPosition=od,i.rewind=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=r.reverse||!1,o=r.mutate||!1;if(!i)throw Error("<geojson> is required");if("boolean"!=typeof n)throw Error("<reverse> must be a boolean");if("boolean"!=typeof o)throw Error("<mutate> must be a boolean");!1===o&&(i=eo(i));var s=[];switch(i.type){case"GeometryCollection":return j(i,function(i){ru(i,n)}),i;case"FeatureCollection":return G(i,function(i){G(ru(i,n),function(i){s.push(i)})}),_(s)}return ru(i,n)},i.rhumbBearing=rr,i.rhumbDestination=ro,i.rhumbDistance=ig,i.round=E,i.sample=function(i,r){if(!i)throw Error("featurecollection is required");if(null==r)throw Error("num is required");if("number"!=typeof r)throw Error("num must be a number");return _(function(i,r){for(var n,o,s=i.slice(0),a=i.length,l=a-r;a-- >l;)n=s[o=Math.floor((a+1)*Math.random())],s[o]=s[a],s[a]=n;return s.slice(l)}(i.features,r))},i.sector=function(i,r,n,o,s){if(!R(s=s||{}))throw Error("options is invalid");var a=s.properties;if(!i)throw Error("center is required");if(null==n)throw Error("bearing1 is required");if(null==o)throw Error("bearing2 is required");if(!r)throw Error("radius is required");if("object"!=typeof s)throw Error("options must be an object");if(ri(n)===ri(o))return ez(i,r,s);var l=tr(i),u=iY(i,r,n,o,s),h=[[l]];return z(u,function(i){h[0].push(i)}),h[0].push(l),d(h,a)},i.segmentEach=W,i.segmentReduce=H,i.shortestPath=function(i,r,n){if(!R(n=n||{}))throw Error("options is invalid");var o=n.resolution,s=n.minDistance,a=n.obstacles||_([]);if(!i)throw Error("start is required");if(!r)throw Error("end is required");if(o&&!k(o)||o<=0)throw Error("options.resolution must be a number, greater than 0");if(s)throw Error("options.minDistance is not yet implemented");var l=ti(i),u=ti(r);switch(i=p(l),r=p(u),tu(a)){case"FeatureCollection":if(0===a.features.length)return g([l,u]);break;case"Polygon":a=_([h(tl(a))]);break;default:throw Error("invalid obstacles")}var c=a;c.features.push(i),c.features.push(r);var f=te(r3(eR(te(c)),1.15));o||(o=ee([f[0],f[1]],[f[2],f[1]],n)/100),c.features.pop(),c.features.pop();for(var d=f[0],m=f[1],y=f[2],v=f[3],x=o/ee([d,m],[y,m],n)*(y-d),b=o/ee([d,m],[d,v],n)*(v-m),w=y-d,E=v-m,I=Math.floor(w/x),S=Math.floor(E/b),M=(w-I*x)/2,T=[],C=[],P=[],A=[],L=1/0,D=1/0,N=v-(E-S*b)/2,O=0;N>=m;){for(var z=[],F=[],B=d+M,U=0;B<=y;){var G=p([B,N]),V=function(i,r){for(var n=0;n<r.features.length;n++)if(t9(i,r.features[n]))return!0;return!1}(G,a);z.push(+!V),F.push(B+"|"+N);var q=ee(G,i);!V&&q<L&&(L=q,P={x:U,y:O});var j=ee(G,r);!V&&j<D&&(D=j,A={x:U,y:O}),B+=x,U++}C.push(z),T.push(F),N-=b,O++}var Z=new nk(C,{diagonal:!0}),X=Z.grid[P.y][P.x],$=Z.grid[A.y][A.x],W=nL.search(Z,X,$),H=[l];return W.forEach(function(i){var r=T[i.x][i.y].split("|");H.push([+r[0],+r[1]])}),H.push(u),eI(g(H))},i.simplify=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=void 0!==r.tolerance?r.tolerance:1,o=r.highQuality||!1,s=r.mutate||!1;if(!i)throw Error("geojson is required");if(n&&n<0)throw Error("invalid tolerance");return!0!==s&&(i=eo(i)),j(i,function(i){!function(i,r,n){var o=i.type;if("Point"!==o&&"MultiPoint"!==o){eI(i,!0);var s=i.coordinates;switch(o){case"LineString":i.coordinates=eP(s,r,n);break;case"MultiLineString":i.coordinates=s.map(function(i){return eP(i,r,n)});break;case"Polygon":i.coordinates=eA(s,r,n);break;case"MultiPolygon":i.coordinates=s.map(function(i){return eA(i,r,n)})}}}(i,n,o)}),i},i.square=eN,i.squareGrid=c0,i.standardDeviationalEllipse=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=r.steps||64,o=r.weight,s=r.properties||{};if(!k(n))throw Error("steps must be a number");if(!R(s))throw Error("properties must be a number");var a=q(i).length,l=or(i,{weight:o}),u=0,h=0,c=0;G(i,function(i){var r=i.properties[o]||1,n=on(tr(i),tr(l));u+=Math.pow(n.x,2)*r,h+=Math.pow(n.y,2)*r,c+=n.x*n.y*r});var p=u-h,f=Math.sqrt(Math.pow(p,2)+4*Math.pow(c,2)),d=Math.atan((p+f)/(2*c)),m=180*d/Math.PI,g=0,y=0,v=0;G(i,function(i){var r=i.properties[o]||1,n=on(tr(i),tr(l));g+=Math.pow(n.x*Math.cos(d)-n.y*Math.sin(d),2)*r,y+=Math.pow(n.x*Math.sin(d)+n.y*Math.cos(d),2)*r,v+=r});var x=Math.sqrt(2*g/v),b=Math.sqrt(2*y/v),w=oe(l,x,b,{units:"degrees",angle:m,steps:n,properties:s}),E=et(i,_([w])),I={meanCenterCoordinates:tr(l),semiMajorAxis:x,semiMinorAxis:b,numberOfFeatures:a,angle:m,percentageWithinEllipse:100*q(E).length/a};return w.properties.standardDeviationalEllipse=I,w},i.tag=function(i,r,n,o){return i=eo(i),r=eo(r),G(i,function(i){i.properties||(i.properties={}),G(r,function(r){void 0===i.properties[o]&&t9(i,r)&&(i.properties[o]=r.properties[n])})}),i},i.tesselate=function(i){if(!i.geometry||"Polygon"!==i.geometry.type&&"MultiPolygon"!==i.geometry.type)throw Error("input must be a Polygon or MultiPolygon");var r={type:"FeatureCollection",features:[]};return"Polygon"===i.geometry.type?r.features=e5(i.geometry.coordinates):i.geometry.coordinates.forEach(function(i){r.features=r.features.concat(e5(i))}),r},i.tin=ei,i.toMercator=oa,i.toWgs84=ol,i.transformRotate=r2,i.transformScale=r3,i.transformTranslate=function(i,r,n,o){if(!R(o=o||{}))throw Error("options is invalid");var s=o.units,a=o.zTranslation,l=o.mutate;if(!i)throw Error("geojson is required");if(null==r||isNaN(r))throw Error("distance is required");if(a&&"number"!=typeof a&&isNaN(a))throw Error("zTranslation is not a number");if(a=void 0!==a?a:0,0===r&&0===a)return i;if(null==n||isNaN(n))throw Error("direction is required");return r<0&&(r=-r,n+=180),!1!==l&&void 0!==l||(i=eo(i)),z(i,function(i){var o=tr(ro(i,r,n,{units:s}));i[0]=o[0],i[1]=o[1],a&&3===i.length&&(i[2]+=a)}),i},i.triangleGrid=c1,i.truncate=iR,i.union=function(i,r,n){void 0===n&&(n={});var o=tl(i),s=tl(r),a=st.union(o.coordinates,s.coordinates);return 0===a.length?null:1===a.length?d(a[0],n.properties):b(a,n.properties)},i.unitsFactors=l,i.unkinkPolygon=function(i){var r=[];return X(i,function(i){"Polygon"===i.geometry.type&&G(function(i){if("Feature"!=i.type)throw Error("The input must a geojson object of type Feature");if(void 0===i.geometry||null==i.geometry)throw Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=i.geometry.type)throw Error("The input must be a geojson Polygon");for(var r=i.geometry.coordinates.length,n=[],o=0;o<r;o++){var s=i.geometry.coordinates[o];iB(s[0],s[s.length-1])||s.push(s[0]),n.push.apply(n,s.slice(0,s.length-1))}if(!function(i){for(var r={},n=1,o=0,s=i.length;o<s;++o){if(Object.prototype.hasOwnProperty.call(r,i[o])){n=0;break}r[i[o]]=1}return n}(n))throw Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var a=n.length,l=function(i,r,n){if("Polygon"!==i.geometry.type)throw Error("The input feature must be a Polygon");void 0===n&&(n=1);var o=i.geometry.coordinates,s=[],a={};if(n){for(var l=[],u=0;u<o.length;u++)for(var h=0;h<o[u].length-1;h++)l.push(y(u,h));var c=tI();c.load(l)}for(var p=0;p<o.length;p++)for(var f=0;f<o[p].length-1;f++)if(n)c.search(y(p,f)).forEach(function(i){var r=i.ring,n=i.edge;g(p,f,r,n)});else for(var d=0;d<o.length;d++)for(var m=0;m<o[d].length-1;m++)g(p,f,d,m);return r||(s={type:"Feature",geometry:{type:"MultiPoint",coordinates:s}}),s;function g(i,n,l,u){var h,c,p=o[i][n],f=o[i][n+1],d=o[l][u],m=o[l][u+1],g=function(i,r,n,o){if(iN(i,n)||iN(i,o)||iN(r,n)||iN(o,n))return null;var s=i[0],a=i[1],l=r[0],u=r[1],h=n[0],c=n[1],p=o[0],f=o[1],d=(s-l)*(c-f)-(a-u)*(h-p);return 0===d?null:[((s*u-a*l)*(h-p)-(s-l)*(h*f-c*p))/d,((s*u-a*l)*(c-f)-(a-u)*(h*f-c*p))/d]}(p,f,d,m);if(null!==g&&(h=f[0]!==p[0]?(g[0]-p[0])/(f[0]-p[0]):(g[1]-p[1])/(f[1]-p[1]),c=m[0]!==d[0]?(g[0]-d[0])/(m[0]-d[0]):(g[1]-d[1])/(m[1]-d[1]),!(h>=1||h<=0||c>=1||c<=0))){var y=!a[g];y&&(a[g]=!0),r?s.push(r(g,i,n,p,f,h,l,u,d,m,c,y)):s.push(g)}}function y(i,r){var n,s,a,l,u=o[i][r],h=o[i][r+1];return u[0]<h[0]?(n=u[0],s=h[0]):(n=h[0],s=u[0]),u[1]<h[1]?(a=u[1],l=h[1]):(a=h[1],l=u[1]),{minX:n,minY:a,maxX:s,maxY:l,ring:i,edge:r}}}(i,function(i,r,n,o,s,a,l,u,h,c,p,f){return[i,r,n,o,s,a,l,u,h,c,p,f]}),u=l.length;if(0==u){var h=[];for(o=0;o<r;o++)h.push(d([i.geometry.coordinates[o]],{parent:-1,winding:function(i){for(var r,n,o=0,s=0;s<i.length-1;s++)i[s][0]<i[o][0]&&(o=s);if(iF([i[((o-1)%(r=i.length-1)+r)%r],i[o],i[((o+1)%(n=i.length-1)+n)%n]],!0))var a=1;else a=-1;return a}(i.geometry.coordinates[o])}));var c=_(h);return j(),Z(),c}var p=[],f=[];for(o=0;o<r;o++){p.push([]);for(var m,g,y,v=0;v<i.geometry.coordinates[o].length-1;v++)p[o].push([new iO(i.geometry.coordinates[o][((v+1)%(m=i.geometry.coordinates[o].length-1)+m)%m],1,[o,v],[o,((v+1)%(g=i.geometry.coordinates[o].length-1)+g)%g],void 0)]),f.push(new iz(i.geometry.coordinates[o][v],[o,((v-1)%(y=i.geometry.coordinates[o].length-1)+y)%y],[o,v],void 0,void 0,!1,!0))}for(o=0;o<u;o++)p[l[o][1]][l[o][2]].push(new iO(l[o][0],l[o][5],[l[o][1],l[o][2]],[l[o][6],l[o][7]],void 0)),l[o][11]&&f.push(new iz(l[o][0],[l[o][1],l[o][2]],[l[o][6],l[o][7]],void 0,void 0,!0,!0));var x=f.length;for(o=0;o<p.length;o++)for(v=0;v<p[o].length;v++)p[o][v].sort(function(i,r){return i.param<r.param?-1:1});var b=[];for(o=0;o<x;o++)b.push({minX:f[o].coord[0],minY:f[o].coord[1],maxX:f[o].coord[0],maxY:f[o].coord[1],index:o});var w=tI();for(w.load(b),o=0;o<p.length;o++)for(v=0;v<p[o].length;v++)for(var E=0;E<p[o][v].length;E++){M=E==p[o][v].length-1?p[o][((v+1)%(I=i.geometry.coordinates[o].length-1)+I)%I][0].coord:p[o][v][E+1].coord;var I,S=w.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0];p[o][v][E].nxtIsectAlongEdgeIn=S.index}for(o=0;o<p.length;o++)for(v=0;v<p[o].length;v++)for(E=0;E<p[o][v].length;E++){var M=p[o][v][E].coord,T=(S=w.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0]).index;T<a?f[T].nxtIsectAlongRingAndEdge2=p[o][v][E].nxtIsectAlongEdgeIn:iB(f[T].ringAndEdge1,p[o][v][E].ringAndEdgeIn)?f[T].nxtIsectAlongRingAndEdge1=p[o][v][E].nxtIsectAlongEdgeIn:f[T].nxtIsectAlongRingAndEdge2=p[o][v][E].nxtIsectAlongEdgeIn}var C=[];for(o=0,v=0;v<r;v++){var P=o;for(E=0;E<i.geometry.coordinates[v].length-1;E++)f[o].coord[0]<f[P].coord[0]&&(P=o),o++;var A=f[P].nxtIsectAlongRingAndEdge2;for(E=0;E<f.length;E++)if(f[E].nxtIsectAlongRingAndEdge1==P||f[E].nxtIsectAlongRingAndEdge2==P){var L=E;break}var k=iF([f[L].coord,f[P].coord,f[A].coord],!0)?1:-1;C.push({isect:P,parent:-1,winding:k})}for(C.sort(function(i,r){return f[i.isect].coord>f[r.isect].coord?-1:1}),h=[];C.length>0;){var R=C.pop(),D=R.isect,N=R.parent,O=R.winding,z=h.length,F=[f[D].coord],B=D;if(f[D].ringAndEdge1Walkable)var U=f[D].ringAndEdge1,G=f[D].nxtIsectAlongRingAndEdge1;else U=f[D].ringAndEdge2,G=f[D].nxtIsectAlongRingAndEdge2;for(;!iB(f[D].coord,f[G].coord);){F.push(f[G].coord);var V=void 0;for(o=0;o<C.length;o++)if(C[o].isect==G){V=o;break}if(null!=V&&C.splice(V,1),iB(U,f[G].ringAndEdge1)){if(U=f[G].ringAndEdge2,f[G].ringAndEdge2Walkable=!1,f[G].ringAndEdge1Walkable){var q={isect:G};iF([f[B].coord,f[G].coord,f[f[G].nxtIsectAlongRingAndEdge2].coord],1==O)?(q.parent=N,q.winding=-O):(q.parent=z,q.winding=O),C.push(q)}B=G,G=f[G].nxtIsectAlongRingAndEdge2}else U=f[G].ringAndEdge1,f[G].ringAndEdge1Walkable=!1,f[G].ringAndEdge2Walkable&&(q={isect:G},iF([f[B].coord,f[G].coord,f[f[G].nxtIsectAlongRingAndEdge1].coord],1==O)?(q.parent=N,q.winding=-O):(q.parent=z,q.winding=O),C.push(q)),B=G,G=f[G].nxtIsectAlongRingAndEdge1}F.push(f[G].coord),h.push(d([F],{index:z,parent:N,winding:O,netWinding:void 0}))}function j(){for(var i=[],r=0;r<c.features.length;r++)-1==c.features[r].properties.parent&&i.push(r);if(i.length>1)for(r=0;r<i.length;r++){for(var n=-1,o=0;o<c.features.length;o++)i[r]!=o&&t9(c.features[i[r]].geometry.coordinates[0][0],c.features[o],{ignoreBoundary:!0})&&iw(c.features[o])<1/0&&(n=o);c.features[i[r]].properties.parent=n}}function Z(){for(var i=0;i<c.features.length;i++)if(-1==c.features[i].properties.parent){var r=c.features[i].properties.winding;c.features[i].properties.netWinding=r,function i(r,n){for(var o=0;o<c.features.length;o++)if(c.features[o].properties.parent==r){var s=n+c.features[o].properties.winding;c.features[o].properties.netWinding=s,i(o,s)}}(i,r)}}return c=_(h),j(),Z(),c}(i),function(n){r.push(d(n.geometry.coordinates,i.properties))})}),_(r)},i.validateBBox=D,i.validateId=N,i.voronoi=function(i,r){if(!R(r=r||{}))throw Error("options is invalid");var n=r.bbox||[-180,-85,180,85];if(!i)throw Error("points is required");if(!Array.isArray(n))throw Error("bbox is invalid");return ta(i,"Point","points"),_((function(){var i=nO,r=nz,n=null;function o(o){return new n7(o.map(function(n,s){var a=[1e-6*Math.round(i(n,s,o)/1e-6),1e-6*Math.round(r(n,s,o)/1e-6)];return a.index=s,a.data=n,a}),n)}return o.polygons=function(i){return o(i).polygons()},o.links=function(i){return o(i).links()},o.triangles=function(i){return o(i).triangles()},o.x=function(r){return arguments.length?(i="function"==typeof r?r:nN(+r),o):i},o.y=function(i){return arguments.length?(r="function"==typeof i?i:nN(+i),o):r},o.extent=function(i){return arguments.length?(n=null==i?null:[[+i[0][0],+i[0][1]],[+i[1][0],+i[1][1]]],o):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},o.size=function(i){return arguments.length?(n=null==i?null:[[0,0],[+i[0],+i[1]]],o):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},o})().x(function(i){return i.geometry.coordinates[0]}).y(function(i){return i.geometry.coordinates[1]}).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(i.features).map(ot))},i.within=et,Object.defineProperty(i,"__esModule",{value:!0})}(ig);var iy={};iy=function(){var i,r,n;function o(o,s){if(i){if(r){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",l={};i(l),n=s(l),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else r=s}else i=s}return o(["exports"],function(i){let r,n,o;var s,a="2.3.1";function l(i,r,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(o-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=n,this.p2y=o}l.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},l.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},l.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},l.prototype.solveCurveX=function(i,r){var n,o,s,a,l;for(void 0===r&&(r=1e-6),s=i,l=0;l<8;l++){if(Math.abs(a=this.sampleCurveX(s)-i)<r)return s;var u=this.sampleCurveDerivativeX(s);if(1e-6>Math.abs(u))break;s-=a/u}if((s=i)<(n=0))return n;if(s>(o=1))return o;for(;n<o&&!(Math.abs((a=this.sampleCurveX(s))-i)<r);)i>a?n=s:o=s,s=.5*(o-n)+n;return s},l.prototype.solve=function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))};var u=h;function h(i,r){this.x=i,this.y=r}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,r){return this.clone()._rotateAround(i,r)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var r=i.x-this.x,n=i.y-this.y;return r*r+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,r){return Math.atan2(this.x*r-this.y*i,this.x*i+this.y*r)},_matMult:function(i){var r=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=r,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var r=Math.cos(i),n=Math.sin(i),o=n*this.x+r*this.y;return this.x=r*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,r){var n=Math.cos(i),o=Math.sin(i),s=r.y+o*(this.x-r.x)+n*(this.y-r.y);return this.x=r.x+n*(this.x-r.x)-o*(this.y-r.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(i){return i instanceof h?i:Array.isArray(i)?new h(i[0],i[1]):i};var c="undefined"!=typeof self?self:{};let p=Math.PI/180,f=180/Math.PI,d=[[0,0],[1,0],[1,1],[0,1]];function m(i){if(i<=0)return 0;if(i>=1)return 1;let r=i*i,n=r*i;return 4*(i<.5?n:3*(i-r)+n-.75)}function g(i,r,n,o){let s=new l(i,r,n,o);return function(i){return s.solve(i)}}let y=g(.25,.1,.25,1);function _(i,r,n){return Math.min(n,Math.max(r,i))}function v(i,r,n){let o=n-r,s=((i-r)%o+o)%o+r;return s===r?n:s}function x(i,r,n){if(!i.length)return n(null,[]);let o=i.length,s=Array(i.length),a=null;i.forEach((i,l)=>{r(i,(i,r)=>{i&&(a=i),s[l]=r,0==--o&&n(a,s)})})}function b(i){let r=[];for(let n in i)r.push(i[n]);return r}function w(i,...r){for(let n of r)for(let r in n)i[r]=n[r];return i}let E=1;function I(){return E++}function S(){return function i(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function M(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function T(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function C(i,r){i.forEach(i=>{r[i]&&(r[i]=r[i].bind(r))})}function P(i,r){return -1!==i.indexOf(r,i.length-r.length)}function A(i,r,n){let o={};for(let s in i)o[s]=r.call(n||this,i[s],s,i);return o}function L(i,r,n){let o={};for(let s in i)r.call(n||this,i[s],s,i)&&(o[s]=i[s]);return o}function k(i){return Array.isArray(i)?i.map(k):"object"==typeof i&&i?A(i,k):i}let R={};function D(i){R[i]||("undefined"!=typeof console&&console.warn(i),R[i]=!0)}function N(i,r,n){return(n.y-i.y)*(r.x-i.x)>(r.y-i.y)*(n.x-i.x)}function O(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function z(i){let r={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,o,s)=>{let a=o||s;return r[n]=!a||a.toLowerCase(),""}),r["max-age"]){let i=parseInt(r["max-age"],10);isNaN(i)?delete r["max-age"]:r["max-age"]=i}return r}let F,B,U,G=null;function V(i){if(null==G){let r=i.navigator?i.navigator.userAgent:null;G=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return G}function q(i){try{let r=c[i];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(i){return!1}}let j={now:()=>void 0!==U?U:c.performance.now(),setNow(i){U=i},restoreNow(){U=void 0},frame(i){let r=c.requestAnimationFrame(i);return{cancel:()=>c.cancelAnimationFrame(r)}},getImageData(i,r=0){let n=c.document.createElement("canvas"),o=n.getContext("2d");if(!o)throw Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-r,-r,i.width+2*r,i.height+2*r)},resolveURL:i=>(F||(F=c.document.createElement("a")),F.href=i,F.href),get devicePixelRatio(){return c.devicePixelRatio},get prefersReducedMotion(){return!!c.matchMedia&&(null==B&&(B=c.matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}},Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=i}catch(n){r=i}}return r},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},X={supported:!1,testSupport:function(i){!H&&W&&(Y?K(i):$=i)}},$,W,H=!1,Y=!1;function K(i){let r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,W),i.isContextLost())return;X.supported=!0}catch(i){}i.deleteTexture(r),H=!0}c.document&&((W=c.document.createElement("img")).onload=function(){$&&K($),$=null,Y=!0},W.onerror=function(){H=!0,$=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let J="NO_ACCESS_TOKEN";function Q(i){return 0===i.indexOf("mapbox:")}function tt(i){return Z.API_URL_REGEX.test(i)}let te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(i){let r=i.match(te);if(!r)throw Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function tr(i){let r=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${r}`}function tn(i){if(!i)return null;let r=i.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(c.atob(r[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(i){return null}}class to{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){let r=tn(Z.ACCESS_TOKEN),n="";return n=r&&r.u?c.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(i,r)=>String.fromCharCode(Number("0x"+r)))):Z.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){let i=q("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(i)try{let i=c.localStorage.getItem(r);i&&(this.eventData=JSON.parse(i));let o=c.localStorage.getItem(n);o&&(this.anonId=o)}catch(i){D("Unable to read from LocalStorage")}}saveEventData(){let i=q("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(i)try{c.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&c.localStorage.setItem(r,JSON.stringify(this.eventData))}catch(i){D("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,r,n,o){if(!Z.EVENTS_URL)return;let s=ti(Z.EVENTS_URL);s.params.push(`access_token=${o||Z.ACCESS_TOKEN||""}`);let l={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:a,skuId:"01",userId:this.anonId},u=r?w(l,r):l,h={url:tr(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([u])};this.pendingRequest=tM(h,i=>{this.pendingRequest=null,n(i),this.saveEventData(),this.processRequests(o)})}queueRequest(i,r){this.queue.push(i),this.processRequests(r)}}let ts=new class extends to{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,r){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(i)&&i.some(i=>Q(i)||tt(i))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let r=tn(Z.ACCESS_TOKEN),n=r?r.u:Z.ACCESS_TOKEN,o=n!==this.eventData.tokenU;T(this.anonId)||(this.anonId=S(),o=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let i=new Date(this.eventData.lastSuccess),r=new Date(s),n=(s-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||i.getDate()!==r.getDate()}else o=!0;if(!o)return this.processRequests();this.postEvent(s,{"enabled.telemetry":!1},i=>{i||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},i)}},ta=ts.postTurnstileEvent.bind(ts),tl=new class extends to{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,n,o){this.skuToken=r,this.errorCb=o,Z.EVENTS_URL&&(n||Z.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(Error(J)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;let{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),T(this.anonId)||(this.anonId=S()),this.postEvent(n,{skuToken:this.skuToken},i=>{i?this.errorCb(i):r&&(this.success[r]=!0)},i))}},tu=tl.postMapLoadEvent.bind(tl),th=new class extends to{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,n,o){if(!Z.API_URL||!Z.SESSION_PATH)return;let s=ti(Z.API_URL+Z.SESSION_PATH);s.params.push(`sku=${r||""}`),s.params.push(`access_token=${o||Z.ACCESS_TOKEN||""}`);let a={url:tr(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=tT(a,i=>{this.pendingRequest=null,n(i),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,r,n,o){this.skuToken=r,this.errorCb=o,Z.SESSION_PATH&&Z.API_URL&&(n||Z.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(Error(J)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;let{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):r&&(this.success[r]=!0)},i)}},tc=th.getSessionAPI.bind(th),tp=new Set,tf="mapbox-tiles",td,tm,tg=500,ty=50;function t_(){c.caches&&!td&&(td=c.caches.open(tf))}function tv(i){let r=i.indexOf("?");return r<0?i:i.slice(0,r)}let tx=1/0,tb={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(tb);class tw extends Error{constructor(i,r,n){401===r&&tt(n)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let tE=O()?()=>self.worker&&self.worker.referrer:()=>("blob:"===c.location.protocol?c.parent:c).location.href,tI=function(i,r){var n;if(!(/^file:/.test(n=i.url)||/^file:/.test(tE())&&!/^\w+:/.test(n))){if(c.fetch&&c.Request&&c.AbortController&&c.Request.prototype.hasOwnProperty("signal"))return function(i,r){var n;let o=new c.AbortController,s=new c.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:tE(),signal:o.signal}),a=!1,l=!1,u=(n=s.url).indexOf("sku=")>0&&tt(n);"json"===i.type&&s.headers.set("Accept","application/json");let h=(n,o,a)=>{if(l)return;if(n&&"SecurityError"!==n.message&&D(n),o&&a)return p(o);let h=Date.now();c.fetch(s).then(n=>{if(n.ok){let i=u?n.clone():null;return p(n,i,h)}return r(new tw(n.statusText,n.status,i.url))}).catch(i=>{20!==i.code&&r(Error(i.message))})},p=(n,o,u)=>{("arrayBuffer"===i.type?n.arrayBuffer():"json"===i.type?n.json():n.text()).then(i=>{l||(o&&u&&function(i,r,n){if(t_(),!td)return;let o={status:r.status,statusText:r.statusText,headers:new c.Headers};r.headers.forEach((i,r)=>o.headers.set(r,i));let s=z(r.headers.get("Cache-Control")||"");s["no-store"]||(s["max-age"]&&o.headers.set("Expires",new Date(n+1e3*s["max-age"]).toUTCString()),new Date(o.headers.get("Expires")).getTime()-n<42e4||function(i,r){if(void 0===tm)try{new Response(new ReadableStream),tm=!0}catch(i){tm=!1}tm?r(i.body):i.blob().then(r)}(r,r=>{let n=new c.Response(r,o);t_(),td&&td.then(r=>r.put(tv(i.url),n)).catch(i=>D(i.message))}))}(s,o,u),a=!0,r(null,i,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(i=>{l||r(Error(i.message))})};return u?function(i,r){if(t_(),!td)return r(null);let n=tv(i.url);td.then(i=>{i.match(n).then(o=>{let s=function(i){if(!i)return!1;let r=new Date(i.headers.get("Expires")||0),n=z(i.headers.get("Cache-Control")||"");return r>Date.now()&&!n["no-cache"]}(o);i.delete(n),s&&i.put(n,o.clone()),r(null,o,s)}).catch(r)}).catch(r)}(s,h):h(null,null),{cancel:()=>{l=!0,a||o.abort()}}}(i,r);if(O()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,r,void 0,!0)}return function(i,r){let n=new c.XMLHttpRequest;for(let r in n.open(i.method||"GET",i.url,!0),"arrayBuffer"===i.type&&(n.responseType="arraybuffer"),i.headers)n.setRequestHeader(r,i.headers[r]);return"json"===i.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===i.credentials,n.onerror=()=>{r(Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let o=n.response;if("json"===i.type)try{o=JSON.parse(n.response)}catch(i){return r(i)}r(null,o,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else r(new tw(n.statusText,n.status,i.url))},n.send(i.body),{cancel:()=>n.abort()}}(i,r)},tS=function(i,r){return tI(w(i,{type:"arrayBuffer"}),r)},tM=function(i,r){return tI(w(i,{method:"POST"}),r)},tT=function(i,r){return tI(w(i,{method:"GET"}),r)},tC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";n=[],o=0;let tP=function(i,r){if(X.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),o>=Z.MAX_PARALLEL_IMAGE_REQUESTS){let o={requestParameters:i,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return n.push(o),o}o++;let s=!1,a=()=>{if(!s)for(s=!0,o--;n.length&&o<Z.MAX_PARALLEL_IMAGE_REQUESTS;){let i=n.shift(),{requestParameters:r,callback:o,cancelled:s}=i;s||(i.cancel=tP(r,o).cancel)}},l=tS(i,(i,n,o,s)=>{a(),i?r(i):n&&(c.createImageBitmap?function(i,r){let n=new c.Blob([new Uint8Array(i)],{type:"image/png"});c.createImageBitmap(n).then(i=>{r(null,i)}).catch(i=>{r(Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(n,(i,n)=>r(i,n,o,s)):function(i,r){let n=new c.Image,o=c.URL;n.onload=()=>{r(null,n),o.revokeObjectURL(n.src),n.onload=null,c.requestAnimationFrame(()=>{n.src=tC})},n.onerror=()=>r(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let s=new c.Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?o.createObjectURL(s):tC}(n,(i,n)=>r(i,n,o,s)))});return{cancel:()=>{l.cancel(),a()}}};function tA(i,r,n){n[i]&&-1!==n[i].indexOf(r)||(n[i]=n[i]||[],n[i].push(r))}function tL(i,r,n){if(n&&n[i]){let o=n[i].indexOf(r);-1!==o&&n[i].splice(o,1)}}class tk{constructor(i,r={}){w(this,r),this.type=i}}class tR extends tk{constructor(i,r={}){super("error",w({error:i},r))}}class tD{on(i,r){return this._listeners=this._listeners||{},tA(i,r,this._listeners),this}off(i,r){return tL(i,r,this._listeners),tL(i,r,this._oneTimeListeners),this}once(i,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},tA(i,r,this._oneTimeListeners),this):new Promise(r=>this.once(i,r))}fire(i,r){"string"==typeof i&&(i=new tk(i,r||{}));let n=i.type;if(this.listens(n)){for(let r of(i.target=this,this._listeners&&this._listeners[n]?this._listeners[n].slice():[]))r.call(this,i);for(let r of this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[])tL(n,r,this._oneTimeListeners),r.call(this,i);let r=this._eventedParent;r&&(w(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(i))}else i instanceof tR&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,r){return this._eventedParent=i,this._eventedParentData=r,this}}var tN={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class tO{constructor(i,r,n,o){this.message=(i?`${i}: `:"")+n,o&&(this.identifier=o),null!=r&&r.__line__&&(this.line=r.__line__)}}function tz(i){let r=i.value;return r?[new tO(i.key,r,"constants have been deprecated as of v8")]:[]}function tF(i,...r){for(let n of r)for(let r in n)i[r]=n[r];return i}function tB(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function tU(i){if(Array.isArray(i))return i.map(tU);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let r={};for(let n in i)r[n]=tU(i[n]);return r}return tB(i)}class tG extends Error{constructor(i,r){super(r),this.message=r,this.key=i}}class tV{constructor(i,r=[]){for(let[n,o]of(this.parent=i,this.bindings={},r))this.bindings[n]=o}concat(i){return new tV(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}let tq={kind:"null"},tj={kind:"number"},tZ={kind:"string"},tX={kind:"boolean"},t$={kind:"color"},tW={kind:"object"},tH={kind:"value"},tY={kind:"collator"},tK={kind:"formatted"},tJ={kind:"resolvedImage"};function tQ(i,r){return{kind:"array",itemType:i,N:r}}function t0(i){if("array"===i.kind){let r=t0(i.itemType);return"number"==typeof i.N?`array<${r}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${r}>`}return i.kind}let t1=[tq,tj,tZ,tX,t$,tK,tW,tQ(tH),tJ];function t2(i,r){if("error"===r.kind)return null;if("array"===i.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!t2(i.itemType,r.itemType))&&("number"!=typeof i.N||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if("value"===i.kind){for(let i of t1)if(!t2(i,r))return null}}return`Expected ${t0(i)} but found ${t0(r)} instead.`}function t3(i,r){return r.some(r=>r.kind===i.kind)}function t5(i,r){return r.some(r=>"null"===r?null===i:"array"===r?Array.isArray(i):"object"===r?i&&!Array.isArray(i)&&"object"==typeof i:r===typeof i)}function t4(i){var r={exports:{}};return i(r,r.exports),r.exports}var t6=t4(function(i,r){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(i){return(i=Math.round(i))<0?0:i>255?255:i}function s(i){return o("%"===i[i.length-1]?parseFloat(i)/100*255:parseInt(i))}function a(i){var r;return(r="%"===i[i.length-1]?parseFloat(i)/100:parseFloat(i))<0?0:r>1?1:r}function l(i,r,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(r-i)*n*6:2*n<1?r:3*n<2?i+(r-i)*(2/3-n)*6:i}try{r.parseCSSColor=function(i){var r,u=i.replace(/ /g,"").toLowerCase();if(u in n)return n[u].slice();if("#"===u[0])return 4===u.length?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:7===u.length&&(r=parseInt(u.substr(1),16))>=0&&r<=0xffffff?[(0xff0000&r)>>16,(65280&r)>>8,255&r,1]:null;var h=u.indexOf("("),c=u.indexOf(")");if(-1!==h&&c+1===u.length){var p=u.substr(0,h),f=u.substr(h+1,c-(h+1)).split(","),d=1;switch(p){case"rgba":if(4!==f.length)break;d=a(f.pop());case"rgb":return 3!==f.length?null:[s(f[0]),s(f[1]),s(f[2]),d];case"hsla":if(4!==f.length)break;d=a(f.pop());case"hsl":if(3!==f.length)break;var m=(parseFloat(f[0])%360+360)%360/360,g=a(f[1]),y=a(f[2]),_=y<=.5?y*(g+1):y+g-y*g,v=2*y-_;return[o(255*l(v,_,m+1/3)),o(255*l(v,_,m)),o(255*l(v,_,m-1/3)),d]}}return null}}catch(i){}});class t8{constructor(i,r,n,o=1){this.r=i,this.g=r,this.b=n,this.a=o}static parse(i){if(!i)return;if(i instanceof t8)return i;if("string"!=typeof i)return;let r=t6.parseCSSColor(i);return r?new t8(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[i,r,n,o]=this.toArray();return`rgba(${Math.round(i)},${Math.round(r)},${Math.round(n)},${o})`}toArray(){let{r:i,g:r,b:n,a:o}=this;return 0===o?[0,0,0,0]:[255*i/o,255*r/o,255*n/o,o]}}t8.black=new t8(0,0,0,1),t8.white=new t8(1,1,1,1),t8.transparent=new t8(0,0,0,0),t8.red=new t8(1,0,0,1),t8.blue=new t8(0,0,1,1);class t9{constructor(i,r,n){this.sensitivity=i?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,r){return this.collator.compare(i,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class t7{constructor(i,r,n,o,s){this.text=i,this.image=r,this.scale=n,this.fontStack=o,this.textColor=s}}class et{constructor(i){this.sections=i}static fromString(i){return new et([new t7(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof et?i:et.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){let i=["format"];for(let r of this.sections){if(r.image){i.push(["image",r.image.name]);continue}i.push(r.text);let n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),i.push(n)}return i}}class ee{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new ee({name:i,available:!1}):null}serialize(){return["image",this.name]}}function ei(i,r,n,o){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===o||"number"==typeof o&&o>=0&&o<=1?null:`Invalid rgba value [${[i,r,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof o?[i,r,n,o]:[i,r,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function er(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof t8||i instanceof t9||i instanceof et||i instanceof ee)return!0;if(Array.isArray(i)){for(let r of i)if(!er(r))return!1;return!0}if("object"==typeof i){for(let r in i)if(!er(i[r]))return!1;return!0}return!1}function en(i){if(null===i)return tq;if("string"==typeof i)return tZ;if("boolean"==typeof i)return tX;if("number"==typeof i)return tj;if(i instanceof t8)return t$;if(i instanceof t9)return tY;if(i instanceof et)return tK;if(i instanceof ee)return tJ;if(Array.isArray(i)){let r;let n=i.length;for(let n of i){let i=en(n);if(r){if(r===i)continue;r=tH;break}r=i}return tQ(r||tH,n)}return tW}function eo(i){let r=typeof i;return null===i?"":"string"===r||"number"===r||"boolean"===r?String(i):i instanceof t8||i instanceof et||i instanceof ee?i.toString():JSON.stringify(i)}class es{constructor(i,r){this.type=i,this.value=r}static parse(i,r){if(2!==i.length)return r.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!er(i[1]))return r.error("invalid value");let n=i[1],o=en(n),s=r.expectedType;return"array"===o.kind&&0===o.N&&s&&"array"===s.kind&&("number"!=typeof s.N||0===s.N)&&(o=s),new es(o,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof t8?["rgba"].concat(this.value.toArray()):this.value instanceof et?this.value.serialize():this.value}}class ea{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}let el={string:tZ,number:tj,boolean:tX,object:tW};class eu{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let n,o=1,s=i[0];if("array"===s){let s,a;if(i.length>2){let n=i[1];if("string"!=typeof n||!(n in el)||"object"===n)return r.error('The item type argument of "array" must be one of string, number, boolean',1);s=el[n],o++}else s=tH;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return r.error('The length argument to "array" must be a positive integer literal',2);a=i[2],o++}n=tQ(s,a)}else n=el[s];let a=[];for(;o<i.length;o++){let n=r.parse(i[o],o,tH);if(!n)return null;a.push(n)}return new eu(n,a)}evaluate(i){for(let r=0;r<this.args.length;r++){let n=this.args[r].evaluate(i);if(!t2(this.type,en(n)))return n;if(r===this.args.length-1)throw new ea(`Expected value to be of type ${t0(this.type)}, but found ${t0(en(n))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){let i=this.type,r=[i.kind];if("array"===i.kind){let n=i.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){r.push(n.kind);let o=i.N;("number"==typeof o||this.args.length>1)&&r.push(o)}}return r.concat(this.args.map(i=>i.serialize()))}}class eh{constructor(i){this.type=tK,this.sections=i}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let n=i[1];if(!Array.isArray(n)&&"object"==typeof n)return r.error("First argument must be an image or text section.");let o=[],s=!1;for(let n=1;n<=i.length-1;++n){let a=i[n];if(s&&"object"==typeof a&&!Array.isArray(a)){s=!1;let i=null;if(a["font-scale"]&&!(i=r.parse(a["font-scale"],1,tj)))return null;let n=null;if(a["text-font"]&&!(n=r.parse(a["text-font"],1,tQ(tZ))))return null;let l=null;if(a["text-color"]&&!(l=r.parse(a["text-color"],1,t$)))return null;let u=o[o.length-1];u.scale=i,u.font=n,u.textColor=l}else{let a=r.parse(i[n],1,tH);if(!a)return null;let l=a.type.kind;if("string"!==l&&"value"!==l&&"null"!==l&&"resolvedImage"!==l)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,o.push({content:a,scale:null,font:null,textColor:null})}}return new eh(o)}evaluate(i){return new et(this.sections.map(r=>{let n=r.content.evaluate(i);return en(n)===tJ?new t7("",n,null,null,null):new t7(eo(n),null,r.scale?r.scale.evaluate(i):null,r.font?r.font.evaluate(i).join(","):null,r.textColor?r.textColor.evaluate(i):null)}))}eachChild(i){for(let r of this.sections)i(r.content),r.scale&&i(r.scale),r.font&&i(r.font),r.textColor&&i(r.textColor)}outputDefined(){return!1}serialize(){let i=["format"];for(let r of this.sections){i.push(r.content.serialize());let n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),i.push(n)}return i}}class ec{constructor(i){this.type=tJ,this.input=i}static parse(i,r){if(2!==i.length)return r.error("Expected two arguments.");let n=r.parse(i[1],1,tZ);return n?new ec(n):r.error("No image name provided.")}evaluate(i){let r=this.input.evaluate(i),n=ee.fromString(r);return n&&i.availableImages&&(n.available=i.availableImages.indexOf(r)>-1),n}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let ep={"to-boolean":tX,"to-color":t$,"to-number":tj,"to-string":tZ};class ef{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let n=i[0];if(("to-boolean"===n||"to-string"===n)&&2!==i.length)return r.error("Expected one argument.");let o=ep[n],s=[];for(let n=1;n<i.length;n++){let o=r.parse(i[n],n,tH);if(!o)return null;s.push(o)}return new ef(o,s)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let r,n;for(let o of this.args){if(r=o.evaluate(i),n=null,r instanceof t8)return r;if("string"==typeof r){let n=i.parseColor(r);if(n)return n}else if(Array.isArray(r)&&!(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ei(r[0],r[1],r[2],r[3])))return new t8(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ea(n||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(let n of this.args){if(null===(r=n.evaluate(i)))return 0;let o=Number(r);if(!isNaN(o))return o}throw new ea(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?et.fromString(eo(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?ee.fromString(eo(this.args[0].evaluate(i))):eo(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new eh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ec(this.args[0]).serialize();let i=[`to-${this.type.kind}`];return this.eachChild(r=>{i.push(r.serialize())}),i}}let ed=["Unknown","Point","LineString","Polygon"];class em{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ed[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let r=this._parseColorCache[i];return r||(r=this._parseColorCache[i]=t8.parse(i)),r}}class eg{constructor(i,r,n,o){this.name=i,this.type=r,this._evaluate=n,this.args=o}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,r){let n=i[0],o=eg.definitions[n];if(!o)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let s=Array.isArray(o)?o[0]:o.type,a=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,l=a.filter(([r])=>!Array.isArray(r)||r.length===i.length-1),u=null;for(let[o,a]of l){u=new eR(r.registry,r.path,null,r.scope);let l=[],h=!1;for(let r=1;r<i.length;r++){let n=i[r],s=Array.isArray(o)?o[r-1]:o.type,a=u.parse(n,1+l.length,s);if(!a){h=!0;break}l.push(a)}if(!h){if(Array.isArray(o)&&o.length!==l.length)u.error(`Expected ${o.length} arguments, but found ${l.length} instead.`);else{for(let i=0;i<l.length;i++){let r=Array.isArray(o)?o[i]:o.type,n=l[i];u.concat(i+1).checkSubtype(r,n.type)}if(0===u.errors.length)return new eg(n,s,a,l)}}}if(1===l.length)r.errors.push(...u.errors);else{let n=(l.length?l:a).map(([i])=>Array.isArray(i)?`(${i.map(t0).join(", ")})`:`(${t0(i.type)}...)`).join(" | "),o=[];for(let n=1;n<i.length;n++){let s=r.parse(i[n],1+o.length);if(!s)return null;o.push(t0(s.type))}r.error(`Expected arguments of type ${n}, but found (${o.join(", ")}) instead.`)}return null}static register(i,r){for(let n in eg.definitions=r,r)i[n]=eg}}class ey{constructor(i,r,n){this.type=tY,this.locale=n,this.caseSensitive=i,this.diacriticSensitive=r}static parse(i,r){if(2!==i.length)return r.error("Expected one argument.");let n=i[1];if("object"!=typeof n||Array.isArray(n))return r.error("Collator options argument must be an object.");let o=r.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,tX);if(!o)return null;let s=r.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,tX);if(!s)return null;let a=null;return!n.locale||(a=r.parse(n.locale,1,tZ))?new ey(o,s,a):null}evaluate(i){return new t9(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){let i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function e_(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function ev(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function ex(i,r){var n,o;let s=!1;for(let a=0,l=r.length;a<l;a++){let l=r[a];for(let r=0,a=l.length;r<a-1;r++){if(function(i,r,n){let o=i[0]-r[0],s=i[1]-r[1],a=i[0]-n[0],l=i[1]-n[1];return o*l-a*s==0&&o*a<=0&&s*l<=0}(i,l[r],l[r+1]))return!1;(n=l[r])[1]>i[1]!=(o=l[r+1])[1]>i[1]&&i[0]<(o[0]-n[0])*(i[1]-n[1])/(o[1]-n[1])+n[0]&&(s=!s)}}return s}function eb(i,r,n,o){let s=o[0]-n[0],a=o[1]-n[1],l=(i[0]-n[0])*a-s*(i[1]-n[1]),u=(r[0]-n[0])*a-s*(r[1]-n[1]);return l>0&&u<0||l<0&&u>0}function ew(i,r){for(let n=0;n<i.length;++n)if(!ex(i[n],r))return!1;for(let n=0;n<i.length-1;++n)if(function(i,r,n){var o,s,a,l;for(let u of n)for(let n=0;n<u.length-1;++n)if(0!=(a=[(s=u[n+1])[0]-(o=u[n])[0],s[1]-o[1]])[0]*(l=[r[0]-i[0],r[1]-i[1]])[1]-a[1]*l[0]&&eb(i,r,o,s)&&eb(o,s,i,r))return!0;return!1}(i[n],i[n+1],r))return!1;return!0}function eE(i,r,n){let o=[];for(let s=0;s<i.length;s++){let a=[];for(let o=0;o<i[s].length;o++){let l=function(i,r){let n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,s=Math.pow(2,r.z);return[Math.round(n*s*8192),Math.round(o*s*8192)]}(i[s][o],n);e_(r,l),a.push(l)}o.push(a)}return o}function eI(i,r,n){let o=[];for(let s=0;s<i.length;s++){let a=eE(i[s],r,n);o.push(a)}return o}function eS(i,r,n,o){if(i[0]<n[0]||i[0]>n[2]){let r=.5*o,s=i[0]-n[0]>r?-o:n[0]-i[0]>r?o:0;0===s&&(s=i[0]-n[2]>r?-o:n[2]-i[0]>r?o:0),i[0]+=s}e_(r,i)}function eM(i,r,n,o){let s=8192*Math.pow(2,o.z),a=[8192*o.x,8192*o.y],l=[];for(let o of i)for(let i of o){let o=[i.x+a[0],i.y+a[1]];eS(o,r,n,s),l.push(o)}return l}function eT(i,r,n,o){let s=8192*Math.pow(2,o.z),a=[8192*o.x,8192*o.y],l=[];for(let n of i){let i=[];for(let o of n){let n=[o.x+a[0],o.y+a[1]];e_(r,n),i.push(n)}l.push(i)}if(r[2]-r[0]<=s/2)for(let i of(r[0]=r[1]=1/0,r[2]=r[3]=-1/0,l))for(let o of i)eS(o,r,n,s);return l}class eC{constructor(i,r){this.type=tX,this.geojson=i,this.geometries=r}static parse(i,r){if(2!==i.length)return r.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(er(i[1])){let r=i[1];if("FeatureCollection"===r.type)for(let i=0;i<r.features.length;++i){let n=r.features[i].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new eC(r,r.features[i].geometry)}else if("Feature"===r.type){let i=r.geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new eC(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new eC(r,r)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(i,r){let n=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if("Polygon"===r.type){let a=eE(r.coordinates,o,s),l=eM(i.geometry(),n,o,s);if(!ev(n,o))return!1;for(let i of l)if(!ex(i,a))return!1}if("MultiPolygon"===r.type){let a=eI(r.coordinates,o,s),l=eM(i.geometry(),n,o,s);if(!ev(n,o))return!1;for(let i of l)if(!function(i,r){for(let n=0;n<r.length;n++)if(ex(i,r[n]))return!0;return!1}(i,a))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(i,r){let n=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if("Polygon"===r.type){let a=eE(r.coordinates,o,s),l=eT(i.geometry(),n,o,s);if(!ev(n,o))return!1;for(let i of l)if(!ew(i,a))return!1}if("MultiPolygon"===r.type){let a=eI(r.coordinates,o,s),l=eT(i.geometry(),n,o,s);if(!ev(n,o))return!1;for(let i of l)if(!function(i,r){for(let n=0;n<r.length;n++)if(ew(i,r[n]))return!0;return!1}(i,a))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function eP(i){if(i instanceof eg&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof eC)return!1;let r=!0;return i.eachChild(i=>{r&&!eP(i)&&(r=!1)}),r}function eA(i){if(i instanceof eg&&"feature-state"===i.name)return!1;let r=!0;return i.eachChild(i=>{r&&!eA(i)&&(r=!1)}),r}function eL(i,r){if(i instanceof eg&&r.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(i=>{n&&!eL(i,r)&&(n=!1)}),n}class ek{constructor(i,r){this.type=r.type,this.name=i,this.boundExpression=r}static parse(i,r){if(2!==i.length||"string"!=typeof i[1])return r.error("'var' expression requires exactly one string literal argument.");let n=i[1];return r.scope.has(n)?new ek(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class eR{constructor(i,r=[],n,o=new tV,s=[]){this.registry=i,this.path=r,this.key=r.map(i=>`[${i}]`).join(""),this.scope=o,this.errors=s,this.expectedType=n}parse(i,r,n,o,s={}){return r?this.concat(r,n,o)._parse(i,s):this._parse(i,s)}_parse(i,r){function n(i,r,n){return"assert"===n?new eu(r,[i]):"coerce"===n?new ef(r,[i]):i}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let o=i[0];if("string"!=typeof o)return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let s=this.registry[o];if(s){let o=s.parse(i,this);if(!o)return null;if(this.expectedType){let i=this.expectedType,s=o.type;if("string"!==i.kind&&"number"!==i.kind&&"boolean"!==i.kind&&"object"!==i.kind&&"array"!==i.kind||"value"!==s.kind){if("color"!==i.kind&&"formatted"!==i.kind&&"resolvedImage"!==i.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(i,s))return null}else o=n(o,i,r.typeAnnotation||"coerce")}else o=n(o,i,r.typeAnnotation||"assert")}if(!(o instanceof es)&&"resolvedImage"!==o.type.kind&&function i(r){if(r instanceof ek)return i(r.boundExpression);if(r instanceof eg&&"error"===r.name||r instanceof ey||r instanceof eC)return!1;let n=r instanceof ef||r instanceof eu,o=!0;return r.eachChild(r=>{o=n?o&&i(r):o&&r instanceof es}),!!o&&eP(r)&&eL(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(o)){let i=new em;try{o=new es(o.type,o.evaluate(i))}catch(i){return this.error(i.message),null}}return o}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,r,n){let o="number"==typeof i?this.path.concat(i):this.path,s=n?this.scope.concat(n):this.scope;return new eR(this.registry,o,r||null,s,this.errors)}error(i,...r){let n=`${this.key}${r.map(i=>`[${i}]`).join("")}`;this.errors.push(new tG(n,i))}checkSubtype(i,r){let n=t2(i,r);return n&&this.error(n),n}}function eD(i,r){let n=i.length-1,o,s,a=0,l=n,u=0;for(;a<=l;)if(o=i[u=Math.floor((a+l)/2)],s=i[u+1],o<=r){if(u===n||r<s)return u;a=u+1}else{if(!(o>r))throw new ea("Input is not a number.");l=u-1}return 0}class eN{constructor(i,r,n){for(let[o,s]of(this.type=i,this.input=r,this.labels=[],this.outputs=[],n))this.labels.push(o),this.outputs.push(s)}static parse(i,r){if(i.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return r.error("Expected an even number of arguments.");let n=r.parse(i[1],1,tj);if(!n)return null;let o=[],s=null;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);for(let n=1;n<i.length;n+=2){let a=1===n?-1/0:i[n],l=i[n+1],u=n,h=n+1;if("number"!=typeof a)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(o.length&&o[o.length-1][0]>=a)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);let c=r.parse(l,h,s);if(!c)return null;s=s||c.type,o.push([a,c])}return new eN(s,n,o)}evaluate(i){let r=this.labels,n=this.outputs;if(1===r.length)return n[0].evaluate(i);let o=this.input.evaluate(i);if(o<=r[0])return n[0].evaluate(i);let s=r.length;return o>=r[s-1]?n[s-1].evaluate(i):n[eD(r,o)].evaluate(i)}eachChild(i){for(let r of(i(this.input),this.outputs))i(r)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&i.push(this.labels[r]),i.push(this.outputs[r].serialize());return i}}function eO(i,r,n){return i*(1-n)+r*n}var ez=Object.freeze({__proto__:null,number:eO,color:function(i,r,n){return new t8(eO(i.r,r.r,n),eO(i.g,r.g,n),eO(i.b,r.b,n),eO(i.a,r.a,n))},array:function(i,r,n){return i.map((i,o)=>eO(i,r[o],n))}});let eF=4/29,eB=6/29,eU=6/29*3*(6/29),eG=Math.PI/180,eV=180/Math.PI;function eq(i){return i>.008856451679035631?Math.pow(i,1/3):i/eU+eF}function ej(i){return i>eB?i*i*i:eU*(i-eF)}function eZ(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function eX(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function e$(i){let r=eX(i.r),n=eX(i.g),o=eX(i.b),s=eq((.4124564*r+.3575761*n+.1804375*o)/.95047),a=eq((.2126729*r+.7151522*n+.072175*o)/1);return{l:116*a-16,a:500*(s-a),b:200*(a-eq((.0193339*r+.119192*n+.9503041*o)/1.08883)),alpha:i.a}}function eW(i){let r=(i.l+16)/116,n=isNaN(i.a)?r:r+i.a/500,o=isNaN(i.b)?r:r-i.b/200;return r=+ej(r),new t8(eZ(3.2404542*(n=.95047*ej(n))-1.5371385*r-.4985314*(o=1.08883*ej(o))),eZ(-.969266*n+1.8760108*r+.041556*o),eZ(.0556434*n-.2040259*r+1.0572252*o),i.alpha)}let eH={forward:e$,reverse:eW,interpolate:function(i,r,n){return{l:eO(i.l,r.l,n),a:eO(i.a,r.a,n),b:eO(i.b,r.b,n),alpha:eO(i.alpha,r.alpha,n)}}},eY={forward:function(i){let{l:r,a:n,b:o}=e$(i),s=Math.atan2(o,n)*eV;return{h:s<0?s+360:s,c:Math.sqrt(n*n+o*o),l:r,alpha:i.a}},reverse:function(i){let r=i.h*eG,n=i.c;return eW({l:i.l,a:Math.cos(r)*n,b:Math.sin(r)*n,alpha:i.alpha})},interpolate:function(i,r,n){return{h:function(i,r,n){let o=r-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}(i.h,r.h,n),c:eO(i.c,r.c,n),l:eO(i.l,r.l,n),alpha:eO(i.alpha,r.alpha,n)}}};var eK=Object.freeze({__proto__:null,lab:eH,hcl:eY});class eJ{constructor(i,r,n,o,s){for(let[a,l]of(this.type=i,this.operator=r,this.interpolation=n,this.input=o,this.labels=[],this.outputs=[],s))this.labels.push(a),this.outputs.push(l)}static interpolationFactor(i,r,n,o){let s=0;if("exponential"===i.name)s=eQ(r,i.base,n,o);else if("linear"===i.name)s=eQ(r,1,n,o);else if("cubic-bezier"===i.name){let a=i.controlPoints;s=new l(a[0],a[1],a[2],a[3]).solve(eQ(r,1,n,o))}return s}static parse(i,r){let[n,o,s,...a]=i;if(!Array.isArray(o)||0===o.length)return r.error("Expected an interpolation type expression.",1);if("linear"===o[0])o={name:"linear"};else if("exponential"===o[0]){let i=o[1];if("number"!=typeof i)return r.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:i}}else{if("cubic-bezier"!==o[0])return r.error(`Unknown interpolation type ${String(o[0])}`,1,0);{let i=o.slice(1);if(4!==i.length||i.some(i=>"number"!=typeof i||i<0||i>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:i}}}if(i.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(!(s=r.parse(s,2,tj)))return null;let l=[],u=null;"interpolate-hcl"===n||"interpolate-lab"===n?u=t$:r.expectedType&&"value"!==r.expectedType.kind&&(u=r.expectedType);for(let i=0;i<a.length;i+=2){let n=a[i],o=a[i+1],s=i+3,h=i+4;if("number"!=typeof n)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(l.length&&l[l.length-1][0]>=n)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',s);let c=r.parse(o,h,u);if(!c)return null;u=u||c.type,l.push([n,c])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new eJ(u,n,o,s,l):r.error(`Type ${t0(u)} is not interpolatable.`)}evaluate(i){let r=this.labels,n=this.outputs;if(1===r.length)return n[0].evaluate(i);let o=this.input.evaluate(i);if(o<=r[0])return n[0].evaluate(i);let s=r.length;if(o>=r[s-1])return n[s-1].evaluate(i);let a=eD(r,o),l=eJ.interpolationFactor(this.interpolation,o,r[a],r[a+1]),u=n[a].evaluate(i),h=n[a+1].evaluate(i);return"interpolate"===this.operator?ez[this.type.kind.toLowerCase()](u,h,l):"interpolate-hcl"===this.operator?eY.reverse(eY.interpolate(eY.forward(u),eY.forward(h),l)):eH.reverse(eH.interpolate(eH.forward(u),eH.forward(h),l))}eachChild(i){for(let r of(i(this.input),this.outputs))i(r)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,i,this.input.serialize()];for(let i=0;i<this.labels.length;i++)r.push(this.labels[i],this.outputs[i].serialize());return r}}function eQ(i,r,n,o){let s=o-n,a=i-n;return 0===s?0:1===r?a/s:(Math.pow(r,a)-1)/(Math.pow(r,s)-1)}class e0{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expectected at least one argument.");let n=null,o=r.expectedType;o&&"value"!==o.kind&&(n=o);let s=[];for(let o of i.slice(1)){let i=r.parse(o,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!i)return null;n=n||i.type,s.push(i)}return new e0(o&&s.some(i=>t2(o,i.type))?tH:n,s)}evaluate(i){let r,n=null,o=0;for(let s of this.args)if(o++,(n=s.evaluate(i))&&n instanceof ee&&!n.available&&(r||(r=n.name),n=null,o===this.args.length&&(n=r)),null!==n)break;return n}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){let i=["coalesce"];return this.eachChild(r=>{i.push(r.serialize())}),i}}class e1{constructor(i,r){this.type=r.type,this.bindings=[].concat(i),this.result=r}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let r of this.bindings)i(r[1]);i(this.result)}static parse(i,r){if(i.length<4)return r.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let n=[];for(let o=1;o<i.length-1;o+=2){let s=i[o];if("string"!=typeof s)return r.error(`Expected string, but found ${typeof s} instead.`,o);if(/[^a-zA-Z0-9_]/.test(s))return r.error("Variable names must contain only alphanumeric characters or '_'.",o);let a=r.parse(i[o+1],o+1);if(!a)return null;n.push([s,a])}let o=r.parse(i[i.length-1],i.length-1,r.expectedType,n);return o?new e1(n,o):null}outputDefined(){return this.result.outputDefined()}serialize(){let i=["let"];for(let[r,n]of this.bindings)i.push(r,n.serialize());return i.push(this.result.serialize()),i}}class e2{constructor(i,r,n){this.type=i,this.index=r,this.input=n}static parse(i,r){if(3!==i.length)return r.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let n=r.parse(i[1],1,tj),o=r.parse(i[2],2,tQ(r.expectedType||tH));return n&&o?new e2(o.type.itemType,n,o):null}evaluate(i){let r=this.index.evaluate(i),n=this.input.evaluate(i);if(r<0)throw new ea(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new ea(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new ea(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class e3{constructor(i,r){this.type=tX,this.needle=i,this.haystack=r}static parse(i,r){if(3!==i.length)return r.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let n=r.parse(i[1],1,tH),o=r.parse(i[2],2,tH);return n&&o?t3(n.type,[tX,tZ,tj,tq,tH])?new e3(n,o):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${t0(n.type)} instead`):null}evaluate(i){let r=this.needle.evaluate(i),n=this.haystack.evaluate(i);if(!n)return!1;if(!t5(r,["boolean","string","number","null"]))throw new ea(`Expected first argument to be of type boolean, string, number or null, but found ${t0(en(r))} instead.`);if(!t5(n,["string","array"]))throw new ea(`Expected second argument to be of type array or string, but found ${t0(en(n))} instead.`);return n.indexOf(r)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class e5{constructor(i,r,n){this.type=tj,this.needle=i,this.haystack=r,this.fromIndex=n}static parse(i,r){if(i.length<=2||i.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let n=r.parse(i[1],1,tH),o=r.parse(i[2],2,tH);if(!n||!o)return null;if(!t3(n.type,[tX,tZ,tj,tq,tH]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${t0(n.type)} instead`);if(4===i.length){let s=r.parse(i[3],3,tj);return s?new e5(n,o,s):null}return new e5(n,o)}evaluate(i){let r=this.needle.evaluate(i),n=this.haystack.evaluate(i);if(!t5(r,["boolean","string","number","null"]))throw new ea(`Expected first argument to be of type boolean, string, number or null, but found ${t0(en(r))} instead.`);if(!t5(n,["string","array"]))throw new ea(`Expected second argument to be of type array or string, but found ${t0(en(n))} instead.`);if(this.fromIndex){let o=this.fromIndex.evaluate(i);return n.indexOf(r,o)}return n.indexOf(r)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){let i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class e4{constructor(i,r,n,o,s,a){this.inputType=i,this.type=r,this.input=n,this.cases=o,this.outputs=s,this.otherwise=a}static parse(i,r){let n,o;if(i.length<5)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return r.error("Expected an even number of arguments.");r.expectedType&&"value"!==r.expectedType.kind&&(o=r.expectedType);let s={},a=[];for(let l=2;l<i.length-1;l+=2){let u=i[l],h=i[l+1];Array.isArray(u)||(u=[u]);let c=r.concat(l);if(0===u.length)return c.error("Expected at least one branch label.");for(let i of u){if("number"!=typeof i&&"string"!=typeof i)return c.error("Branch labels must be numbers or strings.");if("number"==typeof i&&Math.abs(i)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof i&&Math.floor(i)!==i)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,en(i)))return null}else n=en(i);if(void 0!==s[String(i)])return c.error("Branch labels must be unique.");s[String(i)]=a.length}let p=r.parse(h,l,o);if(!p)return null;o=o||p.type,a.push(p)}let l=r.parse(i[1],1,tH);if(!l)return null;let u=r.parse(i[i.length-1],i.length-1,o);return u?"value"!==l.type.kind&&r.concat(1).checkSubtype(n,l.type)?null:new e4(n,o,l,s,a,u):null}evaluate(i){let r=this.input.evaluate(i);return(en(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let i=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],o={};for(let i of r){let r=o[this.cases[i]];void 0===r?(o[this.cases[i]]=n.length,n.push([this.cases[i],[i]])):n[r][1].push(i)}let s=i=>"number"===this.inputType.kind?Number(i):i;for(let[r,o]of n)i.push(1===o.length?s(o[0]):o.map(s)),i.push(this.outputs[r].serialize());return i.push(this.otherwise.serialize()),i}}class e6{constructor(i,r,n){this.type=i,this.branches=r,this.otherwise=n}static parse(i,r){let n;if(i.length<4)return r.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return r.error("Expected an odd number of arguments.");r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);let o=[];for(let s=1;s<i.length-1;s+=2){let a=r.parse(i[s],s,tX);if(!a)return null;let l=r.parse(i[s+1],s+1,n);if(!l)return null;o.push([a,l]),n=n||l.type}let s=r.parse(i[i.length-1],i.length-1,n);return s?new e6(n,o,s):null}evaluate(i){for(let[r,n]of this.branches)if(r.evaluate(i))return n.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[r,n]of this.branches)i(r),i(n);i(this.otherwise)}outputDefined(){return this.branches.every(([i,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let i=["case"];return this.eachChild(r=>{i.push(r.serialize())}),i}}class e8{constructor(i,r,n,o){this.type=i,this.input=r,this.beginIndex=n,this.endIndex=o}static parse(i,r){if(i.length<=2||i.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let n=r.parse(i[1],1,tH),o=r.parse(i[2],2,tj);if(!n||!o)return null;if(!t3(n.type,[tQ(tH),tZ,tH]))return r.error(`Expected first argument to be of type array or string, but found ${t0(n.type)} instead`);if(4===i.length){let s=r.parse(i[3],3,tj);return s?new e8(n.type,n,o,s):null}return new e8(n.type,n,o)}evaluate(i){let r=this.input.evaluate(i),n=this.beginIndex.evaluate(i);if(!t5(r,["string","array"]))throw new ea(`Expected first argument to be of type array or string, but found ${t0(en(r))} instead.`);if(this.endIndex){let o=this.endIndex.evaluate(i);return r.slice(n,o)}return r.slice(n)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){let i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function e9(i,r){return"=="===i||"!="===i?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function e7(i,r,n,o){return 0===o.compare(r,n)}function it(i,r,n){let o="=="!==i&&"!="!==i;return class s{constructor(i,r,n){this.type=tX,this.lhs=i,this.rhs=r,this.collator=n,this.hasUntypedArgument="value"===i.type.kind||"value"===r.type.kind}static parse(i,r){if(3!==i.length&&4!==i.length)return r.error("Expected two or three arguments.");let n=i[0],a=r.parse(i[1],1,tH);if(!a)return null;if(!e9(n,a.type))return r.concat(1).error(`"${n}" comparisons are not supported for type '${t0(a.type)}'.`);let l=r.parse(i[2],2,tH);if(!l)return null;if(!e9(n,l.type))return r.concat(2).error(`"${n}" comparisons are not supported for type '${t0(l.type)}'.`);if(a.type.kind!==l.type.kind&&"value"!==a.type.kind&&"value"!==l.type.kind)return r.error(`Cannot compare types '${t0(a.type)}' and '${t0(l.type)}'.`);o&&("value"===a.type.kind&&"value"!==l.type.kind?a=new eu(l.type,[a]):"value"!==a.type.kind&&"value"===l.type.kind&&(l=new eu(a.type,[l])));let u=null;if(4===i.length){if("string"!==a.type.kind&&"string"!==l.type.kind&&"value"!==a.type.kind&&"value"!==l.type.kind)return r.error("Cannot use collator to compare non-string types.");if(!(u=r.parse(i[3],3,tY)))return null}return new s(a,l,u)}evaluate(s){let a=this.lhs.evaluate(s),l=this.rhs.evaluate(s);if(o&&this.hasUntypedArgument){let r=en(a),n=en(l);if(r.kind!==n.kind||"string"!==r.kind&&"number"!==r.kind)throw new ea(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${r.kind}, ${n.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let i=en(a),n=en(l);if("string"!==i.kind||"string"!==n.kind)return r(s,a,l)}return this.collator?n(s,a,l,this.collator.evaluate(s)):r(s,a,l)}eachChild(i){i(this.lhs),i(this.rhs),this.collator&&i(this.collator)}outputDefined(){return!0}serialize(){let r=[i];return this.eachChild(i=>{r.push(i.serialize())}),r}}}let ie=it("==",function(i,r,n){return r===n},e7),ii=it("!=",function(i,r,n){return r!==n},function(i,r,n,o){return!e7(0,r,n,o)}),ir=it("<",function(i,r,n){return r<n},function(i,r,n,o){return 0>o.compare(r,n)}),io=it(">",function(i,r,n){return r>n},function(i,r,n,o){return o.compare(r,n)>0}),is=it("<=",function(i,r,n){return r<=n},function(i,r,n,o){return 0>=o.compare(r,n)}),ia=it(">=",function(i,r,n){return r>=n},function(i,r,n,o){return o.compare(r,n)>=0});class il{constructor(i,r,n,o,s){this.type=tZ,this.number=i,this.locale=r,this.currency=n,this.minFractionDigits=o,this.maxFractionDigits=s}static parse(i,r){if(3!==i.length)return r.error("Expected two arguments.");let n=r.parse(i[1],1,tj);if(!n)return null;let o=i[2];if("object"!=typeof o||Array.isArray(o))return r.error("NumberFormat options argument must be an object.");let s=null;if(o.locale&&!(s=r.parse(o.locale,1,tZ)))return null;let a=null;if(o.currency&&!(a=r.parse(o.currency,1,tZ)))return null;let l=null;if(o["min-fraction-digits"]&&!(l=r.parse(o["min-fraction-digits"],1,tj)))return null;let u=null;return!o["max-fraction-digits"]||(u=r.parse(o["max-fraction-digits"],1,tj))?new il(n,s,a,l,u):null}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class iu{constructor(i){this.type=tj,this.input=i}static parse(i,r){if(2!==i.length)return r.error(`Expected 1 argument, but found ${i.length-1} instead.`);let n=r.parse(i[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?r.error(`Expected argument of type string or array, but found ${t0(n.type)} instead.`):new iu(n):null}evaluate(i){let r=this.input.evaluate(i);if("string"==typeof r||Array.isArray(r))return r.length;throw new ea(`Expected value to be of type string or array, but found ${t0(en(r))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){let i=["length"];return this.eachChild(r=>{i.push(r.serialize())}),i}}let ih={"==":ie,"!=":ii,">":io,"<":ir,">=":ia,"<=":is,array:eu,at:e2,boolean:eu,case:e6,coalesce:e0,collator:ey,format:eh,image:ec,in:e3,"index-of":e5,interpolate:eJ,"interpolate-hcl":eJ,"interpolate-lab":eJ,length:iu,let:e1,literal:es,match:e4,number:eu,"number-format":il,object:eu,slice:e8,step:eN,string:eu,"to-boolean":ef,"to-color":ef,"to-number":ef,"to-string":ef,var:ek,within:eC};function ic(i,[r,n,o,s]){r=r.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);let a=s?s.evaluate(i):1,l=ei(r,n,o,a);if(l)throw new ea(l);return new t8(r/255*a,n/255*a,o/255*a,a)}function ip(i,r){let n=r[i];return void 0===n?null:n}function id(i){return{type:i}}function im(i){return{result:"success",value:i}}function ig(i){return{result:"error",value:i}}function iy(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function i_(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function iv(i){return!!i.expression&&i.expression.interpolated}function ix(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function ib(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function iw(i){return i}function iE(i,r,n){return void 0!==i?i:void 0!==r?r:void 0!==n?n:void 0}function iI(i,r,n,o,s){return iE(typeof n===s?o[n]:void 0,i.default,r.default)}function iS(i,r,n){if("number"!==ix(n))return iE(i.default,r.default);let o=i.stops.length;if(1===o||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];let s=eD(i.stops.map(i=>i[0]),n);return i.stops[s][1]}function iM(i,r,n){let o=void 0!==i.base?i.base:1;if("number"!==ix(n))return iE(i.default,r.default);let s=i.stops.length;if(1===s||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];let a=eD(i.stops.map(i=>i[0]),n),l=function(i,r,n,o){let s=o-n,a=i-n;return 0===s?0:1===r?a/s:(Math.pow(r,a)-1)/(Math.pow(r,s)-1)}(n,o,i.stops[a][0],i.stops[a+1][0]),u=i.stops[a][1],h=i.stops[a+1][1],c=ez[r.type]||iw;if(i.colorSpace&&"rgb"!==i.colorSpace){let r=eK[i.colorSpace];c=(i,n)=>r.reverse(r.interpolate(r.forward(i),r.forward(n),l))}return"function"==typeof u.evaluate?{evaluate(...i){let r=u.evaluate.apply(void 0,i),n=h.evaluate.apply(void 0,i);if(void 0!==r&&void 0!==n)return c(r,n,l)}}:c(u,h,l)}function iT(i,r,n){return"color"===r.type?n=t8.parse(n):"formatted"===r.type?n=et.fromString(n.toString()):"resolvedImage"===r.type?n=ee.fromString(n.toString()):ix(n)===r.type||"enum"===r.type&&r.values[n]||(n=void 0),iE(n,i.default,r.default)}eg.register(ih,{error:[{kind:"error"},[tZ],(i,[r])=>{throw new ea(r.evaluate(i))}],typeof:[tZ,[tH],(i,[r])=>t0(en(r.evaluate(i)))],"to-rgba":[tQ(tj,4),[t$],(i,[r])=>r.evaluate(i).toArray()],rgb:[t$,[tj,tj,tj],ic],rgba:[t$,[tj,tj,tj,tj],ic],has:{type:tX,overloads:[[[tZ],(i,[r])=>r.evaluate(i)in i.properties()],[[tZ,tW],(i,[r,n])=>r.evaluate(i)in n.evaluate(i)]]},get:{type:tH,overloads:[[[tZ],(i,[r])=>ip(r.evaluate(i),i.properties())],[[tZ,tW],(i,[r,n])=>ip(r.evaluate(i),n.evaluate(i))]]},"feature-state":[tH,[tZ],(i,[r])=>ip(r.evaluate(i),i.featureState||{})],properties:[tW,[],i=>i.properties()],"geometry-type":[tZ,[],i=>i.geometryType()],id:[tH,[],i=>i.id()],zoom:[tj,[],i=>i.globals.zoom],"heatmap-density":[tj,[],i=>i.globals.heatmapDensity||0],"line-progress":[tj,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[tj,[],i=>i.globals.skyRadialProgress||0],accumulated:[tH,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[tj,id(tj),(i,r)=>{let n=0;for(let o of r)n+=o.evaluate(i);return n}],"*":[tj,id(tj),(i,r)=>{let n=1;for(let o of r)n*=o.evaluate(i);return n}],"-":{type:tj,overloads:[[[tj,tj],(i,[r,n])=>r.evaluate(i)-n.evaluate(i)],[[tj],(i,[r])=>-r.evaluate(i)]]},"/":[tj,[tj,tj],(i,[r,n])=>r.evaluate(i)/n.evaluate(i)],"%":[tj,[tj,tj],(i,[r,n])=>r.evaluate(i)%n.evaluate(i)],ln2:[tj,[],()=>Math.LN2],pi:[tj,[],()=>Math.PI],e:[tj,[],()=>Math.E],"^":[tj,[tj,tj],(i,[r,n])=>Math.pow(r.evaluate(i),n.evaluate(i))],sqrt:[tj,[tj],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[tj,[tj],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[tj,[tj],(i,[r])=>Math.log(r.evaluate(i))],log2:[tj,[tj],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[tj,[tj],(i,[r])=>Math.sin(r.evaluate(i))],cos:[tj,[tj],(i,[r])=>Math.cos(r.evaluate(i))],tan:[tj,[tj],(i,[r])=>Math.tan(r.evaluate(i))],asin:[tj,[tj],(i,[r])=>Math.asin(r.evaluate(i))],acos:[tj,[tj],(i,[r])=>Math.acos(r.evaluate(i))],atan:[tj,[tj],(i,[r])=>Math.atan(r.evaluate(i))],min:[tj,id(tj),(i,r)=>Math.min(...r.map(r=>r.evaluate(i)))],max:[tj,id(tj),(i,r)=>Math.max(...r.map(r=>r.evaluate(i)))],abs:[tj,[tj],(i,[r])=>Math.abs(r.evaluate(i))],round:[tj,[tj],(i,[r])=>{let n=r.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[tj,[tj],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[tj,[tj],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[tX,[tZ,tH],(i,[r,n])=>i.properties()[r.value]===n.value],"filter-id-==":[tX,[tH],(i,[r])=>i.id()===r.value],"filter-type-==":[tX,[tZ],(i,[r])=>i.geometryType()===r.value],"filter-<":[tX,[tZ,tH],(i,[r,n])=>{let o=i.properties()[r.value],s=n.value;return typeof o==typeof s&&o<s}],"filter-id-<":[tX,[tH],(i,[r])=>{let n=i.id(),o=r.value;return typeof n==typeof o&&n<o}],"filter->":[tX,[tZ,tH],(i,[r,n])=>{let o=i.properties()[r.value],s=n.value;return typeof o==typeof s&&o>s}],"filter-id->":[tX,[tH],(i,[r])=>{let n=i.id(),o=r.value;return typeof n==typeof o&&n>o}],"filter-<=":[tX,[tZ,tH],(i,[r,n])=>{let o=i.properties()[r.value],s=n.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[tX,[tH],(i,[r])=>{let n=i.id(),o=r.value;return typeof n==typeof o&&n<=o}],"filter->=":[tX,[tZ,tH],(i,[r,n])=>{let o=i.properties()[r.value],s=n.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[tX,[tH],(i,[r])=>{let n=i.id(),o=r.value;return typeof n==typeof o&&n>=o}],"filter-has":[tX,[tH],(i,[r])=>r.value in i.properties()],"filter-has-id":[tX,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[tX,[tQ(tZ)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[tX,[tQ(tH)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[tX,[tZ,tQ(tH)],(i,[r,n])=>n.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[tX,[tZ,tQ(tH)],(i,[r,n])=>(function(i,r,n,o){for(;n<=o;){let s=n+o>>1;if(r[s]===i)return!0;r[s]>i?o=s-1:n=s+1}return!1})(i.properties()[r.value],n.value,0,n.value.length-1)],all:{type:tX,overloads:[[[tX,tX],(i,[r,n])=>r.evaluate(i)&&n.evaluate(i)],[id(tX),(i,r)=>{for(let n of r)if(!n.evaluate(i))return!1;return!0}]]},any:{type:tX,overloads:[[[tX,tX],(i,[r,n])=>r.evaluate(i)||n.evaluate(i)],[id(tX),(i,r)=>{for(let n of r)if(n.evaluate(i))return!0;return!1}]]},"!":[tX,[tX],(i,[r])=>!r.evaluate(i)],"is-supported-script":[tX,[tZ],(i,[r])=>{let n=i.globals&&i.globals.isSupportedScript;return!n||n(r.evaluate(i))}],upcase:[tZ,[tZ],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[tZ,[tZ],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[tZ,id(tH),(i,r)=>r.map(r=>eo(r.evaluate(i))).join("")],"resolved-locale":[tZ,[tY],(i,[r])=>r.evaluate(i).resolvedLocale()]});class iC{constructor(i,r){this.expression=i,this._warningHistory={},this._evaluator=new em,this._defaultValue=r?"color"===r.type&&ib(r.default)?new t8(0,0,0,0):"color"===r.type?t8.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(i,r,n,o,s,a){return this._evaluator.globals=i,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=o,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(i,r,n,o,s,a){this._evaluator.globals=i,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=o,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a||null;try{let i=this.expression.evaluate(this._evaluator);if(null==i||"number"==typeof i&&i!=i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new ea(`Expected value to be one of ${Object.keys(this._enumValues).map(i=>JSON.stringify(i)).join(", ")}, but found ${JSON.stringify(i)} instead.`);return i}catch(i){return this._warningHistory[i.message]||(this._warningHistory[i.message]=!0,"undefined"!=typeof console&&console.warn(i.message)),this._defaultValue}}}function iP(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in ih}function iA(i,r){let n=new eR(ih,[],r?function(i){let r={color:t$,string:tZ,number:tj,enum:tZ,boolean:tX,formatted:tK,resolvedImage:tJ};return"array"===i.type?tQ(r[i.value]||tH,i.length):r[i.type]}(r):void 0),o=n.parse(i,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return o?im(new iC(o,r)):ig(n.errors)}class iL{constructor(i,r){this.kind=i,this._styleExpression=r,this.isStateDependent="constant"!==i&&!eA(r.expression)}evaluateWithoutErrorHandling(i,r,n,o,s,a){return this._styleExpression.evaluateWithoutErrorHandling(i,r,n,o,s,a)}evaluate(i,r,n,o,s,a){return this._styleExpression.evaluate(i,r,n,o,s,a)}}class ik{constructor(i,r,n,o){this.kind=i,this.zoomStops=n,this._styleExpression=r,this.isStateDependent="camera"!==i&&!eA(r.expression),this.interpolationType=o}evaluateWithoutErrorHandling(i,r,n,o,s,a){return this._styleExpression.evaluateWithoutErrorHandling(i,r,n,o,s,a)}evaluate(i,r,n,o,s,a){return this._styleExpression.evaluate(i,r,n,o,s,a)}interpolationFactor(i,r,n){return this.interpolationType?eJ.interpolationFactor(this.interpolationType,i,r,n):0}}function iR(i,r){if("error"===(i=iA(i,r)).result)return i;let n=i.value.expression,o=eP(n);if(!o&&!iy(r))return ig([new tG("","data expressions not supported")]);let s=eL(n,["zoom"]);if(!s&&!i_(r))return ig([new tG("","zoom expressions not supported")]);let a=function i(r){let n=null;if(r instanceof e1)n=i(r.result);else if(r instanceof e0){for(let o of r.args)if(n=i(o))break}else(r instanceof eN||r instanceof eJ)&&r.input instanceof eg&&"zoom"===r.input.name&&(n=r);return n instanceof tG||r.eachChild(r=>{let o=i(r);o instanceof tG?n=o:!n&&o?n=new tG("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&o&&n!==o&&(n=new tG("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(n);return a||s?a instanceof tG?ig([a]):a instanceof eJ&&!iv(r)?ig([new tG("",'"interpolate" expressions cannot be used with this property')]):im(a?new ik(o?"camera":"composite",i.value,a.labels,a instanceof eJ?a.interpolation:void 0):new iL(o?"constant":"source",i.value)):ig([new tG("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iD{constructor(i,r){this._parameters=i,this._specification=r,tF(this,function i(r,n){let o,s,a;let l="color"===n.type,u=r.stops&&"object"==typeof r.stops[0][0],h=u||!(u||void 0!==r.property),c=r.type||(iv(n)?"exponential":"interval");if(l&&((r=tF({},r)).stops&&(r.stops=r.stops.map(i=>[i[0],t8.parse(i[1])])),r.default=t8.parse(r.default?r.default:n.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!eK[r.colorSpace])throw Error(`Unknown color space: ${r.colorSpace}`);if("exponential"===c)o=iM;else if("interval"===c)o=iS;else if("categorical"===c){for(let i of(o=iI,s=Object.create(null),r.stops))s[i[0]]=i[1];a=typeof r.stops[0][0]}else{if("identity"!==c)throw Error(`Unknown function type "${c}"`);o=iT}if(u){let o={},s=[];for(let i=0;i<r.stops.length;i++){let n=r.stops[i],a=n[0].zoom;void 0===o[a]&&(o[a]={zoom:a,type:r.type,property:r.property,default:r.default,stops:[]},s.push(a)),o[a].stops.push([n[0].value,n[1]])}let a=[];for(let r of s)a.push([o[r].zoom,i(o[r],n)]);let l={name:"linear"};return{kind:"composite",interpolationType:l,interpolationFactor:eJ.interpolationFactor.bind(void 0,l),zoomStops:a.map(i=>i[0]),evaluate:({zoom:i},o)=>iM({stops:a,base:r.base},n,i).evaluate(i,o)}}if(h){let i="exponential"===c?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:eJ.interpolationFactor.bind(void 0,i),zoomStops:r.stops.map(i=>i[0]),evaluate:({zoom:i})=>o(r,n,i,s,a)}}return{kind:"source",evaluate(i,l){let u=l&&l.properties?l.properties[r.property]:void 0;return void 0===u?iE(r.default,n.default):o(r,n,u,s,a)}}}(this._parameters,this._specification))}static deserialize(i){return new iD(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function iN(i){let r=i.key,n=i.value,o=i.valueSpec||{},s=i.objectElementValidators||{},a=i.style,l=i.styleSpec,u=[],h=ix(n);if("object"!==h)return[new tO(r,n,`object expected, ${h} found`)];for(let i in n){let h;let c=i.split(".")[0],p=o[c]||o["*"];if(s[c])h=s[c];else if(o[c])h=i8;else if(s["*"])h=s["*"];else{if(!o["*"]){u.push(new tO(r,n[i],`unknown property "${i}"`));continue}h=i8}u=u.concat(h({key:(r?`${r}.`:r)+i,value:n[i],valueSpec:p,style:a,styleSpec:l,object:n,objectKey:i},n))}for(let i in o)s[i]||o[i].required&&void 0===o[i].default&&void 0===n[i]&&u.push(new tO(r,n,`missing required property "${i}"`));return u}function iO(i){let r=i.value,n=i.valueSpec,o=i.style,s=i.styleSpec,a=i.key,l=i.arrayElementValidator||i8;if("array"!==ix(r))return[new tO(a,r,`array expected, ${ix(r)} found`)];if(n.length&&r.length!==n.length)return[new tO(a,r,`array length ${n.length} expected, length ${r.length} found`)];if(n["min-length"]&&r.length<n["min-length"])return[new tO(a,r,`array length at least ${n["min-length"]} expected, length ${r.length} found`)];let u={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};s.$version<7&&(u.function=n.function),"object"===ix(n.value)&&(u=n.value);let h=[];for(let i=0;i<r.length;i++)h=h.concat(l({array:r,arrayIndex:i,value:r[i],valueSpec:u,style:o,styleSpec:s,key:`${a}[${i}]`}));return h}function iz(i){let r=i.key,n=i.value,o=i.valueSpec,s=ix(n);if("number"===s&&n!=n&&(s="NaN"),"number"!==s)return[new tO(r,n,`number expected, ${s} found`)];if("minimum"in o){let s=o.minimum;if("array"===ix(o.minimum)&&(s=o.minimum[i.arrayIndex]),n<s)return[new tO(r,n,`${n} is less than the minimum value ${s}`)]}if("maximum"in o){let s=o.maximum;if("array"===ix(o.maximum)&&(s=o.maximum[i.arrayIndex]),n>s)return[new tO(r,n,`${n} is greater than the maximum value ${s}`)]}return[]}function iF(i){let r=i.valueSpec,n=tB(i.value.type),o,s,a,l={},u="categorical"!==n&&void 0===i.value.property,h="array"===ix(i.value.stops)&&"array"===ix(i.value.stops[0])&&"object"===ix(i.value.stops[0][0]),c=iN({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(i){if("identity"===n)return[new tO(i.key,i.value,'identity function may not have a "stops" property')];let r=[],o=i.value;return r=r.concat(iO({key:i.key,value:o,valueSpec:i.valueSpec,style:i.style,styleSpec:i.styleSpec,arrayElementValidator:p})),"array"===ix(o)&&0===o.length&&r.push(new tO(i.key,o,"array must have at least one stop")),r},default:function(i){return i8({key:i.key,value:i.value,valueSpec:r,style:i.style,styleSpec:i.styleSpec})}}});return"identity"===n&&u&&c.push(new tO(i.key,i.value,'missing required property "property"')),"identity"===n||i.value.stops||c.push(new tO(i.key,i.value,'missing required property "stops"')),"exponential"===n&&i.valueSpec.expression&&!iv(i.valueSpec)&&c.push(new tO(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(u||iy(i.valueSpec)?u&&!i_(i.valueSpec)&&c.push(new tO(i.key,i.value,"zoom functions not supported")):c.push(new tO(i.key,i.value,"property functions not supported"))),("categorical"===n||h)&&void 0===i.value.property&&c.push(new tO(i.key,i.value,'"property" property is required')),c;function p(i){let n=[],o=i.value,u=i.key;if("array"!==ix(o))return[new tO(u,o,`array expected, ${ix(o)} found`)];if(2!==o.length)return[new tO(u,o,`array length 2 expected, length ${o.length} found`)];if(h){if("object"!==ix(o[0]))return[new tO(u,o,`object expected, ${ix(o[0])} found`)];if(void 0===o[0].zoom)return[new tO(u,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new tO(u,o,"object stop key must have value")];if(a&&a>tB(o[0].zoom))return[new tO(u,o[0].zoom,"stop zoom values must appear in ascending order")];tB(o[0].zoom)!==a&&(a=tB(o[0].zoom),s=void 0,l={}),n=n.concat(iN({key:`${u}[0]`,value:o[0],valueSpec:{zoom:{}},style:i.style,styleSpec:i.styleSpec,objectElementValidators:{zoom:iz,value:f}}))}else n=n.concat(f({key:`${u}[0]`,value:o[0],valueSpec:{},style:i.style,styleSpec:i.styleSpec},o));return iP(tU(o[1]))?n.concat([new tO(`${u}[1]`,o[1],"expressions are not allowed in function stops.")]):n.concat(i8({key:`${u}[1]`,value:o[1],valueSpec:r,style:i.style,styleSpec:i.styleSpec}))}function f(i,a){let u=ix(i.value),h=tB(i.value),c=null!==i.value?i.value:a;if(o){if(u!==o)return[new tO(i.key,c,`${u} stop domain type must match previous stop domain type ${o}`)]}else o=u;if("number"!==u&&"string"!==u&&"boolean"!==u)return[new tO(i.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==u&&"categorical"!==n){let o=`number expected, ${u} found`;return iy(r)&&void 0===n&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new tO(i.key,c,o)]}return"categorical"!==n||"number"!==u||isFinite(h)&&Math.floor(h)===h?"categorical"!==n&&"number"===u&&void 0!==s&&h<s?[new tO(i.key,c,"stop domain values must appear in ascending order")]:(s=h,"categorical"===n&&h in l?[new tO(i.key,c,"stop domain values must be unique")]:(l[h]=!0,[])):[new tO(i.key,c,`integer expected, found ${h}`)]}}function iB(i){let r=("property"===i.expressionContext?iR:iA)(tU(i.value),i.valueSpec);if("error"===r.result)return r.value.map(r=>new tO(`${i.key}${r.key}`,i.value,r.message));let n=r.value.expression||r.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!n.outputDefined())return[new tO(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!eA(n))return[new tO(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext&&!eA(n))return[new tO(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!eL(n,["zoom","feature-state"]))return[new tO(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!eP(n))return[new tO(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function iU(i){let r=i.key,n=i.value,o=i.valueSpec,s=[];return Array.isArray(o.values)?-1===o.values.indexOf(tB(n))&&s.push(new tO(r,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(o.values).indexOf(tB(n))&&s.push(new tO(r,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),s}function iG(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let r of i.slice(1))if(!iG(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}let iV={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iq(i){if(null==i)return{filter:()=>!0,needGeometry:!1};iG(i)||(i=function i(r){if(!r)return!0;let n=r[0];return r.length<=1?"any"!==n:"=="===n?iZ(r[1],r[2],"=="):"!="===n?iW(iZ(r[1],r[2],"==")):"<"===n||">"===n||"<="===n||">="===n?iZ(r[1],r[2],n):"any"===n?["any"].concat(r.slice(1).map(i)):"all"===n?["all"].concat(r.slice(1).map(i)):"none"===n?["all"].concat(r.slice(1).map(i).map(iW)):"in"===n?iX(r[1],r.slice(2)):"!in"===n?iW(iX(r[1],r.slice(2))):"has"===n?i$(r[1]):"!has"===n?iW(i$(r[1])):"within"!==n||r}(i));let r=iA(i,iV);if("error"===r.result)throw Error(r.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,n,o)=>r.value.evaluate(i,n,{},o),needGeometry:function i(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let n=1;n<r.length;n++)if(i(r[n]))return!0;return!1}(i)}}function ij(i,r){return i<r?-1:+(i>r)}function iZ(i,r,n){switch(i){case"$type":return[`filter-type-${n}`,r];case"$id":return[`filter-id-${n}`,r];default:return[`filter-${n}`,i,r]}}function iX(i,r){if(0===r.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(i=>typeof i!=typeof r[0])?["filter-in-large",i,["literal",r.sort(ij)]]:["filter-in-small",i,["literal",r]]}}function i$(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function iW(i){return["!",i]}function iH(i){return iG(tU(i.value))?iB(tF({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function i(r){let n=r.value,o=r.key;if("array"!==ix(n))return[new tO(o,n,`array expected, ${ix(n)} found`)];let s=r.styleSpec,a,l=[];if(n.length<1)return[new tO(o,n,"filter array must have at least 1 element")];switch(l=l.concat(iU({key:`${o}[0]`,value:n[0],valueSpec:s.filter_operator,style:r.style,styleSpec:r.styleSpec})),tB(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===tB(n[1])&&l.push(new tO(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&l.push(new tO(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&"string"!==(a=ix(n[1]))&&l.push(new tO(`${o}[1]`,n[1],`string expected, ${a} found`));for(let i=2;i<n.length;i++)a=ix(n[i]),"$type"===tB(n[1])?l=l.concat(iU({key:`${o}[${i}]`,value:n[i],valueSpec:s.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&l.push(new tO(`${o}[${i}]`,n[i],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let s=1;s<n.length;s++)l=l.concat(i({key:`${o}[${s}]`,value:n[s],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":a=ix(n[1]),2!==n.length?l.push(new tO(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==a&&l.push(new tO(`${o}[1]`,n[1],`string expected, ${a} found`));break;case"within":a=ix(n[1]),2!==n.length?l.push(new tO(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==a&&l.push(new tO(`${o}[1]`,n[1],`object expected, ${a} found`))}return l}(i)}function iY(i,r){let n;let o=i.key,s=i.style,a=i.styleSpec,l=i.value,u=i.objectKey,h=a[`${r}_${i.layerType}`];if(!h)return[];let c=u.match(/^(.*)-transition$/);if("paint"===r&&c&&h[c[1]]&&h[c[1]].transition)return i8({key:o,value:l,valueSpec:a.transition,style:s,styleSpec:a});let p=i.valueSpec||h[u];if(!p)return[new tO(o,l,`unknown property "${u}"`)];if("string"===ix(l)&&iy(p)&&!p.tokens&&(n=/^{([^}]+)}$/.exec(l)))return[new tO(o,l,`"${u}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(n[1])} }\`.`)];let f=[];return"symbol"===i.layerType&&("text-field"===u&&s&&!s.glyphs&&f.push(new tO(o,l,'use of "text-field" requires a style "glyphs" property')),"text-font"===u&&ib(tU(l))&&"identity"===tB(l.type)&&f.push(new tO(o,l,'"text-font" does not support identity functions'))),f.concat(i8({key:i.key,value:l,valueSpec:p,style:s,styleSpec:a,expressionContext:"property",propertyType:r,propertyKey:u}))}function iK(i){return iY(i,"paint")}function iJ(i){return iY(i,"layout")}function iQ(i){let r=[],n=i.value,o=i.key,s=i.style,a=i.styleSpec;n.type||n.ref||r.push(new tO(o,n,'either "type" or "ref" is required'));let l=tB(n.type),u=tB(n.ref);if(n.id){let a=tB(n.id);for(let l=0;l<i.arrayIndex;l++){let i=s.layers[l];tB(i.id)===a&&r.push(new tO(o,n.id,`duplicate layer id "${n.id}", previously used at line ${i.id.__line__}`))}}if("ref"in n){let i;["type","source","source-layer","filter","layout"].forEach(i=>{i in n&&r.push(new tO(o,n[i],`"${i}" is prohibited for ref layers`))}),s.layers.forEach(r=>{tB(r.id)===u&&(i=r)}),i?i.ref?r.push(new tO(o,n.ref,"ref cannot reference another ref layer")):l=tB(i.type):r.push(new tO(o,n.ref,`ref layer "${u}" not found`))}else if("background"!==l&&"sky"!==l){if(n.source){let i=s.sources&&s.sources[n.source],a=i&&tB(i.type);i?"vector"===a&&"raster"===l?r.push(new tO(o,n.source,`layer "${n.id}" requires a raster source`)):"raster"===a&&"raster"!==l?r.push(new tO(o,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==l?r.push(new tO(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===l&&n.paint&&n.paint["line-gradient"]&&("geojson"!==a||!i.lineMetrics)&&r.push(new tO(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new tO(o,n,`layer "${n.id}" must specify a "source-layer"`)):r.push(new tO(o,n.source,`source "${n.source}" not found`))}else r.push(new tO(o,n,'missing required property "source"'))}return r=r.concat(iN({key:o,value:n,valueSpec:a.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>i8({key:`${o}.type`,value:n.type,valueSpec:a.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:iH,layout:i=>iN({layer:n,key:i.key,value:i.value,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":i=>iJ(tF({layerType:l},i))}}),paint:i=>iN({layer:n,key:i.key,value:i.value,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":i=>iK(tF({layerType:l},i))}})}}))}function i0(i){let r=i.value,n=i.key,o=ix(r);return"string"!==o?[new tO(n,r,`string expected, ${o} found`)]:[]}let i1={promoteId:function({key:i,value:r}){if("string"===ix(r))return i0({key:i,value:r});{let n=[];for(let o in r)n.push(...i0({key:`${i}.${o}`,value:r[o]}));return n}}};function i2(i){let r;let n=i.value,o=i.key,s=i.styleSpec,a=i.style;if(!n.type)return[new tO(o,n,'"type" is required')];let l=tB(n.type);switch(l){case"vector":case"raster":case"raster-dem":return iN({key:o,value:n,valueSpec:s[`source_${l.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:i1});case"geojson":if(r=iN({key:o,value:n,valueSpec:s.source_geojson,style:a,styleSpec:s,objectElementValidators:i1}),n.cluster)for(let i in n.clusterProperties){let[s,a]=n.clusterProperties[i],l="string"==typeof s?[s,["accumulated"],["get",i]]:s;r.push(...iB({key:`${o}.${i}.map`,value:a,expressionContext:"cluster-map"})),r.push(...iB({key:`${o}.${i}.reduce`,value:l,expressionContext:"cluster-reduce"}))}return r;case"video":return iN({key:o,value:n,valueSpec:s.source_video,style:a,styleSpec:s});case"image":return iN({key:o,value:n,valueSpec:s.source_image,style:a,styleSpec:s});case"canvas":return[new tO(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return iU({key:`${o}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:s})}}function i3(i){let r=i.value,n=i.styleSpec,o=n.light,s=i.style,a=[],l=ix(r);if(void 0===r)return a;if("object"!==l)return a.concat([new tO("light",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/);a=a.concat(l&&o[l[1]]&&o[l[1]].transition?i8({key:i,value:r[i],valueSpec:n.transition,style:s,styleSpec:n}):o[i]?i8({key:i,value:r[i],valueSpec:o[i],style:s,styleSpec:n}):[new tO(i,r[i],`unknown property "${i}"`)])}return a}function i5(i){let r=i.value,n=i.key,o=i.style,s=i.styleSpec,a=s.terrain,l=[],u=ix(r);if(void 0===r)return l;if("object"!==u)return l.concat([new tO("terrain",r,`object expected, ${u} found`)]);for(let i in r){let n=i.match(/^(.*)-transition$/);l=l.concat(n&&a[n[1]]&&a[n[1]].transition?i8({key:i,value:r[i],valueSpec:s.transition,style:o,styleSpec:s}):a[i]?i8({key:i,value:r[i],valueSpec:a[i],style:o,styleSpec:s}):[new tO(i,r[i],`unknown property "${i}"`)])}if(r.source){let i=o.sources&&o.sources[r.source],s=i&&tB(i.type);i?"raster-dem"!==s&&l.push(new tO(n,r.source,`terrain cannot be used with a source of type ${s}, it only be used with a "raster-dem" source type`)):l.push(new tO(n,r.source,`source "${r.source}" not found`))}else l.push(new tO(n,r,'terrain is missing required property "source"'));return l}function i4(i){let r=i.value,n=i.style,o=i.styleSpec,s=o.fog,a=[],l=ix(r);if(void 0===r)return a;if("object"!==l)return a.concat([new tO("fog",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/);a=a.concat(l&&s[l[1]]&&s[l[1]].transition?i8({key:i,value:r[i],valueSpec:o.transition,style:n,styleSpec:o}):s[i]?i8({key:i,value:r[i],valueSpec:s[i],style:n,styleSpec:o}):[new tO(i,r[i],`unknown property "${i}"`)])}return a}let i6={"*":()=>[],array:iO,boolean:function(i){let r=i.value,n=i.key,o=ix(r);return"boolean"!==o?[new tO(n,r,`boolean expected, ${o} found`)]:[]},number:iz,color:function(i){let r=i.key,n=i.value,o=ix(n);return"string"!==o?[new tO(r,n,`color expected, ${o} found`)]:null===t6.parseCSSColor(n)?[new tO(r,n,`color expected, "${n}" found`)]:[]},constants:tz,enum:iU,filter:iH,function:iF,layer:iQ,object:iN,source:i2,light:i3,terrain:i5,fog:i4,string:i0,formatted:function(i){return 0===i0(i).length?[]:iB(i)},resolvedImage:function(i){return 0===i0(i).length?[]:iB(i)}};function i8(i){let r=i.value,n=i.valueSpec,o=i.styleSpec;return n.expression&&ib(tB(r))?iF(i):n.expression&&iP(tU(r))?iB(i):n.type&&i6[n.type]?i6[n.type](i):iN(tF({},i,{valueSpec:n.type?o[n.type]:n}))}function i9(i){let r=i.value,n=i.key,o=i0(i);return o.length||(-1===r.indexOf("{fontstack}")&&o.push(new tO(n,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&o.push(new tO(n,r,'"glyphs" url must include a "{range}" token'))),o}function i7(i,r=tN){let n=[];return n=n.concat(i8({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:i9,"*":()=>[]}})),i.constants&&(n=n.concat(tz({key:"constants",value:i.constants,style:i,styleSpec:r}))),rt(n)}function rt(i){return[].concat(i).sort((i,r)=>i.line-r.line)}function re(i){return function(...r){return rt(i.apply(this,r))}}i7.source=re(i2),i7.light=re(i3),i7.terrain=re(i5),i7.fog=re(i4),i7.layer=re(iQ),i7.filter=re(iH),i7.paintProperty=re(iK),i7.layoutProperty=re(iJ);let ri=i7.light,rr=i7.fog,rn=i7.paintProperty,ro=i7.layoutProperty;function rs(i,r){let n=!1;if(r&&r.length)for(let o of r)i.fire(new tR(Error(o.message))),n=!0;return n}function ra(i,r,n){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var s=new Int32Array(this.arrayBuffer);i=s[0],this.d=(r=s[1])+2*(n=s[2]);for(var a=0;a<this.d*this.d;a++){var l=s[3+a],u=s[3+a+1];o.push(l===u?null:s.subarray(l,u))}var h=s[3+o.length+1];this.keys=s.subarray(s[3+o.length],h),this.bboxes=s.subarray(h),this.insert=this._insertReadonly}else{this.d=r+2*n;for(var c=0;c<this.d*this.d;c++)o.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=n,this.scale=r/i,this.uid=0;var p=n/r*i;this.min=-p,this.max=i+p}ra.prototype.insert=function(i,r,n,o,s){this._forEachCell(r,n,o,s,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s)},ra.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ra.prototype._insertCell=function(i,r,n,o,s,a){this.cells[s].push(a)},ra.prototype.query=function(i,r,n,o,s){var a=this.min,l=this.max;if(i<=a&&r<=a&&l<=n&&l<=o&&!s)return Array.prototype.slice.call(this.keys);var u=[];return this._forEachCell(i,r,n,o,this._queryCell,u,{},s),u},ra.prototype._queryCell=function(i,r,n,o,s,a,l,u){var h=this.cells[s];if(null!==h)for(var c=this.keys,p=this.bboxes,f=0;f<h.length;f++){var d=h[f];if(void 0===l[d]){var m=4*d;(u?u(p[m+0],p[m+1],p[m+2],p[m+3]):i<=p[m+2]&&r<=p[m+3]&&n>=p[m+0]&&o>=p[m+1])?(l[d]=!0,a.push(c[d])):l[d]=!1}}},ra.prototype._forEachCell=function(i,r,n,o,s,a,l,u){for(var h=this._convertToCellCoord(i),c=this._convertToCellCoord(r),p=this._convertToCellCoord(n),f=this._convertToCellCoord(o),d=h;d<=p;d++)for(var m=c;m<=f;m++){var g=this.d*m+d;if((!u||u(this._convertFromCellCoord(d),this._convertFromCellCoord(m),this._convertFromCellCoord(d+1),this._convertFromCellCoord(m+1)))&&s.call(this,i,r,n,o,g,a,l,u))return}},ra.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ra.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ra.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=3+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var s=new Int32Array(r+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var a=r,l=0;l<i.length;l++){var u=i[l];s[3+l]=a,s.set(u,a),a+=u.length}return s[3+i.length]=a,s.set(this.keys,a),s[3+i.length+1]=a+=this.keys.length,s.set(this.bboxes,a),a+=this.bboxes.length,s.buffer};let{ImageData:rl,ImageBitmap:ru}=c,rh={};function rc(i,r,n={}){Object.defineProperty(r,"_classRegistryKey",{value:i,writeable:!1}),rh[i]={klass:r,omit:n.omit||[],shallow:n.shallow||[]}}for(let i in rc("Object",Object),ra.serialize=function(i,r){let n=i.toArrayBuffer();return r&&r.push(n),{buffer:n}},ra.deserialize=function(i){return new ra(i.buffer)},rc("Grid",ra),rc("Color",t8),rc("Error",Error),rc("ResolvedImage",ee),rc("StylePropertyFunction",iD),rc("StyleExpression",iC,{omit:["_evaluator"]}),rc("ZoomDependentExpression",ik),rc("ZoomConstantExpression",iL),rc("CompoundExpression",eg,{omit:["_evaluate"]}),ih)ih[i]._classRegistryKey||rc(`Expression_${i}`,ih[i]);function rp(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function rf(i){return ru&&i instanceof ru}function rd(i,r){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(rp(i)||rf(i))return r&&r.push(i),i;if(ArrayBuffer.isView(i))return r&&r.push(i.buffer),i;if(i instanceof rl)return r&&r.push(i.data.buffer),i;if(Array.isArray(i)){let n=[];for(let o of i)n.push(rd(o,r));return n}if("object"==typeof i){let n=i.constructor,o=n._classRegistryKey;if(!o)throw Error("can't serialize object of unregistered class");let s=n.serialize?n.serialize(i,r):{};if(!n.serialize){for(let n in i){if(!i.hasOwnProperty(n)||rh[o].omit.indexOf(n)>=0)continue;let a=i[n];s[n]=rh[o].shallow.indexOf(n)>=0?a:rd(a,r)}i instanceof Error&&(s.message=i.message)}if(s.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==o&&(s.$name=o),s}throw Error("can't serialize object of type "+typeof i)}function rm(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||rp(i)||rf(i)||ArrayBuffer.isView(i)||i instanceof rl)return i;if(Array.isArray(i))return i.map(rm);if("object"==typeof i){let r=i.$name||"Object",{klass:n}=rh[r];if(!n)throw Error(`can't deserialize unregistered class ${r}`);if(n.deserialize)return n.deserialize(i);let o=Object.create(n.prototype);for(let n of Object.keys(i)){if("$name"===n)continue;let s=i[n];o[n]=rh[r].shallow.indexOf(n)>=0?s:rm(s)}return o}throw Error("can't deserialize object of type "+typeof i)}class rg{constructor(){this.first=!0}update(i,r){let n=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=n,!0))}}let ry=i=>i>=1536&&i<=1791,r_=i=>i>=1872&&i<=1919,rv=i=>i>=2208&&i<=2303,rx=i=>i>=11904&&i<=12031,rb=i=>i>=12032&&i<=12255,rw=i=>i>=12272&&i<=12287,rE=i=>i>=12288&&i<=12351,rI=i=>i>=12352&&i<=12447,rS=i=>i>=12448&&i<=12543,rM=i=>i>=12544&&i<=12591,rT=i=>i>=12704&&i<=12735,rC=i=>i>=12736&&i<=12783,rP=i=>i>=12784&&i<=12799,rA=i=>i>=12800&&i<=13055,rL=i=>i>=13056&&i<=13311,rk=i=>i>=13312&&i<=19903,rR=i=>i>=19968&&i<=40959,rD=i=>i>=40960&&i<=42127,rN=i=>i>=42128&&i<=42191,rO=i=>i>=44032&&i<=55215,rz=i=>i>=63744&&i<=64255,rF=i=>i>=64336&&i<=65023,rB=i=>i>=65040&&i<=65055,rU=i=>i>=65072&&i<=65103,rG=i=>i>=65104&&i<=65135,rV=i=>i>=65136&&i<=65279,rq=i=>i>=65280&&i<=65519;function rj(i){for(let r of i)if(rZ(r.charCodeAt(0)))return!0;return!1}function rZ(i){return!(746!==i&&747!==i&&(i<4352||!(rT(i)||rM(i)||rU(i)&&!(i>=65097&&i<=65103)||rz(i)||rL(i)||rx(i)||rC(i)||!(!rE(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||rk(i)||rR(i)||rA(i)||i>=12592&&i<=12687||i>=43360&&i<=43391||i>=55216&&i<=55295||i>=4352&&i<=4607||rO(i)||rI(i)||rw(i)||i>=12688&&i<=12703||rb(i)||rP(i)||rS(i)&&12540!==i||!(!rq(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!rG(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||i>=5120&&i<=5759||i>=6320&&i<=6399||rB(i)||i>=19904&&i<=19967||rD(i)||rN(i))))}function rX(i){return!(rZ(i)||i>=128&&i<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||i>=8192&&i<=8303&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||i>=8448&&i<=8527||i>=8528&&i<=8591||i>=8960&&i<=9215&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||i>=9216&&i<=9279&&9251!==i||i>=9280&&i<=9311||i>=9312&&i<=9471||i>=9632&&i<=9727||i>=9728&&i<=9983&&!(i>=9754&&i<=9759)||i>=11008&&i<=11263&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||rE(i)||rS(i)||i>=57344&&i<=63743||rU(i)||rG(i)||rq(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i)}function r$(i){return i>=1424&&i<=2303||rF(i)||rV(i)}let rW="deferred",rH="loading",rY="loaded",rK=null,rJ="unavailable",rQ=null,r0=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(rJ="error"),rK&&rK(i)};function r1(){r2.fire(new tk("pluginStateChange",{pluginStatus:rJ,pluginURL:rQ}))}let r2=new tD,r3=function(){return rJ},r5=function(){if(rJ!==rW||!rQ)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");rJ=rH,r1(),rQ&&tS({url:rQ},i=>{i?r0(i):(rJ=rY,r1())})},r4={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>rJ===rY||null!=r4.applyArabicShaping,isLoading:()=>rJ===rH,setState(i){rJ=i.pluginStatus,rQ=i.pluginURL},isParsed:()=>null!=r4.applyArabicShaping&&null!=r4.processBidirectionalText&&null!=r4.processStyledBidirectionalText,getPluginURL:()=>rQ};class r6{constructor(i,r){this.zoom=i,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rg,this.transition={})}isSupportedScript(i){return function(i,r){for(let o of i){var n;if(n=o.charCodeAt(0),!r&&r$(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||n>=6016&&n<=6143)return!1}return!0}(i,r4.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let i=this.zoom,r=i-Math.floor(i),n=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class r8{constructor(i,r){this.property=i,this.value=r,this.expression=function(i,r){if(ib(i))return new iD(i,r);if(iP(i)){let n=iR(i,r);if("error"===n.result)throw Error(n.value.map(i=>`${i.key}: ${i.message}`).join(", "));return n.value}{let n=i;return"string"==typeof i&&"color"===r.type&&(n=t8.parse(i)),{kind:"constant",evaluate:()=>n}}}(void 0===r?i.specification.default:r,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,r,n){return this.property.possiblyEvaluate(this,i,r,n)}}class r9{constructor(i){this.property=i,this.value=new r8(i,void 0)}transitioned(i,r){return new nt(this.property,this.value,r,w({},i.transition,this.transition),i.now)}untransitioned(){return new nt(this.property,this.value,null,{},0)}}class r7{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return k(this._values[i].value.value)}setValue(i,r){this._values.hasOwnProperty(i)||(this._values[i]=new r9(this._values[i].property)),this._values[i].value=new r8(this._values[i].property,null===r?void 0:k(r))}getTransition(i){return k(this._values[i].transition)}setTransition(i,r){this._values.hasOwnProperty(i)||(this._values[i]=new r9(this._values[i].property)),this._values[i].transition=k(r)||void 0}serialize(){let i={};for(let r of Object.keys(this._values)){let n=this.getValue(r);void 0!==n&&(i[r]=n);let o=this.getTransition(r);void 0!==o&&(i[`${r}-transition`]=o)}return i}transitioned(i,r){let n=new ne(this._properties);for(let o of Object.keys(this._values))n._values[o]=this._values[o].transitioned(i,r._values[o]);return n}untransitioned(){let i=new ne(this._properties);for(let r of Object.keys(this._values))i._values[r]=this._values[r].untransitioned();return i}}class nt{constructor(i,r,n,o,s){let a=o.delay||0,l=o.duration||0;s=s||0,this.property=i,this.value=r,this.begin=s+a,this.end=this.begin+l,i.specification.transition&&(o.delay||o.duration)&&(this.prior=n)}possiblyEvaluate(i,r,n){let o=i.now||0,s=this.value.possiblyEvaluate(i,r,n),a=this.prior;if(a){if(o>this.end||this.value.isDataDriven())return this.prior=null,s;if(o<this.begin)return a.possiblyEvaluate(i,r,n);{let l=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(i,r,n),s,m(l))}}return s}}class ne{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,r,n){let o=new nn(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].possiblyEvaluate(i,r,n);return o}hasTransition(){for(let i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ni{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return k(this._values[i].value)}setValue(i,r){this._values[i]=new r8(this._values[i].property,null===r?void 0:k(r))}serialize(){let i={};for(let r of Object.keys(this._values)){let n=this.getValue(r);void 0!==n&&(i[r]=n)}return i}possiblyEvaluate(i,r,n){let o=new nn(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].possiblyEvaluate(i,r,n);return o}}class nr{constructor(i,r,n){this.property=i,this.value=r,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,r,n,o){return this.property.evaluate(this.value,this.parameters,i,r,n,o)}}class nn{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class no{constructor(i){this.specification=i}possiblyEvaluate(i,r){return i.expression.evaluate(r)}interpolate(i,r,n){let o=ez[this.specification.type];return o?o(i,r,n):i}}class ns{constructor(i,r){this.specification=i,this.overrides=r}possiblyEvaluate(i,r,n,o){return new nr(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(r,null,{},n,o)}:i.expression,r)}interpolate(i,r,n){if("constant"!==i.value.kind||"constant"!==r.value.kind)return i;if(void 0===i.value.value||void 0===r.value.value)return new nr(this,{kind:"constant",value:void 0},i.parameters);let o=ez[this.specification.type];return o?new nr(this,{kind:"constant",value:o(i.value.value,r.value.value,n)},i.parameters):i}evaluate(i,r,n,o,s,a){return"constant"===i.kind?i.value:i.evaluate(r,n,o,s,a)}}class na extends ns{possiblyEvaluate(i,r,n,o){if(void 0===i.value)return new nr(this,{kind:"constant",value:void 0},r);if("constant"===i.expression.kind){let s=i.expression.evaluate(r,null,{},n,o),a="resolvedImage"===i.property.specification.type&&"string"!=typeof s?s.name:s;return new nr(this,{kind:"constant",value:this._calculate(a,a,a,r)},r)}return"camera"===i.expression.kind?new nr(this,{kind:"constant",value:this._calculate(i.expression.evaluate({zoom:r.zoom-1}),i.expression.evaluate({zoom:r.zoom}),i.expression.evaluate({zoom:r.zoom+1}),r)},r):new nr(this,i.expression,r)}evaluate(i,r,n,o,s,a){if("source"===i.kind){let l=i.evaluate(r,n,o,s,a);return this._calculate(l,l,l,r)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(r.zoom)-1},n,o),i.evaluate({zoom:Math.floor(r.zoom)},n,o),i.evaluate({zoom:Math.floor(r.zoom)+1},n,o),r):i.value}_calculate(i,r,n,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:i,to:r,other:n}:{from:n,to:r,other:i}}interpolate(i){return i}}class nl{constructor(i){this.specification=i}possiblyEvaluate(i,r,n,o){if(void 0!==i.value){if("constant"===i.expression.kind){let s=i.expression.evaluate(r,null,{},n,o);return this._calculate(s,s,s,r)}return this._calculate(i.expression.evaluate(new r6(Math.floor(r.zoom-1),r)),i.expression.evaluate(new r6(Math.floor(r.zoom),r)),i.expression.evaluate(new r6(Math.floor(r.zoom+1),r)),r)}}_calculate(i,r,n,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:i,to:r}:{from:n,to:r}}interpolate(i){return i}}class nu{constructor(i){this.specification=i}possiblyEvaluate(i,r,n,o){return!!i.expression.evaluate(r,null,{},n,o)}interpolate(){return!1}}class nh{constructor(i){for(let r in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){let n=i[r];n.specification.overridable&&this.overridableProperties.push(r);let o=this.defaultPropertyValues[r]=new r8(n,void 0),s=this.defaultTransitionablePropertyValues[r]=new r9(n);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate({})}}}function nc(i,r){return 256*(i=_(Math.floor(i),0,255))+_(Math.floor(r),0,255)}rc("DataDrivenProperty",ns),rc("DataConstantProperty",no),rc("CrossFadedDataDrivenProperty",na),rc("CrossFadedProperty",nl),rc("ColorRampProperty",nu);let np={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nf{constructor(i,r){this._structArray=i,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nd{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,r){return i._trim(),r&&(i.isTransferred=!0,r.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){let r=Object.create(this.prototype);return r.arrayBuffer=i.arrayBuffer,r.length=i.length,r.capacity=i.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function nm(i,r=1){let n=0,o=0;return{members:i.map(i=>{let s=np[i.type].BYTES_PER_ELEMENT,a=n=ng(n,Math.max(r,s)),l=i.components||1;return o=Math.max(o,s),n+=s*l,{name:i.name,type:i.type,components:l,offset:a}}),size:ng(n,Math.max(o,r)),alignment:r}}function ng(i,r){return Math.ceil(i/r)*r}class ny extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r){let n=this.length;return this.resize(n+1),this.emplace(n,i,r)}emplace(i,r,n){let o=2*i;return this.int16[o+0]=r,this.int16[o+1]=n,i}}ny.prototype.bytesPerElement=4,rc("StructArrayLayout2i4",ny);class n_ extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,i,r,n,o)}emplace(i,r,n,o,s){let a=4*i;return this.int16[a+0]=r,this.int16[a+1]=n,this.int16[a+2]=o,this.int16[a+3]=s,i}}n_.prototype.bytesPerElement=8,rc("StructArrayLayout4i8",n_);class nv extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,i,r,n,o,s,a,l)}emplace(i,r,n,o,s,a,l,u){let h=6*i,c=12*i;return this.int16[h+0]=r,this.int16[h+1]=n,this.uint8[c+4]=o,this.uint8[c+5]=s,this.uint8[c+6]=a,this.uint8[c+7]=l,this.float32[3*i+2]=u,i}}nv.prototype.bytesPerElement=12,rc("StructArrayLayout2i4ub1f12",nv);class nx extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r){let n=this.length;return this.resize(n+1),this.emplace(n,i,r)}emplace(i,r,n){let o=2*i;return this.float32[o+0]=r,this.float32[o+1]=n,i}}nx.prototype.bytesPerElement=8,rc("StructArrayLayout2f8",nx);class nb extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u,h,c){let p=this.length;return this.resize(p+1),this.emplace(p,i,r,n,o,s,a,l,u,h,c)}emplace(i,r,n,o,s,a,l,u,h,c,p){let f=10*i;return this.uint16[f+0]=r,this.uint16[f+1]=n,this.uint16[f+2]=o,this.uint16[f+3]=s,this.uint16[f+4]=a,this.uint16[f+5]=l,this.uint16[f+6]=u,this.uint16[f+7]=h,this.uint16[f+8]=c,this.uint16[f+9]=p,i}}nb.prototype.bytesPerElement=20,rc("StructArrayLayout10ui20",nb);class nw extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,i,r,n,o,s,a,l,u)}emplace(i,r,n,o,s,a,l,u,h){let c=8*i;return this.uint16[c+0]=r,this.uint16[c+1]=n,this.uint16[c+2]=o,this.uint16[c+3]=s,this.uint16[c+4]=a,this.uint16[c+5]=l,this.uint16[c+6]=u,this.uint16[c+7]=h,i}}nw.prototype.bytesPerElement=16,rc("StructArrayLayout8ui16",nw);class nE extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u,h,c,p,f){let d=this.length;return this.resize(d+1),this.emplace(d,i,r,n,o,s,a,l,u,h,c,p,f)}emplace(i,r,n,o,s,a,l,u,h,c,p,f,d){let m=12*i;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=o,this.int16[m+3]=s,this.uint16[m+4]=a,this.uint16[m+5]=l,this.uint16[m+6]=u,this.uint16[m+7]=h,this.int16[m+8]=c,this.int16[m+9]=p,this.int16[m+10]=f,this.int16[m+11]=d,i}}nE.prototype.bytesPerElement=24,rc("StructArrayLayout4i4ui4i24",nE);class nI extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,i,r,n)}emplace(i,r,n,o){let s=3*i;return this.float32[s+0]=r,this.float32[s+1]=n,this.float32[s+2]=o,i}}nI.prototype.bytesPerElement=12,rc("StructArrayLayout3f12",nI);class nS extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){let r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.uint32[+i+0]=r,i}}nS.prototype.bytesPerElement=4,rc("StructArrayLayout1ul4",nS);class nM extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u,h,c){let p=this.length;return this.resize(p+1),this.emplace(p,i,r,n,o,s,a,l,u,h,c)}emplace(i,r,n,o,s,a,l,u,h,c,p){let f=16*i,d=8*i;return this.int16[f+0]=r,this.int16[f+1]=n,this.float32[d+1]=o,this.float32[d+2]=s,this.float32[d+3]=a,this.float32[d+4]=l,this.int16[f+10]=u,this.uint32[d+6]=h,this.uint16[f+14]=c,this.uint16[f+15]=p,i}}nM.prototype.bytesPerElement=32,rc("StructArrayLayout2i4f1i1ul2ui32",nM);class nT extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a){let l=this.length;return this.resize(l+1),this.emplace(l,i,r,n,o,s,a)}emplace(i,r,n,o,s,a,l){let u=6*i;return this.int16[u+0]=r,this.int16[u+1]=n,this.int16[u+2]=o,this.int16[u+3]=s,this.int16[u+4]=a,this.int16[u+5]=l,i}}nT.prototype.bytesPerElement=12,rc("StructArrayLayout2i2i2i12",nT);class nC extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s){let a=this.length;return this.resize(a+1),this.emplace(a,i,r,n,o,s)}emplace(i,r,n,o,s,a){let l=4*i,u=8*i;return this.float32[l+0]=r,this.float32[l+1]=n,this.float32[l+2]=o,this.int16[u+6]=s,this.int16[u+7]=a,i}}nC.prototype.bytesPerElement=16,rc("StructArrayLayout2f1f2i16",nC);class nP extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,i,r,n,o)}emplace(i,r,n,o,s){let a=12*i,l=3*i;return this.uint8[a+0]=r,this.uint8[a+1]=n,this.float32[l+1]=o,this.float32[l+2]=s,i}}nP.prototype.bytesPerElement=12,rc("StructArrayLayout2ub2f12",nP);class nA extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,i,r,n)}emplace(i,r,n,o){let s=3*i;return this.uint16[s+0]=r,this.uint16[s+1]=n,this.uint16[s+2]=o,i}}nA.prototype.bytesPerElement=6,rc("StructArrayLayout3ui6",nA);class nL extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_){let v=this.length;return this.resize(v+1),this.emplace(v,i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_)}emplace(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v){let x=24*i,b=12*i,w=48*i;return this.int16[x+0]=r,this.int16[x+1]=n,this.uint16[x+2]=o,this.uint16[x+3]=s,this.uint32[b+2]=a,this.uint32[b+3]=l,this.uint32[b+4]=u,this.uint16[x+10]=h,this.uint16[x+11]=c,this.uint16[x+12]=p,this.float32[b+7]=f,this.float32[b+8]=d,this.uint8[w+36]=m,this.uint8[w+37]=g,this.uint8[w+38]=y,this.uint32[b+10]=_,this.int16[x+22]=v,i}}nL.prototype.bytesPerElement=48,rc("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",nL);class nk extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S,M,T,C){let P=this.length;return this.resize(P+1),this.emplace(P,i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S,M,T,C)}emplace(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S,M,T,C,P){let A=32*i,L=16*i;return this.int16[A+0]=r,this.int16[A+1]=n,this.int16[A+2]=o,this.int16[A+3]=s,this.int16[A+4]=a,this.int16[A+5]=l,this.int16[A+6]=u,this.int16[A+7]=h,this.uint16[A+8]=c,this.uint16[A+9]=p,this.uint16[A+10]=f,this.uint16[A+11]=d,this.uint16[A+12]=m,this.uint16[A+13]=g,this.uint16[A+14]=y,this.uint16[A+15]=_,this.uint16[A+16]=v,this.uint16[A+17]=x,this.uint16[A+18]=b,this.uint16[A+19]=w,this.uint16[A+20]=E,this.uint16[A+21]=I,this.uint16[A+22]=S,this.uint32[L+12]=M,this.float32[L+13]=T,this.float32[L+14]=C,this.float32[L+15]=P,i}}nk.prototype.bytesPerElement=64,rc("StructArrayLayout8i15ui1ul3f64",nk);class nR extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){let r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.float32[+i+0]=r,i}}nR.prototype.bytesPerElement=4,rc("StructArrayLayout1f4",nR);class nD extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,i,r,n)}emplace(i,r,n,o){let s=3*i;return this.int16[s+0]=r,this.int16[s+1]=n,this.int16[s+2]=o,i}}nD.prototype.bytesPerElement=6,rc("StructArrayLayout3i6",nD);class nN extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,i,r,n,o)}emplace(i,r,n,o,s){let a=6*i;return this.uint32[3*i+0]=r,this.uint16[a+2]=n,this.uint16[a+3]=o,this.uint16[a+4]=s,i}}nN.prototype.bytesPerElement=12,rc("StructArrayLayout1ul3ui12",nN);class nO extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r){let n=this.length;return this.resize(n+1),this.emplace(n,i,r)}emplace(i,r,n){let o=2*i;return this.uint16[o+0]=r,this.uint16[o+1]=n,i}}nO.prototype.bytesPerElement=4,rc("StructArrayLayout2ui4",nO);class nz extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){let r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.uint16[+i+0]=r,i}}nz.prototype.bytesPerElement=2,rc("StructArrayLayout1ui2",nz);class nF extends nd{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,i,r,n,o)}emplace(i,r,n,o,s){let a=4*i;return this.float32[a+0]=r,this.float32[a+1]=n,this.float32[a+2]=o,this.float32[a+3]=s,i}}nF.prototype.bytesPerElement=16,rc("StructArrayLayout4f16",nF);class nB extends nf{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new u(this.anchorPointX,this.anchorPointY)}}nB.prototype.size=32;class nU extends nM{get(i){return new nB(this,i)}}rc("CollisionBoxArray",nU);class nG extends nf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}nG.prototype.size=48;class nV extends nL{get(i){return new nG(this,i)}}rc("PlacedSymbolArray",nV);class nq extends nf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textOffset0(){return this._structArray.float32[this._pos4+13]}get textOffset1(){return this._structArray.float32[this._pos4+14]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+15]}}nq.prototype.size=64;class nj extends nk{get(i){return new nq(this,i)}}rc("SymbolInstanceArray",nj);class nZ extends nR{getoffsetX(i){return this.float32[+i+0]}}rc("GlyphOffsetArray",nZ);class nX extends nD{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}rc("SymbolLineVertexArray",nX);class n$ extends nf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}n$.prototype.size=12;class nW extends nN{get(i){return new n$(this,i)}}rc("FeatureIndexArray",nW);class nH extends nf{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}nH.prototype.size=4;class nY extends nO{get(i){return new nH(this,i)}}rc("FillExtrusionCentroidArray",nY);let nK=nm([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),nJ=nm([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var nQ=t4(function(i){i.exports=function(i,r){var n,o,s,a,l,u;for(o=i.length-(n=3&i.length),s=r,u=0;u<o;)l=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24,++u,s=27492+(65535&(a=5*(65535&(s=(s^=l=(65535&(l=(l=(65535&l)*0xcc9e2d51+(((l>>>16)*0xcc9e2d51&65535)<<16)&0xffffffff)<<15|l>>>17))*0x1b873593+(((l>>>16)*0x1b873593&65535)<<16)&0xffffffff)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&0xffffffff))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&i.charCodeAt(u+2))<<16;case 2:l^=(255&i.charCodeAt(u+1))<<8;case 1:s^=l=(65535&(l=(l=(65535&(l^=255&i.charCodeAt(u)))*0xcc9e2d51+(((l>>>16)*0xcc9e2d51&65535)<<16)&0xffffffff)<<15|l>>>17))*0x1b873593+(((l>>>16)*0x1b873593&65535)<<16)&0xffffffff}return s^=i.length,s=0x85ebca6b*(65535&(s^=s>>>16))+((0x85ebca6b*(s>>>16)&65535)<<16)&0xffffffff,s=0xc2b2ae35*(65535&(s^=s>>>13))+((0xc2b2ae35*(s>>>16)&65535)<<16)&0xffffffff,(s^=s>>>16)>>>0}}),n0=t4(function(i){i.exports=function(i,r){for(var n,o=i.length,s=r^o,a=0;o>=4;)n=0x5bd1e995*(65535&(n=255&i.charCodeAt(a)|(255&i.charCodeAt(++a))<<8|(255&i.charCodeAt(++a))<<16|(255&i.charCodeAt(++a))<<24))+((0x5bd1e995*(n>>>16)&65535)<<16),s=0x5bd1e995*(65535&s)+((0x5bd1e995*(s>>>16)&65535)<<16)^(n=0x5bd1e995*(65535&(n^=n>>>24))+((0x5bd1e995*(n>>>16)&65535)<<16)),o-=4,++a;switch(o){case 3:s^=(255&i.charCodeAt(a+2))<<16;case 2:s^=(255&i.charCodeAt(a+1))<<8;case 1:s=0x5bd1e995*(65535&(s^=255&i.charCodeAt(a)))+((0x5bd1e995*(s>>>16)&65535)<<16)}return s=0x5bd1e995*(65535&(s^=s>>>13))+((0x5bd1e995*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}});nQ.murmur3=nQ,nQ.murmur2=n0;class n1{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,r,n,o){this.ids.push(n2(i)),this.positions.push(r,n,o)}getPositions(i){let r=n2(i),n=0,o=this.ids.length-1;for(;n<o;){let i=n+o>>1;this.ids[i]>=r?o=i:n=i+1}let s=[];for(;this.ids[n]===r;)s.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return s}static serialize(i,r){let n=new Float64Array(i.ids),o=new Uint32Array(i.positions);return function i(r,n,o,s){for(;o<s;){let a=r[o+s>>1],l=o-1,u=s+1;for(;;){do l++;while(r[l]<a)do u--;while(r[u]>a)if(l>=u)break;n3(r,l,u),n3(n,3*l,3*u),n3(n,3*l+1,3*u+1),n3(n,3*l+2,3*u+2)}u-o<s-u?(i(r,n,o,u),o=u+1):(i(r,n,u+1,s),s=u)}}(n,o,0,n.length-1),r&&r.push(n.buffer,o.buffer),{ids:n,positions:o}}static deserialize(i){let r=new n1;return r.ids=i.ids,r.positions=i.positions,r.indexed=!0,r}}function n2(i){let r=+i;return!isNaN(r)&&r<=0x1fffffffffffff?r:nQ(String(i))}function n3(i,r,n){let o=i[r];i[r]=i[n],i[n]=o}rc("FeaturePositionMap",n1);class n5{constructor(i,r){this.gl=i.gl,this.location=r}}class n4 extends n5{constructor(i,r){super(i,r),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class n6 extends n5{constructor(i,r){super(i,r),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class n8 extends n5{constructor(i,r){super(i,r),this.current=t8.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}let n9=new Float32Array(16),n7=new Float32Array(9);function ot(i){return[nc(255*i.r,255*i.g),nc(255*i.b,255*i.a)]}class oe{constructor(i,r,n){this.value=i,this.uniformNames=r.map(i=>`u_${i}`),this.type=n}setUniform(i,r,n){i.set(n.constantOr(this.value))}getBinding(i,r,n){return"color"===this.type?new n8(i,r):new n4(i,r)}}class oi{constructor(i,r){this.uniformNames=r.map(i=>`u_${i}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,r,n,o){let s="u_pattern_to"===o||"u_dash_to"===o?this.patternTo:"u_pattern_from"===o||"u_dash_from"===o?this.patternFrom:"u_pixel_ratio_to"===o?this.pixelRatioTo:"u_pixel_ratio_from"===o?this.pixelRatioFrom:null;s&&i.set(s)}getBinding(i,r,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new n6(i,r):new n4(i,r)}}class or{constructor(i,r,n,o){this.expression=i,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(i=>({name:`a_${i}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(i,r,n,o,s){let a=this.paintVertexArray.length,l=this.expression.evaluate(new r6(0),r,{},o,[],s);this.paintVertexArray.resize(i),this._setPaintValue(a,i,l)}updatePaintArray(i,r,n,o){let s=this.expression.evaluate({zoom:0},n,o);this._setPaintValue(i,r,s)}_setPaintValue(i,r,n){if("color"===this.type){let o=ot(n);for(let n=i;n<r;n++)this.paintVertexArray.emplace(n,o[0],o[1])}else{for(let o=i;o<r;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class on{constructor(i,r,n,o,s,a){this.expression=i,this.uniformNames=r.map(i=>`u_${i}_t`),this.type=n,this.useIntegerZoom=o,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=r.map(i=>({name:`a_${i}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(i,r,n,o,s){let a=this.expression.evaluate(new r6(this.zoom),r,{},o,[],s),l=this.expression.evaluate(new r6(this.zoom+1),r,{},o,[],s),u=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(u,i,a,l)}updatePaintArray(i,r,n,o){let s=this.expression.evaluate({zoom:this.zoom},n,o),a=this.expression.evaluate({zoom:this.zoom+1},n,o);this._setPaintValue(i,r,s,a)}_setPaintValue(i,r,n,o){if("color"===this.type){let s=ot(n),a=ot(o);for(let n=i;n<r;n++)this.paintVertexArray.emplace(n,s[0],s[1],a[0],a[1])}else{for(let s=i;s<r;s++)this.paintVertexArray.emplace(s,n,o);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(o))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,r){let n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=_(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);i.set(o)}getBinding(i,r,n){return new n4(i,r)}}class oo{constructor(i,r,n,o,s,a,l){this.expression=i,this.type=n,this.useIntegerZoom=o,this.zoom=s,this.layerId=l,this.paintVertexAttributes=("array"===n?nJ:nK).members;for(let i=0;i<r.length;++i);this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}populatePaintArray(i,r,n){let o=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(o,i,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(i,r,n,o,s){this._setPaintValues(i,r,n.patterns&&n.patterns[this.layerId],s)}_setPaintValues(i,r,n,o){if(!o||!n)return;let{min:s,mid:a,max:l}=n,u=o[s],h=o[a],c=o[l];if(u&&h&&c)for(let n=i;n<r;n++)this._setPaintValue(this.zoomInPaintVertexArray,n,h,u),this._setPaintValue(this.zoomOutPaintVertexArray,n,h,c)}_setPaintValue(i,r,n,o){i.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],n.pixelRatio,o.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class os{constructor(i,r,n=()=>!0){this.binders={},this._buffers=[];let o=[];for(let a in i.paint._values){var s;if(!n(a))continue;let l=i.paint.get(a);if(!(l instanceof nr&&iy(l.property.specification)))continue;let u=(s=i.type,ol[a]||[a.replace(`${s}-`,"").replace(/-/g,"_")]),h=l.value,c=l.property.specification.type,p=l.property.useIntegerZoom,f=l.property.specification["property-type"],d="cross-faded"===f||"cross-faded-data-driven"===f,m="line-dasharray"===String(a)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==h.kind||m){if("source"===h.kind||m||d){let n=oc(a,c,"source");this.binders[a]=d?new oo(h,u,c,p,r,n,i.id):new or(h,u,c,n),o.push(`/a_${a}`)}else{let i=oc(a,c,"composite");this.binders[a]=new on(h,u,c,p,r,i),o.push(`/z_${a}`)}}else this.binders[a]=d?new oi(h.value,u):new oe(h.value,u,c),o.push(`/u_${a}`)}this.cacheKey=o.sort().join("")}getMaxValue(i){let r=this.binders[i];return r instanceof or||r instanceof on?r.maxValue:0}populatePaintArrays(i,r,n,o,s){for(let a in this.binders){let l=this.binders[a];(l instanceof or||l instanceof on||l instanceof oo)&&l.populatePaintArray(i,r,n,o,s)}}setConstantPatternPositions(i,r){for(let n in this.binders){let o=this.binders[n];o instanceof oi&&o.setConstantPatternPositions(i,r)}}updatePaintArrays(i,r,n,o,s){let a=!1;for(let l in i)for(let u of r.getPositions(l)){let r=n.feature(u.index);for(let n in this.binders){let h=this.binders[n];if((h instanceof or||h instanceof on||h instanceof oo)&&!0===h.expression.isStateDependent){let c=o.paint.get(n);h.expression=c.value,h.updatePaintArray(u.start,u.end,r,i[l],s),a=!0}}}return a}defines(){let i=[];for(let r in this.binders){let n=this.binders[r];(n instanceof oe||n instanceof oi)&&i.push(...n.uniformNames.map(i=>`#define HAS_UNIFORM_${i}`))}return i}getBinderAttributes(){let i=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof or||n instanceof on||n instanceof oo)for(let r=0;r<n.paintVertexAttributes.length;r++)i.push(n.paintVertexAttributes[r].name)}return i}getBinderUniforms(){let i=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof oe||n instanceof oi||n instanceof on)for(let r of n.uniformNames)i.push(r)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,r){let n=[];for(let o in this.binders){let s=this.binders[o];if(s instanceof oe||s instanceof oi||s instanceof on){for(let a of s.uniformNames)if(r[a]){let l=s.getBinding(i,r[a],a);n.push({name:a,property:o,binding:l})}}}return n}setUniforms(i,r,n,o){for(let{name:i,property:s,binding:a}of r)this.binders[s].setUniform(a,o,n.get(s),i)}updatePaintBuffers(i){for(let r in this._buffers=[],this.binders){let n=this.binders[r];if(i&&n instanceof oo){let r=2===i.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof or||n instanceof on)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(i){for(let r in this.binders){let n=this.binders[r];(n instanceof or||n instanceof on||n instanceof oo)&&n.upload(i)}this.updatePaintBuffers()}destroy(){for(let i in this.binders){let r=this.binders[i];(r instanceof or||r instanceof on||r instanceof oo)&&r.destroy()}}}class oa{constructor(i,r,n=()=>!0){for(let o of(this.programConfigurations={},i))this.programConfigurations[o.id]=new os(o,r,n);this.needsUpload=!1,this._featureMap=new n1,this._bufferOffset=0}populatePaintArrays(i,r,n,o,s,a){for(let n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(i,r,o,s,a);void 0!==r.id&&this._featureMap.add(r.id,n,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,r,n,o){for(let s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(i,this._featureMap,r,s,o)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(i);this.needsUpload=!1}}destroy(){for(let i in this.programConfigurations)this.programConfigurations[i].destroy()}}let ol={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]},ou={"line-pattern":{source:nb,composite:nb},"fill-pattern":{source:nb,composite:nb},"fill-extrusion-pattern":{source:nb,composite:nb},"line-dasharray":{source:nw,composite:nw}},oh={color:{source:nx,composite:nF},number:{source:nR,composite:nx}};function oc(i,r,n){let o=ou[i];return o&&o[n]||oh[r][n]}rc("ConstantBinder",oe),rc("CrossFadedConstantBinder",oi),rc("SourceExpressionBinder",or),rc("CrossFadedCompositeBinder",oo),rc("CompositeExpressionBinder",on),rc("ProgramConfiguration",os,{omit:["_buffers"]}),rc("ProgramConfigurationSet",oa);let op="-transition";class of extends tD{constructor(i,r){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),r.layout&&(this._unevaluatedLayout=new ni(r.layout)),r.paint)){for(let n in this._transitionablePaint=new r7(r.paint),i.paint)this.setPaintProperty(n,i.paint[n],{validate:!1});for(let r in i.layout)this.setLayoutProperty(r,i.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nn(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,r,n={}){null!=r&&this._validate(ro,`layers.${this.id}.layout.${i}`,i,r,n)||("visibility"!==i?this._unevaluatedLayout.setValue(i,r):this.visibility=r)}getPaintProperty(i){return P(i,op)?this._transitionablePaint.getTransition(i.slice(0,-op.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,r,n={}){if(null!=r&&this._validate(rn,`layers.${this.id}.paint.${i}`,i,r,n))return!1;if(P(i,op))return this._transitionablePaint.setTransition(i.slice(0,-op.length),r||void 0),!1;{let n=this._transitionablePaint._values[i],o="cross-faded-data-driven"===n.property.specification["property-type"],s=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(i,r),this._handleSpecialPaintPropertyUpdate(i);let l=this._transitionablePaint._values[i].value;return l.isDataDriven()||s||o||this._handleOverridablePaintPropertyUpdate(i,a,l)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,r,n){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,r){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,r)}serialize(){let i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),L(i,(i,r)=>!(void 0===i||"layout"===r&&!Object.keys(i).length||"paint"===r&&!Object.keys(i).length))}_validate(i,r,n,o,s={}){return(!s||!1!==s.validate)&&rs(this,i.call(i7,{key:r,layerType:this.type,objectKey:n,value:o,styleSpec:tN,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let i in this.paint._values){let r=this.paint.get(i);if(r instanceof nr&&iy(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}}let{members:od}=nm([{name:"a_pos",components:2,type:"Int16"}],4);class om{constructor(i=[]){this.segments=i}prepareSegment(i,r,n,o){let s=this.segments[this.segments.length-1];return i>om.MAX_VERTEX_ARRAY_LENGTH&&D(`Max vertices per segment is ${om.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!s||s.vertexLength+i>om.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==o)&&(s={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==o&&(s.sortKey=o),this.segments.push(s)),s}get(){return this.segments}destroy(){for(let i of this.segments)for(let r in i.vaos)i.vaos[r].destroy()}static simpleSegment(i,r,n,o){return new om([{vertexOffset:i,primitiveOffset:r,vertexLength:n,primitiveLength:o,vaos:{},sortKey:0}])}}om.MAX_VERTEX_ARRAY_LENGTH=65535,rc("SegmentVector",om);let og=-16383-1;function oy(i){let r=8192/i.extent,n=i.loadGeometry();for(let i=0;i<n.length;i++){let o=n[i];for(let i=0;i<o.length;i++){let n=o[i],s=Math.round(n.x*r),a=Math.round(n.y*r);n.x=_(s,og,16383),n.y=_(a,og,16383),(s<n.x||s>n.x+1||a<n.y||a>n.y+1)&&D("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function o_(i,r){return{type:i.type,id:i.id,properties:i.properties,geometry:r?oy(i):[]}}function ov(i,r,n,o,s){i.emplaceBack(2*r+(o+1)/2,2*n+(s+1)/2)}class ox{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(i=>i.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ny,this.indexArray=new nA,this.segments=new om,this.programConfigurations=new oa(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(i,r,n){let o=this.layers[0],s=[],a=null;for(let{feature:r,id:l,index:u,sourceLayerIndex:h}of("circle"===o.type&&(a=o.layout.get("circle-sort-key")),i)){let i=this.layers[0]._featureFilter.needGeometry,o=o_(r,i);if(!this.layers[0]._featureFilter.filter(new r6(this.zoom),o,n))continue;let c=a?a.evaluate(o,{},n):void 0,p={id:l,properties:r.properties,type:r.type,sourceLayerIndex:h,index:u,geometry:i?o.geometry:oy(r),patterns:{},sortKey:c};s.push(p)}for(let o of(a&&s.sort((i,r)=>i.sortKey-r.sortKey),s)){let{geometry:s,index:a,sourceLayerIndex:l}=o,u=i[a].feature;this.addFeature(o,s,a,n),r.featureIndex.insert(u,s,a,l,this.index)}}update(i,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,od),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,r,n,o){for(let n of r)for(let r of n){let n=r.x,o=r.y;if(n<0||n>=8192||o<0||o>=8192)continue;let s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),a=s.vertexLength;ov(this.layoutVertexArray,n,o,-1,-1),ov(this.layoutVertexArray,n,o,1,-1),ov(this.layoutVertexArray,n,o,1,1),ov(this.layoutVertexArray,n,o,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,n,{},o)}}function ob(i,r){for(let n=0;n<i.length;n++)if(oT(r,i[n]))return!0;for(let n=0;n<r.length;n++)if(oT(i,r[n]))return!0;return!!oE(i,r)}function ow(i,r){if(1===i.length)return oM(r,i[0]);for(let n=0;n<r.length;n++){let o=r[n];for(let r=0;r<o.length;r++)if(oT(i,o[r]))return!0}for(let n=0;n<i.length;n++)if(oM(r,i[n]))return!0;for(let n=0;n<r.length;n++)if(oE(i,r[n]))return!0;return!1}function oE(i,r){if(0===i.length||0===r.length)return!1;for(let s=0;s<i.length-1;s++){let a=i[s],l=i[s+1];for(let i=0;i<r.length-1;i++){var n,o;if(N(a,n=r[i],o=r[i+1])!==N(l,n,o)&&N(a,l,n)!==N(a,l,o))return!0}}return!1}function oI(i,r,n){let o=n*n;if(1===r.length)return i.distSqr(r[0])<o;for(let n=1;n<r.length;n++)if(oS(i,r[n-1],r[n])<o)return!0;return!1}function oS(i,r,n){let o=r.distSqr(n);if(0===o)return i.distSqr(r);let s=((i.x-r.x)*(n.x-r.x)+(i.y-r.y)*(n.y-r.y))/o;return i.distSqr(s<0?r:s>1?n:n.sub(r)._mult(s)._add(r))}function oM(i,r){let n,o,s,a=!1;for(let l=0;l<i.length;l++){n=i[l];for(let i=0,l=n.length-1;i<n.length;l=i++)o=n[i],s=n[l],o.y>r.y!=s.y>r.y&&r.x<(s.x-o.x)*(r.y-o.y)/(s.y-o.y)+o.x&&(a=!a)}return a}function oT(i,r){let n=!1;for(let o=0,s=i.length-1;o<i.length;s=o++){let a=i[o],l=i[s];a.y>r.y!=l.y>r.y&&r.x<(l.x-a.x)*(r.y-a.y)/(l.y-a.y)+a.x&&(n=!n)}return n}function oC(i,r,n,o,s){for(let a of i)if(r<=a.x&&n<=a.y&&o>=a.x&&s>=a.y)return!0;let a=[new u(r,n),new u(r,s),new u(o,s),new u(o,n)];if(i.length>2){for(let r of a)if(oT(i,r))return!0}for(let r=0;r<i.length-1;r++)if(function(i,r,n){let o=n[0],s=n[2];if(i.x<o.x&&r.x<o.x||i.x>s.x&&r.x>s.x||i.y<o.y&&r.y<o.y||i.y>s.y&&r.y>s.y)return!1;let a=N(i,r,n[0]);return a!==N(i,r,n[1])||a!==N(i,r,n[2])||a!==N(i,r,n[3])}(i[r],i[r+1],a))return!0;return!1}function oP(i,r,n){let o=r.paint.get(i).value;return"constant"===o.kind?o.value:n.programConfigurations.get(r.id).getMaxValue(i)}function oA(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function oL(i,r,n,o,s){if(!r[0]&&!r[1])return i;let a=u.convert(r)._mult(s);"viewport"===n&&a._rotate(-o);let l=[];for(let r=0;r<i.length;r++)l.push(i[r].sub(a));return l}function ok(i,r,n,o){let s=u.convert(i)._mult(o);return"viewport"===r&&s._rotate(-n),s}rc("CircleBucket",ox,{omit:["layers"]});let oR=new nh({"circle-sort-key":new ns(tN.layout_circle["circle-sort-key"])});var oD={paint:new nh({"circle-radius":new ns(tN.paint_circle["circle-radius"]),"circle-color":new ns(tN.paint_circle["circle-color"]),"circle-blur":new ns(tN.paint_circle["circle-blur"]),"circle-opacity":new ns(tN.paint_circle["circle-opacity"]),"circle-translate":new no(tN.paint_circle["circle-translate"]),"circle-translate-anchor":new no(tN.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new no(tN.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new no(tN.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ns(tN.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ns(tN.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ns(tN.paint_circle["circle-stroke-opacity"])}),layout:oR},oN="undefined"!=typeof Float32Array?Float32Array:Array;function oO(){var i=new oN(9);return oN!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function oz(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oF(i,r,n){var o=r[0],s=r[1],a=r[2],l=r[3],u=r[4],h=r[5],c=r[6],p=r[7],f=r[8],d=r[9],m=r[10],g=r[11],y=r[12],_=r[13],v=r[14],x=r[15],b=n[0],w=n[1],E=n[2],I=n[3];return i[0]=b*o+w*u+E*f+I*y,i[1]=b*s+w*h+E*d+I*_,i[2]=b*a+w*c+E*m+I*v,i[3]=b*l+w*p+E*g+I*x,i[4]=(b=n[4])*o+(w=n[5])*u+(E=n[6])*f+(I=n[7])*y,i[5]=b*s+w*h+E*d+I*_,i[6]=b*a+w*c+E*m+I*v,i[7]=b*l+w*p+E*g+I*x,i[8]=(b=n[8])*o+(w=n[9])*u+(E=n[10])*f+(I=n[11])*y,i[9]=b*s+w*h+E*d+I*_,i[10]=b*a+w*c+E*m+I*v,i[11]=b*l+w*p+E*g+I*x,i[12]=(b=n[12])*o+(w=n[13])*u+(E=n[14])*f+(I=n[15])*y,i[13]=b*s+w*h+E*d+I*_,i[14]=b*a+w*c+E*m+I*v,i[15]=b*l+w*p+E*g+I*x,i}function oB(){var i=new oN(3);return oN!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function oU(i){return Math.hypot(i[0],i[1],i[2])}function oG(i,r,n){var o=new oN(3);return o[0]=i,o[1]=r,o[2]=n,o}function oV(i,r,n){return i[0]=r[0]-n[0],i[1]=r[1]-n[1],i[2]=r[2]-n[2],i}function oq(i,r,n){return i[0]=r[0]*n[0],i[1]=r[1]*n[1],i[2]=r[2]*n[2],i}function oj(i,r,n,o){return i[0]=r[0]+n[0]*o,i[1]=r[1]+n[1]*o,i[2]=r[2]+n[2]*o,i}function oZ(i,r){var n=r[0],o=r[1],s=r[2],a=n*n+o*o+s*s;return a>0&&(a=1/Math.sqrt(a)),i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i}function oX(i,r,n){var o=n[0],s=n[1],a=n[2],l=r[0],u=r[1],h=r[2],c=s*h-a*u,p=a*l-o*h,f=o*u-s*l,d=s*f-a*p,m=a*c-o*f,g=o*p-s*c,y=2*n[3];return p*=y,f*=y,m*=2,g*=2,i[0]=l+(c*=y)+(d*=2),i[1]=u+p+m,i[2]=h+f+g,i}function o$(i,r,n){var o=r[0],s=r[1],a=r[2],l=r[3];return i[0]=n[0]*o+n[4]*s+n[8]*a+n[12]*l,i[1]=n[1]*o+n[5]*s+n[9]*a+n[13]*l,i[2]=n[2]*o+n[6]*s+n[10]*a+n[14]*l,i[3]=n[3]*o+n[7]*s+n[11]*a+n[15]*l,i}function oW(){var i=new oN(4);return oN!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function oH(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function oY(i,r,n){n*=.5;var o=r[0],s=r[1],a=r[2],l=r[3],u=Math.sin(n),h=Math.cos(n);return i[0]=o*h+l*u,i[1]=s*h+a*u,i[2]=a*h-s*u,i[3]=l*h-o*u,i}Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)}),oB(),s=new oN(4),oN!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),oB(),oG(1,0,0),oG(0,1,0),oW(),oW(),oO();let oK=oG(0,0,0),oJ=oG(0,0,1);class oQ extends ox{}function o0(i,{width:r,height:n},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==r*n*o)throw RangeError("mismatched image size")}else s=new Uint8Array(r*n*o);return i.width=r,i.height=n,i.data=s,i}function o1(i,{width:r,height:n},o){if(r===i.width&&n===i.height)return;let s=o0({},{width:r,height:n},o);o2(i,s,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,r),height:Math.min(i.height,n)},o),i.width=r,i.height=n,i.data=s.data}function o2(i,r,n,o,s,a){if(0===s.width||0===s.height)return r;if(s.width>i.width||s.height>i.height||n.x>i.width-s.width||n.y>i.height-s.height)throw RangeError("out of range source coordinates for image copy");if(s.width>r.width||s.height>r.height||o.x>r.width-s.width||o.y>r.height-s.height)throw RangeError("out of range destination coordinates for image copy");let l=i.data,u=r.data;for(let h=0;h<s.height;h++){let c=((n.y+h)*i.width+n.x)*a,p=((o.y+h)*r.width+o.x)*a;for(let i=0;i<s.width*a;i++)u[p+i]=l[c+i]}return r}rc("HeatmapBucket",oQ,{omit:["layers"]});class o3{constructor(i,r){o0(this,i,1,r)}resize(i){o1(this,i,1)}clone(){return new o3({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,r,n,o,s){o2(i,r,n,o,s,1)}}class o5{constructor(i,r){o0(this,i,4,r)}resize(i){o1(this,i,4)}replace(i,r){r?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new o5({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,r,n,o,s){o2(i,r,n,o,s,4)}}rc("AlphaImage",o3),rc("RGBAImage",o5);var o4={paint:new nh({"heatmap-radius":new ns(tN.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ns(tN.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new no(tN.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nu(tN.paint_heatmap["heatmap-color"]),"heatmap-opacity":new no(tN.paint_heatmap["heatmap-opacity"])})};function o6(i){let r={},n=i.resolution||256,o=i.clips?i.clips.length:1,s=i.image||new o5({width:n,height:o}),a=(n,o,a)=>{r[i.evaluationKey]=a;let l=i.expression.evaluate(r);s.data[n+o+0]=Math.floor(255*l.r/l.a),s.data[n+o+1]=Math.floor(255*l.g/l.a),s.data[n+o+2]=Math.floor(255*l.b/l.a),s.data[n+o+3]=Math.floor(255*l.a)};if(i.clips)for(let r=0,s=0;r<o;++r,s+=4*n)for(let o=0,l=0;o<n;o++,l+=4){let u=o/(n-1),{start:h,end:c}=i.clips[r];a(s,l,h*(1-u)+c*u)}else for(let i=0,r=0;i<n;i++,r+=4)a(0,r,i/(n-1));return s}var o8={paint:new nh({"hillshade-illumination-direction":new no(tN.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new no(tN.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new no(tN.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new no(tN.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new no(tN.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new no(tN.paint_hillshade["hillshade-accent-color"])})};let{members:o9}=nm([{name:"a_pos",components:2,type:"Int16"}],4);var o7=st;function st(i,r,n){n=n||2;var o,s,a,l,u,h,c,p=r&&r.length,f=p?r[0]*n:i.length,d=se(i,0,f,n,!0),m=[];if(!d||d.next===d.prev)return m;if(p&&(d=function(i,r,n,o){var s,a,l,u=[];for(s=0,a=r.length;s<a;s++)(l=se(i,r[s]*o,s<a-1?r[s+1]*o:i.length,o,!1))===l.next&&(l.steiner=!0),u.push(function(i){var r=i,n=i;do(r.x<n.x||r.x===n.x&&r.y<n.y)&&(n=r),r=r.next;while(r!==i)return n}(l));for(u.sort(sr),s=0;s<u.length;s++)(function(i,r){if(r=function(i,r){var n,o,s,a=r,l=i.x,u=i.y,h=-1/0;do{if(u<=a.y&&u>=a.next.y&&a.next.y!==a.y){var c=a.x+(u-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(c<=l&&c>h){if(h=c,c===l){if(u===a.y)return a;if(u===a.next.y)return a.next}s=a.x<a.next.x?a:a.next}}a=a.next}while(a!==r)if(!s)return null;if(l===h)return s;var p,f=s,d=s.x,m=s.y,g=1/0;a=s;do l>=a.x&&a.x>=d&&l!==a.x&&so(u<m?l:h,u,d,m,u<m?h:l,u,a.x,a.y)&&(p=Math.abs(u-a.y)/(l-a.x),sc(a,i)&&(p<g||p===g&&(a.x>s.x||a.x===s.x&&(n=s,o=a,0>ss(n.prev,n,o.prev)&&0>ss(o.next,n,n.next))))&&(s=a,g=p)),a=a.next;while(a!==f)return s}(i,r)){var n=sp(r,i);si(r,r.next),si(n,n.next)}})(u[s],n),n=si(n,n.next);return n}(i,r,d,n)),i.length>80*n){o=a=i[0],s=l=i[1];for(var g=n;g<f;g+=n)(u=i[g])<o&&(o=u),(h=i[g+1])<s&&(s=h),u>a&&(a=u),h>l&&(l=h);c=0!==(c=Math.max(a-o,l-s))?1/c:0}return function i(r,n,o,s,a,l,u){if(r){!u&&l&&function(i,r,n,o){var s=i;do null===s.z&&(s.z=sn(s.x,s.y,r,n,o)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i)s.prevZ.nextZ=null,s.prevZ=null,function(i){var r,n,o,s,a,l,u,h,c=1;do{for(n=i,i=null,a=null,l=0;n;){for(l++,o=n,u=0,r=0;r<c&&(u++,o=o.nextZ);r++);for(h=c;u>0||h>0&&o;)0!==u&&(0===h||!o||n.z<=o.z)?(s=n,n=n.nextZ,u--):(s=o,o=o.nextZ,h--),a?a.nextZ=s:i=s,s.prevZ=a,a=s;n=o}a.nextZ=null,c*=2}while(l>1)}(s)}(r,s,a,l);for(var h,c,p=r;r.prev!==r.next;)if(h=r.prev,c=r.next,l?function(i,r,n,o){var s=i.prev,a=i.next;if(ss(s,i,a)>=0)return!1;for(var l=s.x>i.x?s.x>a.x?s.x:a.x:i.x>a.x?i.x:a.x,u=s.y>i.y?s.y>a.y?s.y:a.y:i.y>a.y?i.y:a.y,h=sn(s.x<i.x?s.x<a.x?s.x:a.x:i.x<a.x?i.x:a.x,s.y<i.y?s.y<a.y?s.y:a.y:i.y<a.y?i.y:a.y,r,n,o),c=sn(l,u,r,n,o),p=i.prevZ,f=i.nextZ;p&&p.z>=h&&f&&f.z<=c;){if(p!==i.prev&&p!==i.next&&so(s.x,s.y,i.x,i.y,a.x,a.y,p.x,p.y)&&ss(p.prev,p,p.next)>=0||(p=p.prevZ,f!==i.prev&&f!==i.next&&so(s.x,s.y,i.x,i.y,a.x,a.y,f.x,f.y)&&ss(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==i.prev&&p!==i.next&&so(s.x,s.y,i.x,i.y,a.x,a.y,p.x,p.y)&&ss(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=c;){if(f!==i.prev&&f!==i.next&&so(s.x,s.y,i.x,i.y,a.x,a.y,f.x,f.y)&&ss(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}(r,s,a,l):function(i){var r=i.prev,n=i.next;if(ss(r,i,n)>=0)return!1;for(var o=i.next.next;o!==i.prev;){if(so(r.x,r.y,i.x,i.y,n.x,n.y,o.x,o.y)&&ss(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}(r))n.push(h.i/o),n.push(r.i/o),n.push(c.i/o),sd(r),r=c.next,p=c.next;else if((r=c)===p){u?1===u?i(r=function(i,r,n){var o=i;do{var s=o.prev,a=o.next.next;!sa(s,a)&&sl(s,o,o.next,a)&&sc(s,a)&&sc(a,s)&&(r.push(s.i/n),r.push(o.i/n),r.push(a.i/n),sd(o),sd(o.next),o=i=a),o=o.next}while(o!==i)return si(o)}(si(r),n,o),n,o,s,a,l,2):2===u&&function(r,n,o,s,a,l){var u=r;do{for(var h,c,p=u.next.next;p!==u.prev;){if(u.i!==p.i&&(h=u,c=p,h.next.i!==c.i&&h.prev.i!==c.i&&!function(i,r){var n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==r.i&&n.next.i!==r.i&&sl(n,n.next,i,r))return!0;n=n.next}while(n!==i)return!1}(h,c)&&(sc(h,c)&&sc(c,h)&&function(i,r){var n=i,o=!1,s=(i.x+r.x)/2,a=(i.y+r.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next;while(n!==i)return o}(h,c)&&(ss(h.prev,h,c.prev)||ss(h,c.prev,c))||sa(h,c)&&ss(h.prev,h,h.next)>0&&ss(c.prev,c,c.next)>0))){var f=sp(u,p);return u=si(u,u.next),f=si(f,f.next),i(u,n,o,s,a,l),void i(f,n,o,s,a,l)}p=p.next}u=u.next}while(u!==r)}(r,n,o,s,a,l):i(si(r),n,o,s,a,l,1);break}}}(d,m,n,o,s,c),m}function se(i,r,n,o,s){var a,l;if(s===sg(i,r,n,o)>0)for(a=r;a<n;a+=o)l=sf(a,i[a],i[a+1],l);else for(a=n-o;a>=r;a-=o)l=sf(a,i[a],i[a+1],l);return l&&sa(l,l.next)&&(sd(l),l=l.next),l}function si(i,r){if(!i)return i;r||(r=i);var n,o=i;do if(n=!1,o.steiner||!sa(o,o.next)&&0!==ss(o.prev,o,o.next))o=o.next;else{if(sd(o),(o=r=o.prev)===o.next)break;n=!0}while(n||o!==r)return r}function sr(i,r){return i.x-r.x}function sn(i,r,n,o,s){return(i=0x55555555&((i=0x33333333&((i=0xf0f0f0f&((i=0xff00ff&((i=32767*(i-n)*s)|i<<8))|i<<4))|i<<2))|i<<1))|(r=0x55555555&((r=0x33333333&((r=0xf0f0f0f&((r=0xff00ff&((r=32767*(r-o)*s)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function so(i,r,n,o,s,a,l,u){return(s-l)*(r-u)-(i-l)*(a-u)>=0&&(i-l)*(o-u)-(n-l)*(r-u)>=0&&(n-l)*(a-u)-(s-l)*(o-u)>=0}function ss(i,r,n){return(r.y-i.y)*(n.x-r.x)-(r.x-i.x)*(n.y-r.y)}function sa(i,r){return i.x===r.x&&i.y===r.y}function sl(i,r,n,o){var s=sh(ss(i,r,n)),a=sh(ss(i,r,o)),l=sh(ss(n,o,i)),u=sh(ss(n,o,r));return s!==a&&l!==u||!(0!==s||!su(i,n,r))||!(0!==a||!su(i,o,r))||!(0!==l||!su(n,i,o))||!(0!==u||!su(n,r,o))}function su(i,r,n){return r.x<=Math.max(i.x,n.x)&&r.x>=Math.min(i.x,n.x)&&r.y<=Math.max(i.y,n.y)&&r.y>=Math.min(i.y,n.y)}function sh(i){return i>0?1:i<0?-1:0}function sc(i,r){return 0>ss(i.prev,i,i.next)?ss(i,r,i.next)>=0&&ss(i,i.prev,r)>=0:0>ss(i,r,i.prev)||0>ss(i,i.next,r)}function sp(i,r){var n=new sm(i.i,i.x,i.y),o=new sm(r.i,r.x,r.y),s=i.next,a=r.prev;return i.next=r,r.prev=i,n.next=s,s.prev=n,o.next=n,n.prev=o,a.next=o,o.prev=a,o}function sf(i,r,n,o){var s=new sm(i,r,n);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function sd(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function sm(i,r,n){this.i=i,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sg(i,r,n,o){for(var s=0,a=r,l=n-o;a<n;a+=o)s+=(i[l]-i[a])*(i[a+1]+i[l+1]),l=a;return s}function sy(i,r,n){var o=i[r];i[r]=i[n],i[n]=o}function s_(i,r){return i<r?-1:+(i>r)}function sv(i,r){let n,o;let s=i.length;if(s<=1)return[i];let a=[];for(let r=0;r<s;r++){let s=function(i){let r=0;for(let n,o,s=0,a=i.length,l=a-1;s<a;l=s++)n=i[s],r+=((o=i[l]).x-n.x)*(n.y+o.y);return r}(i[r]);0!==s&&(i[r].area=Math.abs(s),void 0===o&&(o=s<0),o===s<0?(n&&a.push(n),n=[i[r]]):n.push(i[r]))}if(n&&a.push(n),r>1)for(let i=0;i<a.length;i++){var l;a[i].length<=r||(function i(r,n,o,s,a){for(;s>o;){if(s-o>600){var l=s-o+1,u=n-o+1,h=Math.log(l),c=.5*Math.exp(2*h/3),p=.5*Math.sqrt(h*c*(l-c)/l)*(u-l/2<0?-1:1);i(r,n,Math.max(o,Math.floor(n-u*c/l+p)),Math.min(s,Math.floor(n+(l-u)*c/l+p)),a)}var f=r[n],d=o,m=s;for(sy(r,o,n),a(r[s],f)>0&&sy(r,o,s);d<m;){for(sy(r,d,m),d++,m--;0>a(r[d],f);)d++;for(;a(r[m],f)>0;)m--}0===a(r[o],f)?sy(r,o,m):sy(r,++m,s),m<=n&&(o=m+1),n<=m&&(s=m-1)}}(l=a[i],r,1,a[i].length-1||l.length-1,sx||s_),a[i]=a[i].slice(0,r))}return a}function sx(i,r){return r.area-i.area}function sb(i,r,n){let o=n.patternDependencies,s=!1;for(let n of r){let r=n.paint.get(`${i}-pattern`);r.isConstant()||(s=!0);let a=r.constantOr(null);a&&(s=!0,o[a.to]=!0,o[a.from]=!0)}return s}function sw(i,r,n,o,s){let a=s.patternDependencies;for(let l of r){let r=l.paint.get(`${i}-pattern`).value;if("constant"!==r.kind){let i=r.evaluate({zoom:o-1},n,{},s.availableImages),u=r.evaluate({zoom:o},n,{},s.availableImages),h=r.evaluate({zoom:o+1},n,{},s.availableImages);i=i&&i.name?i.name:i,u=u&&u.name?u.name:u,h=h&&h.name?h.name:h,a[i]=!0,a[u]=!0,a[h]=!0,n.patterns[l.id]={min:i,mid:u,max:h}}}return n}st.deviation=function(i,r,n,o){var s=r&&r.length,a=Math.abs(sg(i,0,s?r[0]*n:i.length,n));if(s)for(var l=0,u=r.length;l<u;l++)a-=Math.abs(sg(i,r[l]*n,l<u-1?r[l+1]*n:i.length,n));var h=0;for(l=0;l<o.length;l+=3){var c=o[l]*n,p=o[l+1]*n,f=o[l+2]*n;h+=Math.abs((i[c]-i[f])*(i[p+1]-i[c+1])-(i[c]-i[p])*(i[f+1]-i[c+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},st.flatten=function(i){for(var r=i[0][0].length,n={vertices:[],holes:[],dimensions:r},o=0,s=0;s<i.length;s++){for(var a=0;a<i[s].length;a++)for(var l=0;l<r;l++)n.vertices.push(i[s][a][l]);s>0&&n.holes.push(o+=i[s-1].length)}return n},o7.default=st;class sE{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(i=>i.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ny,this.indexArray=new nA,this.indexArray2=new nO,this.programConfigurations=new oa(i.layers,i.zoom),this.segments=new om,this.segments2=new om,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(i,r,n){this.hasPattern=sb("fill",this.layers,r);let o=this.layers[0].layout.get("fill-sort-key"),s=[];for(let{feature:a,id:l,index:u,sourceLayerIndex:h}of i){let i=this.layers[0]._featureFilter.needGeometry,c=o_(a,i);if(!this.layers[0]._featureFilter.filter(new r6(this.zoom),c,n))continue;let p=o?o.evaluate(c,{},n,r.availableImages):void 0,f={id:l,properties:a.properties,type:a.type,sourceLayerIndex:h,index:u,geometry:i?c.geometry:oy(a),patterns:{},sortKey:p};s.push(f)}for(let a of(o&&s.sort((i,r)=>i.sortKey-r.sortKey),s)){let{geometry:o,index:s,sourceLayerIndex:l}=a;if(this.hasPattern){let i=sw("fill",this.layers,a,this.zoom,r);this.patternFeatures.push(i)}else this.addFeature(a,o,s,n,{});r.featureIndex.insert(i[s].feature,o,s,l,this.index)}}update(i,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,n)}addFeatures(i,r,n){for(let i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,o9),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,r,n,o,s){for(let i of sv(r,500)){let r=0;for(let n of i)r+=n.length;let n=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray),o=n.vertexLength,s=[],a=[];for(let r of i){if(0===r.length)continue;r!==i[0]&&a.push(s.length/2);let n=this.segments2.prepareSegment(r.length,this.layoutVertexArray,this.indexArray2),o=n.vertexLength;this.layoutVertexArray.emplaceBack(r[0].x,r[0].y),this.indexArray2.emplaceBack(o+r.length-1,o),s.push(r[0].x),s.push(r[0].y);for(let i=1;i<r.length;i++)this.layoutVertexArray.emplaceBack(r[i].x,r[i].y),this.indexArray2.emplaceBack(o+i-1,o+i),s.push(r[i].x),s.push(r[i].y);n.vertexLength+=r.length,n.primitiveLength+=r.length}let l=o7(s,a);for(let i=0;i<l.length;i+=3)this.indexArray.emplaceBack(o+l[i],o+l[i+1],o+l[i+2]);n.vertexLength+=r,n.primitiveLength+=l.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,n,s,o)}}rc("FillBucket",sE,{omit:["layers","patternFeatures"]});let sI=new nh({"fill-sort-key":new ns(tN.layout_fill["fill-sort-key"])});var sS={paint:new nh({"fill-antialias":new no(tN.paint_fill["fill-antialias"]),"fill-opacity":new ns(tN.paint_fill["fill-opacity"]),"fill-color":new ns(tN.paint_fill["fill-color"]),"fill-outline-color":new ns(tN.paint_fill["fill-outline-color"]),"fill-translate":new no(tN.paint_fill["fill-translate"]),"fill-translate-anchor":new no(tN.paint_fill["fill-translate-anchor"]),"fill-pattern":new na(tN.paint_fill["fill-pattern"])}),layout:sI};let sM=nm([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sT=nm([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:sC}=sM;function sP(i,r,n,o,s){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=s,i.readFields(sA,this,r)}function sA(i,r,n){1==i?r.id=n.readVarint():2==i?function(i,r){for(var n=i.readVarint()+i.pos;i.pos<n;){var o=r._keys[i.readVarint()],s=r._values[i.readVarint()];r.properties[o]=s}}(n,r):3==i?r.type=n.readVarint():4==i&&(r._geometry=n.pos)}function sL(i,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(sk,this,r),this.length=this._features.length}function sk(i,r,n){15===i?r.version=n.readVarint():1===i?r.name=n.readString():5===i?r.extent=n.readVarint():2===i?r._features.push(n.pos):3===i?r._keys.push(n.readString()):4===i&&r._values.push(function(i){for(var r=null,n=i.readVarint()+i.pos;i.pos<n;){var o=i.readVarint()>>3;r=1===o?i.readString():2===o?i.readFloat():3===o?i.readDouble():4===o?i.readVarint64():5===o?i.readVarint():6===o?i.readSVarint():7===o?i.readBoolean():null}return r}(n))}function sR(i,r,n){if(3===i){var o=new sL(n,n.readVarint()+n.pos);o.length&&(r[o.name]=o)}}sP.types=["Unknown","Point","LineString","Polygon"],sP.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,n=i.readVarint()+i.pos,o=1,s=0,a=0,l=0,h=[];i.pos<n;){if(s<=0){var c=i.readVarint();o=7&c,s=c>>3}if(s--,1===o||2===o)a+=i.readSVarint(),l+=i.readSVarint(),1===o&&(r&&h.push(r),r=[]),r.push(new u(a,l));else{if(7!==o)throw Error("unknown command "+o);r&&r.push(r[0].clone())}}return r&&h.push(r),h},sP.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var r=i.readVarint()+i.pos,n=1,o=0,s=0,a=0,l=1/0,u=-1/0,h=1/0,c=-1/0;i.pos<r;){if(o<=0){var p=i.readVarint();n=7&p,o=p>>3}if(o--,1===n||2===n)(s+=i.readSVarint())<l&&(l=s),s>u&&(u=s),(a+=i.readSVarint())<h&&(h=a),a>c&&(c=a);else if(7!==n)throw Error("unknown command "+n)}return[l,h,u,c]},sP.prototype.toGeoJSON=function(i,r,n){var o,s,a=this.extent*Math.pow(2,n),l=this.extent*i,u=this.extent*r,h=this.loadGeometry(),c=sP.types[this.type];function p(i){for(var r=0;r<i.length;r++){var n=i[r];i[r]=[360*(n.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+u)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(o=0;o<h.length;o++)f[o]=h[o][0];p(h=f);break;case 2:for(o=0;o<h.length;o++)p(h[o]);break;case 3:for(h=function(i){var r=i.length;if(r<=1)return[i];for(var n,o,s=[],a=0;a<r;a++){var l=function(i){for(var r,n,o=0,s=0,a=i.length,l=a-1;s<a;l=s++)o+=((n=i[l]).x-(r=i[s]).x)*(r.y+n.y);return o}(i[a]);0!==l&&(void 0===o&&(o=l<0),o===l<0?(n&&s.push(n),n=[i[a]]):n.push(i[a]))}return n&&s.push(n),s}(h),o=0;o<h.length;o++)for(s=0;s<h[o].length;s++)p(h[o][s])}1===h.length?h=h[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:h},properties:this.properties};return"id"in this&&(d.id=this.id),d},sL.prototype.feature=function(i){if(i<0||i>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new sP(this._pbf,r,this.extent,this._keys,this._values)};var sD={VectorTile:function(i,r){this.layers=i.readFields(sR,{},r)},VectorTileFeature:sP,VectorTileLayer:sL};let sN=sD.VectorTileFeature.types;function sO(i,r,n,o,s,a,l,u){i.emplaceBack((r<<1)+l,(n<<1)+a,(Math.floor(8192*o)<<1)+s,Math.round(u))}class sz{constructor(){this.acc=new u(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new u(i.x,i.y),this.max=new u(i.x,i.y))}append(i,r){this.currentPolyCount.edges++,this.acc._add(i);let n=!!this.borders,o=this.min,s=this.max;i.x<o.x?(o.x=i.x,n=!0):i.x>s.x&&(s.x=i.x,n=!0),i.y<o.y?(o.y=i.y,n=!0):i.y>s.y&&(s.y=i.y,n=!0),((0===i.x||8192===i.x)&&i.x===r.x)!=((0===i.y||8192===i.y)&&i.y===r.y)&&this.processBorderOverlap(i,r),n&&this.checkBorderIntersection(i,r)}checkBorderIntersection(i,r){r.x<0!=i.x<0&&this.addBorderIntersection(0,eO(r.y,i.y,(0-r.x)/(i.x-r.x))),r.x>8192!=i.x>8192&&this.addBorderIntersection(1,eO(r.y,i.y,(8192-r.x)/(i.x-r.x))),r.y<0!=i.y<0&&this.addBorderIntersection(2,eO(r.x,i.x,(0-r.y)/(i.y-r.y))),r.y>8192!=i.y>8192&&this.addBorderIntersection(3,eO(r.x,i.x,(8192-r.y)/(i.y-r.y)))}addBorderIntersection(i,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let n=this.borders[i];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(i,r){if(i.x===r.x){if(i.y===r.y)return;let n=+(0!==i.x);this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,i.y)}else{let n=0===i.y?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,i.x)}}centroid(){let i=this.polyCount.reduce((i,r)=>i+r.edges,0);return 0!==i?this.acc.div(i)._round():new u(0,0)}span(){return new u(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,r)=>i+ +(r[0]!==Number.MAX_VALUE),0)}}class sF{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(i=>i.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new n_,this.centroidVertexArray=new nY,this.indexArray=new nA,this.programConfigurations=new oa(i.layers,i.zoom),this.segments=new om,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=i.enableTerrain}populate(i,r,n){for(let{feature:o,id:s,index:a,sourceLayerIndex:l}of(this.features=[],this.hasPattern=sb("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(i){let r=Math.exp(Math.PI*(1-i.y/(1<<i.z)*2));return 0x4c6fe12*r/(r*r+1)/8192/(1<<i.z)}(n),i)){let i=this.layers[0]._featureFilter.needGeometry,u=o_(o,i);if(!this.layers[0]._featureFilter.filter(new r6(this.zoom),u,n))continue;let h={id:s,sourceLayerIndex:l,index:a,geometry:i?u.geometry:oy(o),properties:o.properties,type:o.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(sw("fill-extrusion",this.layers,h,this.zoom,r)):this.addFeature(h,h.geometry,a,n,{}),r.featureIndex.insert(o,h.geometry,a,l,this.index,c)}this.sortBorders()}addFeatures(i,r,n){for(let i of this.features){let{geometry:o}=i;this.addFeature(i,o,i.index,r,n)}this.sortBorders()}update(i,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sC),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,sT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,r,n,o,s){var a;let l=this.enableTerrain&&i.properties&&"Polygon"===sN[i.type]?new sz:null;for(let n of sv(r,500)){let r=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===n.length||(a=n[0]).every(i=>i.x<=0)||a.every(i=>i.x>=8192)||a.every(i=>i.y<=0)||a.every(i=>i.y>=8192))continue;for(let i=0;i<n.length;i++){let s=n[i];if(0===s.length)continue;r+=s.length;let a=0;l&&l.startRing(s[0]);for(let i=0;i<s.length;i++){let r=s[i];if(i>=1){let n=s[i-1];if((r.x!==n.x||!(r.x<0)&&!(r.x>8192))&&(r.y!==n.y||!(r.y<0)&&!(r.y>8192))){l&&l.append(r,n),o.vertexLength+4>om.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let i=r.sub(n)._perp(),s=i.x/(Math.abs(i.x)+Math.abs(i.y)),u=+(i.y>0),h=n.dist(r);a+h>32768&&(a=0),sO(this.layoutVertexArray,r.x,r.y,s,u,0,0,a),sO(this.layoutVertexArray,r.x,r.y,s,u,0,1,a),a+=h,sO(this.layoutVertexArray,n.x,n.y,s,u,0,0,a),sO(this.layoutVertexArray,n.x,n.y,s,u,0,1,a);let c=o.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),o.vertexLength+=4,o.primitiveLength+=2}}}}if(o.vertexLength+r>om.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray)),"Polygon"!==sN[i.type])continue;let s=[],u=[],h=o.vertexLength;for(let i=0;i<n.length;i++){let r=n[i];if(0!==r.length){r!==n[0]&&u.push(s.length/2);for(let i=0;i<r.length;i++){let n=r[i];sO(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),s.push(n.x),s.push(n.y),l&&l.currentPolyCount.top++}}}let c=o7(s,u);for(let i=0;i<c.length;i+=3)this.indexArray.emplaceBack(h+c[i],h+c[i+2],h+c[i+1]);o.primitiveLength+=c.length/3,o.vertexLength+=r}if(l&&l.polyCount.length>0){if(l.borders){l.vertexArrayOffset=this.centroidVertexArray.length;let i=l.borders,r=this.featuresOnBorder.push(l)-1;for(let n=0;n<4;n++)i[n][0]!==Number.MAX_VALUE&&this.borders[n].push(r)}this.encodeCentroid(l.borders?void 0:l.centroid(),l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,n,s,o)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((r,n)=>this.featuresOnBorder[r].borders[i][0]-this.featuresOnBorder[n].borders[i][0])}encodeCentroid(i,r,n=!0){let o,s;if(i){if(0!==i.y){let n=r.span()._mult(this.tileToMeter);o=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(n.x/10)),s=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else o=Math.ceil(7*(i.x+450)),s=0}else o=0,s=+n;let a=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(let i of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*i.edges+i.top);for(let r=0;r<2*i.edges;r++)this.centroidVertexArray.emplace(a++,0,s),this.centroidVertexArray.emplace(a++,o,s);for(let r=0;r<i.top;r++)this.centroidVertexArray.emplace(a++,o,s)}}}rc("FillExtrusionBucket",sF,{omit:["layers","features"]}),rc("PartMetadata",sz);var sB={paint:new nh({"fill-extrusion-opacity":new no(tN["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ns(tN["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new no(tN["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new no(tN["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new na(tN["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ns(tN["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ns(tN["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new no(tN["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function sU(i,r){return i.x*r.x+i.y*r.y}function sG(i,r){if(1===i.length){let n,o=0,s=r[o++];for(;!n||s.equals(n);)if(!(n=r[o++]))return 1/0;for(;o<r.length;o++){let a=r[o],l=i[0],u=n.sub(s),h=a.sub(s),c=l.sub(s),p=sU(u,u),f=sU(u,h),d=sU(h,h),m=sU(c,u),g=sU(c,h),y=p*d-f*f,_=(d*m-f*g)/y,v=(p*g-f*m)/y,x=s.z*(1-_-v)+n.z*_+a.z*v;if(isFinite(x))return x}return 1/0}{let i=1/0;for(let n of r)i=Math.min(i,n.z);return i}}function sV(i){let r=new u(i[0],i[1]);return r.z=i[2],r}let{members:sq}=nm([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sj}=nm([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),sZ=sD.VectorTileFeature.types,sX=Math.cos(Math.PI/180*37.5);class s${constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(i=>i.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nv,this.layoutVertexArray2=new nx,this.indexArray=new nA,this.programConfigurations=new oa(i.layers,i.zoom),this.segments=new om,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(i,r,n){this.hasPattern=sb("line",this.layers,r);let o=this.layers[0].layout.get("line-sort-key"),s=[];for(let{feature:r,id:a,index:l,sourceLayerIndex:u}of i){let i=this.layers[0]._featureFilter.needGeometry,h=o_(r,i);if(!this.layers[0]._featureFilter.filter(new r6(this.zoom),h,n))continue;let c=o?o.evaluate(h,{},n):void 0,p={id:a,properties:r.properties,type:r.type,sourceLayerIndex:u,index:l,geometry:i?h.geometry:oy(r),patterns:{},sortKey:c};s.push(p)}o&&s.sort((i,r)=>i.sortKey-r.sortKey);let{lineAtlas:a,featureIndex:l}=r,u=this.addConstantDashes(a);for(let o of s){let{geometry:s,index:h,sourceLayerIndex:c}=o;if(u&&this.addFeatureDashes(o,a),this.hasPattern){let i=sw("line",this.layers,o,this.zoom,r);this.patternFeatures.push(i)}else this.addFeature(o,s,h,n,a.positions);l.insert(i[h].feature,s,h,c,this.index)}}addConstantDashes(i){let r=!1;for(let n of this.layers){let o=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==s.kind)r=!0;else{let r=s.value,n=o.value;if(!n)continue;i.addDash(n.from,r),i.addDash(n.to,r),n.other&&i.addDash(n.other,r)}}return r}addFeatureDashes(i,r){let n=this.zoom;for(let o of this.layers){let s,a,l,u,h,c;let p=o.paint.get("line-dasharray").value,f=o.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===f.kind)continue;if("constant"===p.kind){let i=p.value;if(!i)continue;s=i.other||i.to,a=i.to,l=i.from}else s=p.evaluate({zoom:n-1},i),a=p.evaluate({zoom:n},i),l=p.evaluate({zoom:n+1},i);"constant"===f.kind?u=h=c=f.value:(u=f.evaluate({zoom:n-1},i),h=f.evaluate({zoom:n},i),c=f.evaluate({zoom:n+1},i)),r.addDash(s,u),r.addDash(a,h),r.addDash(l,c);let d=r.getKey(s,u),m=r.getKey(a,h),g=r.getKey(l,c);i.patterns[o.id]={min:d,mid:m,max:g}}}update(i,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,n)}addFeatures(i,r,n){for(let i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,sj)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sq),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,r,n,o,s){let a=this.layers[0].layout,l=a.get("line-join").evaluate(i,{}),u=a.get("line-cap").evaluate(i,{}),h=a.get("line-miter-limit"),c=a.get("line-round-limit");for(let n of(this.lineClips=this.lineFeatureClips(i),r))this.addLine(n,i,l,u,h,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,n,s,o)}addLine(i,r,n,o,s,a){let l,u,h,c,p;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let r=0;r<i.length-1;r++)this.totalDistance+=i[r].dist(i[r+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let f="Polygon"===sZ[r.type],d=i.length;for(;d>=2&&i[d-1].equals(i[d-2]);)d--;let m=0;for(;m<d-1&&i[m].equals(i[m+1]);)m++;if(d<(f?3:2))return;"bevel"===n&&(s=1.05);let g=this.overscaling<=16?122880/(512*this.overscaling):0,y=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,f&&(l=i[d-2],p=i[m].sub(l)._unit()._perp());for(let r=m;r<d;r++){if((h=r===d-1?f?i[m+1]:void 0:i[r+1])&&i[r].equals(h))continue;p&&(c=p),l&&(u=l),l=i[r],p=h?h.sub(l)._unit()._perp():c;let _=(c=c||p).add(p);0===_.x&&0===_.y||_._unit();let v=c.x*p.x+c.y*p.y,x=_.x*p.x+_.y*p.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),E=x<sX&&u&&h,I=c.x*p.y-c.y*p.x>0;if(E&&r>m){let i=l.dist(u);if(i>2*g){let r=l.sub(l.sub(u)._mult(g/i)._round());this.updateDistance(u,r),this.addCurrentVertex(r,c,0,0,y),u=r}}let S=u&&h,M=S?n:f?"butt":o;if(S&&"round"===M&&(b<a?M="miter":b<=2&&(M="fakeround")),"miter"===M&&b>s&&(M="bevel"),"bevel"===M&&(b>2&&(M="flipbevel"),b<s&&(M="miter")),u&&this.updateDistance(u,l),"miter"===M)_._mult(b),this.addCurrentVertex(l,_,0,0,y);else if("flipbevel"===M){if(b>100)_=p.mult(-1);else{let i=b*c.add(p).mag()/c.sub(p).mag();_._perp()._mult(i*(I?-1:1))}this.addCurrentVertex(l,_,0,0,y),this.addCurrentVertex(l,_.mult(-1),0,0,y)}else if("bevel"===M||"fakeround"===M){let i=-Math.sqrt(b*b-1),r=I?i:0,n=I?0:i;if(u&&this.addCurrentVertex(l,c,r,n,y),"fakeround"===M){let i=Math.round(180*w/Math.PI/20);for(let r=1;r<i;r++){let n=r/i;if(.5!==n){let i=n-.5;n+=n*i*(n-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*i*i+(.848013+v*(.215638*v-1.06021)))}let o=p.sub(c)._mult(n)._add(c)._unit()._mult(I?-1:1);this.addHalfVertex(l,o.x,o.y,!1,I,0,y)}}h&&this.addCurrentVertex(l,p,-r,-n,y)}else if("butt"===M)this.addCurrentVertex(l,_,0,0,y);else if("square"===M){let i=u?1:-1;u||this.addCurrentVertex(l,_,i,i,y),this.addCurrentVertex(l,_,0,0,y),u&&this.addCurrentVertex(l,_,i,i,y)}else"round"===M&&(u&&(this.addCurrentVertex(l,c,0,0,y),this.addCurrentVertex(l,c,1,1,y,!0)),h&&(this.addCurrentVertex(l,p,-1,-1,y,!0),this.addCurrentVertex(l,p,0,0,y)));if(E&&r<d-1){let i=l.dist(h);if(i>2*g){let r=l.add(h.sub(l)._mult(g/i)._round());this.updateDistance(l,r),this.addCurrentVertex(r,p,0,0,y),l=r}}}}addCurrentVertex(i,r,n,o,s,a=!1){let l=r.y*o-r.x,u=-r.y-r.x*o;this.addHalfVertex(i,r.x+r.y*n,r.y-r.x*n,a,!1,n,s),this.addHalfVertex(i,l,u,a,!0,-o,s)}addHalfVertex({x:i,y:r},n,o,s,a,l,u){this.layoutVertexArray.emplaceBack((i<<1)+ +!!s,(r<<1)+ +!!a,Math.round(63*n)+128,Math.round(63*o)+128,1+(0===l?0:l<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);let h=u.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,h),u.primitiveLength++),a?this.e2=h:this.e1=h}updateScaledDistance(){if(this.lineClips){let i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,r){this.distance+=i.dist(r),this.updateScaledDistance()}}rc("LineBucket",s$,{omit:["layers","patternFeatures"]});let sW=new nh({"line-cap":new ns(tN.layout_line["line-cap"]),"line-join":new ns(tN.layout_line["line-join"]),"line-miter-limit":new no(tN.layout_line["line-miter-limit"]),"line-round-limit":new no(tN.layout_line["line-round-limit"]),"line-sort-key":new ns(tN.layout_line["line-sort-key"])});var sH={paint:new nh({"line-opacity":new ns(tN.paint_line["line-opacity"]),"line-color":new ns(tN.paint_line["line-color"]),"line-translate":new no(tN.paint_line["line-translate"]),"line-translate-anchor":new no(tN.paint_line["line-translate-anchor"]),"line-width":new ns(tN.paint_line["line-width"]),"line-gap-width":new ns(tN.paint_line["line-gap-width"]),"line-offset":new ns(tN.paint_line["line-offset"]),"line-blur":new ns(tN.paint_line["line-blur"]),"line-dasharray":new na(tN.paint_line["line-dasharray"]),"line-pattern":new na(tN.paint_line["line-pattern"]),"line-gradient":new nu(tN.paint_line["line-gradient"])}),layout:sW};let sY=new class extends ns{possiblyEvaluate(i,r){return r=new r6(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,n,o){return r=w({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,n,o)}}(sH.paint.properties["line-width"].specification);sY.useIntegerZoom=!0;let sK=nm([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sJ=nm([{name:"a_projected_pos",components:3,type:"Float32"}],4);nm([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let sQ=nm([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),s0=nm([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);nm([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let s1=nm([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),s2=nm([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function s3(i,r){let{expression:n}=r;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new r6(i+1))};if("source"===n.kind)return{kind:"source"};{let{zoomStops:r,interpolationType:o}=n,s=0;for(;s<r.length&&r[s]<=i;)s++;let a=s=Math.max(0,s-1);for(;a<r.length&&r[a]<i+1;)a++;a=Math.min(r.length-1,a);let l=r[s],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:l,maxZoom:u,interpolationType:o}:{kind:"camera",minZoom:l,maxZoom:u,minSize:n.evaluate(new r6(l)),maxSize:n.evaluate(new r6(u)),interpolationType:o}}}function s5(i,{uSize:r,uSizeT:n},{lowerSize:o,upperSize:s}){return"source"===i.kind?o/128:"composite"===i.kind?eO(o/128,s/128,n):r}function s4(i,r){let n=0,o=0;if("constant"===i.kind)o=i.layoutSize;else if("source"!==i.kind){let{interpolationType:s,minZoom:a,maxZoom:l}=i,u=s?_(eJ.interpolationFactor(s,r,a,l),0,1):0;"camera"===i.kind?o=eO(i.minSize,i.maxSize,u):n=u}return{uSizeT:n,uSize:o}}nm([{name:"triangle",components:3,type:"Uint16"}]),nm([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),nm([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),nm([{type:"Float32",name:"offsetX"}]),nm([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var s6=Object.freeze({__proto__:null,getSizeData:s3,evaluateSizeForFeature:s5,evaluateSizeForZoom:s4,SIZE_PACK_FACTOR:128});let s8={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var s9=function(i,r,n,o,s){var a,l,u=8*s-o-1,h=(1<<u)-1,c=h>>1,p=-7,f=n?s-1:0,d=n?-1:1,m=i[r+f];for(f+=d,a=m&(1<<-p)-1,m>>=-p,p+=u;p>0;a=256*a+i[r+f],f+=d,p-=8);for(l=a&(1<<-p)-1,a>>=-p,p+=o;p>0;l=256*l+i[r+f],f+=d,p-=8);if(0===a)a=1-c;else{if(a===h)return l?NaN:1/0*(m?-1:1);l+=Math.pow(2,o),a-=c}return(m?-1:1)*l*Math.pow(2,a-o)},s7=function(i,r,n,o,s,a){var l,u,h,c=8*a-s-1,p=(1<<c)-1,f=p>>1,d=5960464477539062e-23*(23===s),m=o?0:a-1,g=o?1:-1,y=+(r<0||0===r&&1/r<0);for(isNaN(r=Math.abs(r))||r===1/0?(u=+!!isNaN(r),l=p):(l=Math.floor(Math.log(r)/Math.LN2),r*(h=Math.pow(2,-l))<1&&(l--,h*=2),(r+=l+f>=1?d/h:d*Math.pow(2,1-f))*h>=2&&(l++,h/=2),l+f>=p?(u=0,l=p):l+f>=1?(u=(r*h-1)*Math.pow(2,s),l+=f):(u=r*Math.pow(2,f-1)*Math.pow(2,s),l=0));s>=8;i[n+m]=255&u,m+=g,u/=256,s-=8);for(l=l<<s|u,c+=s;c>0;i[n+m]=255&l,m+=g,l/=256,c-=8);i[n+m-g]|=128*y};function at(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}at.Varint=0,at.Fixed64=1,at.Bytes=2,at.Fixed32=5;var ae="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ai(i){return i.type===at.Bytes?i.readVarint()+i.pos:i.pos+1}function ar(i,r,n){var o=r<=16383?1:r<=2097151?2:r<=0xfffffff?3:Math.floor(Math.log(r)/(7*Math.LN2));n.realloc(o);for(var s=n.pos-1;s>=i;s--)n.buf[s+o]=n.buf[s]}function an(i,r){for(var n=0;n<i.length;n++)r.writeVarint(i[n])}function ao(i,r){for(var n=0;n<i.length;n++)r.writeSVarint(i[n])}function as(i,r){for(var n=0;n<i.length;n++)r.writeFloat(i[n])}function aa(i,r){for(var n=0;n<i.length;n++)r.writeDouble(i[n])}function al(i,r){for(var n=0;n<i.length;n++)r.writeBoolean(i[n])}function au(i,r){for(var n=0;n<i.length;n++)r.writeFixed32(i[n])}function ah(i,r){for(var n=0;n<i.length;n++)r.writeSFixed32(i[n])}function ac(i,r){for(var n=0;n<i.length;n++)r.writeFixed64(i[n])}function ap(i,r){for(var n=0;n<i.length;n++)r.writeSFixed64(i[n])}function af(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+0x1000000*i[r+3]}function ad(i,r,n){i[n]=r,i[n+1]=r>>>8,i[n+2]=r>>>16,i[n+3]=r>>>24}function am(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+(i[r+3]<<24)}function ag(i,r,n){1===i&&n.readMessage(ay,r)}function ay(i,r,n){if(3===i){let{id:i,bitmap:o,width:s,height:a,left:l,top:u,advance:h}=n.readMessage(a_,{});r.push({id:i,bitmap:new o3({width:s+6,height:a+6},o),metrics:{width:s,height:a,left:l,top:u,advance:h}})}}function a_(i,r,n){1===i?r.id=n.readVarint():2===i?r.bitmap=n.readBytes():3===i?r.width=n.readVarint():4===i?r.height=n.readVarint():5===i?r.left=n.readSVarint():6===i?r.top=n.readSVarint():7===i&&(r.advance=n.readVarint())}function av(i){let r=0,n=0;for(let o of i)r+=o.w*o.h,n=Math.max(n,o.w);i.sort((i,r)=>r.h-i.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),n),h:1/0}],s=0,a=0;for(let r of i)for(let i=o.length-1;i>=0;i--){let n=o[i];if(!(r.w>n.w||r.h>n.h)){if(r.x=n.x,r.y=n.y,a=Math.max(a,r.y+r.h),s=Math.max(s,r.x+r.w),r.w===n.w&&r.h===n.h){let r=o.pop();i<o.length&&(o[i]=r)}else r.h===n.h?(n.x+=r.w,n.w-=r.w):(r.w===n.w||o.push({x:n.x+r.w,y:n.y,w:n.w-r.w,h:r.h}),n.y+=r.h,n.h-=r.h);break}}return{w:s,h:a,fill:r/(s*a)||0}}at.prototype={destroy:function(){this.buf=null},readFields:function(i,r,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),s=o>>3,a=this.pos;this.type=7&o,i(s,r,this),this.pos===a&&this.skip(o)}return r},readMessage:function(i,r){return this.readFields(i,r,this.readVarint()+this.pos)},readFixed32:function(){var i=af(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=am(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=af(this.buf,this.pos)+0x100000000*af(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=af(this.buf,this.pos)+0x100000000*am(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=s9(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=s9(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var r,n,o=this.buf;return r=127&(n=o[this.pos++]),n<128?r:(r|=(127&(n=o[this.pos++]))<<7,n<128?r:(r|=(127&(n=o[this.pos++]))<<14,n<128?r:(r|=(127&(n=o[this.pos++]))<<21,n<128?r:function(i,r,n){var o,s,a,l=n.buf;if(s=(112&(a=l[n.pos++]))>>4,a<128||(s|=(127&(a=l[n.pos++]))<<3,a<128)||(s|=(127&(a=l[n.pos++]))<<10,a<128)||(s|=(127&(a=l[n.pos++]))<<17,a<128)||(s|=(127&(a=l[n.pos++]))<<24,a<128)||(s|=(1&(a=l[n.pos++]))<<31,a<128))return o=s,r?0x100000000*o+(i>>>0):0x100000000*(o>>>0)+(i>>>0);throw Error("Expected varint not more than 10 bytes")}(r|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?-((i+1)/2):i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i,r=this.readVarint()+this.pos,n=this.pos;return this.pos=r,r-n>=12&&ae?(i=this.buf,ae.decode(i.subarray(n,r))):function(i,r,n){for(var o="",s=r;s<n;){var a,l,u,h=i[s],c=null,p=h>239?4:h>223?3:h>191?2:1;if(s+p>n)break;1===p?h<128&&(c=h):2===p?128==(192&(a=i[s+1]))&&(c=(31&h)<<6|63&a)<=127&&(c=null):3===p?(l=i[s+2],128==(192&(a=i[s+1]))&&128==(192&l)&&((c=(15&h)<<12|(63&a)<<6|63&l)<=2047||c>=55296&&c<=57343)&&(c=null)):4===p&&(l=i[s+2],u=i[s+3],128==(192&(a=i[s+1]))&&128==(192&l)&&128==(192&u)&&((c=(15&h)<<18|(63&a)<<12|(63&l)<<6|63&u)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,p=1):c>65535&&(c-=65536,o+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),o+=String.fromCharCode(c),s+=p}return o}(this.buf,n,r)},readBytes:function(){var i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r},readPackedVarint:function(i,r){if(this.type!==at.Bytes)return i.push(this.readVarint(r));var n=ai(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(r));return i},readPackedSVarint:function(i){if(this.type!==at.Bytes)return i.push(this.readSVarint());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==at.Bytes)return i.push(this.readBoolean());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==at.Bytes)return i.push(this.readFloat());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==at.Bytes)return i.push(this.readDouble());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==at.Bytes)return i.push(this.readFixed32());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==at.Bytes)return i.push(this.readSFixed32());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==at.Bytes)return i.push(this.readFixed64());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==at.Bytes)return i.push(this.readSFixed64());var r=ai(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed64());return i},skip:function(i){var r=7&i;if(r===at.Varint)for(;this.buf[this.pos++]>127;);else if(r===at.Bytes)this.pos=this.readVarint()+this.pos;else if(r===at.Fixed32)this.pos+=4;else{if(r!==at.Fixed64)throw Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(i,r){this.writeVarint(i<<3|r)},realloc:function(i){for(var r=this.length||16;r<this.pos+i;)r*=2;if(r!==this.length){var n=new Uint8Array(r);n.set(this.buf),this.buf=n,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ad(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ad(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ad(this.buf,-1&i,this.pos),ad(this.buf,Math.floor(23283064365386963e-26*i),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ad(this.buf,-1&i,this.pos),ad(this.buf,Math.floor(23283064365386963e-26*i),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>0xfffffff||i<0?function(i,r){var n,o,s,a,l;if(i>=0?(n=i%0x100000000|0,o=i/0x100000000|0):(o=~(-i/0x100000000),0xffffffff^(n=~(-i%0x100000000))?n=n+1|0:(n=0,o=o+1|0)),i>=0xffffffffffffffff||i<-0xffffffffffffffff)throw Error("Given varint doesn't fit into 10 bytes");r.realloc(10),s=n,r.buf[r.pos++]=127&s|128,s>>>=7,r.buf[r.pos++]=127&s|128,s>>>=7,r.buf[r.pos++]=127&s|128,s>>>=7,r.buf[r.pos++]=127&s|128,r.buf[r.pos]=127&(s>>>=7),l=(7&(a=o))<<4,r.buf[r.pos++]|=l|128*!!(a>>>=3),a&&(r.buf[r.pos++]=127&a|128*!!(a>>>=7),a&&(r.buf[r.pos++]=127&a|128*!!(a>>>=7),a&&(r.buf[r.pos++]=127&a|128*!!(a>>>=7),a&&(r.buf[r.pos++]=127&a|128*!!(a>>>=7),a&&(r.buf[r.pos++]=127&a)))))}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|128*(i>127),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|128*(i>127),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|128*(i>127),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?-(2*i)-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var r=this.pos;this.pos=function(i,r,n){for(var o,s,a=0;a<r.length;a++){if((o=r.charCodeAt(a))>55295&&o<57344){if(!s){o>56319||a+1===r.length?(i[n++]=239,i[n++]=191,i[n++]=189):s=o;continue}if(o<56320){i[n++]=239,i[n++]=191,i[n++]=189,s=o;continue}o=s-55296<<10|o-56320|65536,s=null}else s&&(i[n++]=239,i[n++]=191,i[n++]=189,s=null);o<128?i[n++]=o:(o<2048?i[n++]=o>>6|192:(o<65536?i[n++]=o>>12|224:(i[n++]=o>>18|240,i[n++]=o>>12&63|128),i[n++]=o>>6&63|128),i[n++]=63&o|128)}return n}(this.buf,i,this.pos);var n=this.pos-r;n>=128&&ar(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),s7(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),s7(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var r=i.length;this.writeVarint(r),this.realloc(r);for(var n=0;n<r;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,r){this.pos++;var n=this.pos;i(r,this);var o=this.pos-n;o>=128&&ar(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,r,n){this.writeTag(i,at.Bytes),this.writeRawMessage(r,n)},writePackedVarint:function(i,r){r.length&&this.writeMessage(i,an,r)},writePackedSVarint:function(i,r){r.length&&this.writeMessage(i,ao,r)},writePackedBoolean:function(i,r){r.length&&this.writeMessage(i,al,r)},writePackedFloat:function(i,r){r.length&&this.writeMessage(i,as,r)},writePackedDouble:function(i,r){r.length&&this.writeMessage(i,aa,r)},writePackedFixed32:function(i,r){r.length&&this.writeMessage(i,au,r)},writePackedSFixed32:function(i,r){r.length&&this.writeMessage(i,ah,r)},writePackedFixed64:function(i,r){r.length&&this.writeMessage(i,ac,r)},writePackedSFixed64:function(i,r){r.length&&this.writeMessage(i,ap,r)},writeBytesField:function(i,r){this.writeTag(i,at.Bytes),this.writeBytes(r)},writeFixed32Field:function(i,r){this.writeTag(i,at.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(i,r){this.writeTag(i,at.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(i,r){this.writeTag(i,at.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(i,r){this.writeTag(i,at.Fixed64),this.writeSFixed64(r)},writeVarintField:function(i,r){this.writeTag(i,at.Varint),this.writeVarint(r)},writeSVarintField:function(i,r){this.writeTag(i,at.Varint),this.writeSVarint(r)},writeStringField:function(i,r){this.writeTag(i,at.Bytes),this.writeString(r)},writeFloatField:function(i,r){this.writeTag(i,at.Fixed32),this.writeFloat(r)},writeDoubleField:function(i,r){this.writeTag(i,at.Fixed64),this.writeDouble(r)},writeBooleanField:function(i,r){this.writeVarintField(i,!!r)}};class ax{constructor(i,{pixelRatio:r,version:n,stretchX:o,stretchY:s,content:a}){this.paddedRect=i,this.pixelRatio=r,this.stretchX=o,this.stretchY=s,this.content=a,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ab{constructor(i,r){let n={},o={};this.haveRenderCallbacks=[];let s=[];this.addImages(i,n,s),this.addImages(r,o,s);let{w:a,h:l}=av(s),u=new o5({width:a||1,height:l||1});for(let r in i){let o=i[r],s=n[r].paddedRect;o5.copy(o.data,u,{x:0,y:0},{x:s.x+1,y:s.y+1},o.data)}for(let i in r){let n=r[i],s=o[i].paddedRect,a=s.x+1,l=s.y+1,h=n.data.width,c=n.data.height;o5.copy(n.data,u,{x:0,y:0},{x:a,y:l},n.data),o5.copy(n.data,u,{x:0,y:c-1},{x:a,y:l-1},{width:h,height:1}),o5.copy(n.data,u,{x:0,y:0},{x:a,y:l+c},{width:h,height:1}),o5.copy(n.data,u,{x:h-1,y:0},{x:a-1,y:l},{width:1,height:c}),o5.copy(n.data,u,{x:0,y:0},{x:a+h,y:l},{width:1,height:c})}this.image=u,this.iconPositions=n,this.patternPositions=o}addImages(i,r,n){for(let o in i){let s=i[o],a={x:0,y:0,w:s.data.width+2,h:s.data.height+2};n.push(a),r[o]=new ax(a,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(i,r){for(let n in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[n],i.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],i.getImage(n),r)}patchUpdatedImage(i,r,n){if(!i||!r||i.version===r.version)return;i.version=r.version;let[o,s]=i.tl;n.update(r.data,void 0,{x:o,y:s})}}rc("ImagePosition",ax),rc("ImageAtlas",ab);let aw={horizontal:1,vertical:2,horizontalOnly:3};class aE{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,r){let n=new aE;return n.scale=i||1,n.fontStack=r,n}static forImage(i){let r=new aE;return r.imageName=i,r}}class aI{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,r){let n=new aI;for(let o=0;o<i.sections.length;o++){let s=i.sections[o];s.image?n.addImageSection(s):n.addTextSection(s,r)}return n}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let r="";for(let n=0;n<i.length;n++){let o=i.charCodeAt(n+1)||null,s=i.charCodeAt(n-1)||null;r+=o&&rX(o)&&!s8[i[n+1]]||s&&rX(s)&&!s8[i[n-1]]||!s8[i[n]]?i[n]:s8[i[n]]}return r}(this.text)}trim(){let i=0;for(let r=0;r<this.text.length&&aM[this.text.charCodeAt(r)];r++)i++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=i&&aM[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(i,r),this.sectionIndex=this.sectionIndex.slice(i,r)}substring(i,r){let n=new aI;return n.text=this.text.substring(i,r),n.sectionIndex=this.sectionIndex.slice(i,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,r)=>Math.max(i,this.sections[r].scale),0)}addTextSection(i,r){this.text+=i.text,this.sections.push(aE.forText(i.scale,i.fontStack||r));let n=this.sections.length-1;for(let r=0;r<i.text.length;++r)this.sectionIndex.push(n)}addImageSection(i){let r=i.image?i.image.name:"";if(0===r.length)return void D("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(aE.forImage(r)),this.sectionIndex.push(this.sections.length-1)):D("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function aS(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y){let _;let v=aI.fromFeature(i,s);f===aw.vertical&&v.verticalizePunctuation();let{processBidirectionalText:x,processStyledBidirectionalText:b}=r4;if(x&&1===v.sections.length)for(let i of(_=[],x(v.toString(),aL(v,c,a,r,o,m,g)))){let r=new aI;r.text=i,r.sections=v.sections;for(let n=0;n<i.length;n++)r.sectionIndex.push(0);_.push(r)}else if(b)for(let i of(_=[],b(v.text,v.sectionIndex,aL(v,c,a,r,o,m,g)))){let r=new aI;r.text=i[0],r.sectionIndex=i[1],r.sections=v.sections,_.push(r)}else _=function(i,r){let n=[],o=i.text,s=0;for(let o of r)n.push(i.substring(s,o)),s=o;return s<o.length&&n.push(i.substring(s,o.length)),n}(v,aL(v,c,a,r,o,m,g));let w=[],E={positionedLines:w,text:v.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:f,iconsInText:!1,verticalizable:!1};return function(i,r,n,o,s,a,l,u,h,c,p,f){let d=0,m=-17,g=0,y=0,_="right"===u?1:.5*("left"!==u),v=0;for(let l of s){l.trim();let s=l.getMaxScale(),u=(s-1)*24,x={positionedGlyphs:[],lineOffset:0};i.positionedLines[v]=x;let b=x.positionedGlyphs,w=0;if(!l.length()){m+=a,++v;continue}for(let a=0;a<l.length();a++){let g=l.getSection(a),y=l.getSectionIndex(a),_=l.getCharCode(a),v=0,x=null,E=null,I=null,S=24,M=!(h===aw.horizontal||!p&&!rZ(_)||p&&(aM[_]||ry(_)||r_(_)||rv(_)||rF(_)||rV(_)));if(g.imageName){let r=o[g.imageName];if(!r)continue;I=g.imageName,i.iconsInText=i.iconsInText||!0,E=r.paddedRect;let n=r.displaySize;g.scale=24*g.scale/f,x={width:n[0],height:n[1],left:1,top:-3,advance:M?n[1]:n[0],localGlyph:!1},v=u+(24-n[1]*g.scale),S=x.advance;let a=M?n[0]*g.scale-24*s:n[1]*g.scale-24*s;a>0&&a>w&&(w=a)}else{let i=n[g.fontStack],o=i&&i[_];if(o&&o.rect)E=o.rect,x=o.metrics;else{let i=r[g.fontStack],n=i&&i[_];if(!n)continue;x=n.metrics}v=(s-g.scale)*24}M?(i.verticalizable=!0,b.push({glyph:_,imageName:I,x:d,y:m+v,vertical:M,scale:g.scale,localGlyph:x.localGlyph,fontStack:g.fontStack,sectionIndex:y,metrics:x,rect:E}),d+=S*g.scale+c):(b.push({glyph:_,imageName:I,x:d,y:m+v,vertical:M,scale:g.scale,localGlyph:x.localGlyph,fontStack:g.fontStack,sectionIndex:y,metrics:x,rect:E}),d+=x.advance*g.scale+c)}0!==b.length&&(g=Math.max(d-c,g),function(i,r,n,o,s){if(!o&&!s)return;let a=i[n],l=(i[n].x+a.metrics.advance*a.scale)*o;for(let r=0;r<=n;r++)i[r].x-=l,i[r].y+=s}(b,0,b.length-1,_,w)),d=0;let E=a*s+w;x.lineOffset=Math.max(w,u),m+=E,y=Math.max(E,y),++v}let x=m- -17,{horizontalAlign:b,verticalAlign:w}=ak(l);(function(i,r,n,o,s,a,l,u,h){let c=(r-n)*s,p=0;for(let r of(p=a!==l?-u*o- -17:(-o*h+.5)*l,i))for(let i of r.positionedGlyphs)i.x+=c,i.y+=p})(i.positionedLines,_,b,w,g,y,a,x,s.length),i.top+=-w*x,i.bottom=i.top+x,i.left+=-b*g,i.right=i.left+g}(E,r,n,o,_,l,u,h,f,c,d,y),!function(i){for(let r of i)if(0!==r.positionedGlyphs.length)return!1;return!0}(w)&&E}let aM={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function aC(i,r,n,o,s,a){if(r.imageName){let i=o[r.imageName];return i?i.displaySize[0]*r.scale*24/a+s:0}{let o=n[r.fontStack],a=o&&o[i];return a?a.metrics.advance*r.scale+s:0}}function aP(i,r,n,o){let s=Math.pow(i-r,2);return o?i<r?s/2:2*s:s+Math.abs(n)*n}function aA(i,r,n,o,s,a){let l=null,u=aP(r,n,s,a);for(let i of o){let o=aP(r-i.x,n,s,a)+i.badness;o<=u&&(l=i,u=o)}return{index:i,x:r,priorBreak:l,badness:u}}function aL(i,r,n,o,s,a,l){if("point"!==a||!i)return[];let u=[],h=function(i,r,n,o,s,a){let l=0;for(let n=0;n<i.length();n++){let u=i.getSection(n);l+=aC(i.getCharCode(n),u,o,s,r,a)}return l/Math.max(1,Math.ceil(l/n))}(i,r,n,o,s,l),c=i.text.indexOf("​")>=0,p=0;for(let n=0;n<i.length();n++){let a=i.getSection(n),f=i.getCharCode(n);if(aM[f]||(p+=aC(f,a,o,s,r,l)),n<i.length()-1){let r=!(f<11904||!(rT(f)||rM(f)||rU(f)||rz(f)||rL(f)||rx(f)||rC(f)||rE(f)||rk(f)||rR(f)||rA(f)||rq(f)||rI(f)||rw(f)||rb(f)||rP(f)||rS(f)||rB(f)||rN(f)||rD(f)));(aT[f]||r||a.imageName)&&u.push(aA(n+1,p,h,u,function(i,r,n){let o=0;return 10===i&&(o-=1e4),n&&(o+=150),40!==i&&65288!==i||(o+=50),41!==r&&65289!==r||(o+=50),o}(f,i.getCharCode(n+1),r&&c),!1))}}return function i(r){return r?i(r.priorBreak).concat(r.index):[]}(aA(i.length(),p,h,u,0,!0))}function ak(i){let r=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:r,verticalAlign:n}}function aR(i,r,n,o,s,a){let l,u,h,c,p;let f=i.image;if(f.content){let i=f.content,r=f.pixelRatio||1;l=[i[0]/r,i[1]/r,f.displaySize[0]-i[2]/r,f.displaySize[1]-i[3]/r]}let d=r.left*a,m=r.right*a;"width"===n||"both"===n?(p=s[0]+d-o[3],h=s[0]+m+o[1]):h=(p=s[0]+(d+m-f.displaySize[0])/2)+f.displaySize[0];let g=r.top*a,y=r.bottom*a;return"height"===n||"both"===n?(u=s[1]+g-o[0],c=s[1]+y+o[2]):c=(u=s[1]+(g+y-f.displaySize[1])/2)+f.displaySize[1],{image:f,top:u,right:h,bottom:c,left:p,collisionPadding:l}}class aD extends u{constructor(i,r,n,o){super(i,r),this.angle=n,void 0!==o&&(this.segment=o)}clone(){return new aD(this.x,this.y,this.angle,this.segment)}}function aN(i,r,n,o,s){if(void 0===r.segment)return!0;let a=r,l=r.segment+1,u=0;for(;u>-n/2;){if(--l<0)return!1;u-=i[l].dist(a),a=i[l]}u+=i[l].dist(i[l+1]),l++;let h=[],c=0;for(;u<n/2;){let r=i[l],n=i[l+1];if(!n)return!1;let a=i[l-1].angleTo(r)-r.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),h.push({distance:u,angleDelta:a}),c+=a;u-h[0].distance>o;)c-=h.shift().angleDelta;if(c>s)return!1;l++,u+=r.dist(n)}return!0}function aO(i){let r=0;for(let n=0;n<i.length-1;n++)r+=i[n].dist(i[n+1]);return r}function az(i,r){return Math.max(i?i.right-i.left:0,r?r.right-r.left:0)}function aF(i,r,n,o,s){let a=[];for(let l=0;l<i.length;l++){let h;let c=i[l];for(let i=0;i<c.length-1;i++){let l=c[i],p=c[i+1];l.x<r&&p.x<r||(l.x<r?l=new u(r,l.y+(r-l.x)/(p.x-l.x)*(p.y-l.y))._round():p.x<r&&(p=new u(r,l.y+(r-l.x)/(p.x-l.x)*(p.y-l.y))._round()),l.y<n&&p.y<n||(l.y<n?l=new u(l.x+(n-l.y)/(p.y-l.y)*(p.x-l.x),n)._round():p.y<n&&(p=new u(l.x+(n-l.y)/(p.y-l.y)*(p.x-l.x),n)._round()),l.x>=o&&p.x>=o||(l.x>=o?l=new u(o,l.y+(o-l.x)/(p.x-l.x)*(p.y-l.y))._round():p.x>=o&&(p=new u(o,l.y+(o-l.x)/(p.x-l.x)*(p.y-l.y))._round()),l.y>=s&&p.y>=s||(l.y>=s?l=new u(l.x+(s-l.y)/(p.y-l.y)*(p.x-l.x),s)._round():p.y>=s&&(p=new u(l.x+(s-l.y)/(p.y-l.y)*(p.x-l.x),s)._round()),h&&l.equals(h[h.length-1])||(h=[l],a.push(h)),h.push(p)))))}}return a}function aB(i,r,n,o,s,a){this.fontSize=i||24,this.buffer=void 0===r?3:r,this.cutoff=o||.25,this.fontFamily=s||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var l=this.size=this.fontSize+2*this.buffer,u=l+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=l,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(l/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function aU(i,r,n,o,s,a){for(var l=0;l<r;l++)aG(i,l,r,n,o,s,a);for(var u=0;u<n;u++)aG(i,u*r,1,r,o,s,a)}function aG(i,r,n,o,s,a,l){var u,h,c,p;for(a[0]=0,l[0]=-1e20,l[1]=1e20,u=0;u<o;u++)s[u]=i[r+u*n];for(u=1,h=0,c=0;u<o;u++){do c=(s[u]-s[p=a[h]]+u*u-p*p)/(u-p)/2;while(c<=l[h]&&--h>-1)a[++h]=u,l[h]=c,l[h+1]=1e20}for(u=0,h=0;u<o;u++){for(;l[h+1]<u;)h++;i[r+u*n]=s[p=a[h]]+(u-p)*(u-p)}}rc("Anchor",aD),aB.prototype._draw=function(i,r){var n,o,s,a,l,u,h,c,p,f=this.ctx.measureText(i),d=f.width,m=2*this.buffer;r&&this.useMetrics?(l=Math.floor(f.actualBoundingBoxAscent),c=this.buffer+Math.ceil(f.actualBoundingBoxAscent),u=this.buffer,h=this.buffer,n=(o=Math.min(this.size,Math.ceil(f.actualBoundingBoxRight-f.actualBoundingBoxLeft)))+m,s=(a=Math.min(this.size-u,Math.ceil(f.actualBoundingBoxAscent+f.actualBoundingBoxDescent)))+m,this.ctx.textBaseline="alphabetic"):(n=o=this.size,s=a=this.size,l=19*this.fontSize/24,u=h=0,c=this.middle,this.ctx.textBaseline="middle"),o&&a&&(this.ctx.clearRect(h,u,o,a),this.ctx.fillText(i,this.buffer,c),p=this.ctx.getImageData(h,u,o,a));var g=new Uint8ClampedArray(n*s);return function(i,r,n,o,s,a,l){a.fill(1e20,0,r*n),l.fill(0,0,r*n);for(var u=(r-o)/2,h=0;h<s;h++)for(var c=0;c<o;c++){var p=(h+u)*r+c+u,f=i.data[4*(h*o+c)+3]/255;if(1===f)a[p]=0,l[p]=1e20;else if(0===f)a[p]=1e20,l[p]=0;else{var d=Math.max(0,.5-f),m=Math.max(0,f-.5);a[p]=d*d,l[p]=m*m}}}(p,n,s,o,a,this.gridOuter,this.gridInner),aU(this.gridOuter,n,s,this.f,this.v,this.z),aU(this.gridInner,n,s,this.f,this.v,this.z),function(i,r,n,o,s,a,l){for(var u=0;u<r*n;u++){var h=Math.sqrt(o[u])-Math.sqrt(s[u]);i[u]=Math.round(255-255*(h/a+l))}}(g,n,s,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:a,sdfWidth:n,sdfHeight:s,top:l,left:0,advance:d}}},aB.prototype.draw=function(i){return this._draw(i,!1).data},aB.prototype.drawWithMetrics=function(i){return this._draw(i,!0)},aB.default=aB;let aV={none:0,ideographs:1,all:2};class aq{constructor(i,r,n){this.requestManager=i,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,r){let n=[];for(let r in i)for(let o of i[r])n.push({stack:r,id:o});x(n,({stack:i,id:r},n)=>{let o=this.entries[i];o||(o=this.entries[i]={glyphs:{},requests:{},ranges:{}});let s=o.glyphs[r];if(void 0!==s)return void n(null,{stack:i,id:r,glyph:s});if(s=this._tinySDF(o,i,r))return o.glyphs[r]=s,void n(null,{stack:i,id:r,glyph:s});let a=Math.floor(r/256);if(256*a>65535)return void n(Error("glyphs > 65535 not supported"));if(o.ranges[a])return void n(null,{stack:i,id:r,glyph:s});let l=o.requests[a];l||(l=o.requests[a]=[],aq.loadGlyphRange(i,a,this.url,this.requestManager,(i,r)=>{if(r){for(let i in r)this._doesCharSupportLocalGlyph(+i)||(o.glyphs[+i]=r[+i]);o.ranges[a]=!0}for(let n of l)n(i,r);delete o.requests[a]})),l.push((o,s)=>{o?n(o):s&&n(null,{stack:i,id:r,glyph:s[r]||null})})},(i,n)=>{if(i)r(i);else if(n){let i={};for(let{stack:r,id:o,glyph:s}of n)(i[r]||(i[r]={}))[o]=s&&{id:s.id,bitmap:s.bitmap.clone(),metrics:s.metrics};r(null,i)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==aV.none&&(this.localGlyphMode===aV.all?!!this.localFontFamily:!!this.localFontFamily&&(rR(i)||rO(i)||rI(i)||rS(i)))}_tinySDF(i,r,n){let o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(n))return;let s=i.tinySDF;if(!s){let n="400";/bold/i.test(r)?n="900":/medium/i.test(r)?n="500":/light/i.test(r)&&(n="200"),s=i.tinySDF=new aq.TinySDF(48,6,16,.25,o,n)}if(this.localGlyphs[s.fontWeight][n])return this.localGlyphs[s.fontWeight][n];let{data:a,metrics:l}=s.drawWithMetrics(String.fromCharCode(n)),{sdfWidth:u,sdfHeight:h,width:c,height:p,left:f,top:d,advance:m}=l;return this.localGlyphs[s.fontWeight][n]={id:n,bitmap:new o3({width:u,height:h},a),metrics:{width:c/2,height:p/2,left:f/2,top:d/2-27,advance:m/2,localGlyph:!0}}}}function aj(i,r,n,o){let s=[],a=i.image,l=a.pixelRatio,h=a.paddedRect.w-2,c=a.paddedRect.h-2,p=i.right-i.left,f=i.bottom-i.top,d=a.stretchX||[[0,h]],m=a.stretchY||[[0,c]],g=(i,r)=>i+r[1]-r[0],y=d.reduce(g,0),_=m.reduce(g,0),v=h-y,x=c-_,b=0,w=y,E=0,I=_,S=0,M=v,T=0,C=x;if(a.content&&o){let i=a.content;b=aZ(d,0,i[0]),E=aZ(m,0,i[1]),w=aZ(d,i[0],i[2]),I=aZ(m,i[1],i[3]),S=i[0]-b,T=i[1]-E,M=i[2]-i[0]-w,C=i[3]-i[1]-I}let P=(o,s,h,c)=>{var d,m,g,v;let x=(o.stretch-b)/w*p+i.left,P=(d=o.fixed-S,d-M*o.stretch/y),A=(s.stretch-E)/I*f+i.top,L=(m=s.fixed-T,m-C*s.stretch/_),k=(h.stretch-b)/w*p+i.left,R=(g=h.fixed-S,g-M*h.stretch/y),D=(c.stretch-E)/I*f+i.top,N=(v=c.fixed-T,v-C*c.stretch/_),O=new u(x,A),z=new u(k,A),F=new u(k,D),B=new u(x,D),U=new u(P/l,L/l),G=new u(R/l,N/l),V=r*Math.PI/180;if(V){let i=Math.sin(V),r=Math.cos(V),n=[r,-i,i,r];O._matMult(n),z._matMult(n),B._matMult(n),F._matMult(n)}let q=o.stretch+o.fixed,j=s.stretch+s.fixed;return{tl:O,tr:z,bl:B,br:F,tex:{x:a.paddedRect.x+1+q,y:a.paddedRect.y+1+j,w:h.stretch+h.fixed-q,h:c.stretch+c.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:U,pixelOffsetBR:G,minFontScaleX:M/l/p,minFontScaleY:C/l/f,isSDF:n}};if(o&&(a.stretchX||a.stretchY)){let i=aX(d,v,y),r=aX(m,x,_);for(let n=0;n<i.length-1;n++){let o=i[n],a=i[n+1];for(let i=0;i<r.length-1;i++)s.push(P(o,r[i],a,r[i+1]))}}else s.push(P({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:c+1}));return s}function aZ(i,r,n){let o=0;for(let s of i)o+=Math.max(r,Math.min(n,s[1]))-Math.max(r,Math.min(n,s[0]));return o}function aX(i,r,n){let o=[{fixed:-1,stretch:0}];for(let[r,n]of i){let i=o[o.length-1];o.push({fixed:r-i.stretch,stretch:i.stretch}),o.push({fixed:r-i.stretch,stretch:i.stretch+(n-r)})}return o.push({fixed:r+1,stretch:n}),o}aq.loadGlyphRange=function(i,r,n,o,s){let a=256*r;tS(o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${a}-${a+255}`),tb.Glyphs),(i,r)=>{if(i)s(i);else if(r){let i={};for(let n of new at(r).readFields(ag,[]))i[n.id]=n;s(null,i)}})},aq.TinySDF=aB;class a${constructor(i=[],r=aW){if(this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let i=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:r,compare:n}=this,o=r[i];for(;i>0;){let s=i-1>>1,a=r[s];if(n(o,a)>=0)break;r[i]=a,i=s}r[i]=o}_down(i){let{data:r,compare:n}=this,o=this.length>>1,s=r[i];for(;i<o;){let o=1+(i<<1),a=r[o],l=o+1;if(l<this.length&&0>n(r[l],a)&&(o=l,a=r[l]),n(a,s)>=0)break;r[i]=a,i=o}r[i]=s}}function aW(i,r){return i<r?-1:+(i>r)}function aH(i,r){return r.max-i.max}function aY(i,r,n,o){this.p=new u(i,r),this.h=n,this.d=function(i,r){let n=!1,o=1/0;for(let s=0;s<r.length;s++){let a=r[s];for(let r=0,s=a.length,l=s-1;r<s;l=r++){let s=a[r],u=a[l];s.y>i.y!=u.y>i.y&&i.x<(u.x-s.x)*(i.y-s.y)/(u.y-s.y)+s.x&&(n=!n),o=Math.min(o,oS(i,s,u))}}return(n?1:-1)*Math.sqrt(o)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}let aK=Number.POSITIVE_INFINITY;function aJ(i,r){return r[1]!==aK?function(i,r,n){let o=0,s=0;switch(r=Math.abs(r),n=Math.abs(n),i){case"top-right":case"top-left":case"top":s=n-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-n}switch(i){case"top-right":case"bottom-right":case"right":o=-r;break;case"top-left":case"bottom-left":case"left":o=r}return[o,s]}(i,r[0],r[1]):function(i,r){let n=0,o=0;r<0&&(r=0);let s=r/Math.sqrt(2);switch(i){case"top-right":case"top-left":o=s-7;break;case"bottom-right":case"bottom-left":o=7-s;break;case"bottom":o=7-r;break;case"top":o=r-7}switch(i){case"top-right":case"bottom-right":n=-s;break;case"top-left":case"bottom-left":n=s;break;case"left":n=r;break;case"right":n=-r}return[n,o]}(i,r[0])}function aQ(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function a0(i,r,n,o,s,a,l,h,c,p,f,d,m,g,y){let _=function(i,r,n,o,s,a,l,h){let c=o.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,p=[];for(let i of r.positionedLines)for(let o of i.positionedGlyphs){if(!o.rect)continue;let a=o.rect||{},f=4,d=!0,m=1,g=0,y=(s||h)&&o.vertical,_=o.metrics.advance*o.scale/2;if(h&&r.verticalizable){let r=(o.scale-1)*24,n=(24-o.metrics.width*o.scale)/2;g=i.lineOffset/2-(o.imageName?-n:r)}if(o.imageName){let i=l[o.imageName];d=i.sdf,f=1/(m=i.pixelRatio)}let v=s?[o.x+_,o.y]:[0,0],x=s?[0,0]:[o.x+_+n[0],o.y+n[1]-g],b=[0,0];y&&(b=x,x=[0,0]);let w=(o.metrics.left-f)*o.scale-_+x[0],E=(-o.metrics.top-f)*o.scale+x[1],I=w+a.w*o.scale/(m*(o.localGlyph?2:1)),S=E+a.h*o.scale/(m*(o.localGlyph?2:1)),M=new u(w,E),T=new u(I,E),C=new u(w,S),P=new u(I,S);if(y){let i=new u(-_,_- -17),r=-Math.PI/2,n=12-_,s=new u(22-n,-(o.imageName?n:0)),a=new u(...b);M._rotateAround(r,i)._add(s)._add(a),T._rotateAround(r,i)._add(s)._add(a),C._rotateAround(r,i)._add(s)._add(a),P._rotateAround(r,i)._add(s)._add(a)}if(c){let i=Math.sin(c),r=Math.cos(c),n=[r,-i,i,r];M._matMult(n),T._matMult(n),C._matMult(n),P._matMult(n)}let A=new u(0,0),L=new u(0,0);p.push({tl:M,tr:T,bl:C,br:P,tex:a,writingMode:r.writingMode,glyphOffset:v,sectionIndex:o.sectionIndex,isSDF:d,pixelOffsetTL:A,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}return p}(0,n,h,s,a,l,o,i.allowVerticalPlacement),v=i.textSizeData,x=null;for(let n of("source"===v.kind?(x=[128*s.layout.get("text-size").evaluate(l,{},y)])[0]>32640&&D(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===v.kind&&((x=[128*g.compositeTextSizes[0].evaluate(l,{},y),128*g.compositeTextSizes[1].evaluate(l,{},y)])[0]>32640||x[1]>32640)&&D(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),i.addSymbols(i.text,_,x,h,a,l,p,r,c.lineStartIndex,c.lineLength,m,y),f))d[n]=i.text.placedSymbolArray.length-1;return 4*_.length}function a1(i){for(let r in i)return i[r];return null}function a2(i,r,n,o,s,a,l,h){let c=a.top,f=a.bottom,d=a.left,m=a.right,g=a.collisionPadding;if(g&&(d-=g[0],c-=g[1],m+=g[2],f+=g[3]),h){let i=new u(d,c),r=new u(m,c),n=new u(d,f),o=new u(m,f),s=h*p;i._rotate(s),r._rotate(s),n._rotate(s),o._rotate(s),d=Math.min(i.x,r.x,n.x,o.x),m=Math.max(i.x,r.x,n.x,o.x),c=Math.min(i.y,r.y,n.y,o.y),f=Math.max(i.y,r.y,n.y,o.y)}return i.emplaceBack(r.x,r.y,d,c,m,f,l,n,o,s),i.length-1}function a3(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let r=i.bottom-i.top;return r>0?Math.max(10,r):null}let a5=sD.VectorTileFeature.types,a4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function a6(i,r,n,o,s,a,l,u,h,c,p,f,d){let m=u?Math.min(32640,Math.round(u[0])):0,g=u?Math.min(32640,Math.round(u[1])):0;i.emplaceBack(r,n,Math.round(32*o),Math.round(32*s),a,l,(m<<1)+ +!!h,g,16*c,16*p,256*f,256*d)}function a8(i,r,n){i.emplaceBack(r.x,r.y,n),i.emplaceBack(r.x,r.y,n),i.emplaceBack(r.x,r.y,n),i.emplaceBack(r.x,r.y,n)}class a9{constructor(i){this.layoutVertexArray=new nE,this.indexArray=new nA,this.programConfigurations=i,this.segments=new om,this.dynamicLayoutVertexArray=new nI,this.opacityVertexArray=new nS,this.placedSymbolArray=new nV}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,r,n,o){this.isEmpty()||(n&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sK.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,sJ.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,a4,!0),this.opacityVertexBuffer.itemSize=1),(n||o)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rc("SymbolBuffers",a9);class a7{constructor(i,r,n){this.layoutVertexArray=new i,this.layoutAttributes=r,this.indexArray=new n,this.segments=new om,this.collisionVertexArray=new nP,this.collisionVertexArrayExt=new nI}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,sQ.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,s0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rc("CollisionBuffers",a7);class lt{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(i=>i.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oz([]),this.placementViewportMatrix=oz([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=s3(this.zoom,r["text-size"]),this.iconSizeData=s3(this.zoom,r["icon-size"]);let n=this.layers[0].layout,o=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==s&&void 0!==o.constantOr(1),this.sortFeaturesByY=("viewport-y"===s||"auto"===s&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map(i=>aw[i])),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.sourceID=i.sourceID}createArrays(){this.text=new a9(new oa(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new a9(new oa(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new nZ,this.lineVertexArray=new nX,this.symbolInstances=new nj}calculateGlyphDependencies(i,r,n,o,s){for(let a=0;a<i.length;a++)if(r[i.charCodeAt(a)]=!0,(n||o)&&s){let n=s8[i.charAt(a)];n&&(r[n.charCodeAt(0)]=!0)}}populate(i,r,n){let o=this.layers[0],s=o.layout,a=s.get("text-font"),l=s.get("text-field"),u=s.get("icon-image"),h=("constant"!==l.value.kind||l.value.value instanceof et&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),c="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=s.get("symbol-sort-key");if(this.features=[],!h&&!c)return;let f=r.iconDependencies,d=r.glyphDependencies,m=r.availableImages,g=new r6(this.zoom);for(let{feature:r,id:l,index:u,sourceLayerIndex:y}of i){let i,_;let v=o._featureFilter.needGeometry,x=o_(r,v);if(!o._featureFilter.filter(g,x,n))continue;if(v||(x.geometry=oy(r)),h){let r=o.getValueAndResolveTokens("text-field",x,n,m),s=et.factory(r);(function(i){for(let r of i.sections)if(function(i){for(let r of i)if(r$(r.charCodeAt(0)))return!0;return!1}(r.text))return!0;return!1})(s)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===r3()||this.hasRTLText&&r4.isParsed())&&(i=function(i,r,n){return i.sections.forEach(i=>{i.text=function(i,r,n){let o=r.layout.get("text-transform").evaluate(n,{});return"uppercase"===o?i=i.toLocaleUpperCase():"lowercase"===o&&(i=i.toLocaleLowerCase()),r4.applyArabicShaping&&(i=r4.applyArabicShaping(i)),i}(i.text,r,n)}),i}(s,o,x))}if(c){let i=o.getValueAndResolveTokens("icon-image",x,n,m);_=i instanceof ee?i:ee.fromString(i)}if(!i&&!_)continue;let b=this.sortFeaturesByKey?p.evaluate(x,{},n):void 0;if(this.features.push({id:l,text:i,icon:_,index:u,sourceLayerIndex:y,geometry:x.geometry,properties:r.properties,type:a5[r.type],sortKey:b}),_&&(f[_.name]=!0),i){let r=a.evaluate(x,{},n).join(","),o="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");for(let n of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(aw.vertical)>=0,i.sections))if(n.image)f[n.image.name]=!0;else{let s=rj(i.toString()),a=n.fontStack||r,l=d[a]=d[a]||{};this.calculateGlyphDependencies(n.text,l,o,this.allowVerticalPlacement,s)}}}"line"===s.get("symbol-placement")&&(this.features=function(i){let r={},n={},o=[],s=0;function a(r){o.push(i[r]),s++}function l(i,r,s){let a=n[i];return delete n[i],n[r]=a,o[a].geometry[0].pop(),o[a].geometry[0]=o[a].geometry[0].concat(s[0]),a}function u(i,n,s){let a=r[n];return delete r[n],r[i]=a,o[a].geometry[0].shift(),o[a].geometry[0]=s[0].concat(o[a].geometry[0]),a}function h(i,r,n){let o=n?r[0][r[0].length-1]:r[0][0];return`${i}:${o.x}:${o.y}`}for(let c=0;c<i.length;c++){let p=i[c],f=p.geometry,d=p.text?p.text.toString():null;if(!d){a(c);continue}let m=h(d,f),g=h(d,f,!0);if(m in n&&g in r&&n[m]!==r[g]){let i=u(m,g,f),s=l(m,g,o[i].geometry);delete r[m],delete n[g],n[h(d,o[s].geometry,!0)]=s,o[i].geometry=null}else m in n?l(m,g,f):g in r?u(m,g,f):(a(c),r[m]=s-1,n[g]=s-1)}return o.filter(i=>i.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((i,r)=>i.sortKey-r.sortKey)}update(i,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,r,this.layers,n),this.icon.programConfigurations.updatePaintArrays(i,r,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,r){let n=this.lineVertexArray.length;if(void 0!==i.segment){let n=i.dist(r[i.segment+1]),o=i.dist(r[i.segment]),s={};for(let o=i.segment+1;o<r.length;o++)s[o]={x:r[o].x,y:r[o].y,tileUnitDistanceFromAnchor:n},o<r.length-1&&(n+=r[o+1].dist(r[o]));for(let n=i.segment||0;n>=0;n--)s[n]={x:r[n].x,y:r[n].y,tileUnitDistanceFromAnchor:o},n>0&&(o+=r[n-1].dist(r[n]));for(let i=0;i<r.length;i++){let r=s[i];this.lineVertexArray.emplaceBack(r.x,r.y,r.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(i,r,n,o,s,a,l,u,h,c,p,f){let d=i.indexArray,m=i.layoutVertexArray,g=i.segments.prepareSegment(4*r.length,m,d,this.canOverlap?a.sortKey:void 0),y=this.glyphOffsetArray.length,_=g.vertexLength,v=this.allowVerticalPlacement&&l===aw.vertical?Math.PI/2:0,x=a.text&&a.text.sections;for(let o=0;o<r.length;o++){let{tl:s,tr:l,bl:h,br:c,tex:p,pixelOffsetTL:y,pixelOffsetBR:_,minFontScaleX:b,minFontScaleY:w,glyphOffset:E,isSDF:I,sectionIndex:S}=r[o],M=g.vertexLength,T=E[1];a6(m,u.x,u.y,s.x,T+s.y,p.x,p.y,n,I,y.x,y.y,b,w),a6(m,u.x,u.y,l.x,T+l.y,p.x+p.w,p.y,n,I,_.x,y.y,b,w),a6(m,u.x,u.y,h.x,T+h.y,p.x,p.y+p.h,n,I,y.x,_.y,b,w),a6(m,u.x,u.y,c.x,T+c.y,p.x+p.w,p.y+p.h,n,I,_.x,_.y,b,w),a8(i.dynamicLayoutVertexArray,u,v),d.emplaceBack(M,M+1,M+2),d.emplaceBack(M+1,M+2,M+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(E[0]),o!==r.length-1&&S===r[o+1].sectionIndex||i.programConfigurations.populatePaintArrays(m.length,a,a.index,{},f,x&&x[S])}i.placedSymbolArray.emplaceBack(u.x,u.y,y,this.glyphOffsetArray.length-y,_,h,c,u.segment,n?n[0]:0,n?n[1]:0,o[0],o[1],l,0,!1,0,p)}_commitLayoutVertex(i,r,n,o,s){i.emplaceBack(r.x,r.y,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(i,r,n,o,s){let a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,h=s.anchorX,c=s.anchorY;for(let i=0;i<4;i++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-i.padding,-i.padding),n.collisionVertexArrayExt.emplaceBack(r,i.padding,-i.padding),n.collisionVertexArrayExt.emplaceBack(r,i.padding,i.padding),n.collisionVertexArrayExt.emplaceBack(r,-i.padding,i.padding),this._commitLayoutVertex(n.layoutVertexArray,o,h,c,new u(i.x1,i.y1)),this._commitLayoutVertex(n.layoutVertexArray,o,h,c,new u(i.x2,i.y1)),this._commitLayoutVertex(n.layoutVertexArray,o,h,c,new u(i.x2,i.y2)),this._commitLayoutVertex(n.layoutVertexArray,o,h,c,new u(i.x1,i.y2)),a.vertexLength+=4;let p=n.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(i,r,n,o,s,a){for(let l=o;l<s;l++){let o=n.get(l),s=this.getSymbolInstanceTextSize(i,a,r,l);this._addCollisionDebugVertices(o,s,this.textCollisionBox,o.anchorPoint,a)}}_addIconDebugCollisionBoxes(i,r,n,o,s,a){for(let l=o;l<s;l++){let o=n.get(l),s=this.getSymbolInstanceIconSize(i,r,l);this._addCollisionDebugVertices(o,s,this.iconCollisionBox,o.anchorPoint,a)}}generateCollisionDebugBuffers(i,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a7(nT,s1.members,nO),this.iconCollisionBox=new a7(nT,s1.members,nO);let n=s4(this.iconSizeData,i),o=s4(this.textSizeData,i);for(let s=0;s<this.symbolInstances.length;s++){let a=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(o,i,r,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(o,i,r,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,i,r,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,i,r,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(i,r,n,o){let s=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:o),a=s5(this.textSizeData,i,s)/24;return this.tilePixelRatio*a}getSymbolInstanceIconSize(i,r,n){let o=this.icon.placedSymbolArray.get(n),s=s5(this.iconSizeData,i,o);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(i,r,n){i.emplaceBack(r,-n,-n),i.emplaceBack(r,n,-n),i.emplaceBack(r,n,n),i.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(i,r,n,o,s,a){for(let l=o;l<s;l++){let o=n.get(l),s=this.getSymbolInstanceTextSize(i,a,r,l);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,s,o.padding)}}_updateIconDebugCollisionBoxes(i,r,n,o,s){for(let a=o;a<s;a++){let o=n.get(a),s=this.getSymbolInstanceIconSize(i,r,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,s,o.padding)}}updateCollisionDebugBuffers(i,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let n=s4(this.iconSizeData,i),o=s4(this.textSizeData,i);for(let s=0;s<this.symbolInstances.length;s++){let a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(o,i,r,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(o,i,r,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,i,r,a.iconBoxStartIndex,a.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,i,r,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,r,n,o,s,a,l,u,h){let c={};for(let o=r;o<n;o++){let r=i.get(o);c.textBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,anchorPointX:r.anchorPointX,anchorPointY:r.anchorPointY},c.textFeatureIndex=r.featureIndex;break}for(let r=o;r<s;r++){let n=i.get(r);c.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalTextFeatureIndex=n.featureIndex;break}for(let r=a;r<l;r++){let n=i.get(r);c.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.iconFeatureIndex=n.featureIndex;break}for(let r=u;r<h;r++){let n=i.get(r);c.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalIconFeatureIndex=n.featureIndex;break}return c}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,r){let n=i.placedSymbolArray.get(r),o=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<o;r+=4)i.indexArray.emplaceBack(r,r+1,r+2),i.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let r=Math.sin(i),n=Math.cos(i),o=[],s=[],a=[];for(let i=0;i<this.symbolInstances.length;++i){a.push(i);let l=this.symbolInstances.get(i);o.push(0|Math.round(r*l.anchorX+n*l.anchorY)),s.push(l.featureIndex)}return a.sort((i,r)=>o[i]-o[r]||s[r]-s[i]),a}addToSortKeyRanges(i,r){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let r of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let i=this.symbolInstances.get(r);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((i,r,n)=>{i>=0&&n.indexOf(i)===r&&this.addIndicesForPlacedSymbol(this.text,i)}),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rc("SymbolBucket",lt,{omit:["layers","collisionBoxArray","features","compareText"]}),lt.MAX_GLYPHS=65535,lt.addDynamicAttributes=a8;let le=new nh({"symbol-placement":new no(tN.layout_symbol["symbol-placement"]),"symbol-spacing":new no(tN.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new no(tN.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ns(tN.layout_symbol["symbol-sort-key"]),"symbol-z-order":new no(tN.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new no(tN.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new no(tN.layout_symbol["icon-ignore-placement"]),"icon-optional":new no(tN.layout_symbol["icon-optional"]),"icon-rotation-alignment":new no(tN.layout_symbol["icon-rotation-alignment"]),"icon-size":new ns(tN.layout_symbol["icon-size"]),"icon-text-fit":new no(tN.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new no(tN.layout_symbol["icon-text-fit-padding"]),"icon-image":new ns(tN.layout_symbol["icon-image"]),"icon-rotate":new ns(tN.layout_symbol["icon-rotate"]),"icon-padding":new no(tN.layout_symbol["icon-padding"]),"icon-keep-upright":new no(tN.layout_symbol["icon-keep-upright"]),"icon-offset":new ns(tN.layout_symbol["icon-offset"]),"icon-anchor":new ns(tN.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new no(tN.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new no(tN.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new no(tN.layout_symbol["text-rotation-alignment"]),"text-field":new ns(tN.layout_symbol["text-field"]),"text-font":new ns(tN.layout_symbol["text-font"]),"text-size":new ns(tN.layout_symbol["text-size"]),"text-max-width":new ns(tN.layout_symbol["text-max-width"]),"text-line-height":new ns(tN.layout_symbol["text-line-height"]),"text-letter-spacing":new ns(tN.layout_symbol["text-letter-spacing"]),"text-justify":new ns(tN.layout_symbol["text-justify"]),"text-radial-offset":new ns(tN.layout_symbol["text-radial-offset"]),"text-variable-anchor":new no(tN.layout_symbol["text-variable-anchor"]),"text-anchor":new ns(tN.layout_symbol["text-anchor"]),"text-max-angle":new no(tN.layout_symbol["text-max-angle"]),"text-writing-mode":new no(tN.layout_symbol["text-writing-mode"]),"text-rotate":new ns(tN.layout_symbol["text-rotate"]),"text-padding":new no(tN.layout_symbol["text-padding"]),"text-keep-upright":new no(tN.layout_symbol["text-keep-upright"]),"text-transform":new ns(tN.layout_symbol["text-transform"]),"text-offset":new ns(tN.layout_symbol["text-offset"]),"text-allow-overlap":new no(tN.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new no(tN.layout_symbol["text-ignore-placement"]),"text-optional":new no(tN.layout_symbol["text-optional"])});var li={paint:new nh({"icon-opacity":new ns(tN.paint_symbol["icon-opacity"]),"icon-color":new ns(tN.paint_symbol["icon-color"]),"icon-halo-color":new ns(tN.paint_symbol["icon-halo-color"]),"icon-halo-width":new ns(tN.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ns(tN.paint_symbol["icon-halo-blur"]),"icon-translate":new no(tN.paint_symbol["icon-translate"]),"icon-translate-anchor":new no(tN.paint_symbol["icon-translate-anchor"]),"text-opacity":new ns(tN.paint_symbol["text-opacity"]),"text-color":new ns(tN.paint_symbol["text-color"],{runtimeType:t$,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ns(tN.paint_symbol["text-halo-color"]),"text-halo-width":new ns(tN.paint_symbol["text-halo-width"]),"text-halo-blur":new ns(tN.paint_symbol["text-halo-blur"]),"text-translate":new no(tN.paint_symbol["text-translate"]),"text-translate-anchor":new no(tN.paint_symbol["text-translate-anchor"])}),layout:le};class lr{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:tq,this.defaultValue=i}evaluate(i){if(i.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(i.formattedSection))return r.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rc("FormatSectionOverride",lr,{omit:["defaultValue"]});class ln extends of{constructor(i){super(i,li)}recalculate(i,r){if(super.recalculate(i,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let i=this.layout.get("text-writing-mode");if(i){let r=[];for(let n of i)0>r.indexOf(n)&&r.push(n);this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,r,n,o){var s;let a=this.layout.get(i).evaluate(r,{},n,o),l=this._unevaluatedLayout._values[i];return l.isDataDriven()||iP(l.value)||!a?a:(s=r.properties,a.replace(/{([^{}]+)}/g,(i,r)=>r in s?String(s[r]):""))}createBucket(i){return new lt(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let i of li.paint.overridableProperties){if(!ln.hasPaintOverride(this.layout,i))continue;let r=this.paint.get(i),n=new iC(new lr(r),r.property.specification),o=null;o="constant"===r.value.kind||"source"===r.value.kind?new iL("source",n):new ik("composite",n,r.value.zoomStops,r.value._interpolationType),this.paint._values[i]=new nr(r.property,o,r.parameters)}}_handleOverridablePaintPropertyUpdate(i,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&ln.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,r){let n=i.get("text-field"),o=li.paint.properties[r],s=!1,a=i=>{for(let r of i)if(o.overrides&&o.overrides.hasOverride(r))return void(s=!0)};if("constant"===n.value.kind&&n.value.value instanceof et)a(n.value.value.sections);else if("source"===n.value.kind){let i=r=>{s||(r instanceof es&&en(r.value)===tK?a(r.value.sections):r instanceof eh?a(r.sections):r.eachChild(i))},r=n.value;r._styleExpression&&i(r._styleExpression.expression)}return s}getProgramConfiguration(i){return new os(this,i)}}var lo={paint:new nh({"background-color":new no(tN.paint_background["background-color"]),"background-pattern":new nl(tN.paint_background["background-pattern"]),"background-opacity":new no(tN.paint_background["background-opacity"])})},ls={paint:new nh({"raster-opacity":new no(tN.paint_raster["raster-opacity"]),"raster-hue-rotate":new no(tN.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new no(tN.paint_raster["raster-brightness-min"]),"raster-brightness-max":new no(tN.paint_raster["raster-brightness-max"]),"raster-saturation":new no(tN.paint_raster["raster-saturation"]),"raster-contrast":new no(tN.paint_raster["raster-contrast"]),"raster-resampling":new no(tN.paint_raster["raster-resampling"]),"raster-fade-duration":new no(tN.paint_raster["raster-fade-duration"])})};class la extends of{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var ll={paint:new nh({"sky-type":new no(tN.paint_sky["sky-type"]),"sky-atmosphere-sun":new no(tN.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new no(tN.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new no(tN.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new no(tN.paint_sky["sky-gradient-radius"]),"sky-gradient":new nu(tN.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new no(tN.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new no(tN.paint_sky["sky-atmosphere-color"]),"sky-opacity":new no(tN.paint_sky["sky-opacity"])})};function lu(i,r,n){var o,s,a,l,u,h,c;let f=oG(0,0,1),d=oH(oW());return o=(n?-(i*p)+Math.PI:i*p)*.5,s=d[0],a=d[1],l=d[2],u=d[3],h=Math.sin(o),c=Math.cos(o),d[0]=s*c-l*h,d[1]=a*c+u*h,d[2]=l*c+s*h,d[3]=u*c-a*h,oY(d,d,-(r*p)),oX(f,f,d),oZ(f,f)}let lh={circle:class extends of{constructor(i){super(i,oD)}createBucket(i){return new ox(i)}queryRadius(i){return oP("circle-radius",this,i)+oP("circle-stroke-width",this,i)+oA(this.paint.get("circle-translate"))}queryIntersectsFeature(i,r,n,o,s,a,l,h){let c="map"===this.paint.get("circle-pitch-alignment");if(c&&i.queryGeometry.isAboveHorizon)return!1;let p=ok(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,i.pixelToTileUnitsFactor),f=this.paint.get("circle-radius").evaluate(r,n)+this.paint.get("circle-stroke-width").evaluate(r,n),d=c?f*i.pixelToTileUnitsFactor:f;for(let r of o)for(let n of r){var m;let r=n.add(p),o=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(r.x,r.y,!0):0,s=c?r:function(i,r,n){let o=o$([],[i.x,i.y,r,1],n);return new u(o[0]/o[3],o[1]/o[3])}(r,o,l),f=c?i.tilespaceRays.map(i=>(function(i,r){let n=oB();return oK[2]=r,i.intersectsPlane(oK,oJ,n),new u(n[0],n[1])})(i,o)):i.queryGeometry.screenGeometry,g=d,y=o$([],[n.x,n.y,o,1],l);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?g*=y[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(g*=a.cameraToCenterDistance/y[3]),m=g,oT(f,s)||oI(s,f,m))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new os(this,i)}},heatmap:class extends of{createBucket(i){return new oQ(i)}constructor(i){super(i,o4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o6({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new os(this,i)}},hillshade:class extends of{constructor(i){super(i,o8)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new os(this,i)}},fill:class extends of{constructor(i){super(i,sS)}getProgramIds(){let i=this.paint.get("fill-pattern"),r=i&&i.constantOr(1),n=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new os(this,i)}recalculate(i,r){super.recalculate(i,r);let n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new sE(i)}queryRadius(){return oA(this.paint.get("fill-translate"))}queryIntersectsFeature(i,r,n,o,s,a){return!i.queryGeometry.isAboveHorizon&&ow(oL(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends of{constructor(i){super(i,sB)}createBucket(i){return new sF(i)}queryRadius(){return oA(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new os(this,i)}queryIntersectsFeature(i,r,n,o,s,a,l,h,c){var p,f;let d=ok(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,i.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(r,n),g=this.paint.get("fill-extrusion-base").evaluate(r,n),y=[0,0],_=h&&a.elevation,v=a.elevation?a.elevation.exaggeration():1;if(_){let r=i.tile.getBucket(this).centroidVertexArray,n=c+1;if(n<r.length){let i=r.get(n);y[0]=i.a_centroid_pos0,y[1]=i.a_centroid_pos1}}if(0===y[0]&&1===y[1])return!1;let x=(p=_?h:null,f=a.center.lat,p?function(i,r,n,o,s,a,l,u,h){let c=[],p=[],f=[0,0,0,1];for(let d of i){let i=[],m=[];for(let c of d){let p=c.x+o.x,d=c.y+o.y,g=function(i,r,n,o,s,a,l,u){let h=l*s.getElevationAt(i,r,!0,!0),c=0!==a[0],p=c?0===a[1]?l*(a[0]/7-450):l*function(i,r,n){var o,s;let a=Math.floor(r[0]/8),l=Math.floor(r[1]/8),u=10*(r[0]-8*a),h=10*(r[1]-8*l),c=i.getElevationAt(a,l,!0,!0),p=i.getMeterToDEM(n),f=Math.floor(.5*(u*p-1)),d=Math.floor(.5*(h*p-1)),m=i.tileCoordToPixel(a,l),g=2*f+1,y=2*d+1,_=(o=m.x-f,s=m.y-d,[i.getElevationAtPixel(o,s,!0),i.getElevationAtPixel(o+y,s,!0),i.getElevationAtPixel(o,s+y,!0),i.getElevationAtPixel(o+g,s+y,!0)]),v=Math.abs(_[0]-_[1]);return c+Math.max(Math.min(.25,.5*p*(v+Math.abs(_[2]-_[3]))/g)*u,Math.min(.25,.5*p*(Math.abs(_[0]-_[2])+Math.abs(_[1]-_[3]))/y)*h)}(s,a,u):h;return{base:h+(0===n)?-1:n,top:c?Math.max(p+o,h+n+2):h+o}}(p,d,r,n,a,l,u,h);f[0]=p,f[1]=d,f[2]=g.base,f[3]=1,o$(f,f,s),f[3]=Math.max(f[3],1e-5);let y=sV([f[0]/f[3],f[1]/f[3],f[2]/f[3]]);f[0]=p,f[1]=d,f[2]=g.top,f[3]=1,o$(f,f,s),f[3]=Math.max(f[3],1e-5);let _=sV([f[0]/f[3],f[1]/f[3],f[2]/f[3]]);i.push(y),m.push(_)}c.push(i),p.push(m)}return[c,p]}(o,g,m,d,l,p,y,v,f):function(i,r,n,o,s){let a=[],l=[],h=s[8]*r,c=s[9]*r,p=s[10]*r,f=s[11]*r,d=s[8]*n,m=s[9]*n,g=s[10]*n,y=s[11]*n;for(let r of i){let i=[],n=[];for(let a of r){let r=a.x+o.x,l=a.y+o.y,_=s[0]*r+s[4]*l+s[12],v=s[1]*r+s[5]*l+s[13],x=s[2]*r+s[6]*l+s[14],b=s[3]*r+s[7]*l+s[15],w=_+h,E=v+c,I=x+p,S=Math.max(b+f,1e-5),M=_+d,T=v+m,C=x+g,P=Math.max(b+y,1e-5),A=new u(w/S,E/S);A.z=I/S,i.push(A);let L=new u(M/P,T/P);L.z=C/P,n.push(L)}a.push(i),l.push(n)}return[a,l]}(o,g,m,d,l)),b=i.queryGeometry;return function(i,r,n){let o=1/0;ow(n,r)&&(o=sG(n,r[0]));for(let s=0;s<r.length;s++){let a=r[s],l=i[s];for(let i=0;i<a.length-1;i++){let r=a[i],s=[r,a[i+1],l[i+1],l[i],r];ob(n,s)&&(o=Math.min(o,sG(n,s)))}}return o!==1/0&&o}(x[0],x[1],b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends of{constructor(i){super(i,sH),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){let i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof eN,this.gradientVersion=(this.gradientVersion+1)%0x1fffffffffffff}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=sY.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new s$(i)}getProgramIds(){let i=this.paint.get("line-dasharray"),r=this.paint.get("line-pattern").constantOr(1),n=this.paint.get("line-gradient");return[r?"linePattern":i?"lineSDF":n?"lineGradient":"line"]}getProgramConfiguration(i){return new os(this,i)}queryRadius(i){var r,n;return r=oP("line-width",this,i),((n=oP("line-gap-width",this,i))>0?n+2*r:r)/2+Math.abs(oP("line-offset",this,i))+oA(this.paint.get("line-translate"))}queryIntersectsFeature(i,r,n,o,s,a){var l,h;if(i.queryGeometry.isAboveHorizon)return!1;let c=oL(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,i.pixelToTileUnitsFactor),p=i.pixelToTileUnitsFactor/2*(l=this.paint.get("line-width").evaluate(r,n),(h=this.paint.get("line-gap-width").evaluate(r,n))>0?h+2*l:l),f=this.paint.get("line-offset").evaluate(r,n);return f&&(o=function(i,r){let n=[],o=new u(0,0);for(let s=0;s<i.length;s++){let a=i[s],l=[];for(let i=0;i<a.length;i++){let n=a[i-1],s=a[i],u=a[i+1],h=0===i?o:s.sub(n)._unit()._perp(),c=i===a.length-1?o:u.sub(s)._unit()._perp(),p=h._add(c)._unit();p._mult(1/(p.x*c.x+p.y*c.y)),l.push(p._mult(r)._add(s))}n.push(l)}return n}(o,f*i.pixelToTileUnitsFactor)),function(i,r,n){for(let o=0;o<r.length;o++){let s=r[o];if(i.length>=3){for(let r=0;r<s.length;r++)if(oT(i,s[r]))return!0}if(function(i,r,n){if(i.length>1){if(oE(i,r))return!0;for(let o=0;o<r.length;o++)if(oI(r[o],i,n))return!0}for(let o=0;o<i.length;o++)if(oI(i[o],r,n))return!0;return!1}(i,s,n))return!0}return!1}(c,o,p)}isTileClipped(){return!0}},symbol:ln,background:class extends of{constructor(i){super(i,lo)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends of{constructor(i){super(i,ls)}getProgramIds(){return["raster"]}},sky:class extends of{constructor(i){super(i,ll),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=o6({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let r=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(i,r){let n=this.paint.get("sky-type");if("atmosphere"===n){let n=this.paint.get("sky-atmosphere-sun"),o=!n,s=i.style.light,a=s.properties.get("position");return o&&"viewport"===s.properties.get("anchor")&&D("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?lu(a.azimuthal,90-a.polar,r):lu(n[0],90-n[1],r)}if("gradient"===n){let i=this.paint.get("sky-gradient-center");return lu(i[0],90-i[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:lc,HTMLCanvasElement:lp,HTMLVideoElement:lf,ImageData:ld,ImageBitmap:lm}=c;class lg{constructor(i,r,n,o){this.context=i,this.format=n,this.texture=i.gl.createTexture(),this.update(r,o)}update(i,r,n){let{width:o,height:s}=i,a=!(this.size&&this.size[0]===o&&this.size[1]===s||n),{context:l}=this,{gl:u}=l;if(this.useMipmap=!!(r&&r.useMipmap),u.bindTexture(u.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===u.RGBA&&(!r||!1!==r.premultiply)),a)this.size=[o,s],i instanceof lc||i instanceof lp||i instanceof lf||i instanceof ld||lm&&i instanceof lm?u.texImage2D(u.TEXTURE_2D,0,this.format,this.format,u.UNSIGNED_BYTE,i):u.texImage2D(u.TEXTURE_2D,0,this.format,o,s,0,this.format,u.UNSIGNED_BYTE,i.data);else{let{x:r,y:a}=n||{x:0,y:0};i instanceof lc||i instanceof lp||i instanceof lf||i instanceof ld||lm&&i instanceof lm?u.texSubImage2D(u.TEXTURE_2D,0,r,a,u.RGBA,u.UNSIGNED_BYTE,i):u.texSubImage2D(u.TEXTURE_2D,0,r,a,o,s,u.RGBA,u.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&u.generateMipmap(u.TEXTURE_2D)}bind(i,r,n){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),n!==s.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=s.LINEAR),i!==this.filter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,n||i),this.filter=i),r!==this.wrap&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class ly{constructor(i,r){i&&(r?this.setSouthWest(i).setNorthEast(r):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof l_?new l_(i.lng,i.lat):l_.convert(i),this}setSouthWest(i){return this._sw=i instanceof l_?new l_(i.lng,i.lat):l_.convert(i),this}extend(i){let r,n;let o=this._sw,s=this._ne;if(i instanceof l_)r=i,n=i;else{if(!(i instanceof ly))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(ly.convert(i)):this.extend(l_.convert(i)):this;if(r=i._sw,n=i._ne,!r||!n)return this}return o||s?(o.lng=Math.min(r.lng,o.lng),o.lat=Math.min(r.lat,o.lat),s.lng=Math.max(n.lng,s.lng),s.lat=Math.max(n.lat,s.lat)):(this._sw=new l_(r.lng,r.lat),this._ne=new l_(n.lng,n.lat)),this}getCenter(){return new l_((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l_(this.getWest(),this.getNorth())}getSouthEast(){return new l_(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){let{lng:r,lat:n}=l_.convert(i),o=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&o}static convert(i){return!i||i instanceof ly?i:new ly(i)}}class l_{constructor(i,r){if(isNaN(i)||isNaN(r))throw Error(`Invalid LngLat object: (${i}, ${r})`);if(this.lng=+i,this.lat=+r,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new l_(v(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){let r=Math.PI/180,n=this.lat*r,o=i.lat*r;return 6371008.8*Math.acos(Math.min(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((i.lng-this.lng)*r),1))}toBounds(i=0){let r=360*i/0x2637f09,n=r/Math.cos(Math.PI/180*this.lat);return new ly(new l_(this.lng-n,this.lat-r),new l_(this.lng+n,this.lat+r))}static convert(i){if(i instanceof l_)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new l_(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new l_(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let lv=2*Math.PI*6371008.8;function lx(i){return lv*Math.cos(i*Math.PI/180)}function lb(i){return(180+i)/360}function lw(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function lE(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function lI(i,r){return i*lx(lE(r))}class lS{constructor(i,r,n=0){this.x=+i,this.y=+r,this.z=+n}static fromLngLat(i,r=0){let n=l_.convert(i);return new lS(lb(n.lng),lw(n.lat),r/lx(n.lat))}toLngLat(){return new l_(360*this.x-180,lE(this.y))}toAltitude(){return lI(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lv*(1/Math.cos(lE(this.y)*Math.PI/180))}}class lM{constructor(i,r){this.width=i,this.height=r,this.nextRow=0,this.image=new o3({width:i,height:r}),this.positions={},this.uploaded=!1}getDash(i,r){let n=this.getKey(i,r);return this.positions[n]}trim(){let i=this.width,r=this.height=M(this.nextRow);this.image.resize({width:i,height:r})}getKey(i,r){return i.join(",")+r}getDashRanges(i,r,n){let o=[],s=i.length%2==1?-i[i.length-1]*n:0,a=i[0]*n,l=!0;o.push({left:s,right:a,isDash:l,zeroLength:0===i[0]});let u=i[0];for(let r=1;r<i.length;r++){l=!l;let h=i[r];s=u*n,u+=h,a=u*n,o.push({left:s,right:a,isDash:l,zeroLength:0===h})}return o}addRoundDash(i,r,n){let o=r/2;for(let r=-n;r<=n;r++){let s=this.width*(this.nextRow+n+r),a=0,l=i[0];for(let u=0;u<this.width;u++){let h;u/l.right>1&&(l=i[++a]);let c=Math.min(Math.abs(u-l.left),Math.abs(u-l.right)),p=r/n*(o+1);if(l.isDash){let i=o-Math.abs(p);h=Math.sqrt(c*c+i*i)}else h=o-Math.sqrt(c*c+p*p);this.image.data[s+u]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(i,r){for(let r=i.length-1;r>=0;--r){let n=i[r],o=i[r+1];n.zeroLength?i.splice(r,1):o&&o.isDash===n.isDash&&(o.left=n.left,i.splice(r,1))}let n=i[0],o=i[i.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);let s=this.width*this.nextRow,a=0,l=i[0];for(let n=0;n<this.width;n++){n/l.right>1&&(l=i[++a]);let o=Math.min(Math.abs(n-l.left),Math.abs(n-l.right));this.image.data[s+n]=Math.max(0,Math.min(255,(l.isDash?o:-o)+r+128))}}addDash(i,r){let n=this.getKey(i,r);if(this.positions[n])return this.positions[n];let o="round"===r,s=7*!!o,a=2*s+1;if(this.nextRow+a>this.height)return D("LineAtlas out of space"),null;0===i.length&&i.push(1);let l=0;for(let r=0;r<i.length;r++)i[r]<0&&(D("Negative value is found in line dasharray, replacing values with 0"),i[r]=0),l+=i[r];if(0!==l){let n=this.width/l,a=this.getDashRanges(i,this.width,n);o?this.addRoundDash(a,n,s):this.addRegularDash(a,"square"===r?.5*n:0)}let u=this.nextRow+s;this.nextRow+=a;let h={tl:[u,s],br:[l,0]};return this.positions[n]=h,h}}rc("LineAtlas",lM);class lT{constructor(i){this._callback=i,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let lC=c.performance;function lP(i){let r=i?i.url.toString():void 0;return lC.getEntriesByName(r)}class lA{constructor(){this.tasks={},this.taskQueue=[],C(["process"],this),this.invoker=new lT(this.process),this.nextId=0}add(i,r){let n=this.nextId++,o=function({type:i,isSymbolTile:r,zoom:n}){return n=n||0,"message"===i?0:"maybePrepare"!==i||r?"parseTile"!==i||r?"parseTile"===i&&r?300-n:"maybePrepare"===i&&r?400-n:500:200-n:100-n}(r);return 0===o?(O(),i(),{cancel:()=>{}}):(this.tasks[n]={fn:i,metadata:r,priority:o,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}})}process(){O();{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;let i=this.pick();if(null===i)return;let r=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}}pick(){let i=null,r=1/0;for(let n=0;n<this.taskQueue.length;n++){let o=this.tasks[this.taskQueue[n]];o.priority<r&&(r=o.priority,i=n)}if(null===i)return null;let n=this.taskQueue[i];return this.taskQueue.splice(i,1),n}remove(){this.invoker.remove()}}function lL(i,r,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,r*o-2*Math.PI*6378137/2]}class lk{constructor(i,r,n){this.z=i,this.x=r,this.y=n,this.key=lN(0,i,i,r,n)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,r){var n,o,s,a,l;let u=(o=this.y,s=this.z,a=lL(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=lL(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]),h=function(i,r,n){let o,s="";for(let a=i;a>0;a--)s+=(r&(o=1<<a-1)?1:0)+(n&o?2:0);return s}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}getTilePoint(i){let r=Math.pow(2,this.z);return new u((i.x*r-this.x)*8192,(i.y*r-this.y)*8192)}getTileVec3(i){let r=Math.pow(2,this.z);return oG((i.x*r-this.x)*8192,(i.y*r-this.y)*8192,lI(i.z,i.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class lR{constructor(i,r){this.wrap=i,this.canonical=r,this.key=lN(i,r.z,r.z,r.x,r.y)}}class lD{constructor(i,r,n,o,s){this.overscaledZ=i,this.wrap=r,this.canonical=new lk(n,+o,+s),this.key=0===r&&i===n?this.canonical.key:lN(r,i,n,o,s)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){let r=this.canonical.z-i;return i>this.canonical.z?new lD(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lD(i,this.wrap,i,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(i,r=!0){if(this.overscaledZ===i&&r)return this.key;if(i>this.canonical.z)return lN(this.wrap*+r,i,this.canonical.z,this.canonical.x,this.canonical.y);{let n=this.canonical.z-i;return lN(this.wrap*+r,i,i,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;let r=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>r&&i.canonical.y===this.canonical.y>>r}children(i){if(this.overscaledZ>=i)return[new lD(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,n=2*this.canonical.x,o=2*this.canonical.y;return[new lD(r,this.wrap,r,n,o),new lD(r,this.wrap,r,n+1,o),new lD(r,this.wrap,r,n,o+1),new lD(r,this.wrap,r,n+1,o+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new lD(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new lD(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lR(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new lS(i.x-this.wrap,i.y))}getTileVec3(i){return this.canonical.getTileVec3(new lS(i.x-this.wrap,i.y,i.z))}}function lN(i,r,n,o,s){let a=1<<Math.min(n,22),l=s%a*a+o%a;return i&&n<22&&(l+=a*a*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*l+n)+(r-n)}rc("CanonicalTileID",lk),rc("OverscaledTileID",lD,{omit:["projMatrix"]});class lO{constructor(i){this._stringToNumber={},this._numberToString=[];for(let r=0;r<i.length;r++){let n=i[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class lz{constructor(i,r,n,o,s){this.type="Feature",this._vectorTileFeature=i,i._z=r,i._x=n,i._y=o,this.properties=i.properties,this.id=s}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){let i={geometry:this.geometry};for(let r in this)"_geometry"!==r&&"_vectorTileFeature"!==r&&(i[r]=this[r]);return i}}var lF=nm([{name:"a_pos",type:"Int16",components:2}]);class lB{constructor(i,r,n){this.tileID=i,this.uid=I(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){let r=i+this.timeAdded;r<j.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(i,r,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(let o in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(i,r){let n={};if(!r)return n;for(let o of i){let i=o.layerIds.map(i=>r.getLayer(i)).filter(Boolean);if(0!==i.length)for(let r of(o.layers=i,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map(r=>i.filter(i=>i.id===r)[0])),i))n[r.id]=o}return n}(i.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){let i=this.buckets[o];if(i instanceof lt){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let i in this.buckets){let r=this.buckets[i];if(r instanceof lt&&r.hasRTLText){this.hasRTLText=!0,r4.isLoading()||r4.isLoaded()||"deferred"!==r3()||r5();break}}for(let i in this.queryPadding=0,this.buckets){let n=this.buckets[i];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(i).queryRadius(n))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new nU}unloadVectorData(){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(let r in this.buckets){let n=this.buckets[r];n.uploadPending()&&n.upload(i)}let r=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new lg(i,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new lg(i,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new lg(i,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,r,n,o,s,a,l,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:o,pixelPosMatrix:l,transform:a,params:s},i,r,n):{}}querySourceFeatures(i,r){let n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;let o=n.loadVTLayers(),s=r?r.sourceLayer:"",a=o._geojsonTileLayer||o[s];if(!a)return;let l=iq(r&&r.filter),{z:u,x:h,y:c}=this.tileID.canonical,p={z:u,x:h,y:c};for(let r=0;r<a.length;r++){let o=a.feature(r);if(l.needGeometry){let i=o_(o,!0);if(!l.filter(new r6(this.tileID.overscaledZ),i,this.tileID.canonical))continue}else if(!l.filter(new r6(this.tileID.overscaledZ),o))continue;let f=n.getId(o,s),d=new lz(o,u,h,c,f);d.tile=p,i.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){let r=this.expirationTime;if(i.cacheControl){let r=z(i.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){let i=Date.now(),n=!1;if(this.expirationTime>i)n=!1;else if(r){if(this.expirationTime<r)n=!0;else{let o=this.expirationTime-r;o?this.expirationTime=i+Math.max(o,3e4):n=!0}}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),0x7fffffff)}setFeatureState(i,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length)return;let n=this.latestFeatureIndex.loadVTLayers();for(let o in this.buckets){if(!r.style.hasLayer(o))continue;let s=this.buckets[o],a=s.layers[0].sourceLayer||"_geojsonTileLayer",l=n[a],u=i[a];if(!l||!u||0===Object.keys(u).length)continue;s.update(u,l,this.imageAtlas&&this.imageAtlas.patternPositions||{});let h=r&&r.style&&r.style.getLayer(o);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=j.now()+i}setDependencies(i,r){let n={};for(let i of r)n[i]=!0;this.dependencies[i]=n}hasDependency(i,r){for(let n of i){let i=this.dependencies[n];if(i){for(let n of r)if(i[n])return!0}}return!1}clearQueryDebugViz(){}}class lU{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,r,n){let o=String(r);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][o]=this.stateChanges[i][o]||{},w(this.stateChanges[i][o],n),null===this.deletedStates[i])for(let r in this.deletedStates[i]={},this.state[i])r!==o&&(this.deletedStates[i][r]=null);else if(this.deletedStates[i]&&null===this.deletedStates[i][o])for(let r in this.deletedStates[i][o]={},this.state[i][o])n[r]||(this.deletedStates[i][o][r]=null);else for(let r in n)this.deletedStates[i]&&this.deletedStates[i][o]&&null===this.deletedStates[i][o][r]&&delete this.deletedStates[i][o][r]}removeFeatureState(i,r,n){if(null===this.deletedStates[i])return;let o=String(r);if(this.deletedStates[i]=this.deletedStates[i]||{},n&&void 0!==r)null!==this.deletedStates[i][o]&&(this.deletedStates[i][o]=this.deletedStates[i][o]||{},this.deletedStates[i][o][n]=null);else if(void 0!==r){if(this.stateChanges[i]&&this.stateChanges[i][o])for(n in this.deletedStates[i][o]={},this.stateChanges[i][o])this.deletedStates[i][o][n]=null;else this.deletedStates[i][o]=null}else this.deletedStates[i]=null}getState(i,r){let n=String(r),o=w({},(this.state[i]||{})[n],(this.stateChanges[i]||{})[n]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){let n=this.deletedStates[i][r];if(null===n)return{};for(let i in n)delete o[i]}return o}initializeTileState(i,r){i.setFeatureState(this.state,r)}coalesceChanges(i,r){let n={};for(let i in this.stateChanges){this.state[i]=this.state[i]||{};let r={};for(let n in this.stateChanges[i])this.state[i][n]||(this.state[i][n]={}),w(this.state[i][n],this.stateChanges[i][n]),r[n]=this.state[i][n];n[i]=r}for(let i in this.deletedStates){this.state[i]=this.state[i]||{};let r={};if(null===this.deletedStates[i])for(let n in this.state[i])r[n]={},this.state[i][n]={};else for(let n in this.deletedStates[i]){if(null===this.deletedStates[i][n])this.state[i][n]={};else for(let r of Object.keys(this.deletedStates[i][n]))delete this.state[i][n][r];r[n]=this.state[i][n]}n[i]=n[i]||{},w(n[i],r)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(let o in i)i[o].setFeatureState(n,r)}}class lG{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,r){let n=this.toIdx(i,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(i,r){return this.leaves[this.toIdx(i,r)]}toIdx(i,r){return r*this.size+i}}function lV(i,r,n,o){let s=0,a=Number.MAX_VALUE;for(let l=0;l<3;l++)if(1e-15>Math.abs(o[l])){if(n[l]<i[l]||n[l]>r[l])return null}else{let u=1/o[l],h=(i[l]-n[l])*u,c=(r[l]-n[l])*u;if(h>c){let i=h;h=c,c=i}if(h>s&&(s=h),c<a&&(a=c),s>a)return null}return s}function lq(i,r,n,o,s,a,l,u,h,c,p){let f=o-i,d=s-r,m=a-n,g=l-i,y=u-r,_=h-n,v=p[1]*_-p[2]*y,x=p[2]*g-p[0]*_,b=p[0]*y-p[1]*g,w=f*v+d*x+m*b;if(1e-15>Math.abs(w))return null;let E=1/w,I=c[0]-i,S=c[1]-r,M=c[2]-n,T=(I*v+S*x+M*b)*E;if(T<0||T>1)return null;let C=S*m-M*d,P=M*f-I*m,A=I*d-S*f,L=(p[0]*C+p[1]*P+p[2]*A)*E;return L<0||T+L>1?null:(g*C+y*P+_*A)*E}function lj(i,r,n,o,s,a,l,u,h){let c=1<<n,p=a-o,f=l-s;u[0]=(i+0)/c*p+o,u[1]=(r+0)/c*f+s,h[0]=(i+1)/c*p+o,h[1]=(r+1)/c*f+s}class lZ{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(i){let r=Math.ceil(Math.log2(i.dim/8)),n=[],o=Math.ceil(Math.pow(2,r)),s=1/o,a=(i,r,n,o,s)=>{let a=+!!o;s[0]=i*n,s[1]=r*n,s[2]=(i+1)*n-a,s[3]=(r+1)*n-a},l=new lG(o),u=[];for(let r=0;r<o*o;r++){a(r%o,Math.floor(r/o),s,!1,u);let n=l$(u[0],u[1],i),h=l$(u[2],u[1],i),c=l$(u[2],u[3],i),p=l$(u[0],u[3],i);l.minimums.push(Math.min(n,h,c,p)),l.maximums.push(Math.max(n,h,c,p)),l.leaves.push(1)}for(n.push(l),o/=2;o>=1;o/=2){let i=n[n.length-1];l=new lG(o);for(let r=0;r<o*o;r++){a(r%o,Math.floor(r/o),2,!0,u);let n=i.getElevation(u[0],u[1]),s=i.getElevation(u[2],u[1]),h=i.getElevation(u[2],u[3]),c=i.getElevation(u[0],u[3]),p=i.isLeaf(u[0],u[1]),f=i.isLeaf(u[2],u[1]),d=i.isLeaf(u[2],u[3]),m=i.isLeaf(u[0],u[3]),g=Math.min(n.min,s.min,h.min,c.min),y=Math.max(n.max,s.max,h.max,c.max),_=p&&f&&d&&m;l.maximums.push(y),l.minimums.push(g),l.leaves.push(y-g<=5&&_?1:0)}n.push(l)}return n}(this.dem),n=r.length-1,o=r[n];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(i,r,n,o,s,a,l=1){return lV([i,r,-100],[n,o,this.maximums[0]*l],s,a)}raycast(i,r,n,o,s,a,l=1){if(!this.nodeCount)return null;let u=this.raycastRoot(i,r,n,o,s,a,l);if(null==u)return null;let h=[],c=[],p=[],f=[],d=[{idx:0,t:u,nodex:0,nodey:0,depth:0}];for(;d.length>0;){let{idx:u,t:y,nodex:_,nodey:v,depth:x}=d.pop();if(this.leaves[u]){lj(_,v,x,i,r,n,o,p,f);let u=1<<x,h=(_+0)/u,c=(_+1)/u,d=(v+0)/u,b=(v+1)/u,w=l$(h,d,this.dem)*l,E=l$(c,d,this.dem)*l,I=l$(c,b,this.dem)*l,S=l$(h,b,this.dem)*l,M=lq(p[0],p[1],w,f[0],p[1],E,f[0],f[1],I,s,a),T=lq(f[0],f[1],I,p[0],f[1],S,p[0],p[1],w,s,a),C=Math.min(null!==M?M:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(C!==Number.MAX_VALUE)return C;{var m,g;let i=oj([],s,a,y);if(lX(w,E,S,I,(i[0]-(m=p[0]))/(f[0]-m),(i[1]-(g=p[1]))/(f[1]-g))>=i[2])return y}continue}let b=0;for(let d=0;d<this._siblingOffset.length;d++){lj((_<<1)+this._siblingOffset[d][0],(v<<1)+this._siblingOffset[d][1],x+1,i,r,n,o,p,f),p[2]=-100,f[2]=this.maximums[this.childOffsets[u]+d]*l;let m=lV(p,f,s,a);if(null!=m){h[d]=m;let i=!1;for(let r=0;r<b&&!i;r++)m>=h[c[r]]&&(c.splice(r,0,d),i=!0);i||(c[b]=d),b++}}for(let i=0;i<b;i++){let r=c[i];d.push({idx:this.childOffsets[u]+r,t:h[r],nodex:(_<<1)+this._siblingOffset[r][0],nodey:(v<<1)+this._siblingOffset[r][1],depth:x+1})}}return null}_addNode(i,r,n){return this.minimums.push(i),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(i,r,n,o,s){if(1===i[o].isLeaf(r,n))return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);let a=o-1,l=i[a],u,h=0;for(let i=0;i<this._siblingOffset.length;i++){let o=2*r+this._siblingOffset[i][0],s=2*n+this._siblingOffset[i][1],a=l.getElevation(o,s),c=l.isLeaf(o,s),p=this._addNode(a.min,a.max,c);c&&(h|=1<<i),u||(u=p)}for(let o=0;o<this._siblingOffset.length;o++)h&1<<o||this._construct(i,2*r+this._siblingOffset[o][0],2*n+this._siblingOffset[o][1],a,u+o)}}function lX(i,r,n,o,s,a){return eO(eO(i,n,a),eO(r,o,a),s)}function l$(i,r,n){let o=n.dim,s=_(i*o-.5,0,o-1),a=_(r*o-.5,0,o-1),l=Math.floor(s),u=Math.floor(a),h=Math.min(l+1,o-1),c=Math.min(u+1,o-1);return lX(n.get(l,u),n.get(h,u),n.get(l,c),n.get(h,c),s-l,a-u)}let lW={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class lH{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,r,n,o=!1,s=!1){if(this.uid=i,r.height!==r.width)throw RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return D(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let a=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=o,!o){for(let i=0;i<a;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(a,i)]=this.data[this._idx(a-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,a)]=this.data[this._idx(i,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],s&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new lZ(this)}get(i,r,n=!1){let o=new Uint8Array(this.data.buffer);n&&(i=_(i,-1,this.dim),r=_(r,-1,this.dim));let s=4*this._idx(i,r);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(o[s],o[s+1],o[s+2])}static getUnpackVector(i){return lW[i]}get unpackVector(){return lW[this.encoding]}_idx(i,r){if(i<-1||i>=this.dim+1||r<-1||r>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(i+1)}_unpackMapbox(i,r,n){return(256*i*256+256*r+n)/10-1e4}_unpackTerrarium(i,r,n){return 256*i+r+n/256-32768}static pack(i,r){let n=[0,0,0,0],o=lH.getUnpackVector(r),s=Math.floor((i+o[3])/o[2]);return n[2]=s%256,s=Math.floor(s/256),n[1]=s%256,s=Math.floor(s/256),n[0]=s,n}getPixels(){return new o5({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,r,n){if(this.dim!==i.dim)throw Error("dem dimension mismatch");let o=r*this.dim,s=r*this.dim+this.dim,a=n*this.dim,l=n*this.dim+this.dim;switch(r){case -1:o=s-1;break;case 1:s=o+1}switch(n){case -1:a=l-1;break;case 1:l=a+1}let u=-r*this.dim,h=-n*this.dim;for(let r=a;r<l;r++)for(let n=o;n<s;n++)this.data[this._idx(n,r)]=i.data[this._idx(n+u,r+h)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}rc("DEMData",lH),rc("DemMinMaxQuadTree",lZ,{omit:["dem"]});class lY{constructor(i,r){this.max=i,this.onRemove=r,this.reset()}reset(){for(let i in this.data)for(let r of this.data[i])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(i,r,n){let o=i.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);let s={value:r,timeout:void 0};if(void 0!==n&&(s.timeout=setTimeout(()=>{this.remove(i,s)},n)),this.data[o].push(s),this.order.push(o),this.order.length>this.max){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){let r=this.data[i].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),r.value}getByKey(i){let r=this.data[i];return r?r[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,r){if(!this.has(i))return this;let n=i.wrapped().key,o=void 0===r?0:this.data[n].indexOf(r),s=this.data[n][o];return this.data[n].splice(o,1),s.timeout&&clearTimeout(s.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(s.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(i){let r=[];for(let n in this.data)for(let o of this.data[n])i(o.value)||r.push(o);for(let i of r)this.remove(i.value.tileID,i)}}class lK{constructor(i,r,n){this.func=i,this.mask=r,this.range=n}}lK.ReadOnly=!1,lK.ReadWrite=!0,lK.disabled=new lK(519,lK.ReadOnly,[0,1]);class lJ{constructor(i,r,n,o,s,a){this.test=i,this.ref=r,this.mask=n,this.fail=o,this.depthFail=s,this.pass=a}}lJ.disabled=new lJ({func:519,mask:0},0,0,7680,7680,7680);class lQ{constructor(i,r,n){this.blendFunction=i,this.blendColor=r,this.mask=n}}lQ.Replace=[1,0],lQ.disabled=new lQ(lQ.Replace,t8.transparent,[!1,!1,!1,!1]),lQ.unblended=new lQ(lQ.Replace,t8.transparent,[!0,!0,!0,!0]),lQ.alphaBlended=new lQ([1,771],t8.transparent,[!0,!0,!0,!0]);class l0{constructor(i,r,n){this.enable=i,this.mode=r,this.frontFace=n}}l0.disabled=new l0(!1,1029,2305),l0.backCCW=new l0(!0,1029,2305),l0.backCW=new l0(!0,1029,2304),l0.frontCW=new l0(!0,1028,2304),l0.frontCCW=new l0(!0,1028,2305);class l1 extends tD{constructor(i,r,n){super(),this.id=i,this._onlySymbols=n,r.on("data",i=>{"source"===i.dataType&&"metadata"===i.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===i.dataType&&"content"===i.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new lY(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new lU}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let i in this._tiles){let r=this._tiles[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,r){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,r)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){for(let r in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let n=this._tiles[r];n.upload(i),n.prepare(this.map.style.imageManager)}}getIds(){return b(this._tiles).map(i=>i.tileID).sort(l2).map(i=>i.key)}getRenderableIds(i){let r=[];for(let n in this._tiles)this._isIdRenderable(+n,i)&&r.push(this._tiles[n]);return i?r.sort((i,r)=>{let n=i.tileID,o=r.tileID,s=new u(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),a=new u(o.canonical.x,o.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-o.overscaledZ||a.y-s.y||a.x-s.x}).map(i=>i.tileID.key):r.map(i=>i.tileID).sort(l2).map(i=>i.key)}hasRenderableParent(i){let r=this.findLoadedParent(i,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(i,r){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(r||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let i in this._cache.reset(),this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}_reloadTile(i,r){let n=this._tiles[i];n&&("loading"!==n.state&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,i,r)))}_tileLoaded(i,r,n,o){if(o)return i.state="errored",void(404!==o.status?this._source.fire(new tR(o,{tile:i})):this.update(this.transform));i.timeAdded=j.now(),"expired"===n&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(r,i),"raster-dem"===this.getSource().type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new tk("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){let r=this.getRenderableIds();for(let o=0;o<r.length;o++){let s=r[o];if(i.neighboringTiles&&i.neighboringTiles[s]){let r=this.getTileByID(s);n(i,r),n(r,i)}}function n(i,r){if(!i.dem||i.dem.borderReady)return;i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0;let n=r.tileID.canonical.x-i.tileID.canonical.x,o=r.tileID.canonical.y-i.tileID.canonical.y,s=Math.pow(2,i.tileID.canonical.z),a=r.tileID.key;0===n&&0===o||Math.abs(o)>1||(Math.abs(n)>1&&(1===Math.abs(n+s)?n+=s:1===Math.abs(n-s)&&(n-=s)),r.dem&&i.dem&&(i.dem.backfillBorder(r.dem,n,o),i.neighboringTiles&&i.neighboringTiles[a]&&(i.neighboringTiles[a].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,r,n,o){for(let s in this._tiles){let a=this._tiles[s];if(o[s]||!a.hasData()||a.tileID.overscaledZ<=r||a.tileID.overscaledZ>n)continue;let l=a.tileID;for(;a&&a.tileID.overscaledZ>r+1;){let i=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[i.key])&&a.hasData()&&(l=i)}let u=l;for(;u.overscaledZ>r;)if(i[(u=u.scaledTo(u.overscaledZ-1)).key]){o[l.key]=l;break}}}findLoadedParent(i,r){if(i.key in this._loadedParentTiles){let n=this._loadedParentTiles[i.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=i.overscaledZ-1;n>=r;n--){let r=i.scaledTo(n),o=this._getLoadedTile(r);if(o)return o}}_getLoadedTile(i){let r=this._tiles[i.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,r){r=r||this._source.tileSize;let n=Math.floor((Math.ceil(i.width/r)+1)*(Math.ceil(i.height/r)+1)*5),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(i){let r=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,r){let i={};for(let n in this._tiles){let o=this._tiles[n];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+r),i[o.tileID.key]=o}for(let r in this._tiles=i,this._timers)clearTimeout(this._timers[r]),delete this._timers[r];for(let i in this._tiles)this._setTileReloadTimer(+i,this._tiles[i])}}update(i,r,n){let o;if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;this.updateCacheSize(i,r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(i=>new lD(i.canonical.z,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y)):(o=i.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter(i=>this._source.hasTile(i)))):o=[];let s=this._updateRetainedTiles(o);if(l3(this._source.type)&&0!==o.length){let i={},r={};for(let n of Object.keys(s)){let o=s[n],a=this._tiles[n];if(!a||a.fadeEndTime&&a.fadeEndTime<=j.now())continue;let l=this.findLoadedParent(o,Math.max(o.overscaledZ-l1.maxOverzooming,this._source.minzoom));l&&(this._addTile(l.tileID),i[l.tileID.key]=l.tileID),r[n]=o}let n=o[o.length-1].overscaledZ;for(let i in this._tiles){let o=this._tiles[i];if(s[i]||!o.hasData())continue;let a=o.tileID;for(;a.overscaledZ>n;){a=a.scaledTo(a.overscaledZ-1);let n=this._tiles[a.key];if(n&&n.hasData()&&r[a.key]){s[i]=o.tileID;break}}}for(let r in i)s[r]||(this._coveredTiles[r]=!0,s[r]=i[r])}for(let i in s)this._tiles[i].clearFadeHold();for(let i of function(i,r){let n=[];for(let o in i)o in r||n.push(o);return n}(this._tiles,s)){let r=this._tiles[i];r.hasSymbolBuckets&&!r.holdingForFade()?r.setHoldDuration(this.map._fadeDuration):r.hasSymbolBuckets&&!r.symbolFadeFinished()||this._removeTile(+i)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){let r={};if(0===i.length)return r;let n={},o=i[i.length-1].overscaledZ,s=i[0].overscaledZ,a=Math.max(s-l1.maxOverzooming,this._source.minzoom),l=Math.max(s+l1.maxUnderzooming,this._source.minzoom),u={};for(let n of i){let i=this._addTile(n);r[n.key]=n,i.hasData()||o<this._source.maxzoom&&(u[n.key]=n)}for(let s of(this._retainLoadedChildren(u,o,l,r),i)){let i=this._tiles[s.key];if(i.hasData())continue;if(s.canonical.z>=this._source.maxzoom){let i=s.children(this._source.maxzoom)[0],n=this.getTile(i);if(n&&n.hasData()){r[i.key]=i;continue}}else{let i=s.children(this._source.maxzoom);if(r[i[0].key]&&r[i[1].key]&&r[i[2].key]&&r[i[3].key])continue}let o=i.wasRequested();for(let l=s.overscaledZ-1;l>=a;--l){let a=s.scaledTo(l);if(n[a.key]||(n[a.key]=!0,(i=this.getTile(a))||!o||(i=this._addTile(a)),i&&(r[a.key]=a,o=i.wasRequested(),i.hasData())))break}}return r}_updateLoadedParentTileCache(){for(let i in this._loadedParentTiles={},this._tiles){let r=[],n,o=this._tiles[i].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){n=this._loadedParentTiles[o.key];break}r.push(o.key);let i=o.scaledTo(o.overscaledZ-1);if(n=this._getLoadedTile(i))break;o=i}for(let i of r)this._loadedParentTiles[i]=n}}_addTile(i){let r=this._tiles[i.key];if(r)return r;(r=this._cache.getAndRemove(i))&&(this._setTileReloadTimer(i.key,r),r.tileID=i,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,r)));let n=!!r;return n||(r=new lB(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom),this._loadTile(r,this._tileLoaded.bind(this,r,i.key,r.state))),r?(r.uses++,this._tiles[i.key]=r,n||this._source.fire(new tk("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(i,r){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);let n=r.getExpiryTimeout();n&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},n))}_removeTile(i){let r=this._tiles[i];r&&(r.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){for(let i in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+i);this._cache.reset()}tilesIn(i,r,n){let o=[],s=this.transform;if(!s)return o;for(let a in this._tiles){let l=this._tiles[a];if(n&&l.clearQueryDebugViz(),l.holdingForFade())continue;let u=i.containsTile(l,s,r);u&&o.push(u)}return o}getVisibleCoordinates(i){let r=this.getRenderableIds(i).map(i=>this._tiles[i].tileID);for(let i of r)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(l3(this._source.type))for(let i in this._tiles){let r=this._tiles[i];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=j.now())return!0}return!1}setFeatureState(i,r,n){this._state.updateState(i=i||"_geojsonTileLayer",r,n)}removeFeatureState(i,r,n){this._state.removeFeatureState(i=i||"_geojsonTileLayer",r,n)}getFeatureState(i,r){return this._state.getState(i=i||"_geojsonTileLayer",r)}setDependencies(i,r,n){let o=this._tiles[i];o&&o.setDependencies(r,n)}reloadTilesForDependencies(i,r){for(let n in this._tiles)this._tiles[n].hasDependency(i,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(i,r))}}function l2(i,r){let n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*r.wrap)-+(r.wrap<0);return i.overscaledZ-r.overscaledZ||o-n||r.canonical.y-i.canonical.y||r.canonical.x-i.canonical.x}function l3(i){return"raster"===i||"image"===i||"video"===i}l1.maxOverzooming=10,l1.maxUnderzooming=3;class l5{constructor(i,r,n){this._demTile=i,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(i,r,n){let o=n||i.findDEMTileFor(r);if(!o||!o.dem)return;let s=o.dem,a=o.tileID,l=1<<r.canonical.z-a.canonical.z;return new l5(o,o.tileSize/8192/l,[(r.canonical.x/l-a.canonical.x)*s.dim,(r.canonical.y/l-a.canonical.y)*s.dim])}tileCoordToPixel(i,r){let n=r*this._scale+this._offset[1];return new u(Math.floor(i*this._scale+this._offset[0]),Math.floor(n))}getElevationAt(i,r,n,o){let s=i*this._scale+this._offset[0],a=r*this._scale+this._offset[1],l=Math.floor(s),u=Math.floor(a),h=this._dem;return o=!!o,n?eO(eO(h.get(l,u,o),h.get(l,u+1,o),a-u),eO(h.get(l+1,u,o),h.get(l+1,u+1,o),a-u),s-l):h.get(l,u,o)}getElevationAtPixel(i,r,n){return this._dem.get(i,r,!!n)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*(1/lx(i))*this._dem.stride}}class l4{constructor(i,r){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ra(8192,16,0),this.featureIndexArray=new nW,this.promoteId=r}insert(i,r,n,o,s,a=0){let l=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,o,s,a);let u=this.grid;for(let i=0;i<r.length;i++){let n=r[i],o=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;i++){let r=n[i];o[0]=Math.min(o[0],r.x),o[1]=Math.min(o[1],r.y),o[2]=Math.max(o[2],r.x),o[3]=Math.max(o[3],r.y)}o[0]<8192&&o[1]<8192&&o[2]>=0&&o[3]>=0&&u.insert(l,o[0],o[1],o[2],o[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new sD.VectorTile(new at(this.rawTileData)).layers,this.sourceLayerCoder=new lO(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,r,n,o){let s;this.loadVTLayers();let a=i.params||{},l=iq(a.filter),u=i.tileResult,h=i.transform,c=u.bufferedTilespaceBounds,p=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(i,r,n,o)=>oC(u.bufferedTilespaceGeometry,i,r,n,o));p.sort(l8);let f=null;h.elevation&&p.length>0&&(f=l5.create(h.elevation,this.tileID));let d={};for(let h=0;h<p.length;h++){let c=p[h];if(c===s)continue;s=c;let m=this.featureIndexArray.get(c),g=null;this.loadMatchingFeature(d,m,l,a.layers,a.availableImages,r,n,o,(r,n,o,s=0)=>(g||(g=oy(r)),n.queryIntersectsFeature(u,r,o,g,this.z,i.transform,i.pixelPosMatrix,f,s)))}return d}loadMatchingFeature(i,r,n,o,s,a,l,u,h){let{featureIndex:c,bucketIndex:p,sourceLayerIndex:f,layoutVertexArrayOffset:d}=r,m=this.bucketLayerIDs[p];if(o&&!function(i,r){for(let n=0;n<i.length;n++)if(r.indexOf(i[n])>=0)return!0;return!1}(o,m))return;let g=this.sourceLayerCoder.decode(f),y=this.vtLayers[g].feature(c);if(n.needGeometry){let i=o_(y,!0);if(!n.filter(new r6(this.tileID.overscaledZ),i,this.tileID.canonical))return}else if(!n.filter(new r6(this.tileID.overscaledZ),y))return;let _=this.getId(y,g);for(let r=0;r<m.length;r++){let n=m[r];if(o&&0>o.indexOf(n))continue;let p=a[n];if(!p)continue;let f={};void 0!==_&&u&&(f=u.getState(p.sourceLayer||"_geojsonTileLayer",_));let g=w({},l[n]);g.paint=l6(g.paint,p.paint,y,f,s),g.layout=l6(g.layout,p.layout,y,f,s);let v=!h||h(y,p,f,d);if(!v)continue;let x=new lz(y,this.z,this.x,this.y,_);x.layer=g;let b=i[n];void 0===b&&(b=i[n]=[]),b.push({featureIndex:c,feature:x,intersectionZ:v})}}lookupSymbolFeatures(i,r,n,o,s,a,l,u){let h={};this.loadVTLayers();let c=iq(s);for(let s of i)this.loadMatchingFeature(h,{bucketIndex:n,sourceLayerIndex:o,featureIndex:s,layoutVertexArrayOffset:0},c,a,l,u,r);return h}hasLayer(i){for(let r of this.bucketLayerIDs)for(let n of r)if(i===n)return!0;return!1}getId(i,r){let n=i.id;return this.promoteId&&"boolean"==typeof(n=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[r]])&&(n=Number(n)),n}}function l6(i,r,n,o,s){return A(i,(i,a)=>{let l=r instanceof nn?r.get(a):null;return l&&l.evaluate?l.evaluate(n,o,s):l})}function l8(i,r){return r-i}rc("FeatureIndex",l4,{omit:["rawTileData","sourceLayerCoder"]});class l9{constructor(i){let r={},n=[];for(let o in i){let s=i[o],a=r[o]={};for(let i in s){let r=s[+i];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;let o=r.metrics.localGlyph?2:1,l={x:0,y:0,w:r.bitmap.width+2*o,h:r.bitmap.height+2*o};n.push(l),a[i]={rect:l,metrics:r.metrics}}}let{w:o,h:s}=av(n),a=new o3({width:o||1,height:s||1});for(let n in i){let o=i[n];for(let i in o){let s=o[+i];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;let l=r[n][i].rect,u=s.metrics.localGlyph?2:1;o3.copy(s.bitmap,a,{x:0,y:0},{x:l.x+u,y:l.y+u},s.bitmap)}}this.image=a,this.positions=r}}rc("GlyphAtlas",l9);class l7{constructor(i){this.tileID=new lD(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile}parse(i,r,n,o,s){let a,l,h,c;this.status="parsing",this.data=i,this.collisionBoxArray=new nU;let f=new lO(Object.keys(i.layers).sort()),d=new l4(this.tileID,this.promoteId);d.bucketLayerIDs=[];let m={},g=new lM(256,256),y={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:n},_=r.familiesBySource[this.source];for(let r in _){let o=i.layers[r];if(!o)continue;let s=!1,a=!1;for(let i of _[r])"symbol"===i[0].type?s=!0:a=!0;if(!0===this.isSymbolTile&&!s||!1===this.isSymbolTile&&!a)continue;1===o.version&&D(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let l=f.encode(r),u=[];for(let i=0;i<o.length;i++){let n=o.feature(i),s=d.getId(n,r);u.push({feature:n,id:s,index:i,sourceLayerIndex:l})}for(let i of _[r]){let r=i[0];void 0!==this.isSymbolTile&&"symbol"===r.type!==this.isSymbolTile||r.minzoom&&this.zoom<Math.floor(r.minzoom)||r.maxzoom&&this.zoom>=r.maxzoom||"none"!==r.visibility&&(ut(i,this.zoom,n),(m[r.id]=r.createBucket({index:d.bucketLayerIDs.length,layers:i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:l,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(u,y,this.tileID.canonical),d.bucketLayerIDs.push(i.map(i=>i.id)))}}g.trim();let v={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},x=A(y.glyphDependencies,i=>Object.keys(i).map(Number));Object.keys(x).length?o.send("getGlyphs",{uid:this.uid,stacks:x},(i,r)=>{a||(a=i,l=r,I.call(this))},void 0,!1,v):l={};let w=Object.keys(y.iconDependencies);w.length?o.send("getImages",{icons:w,source:this.source,tileID:this.tileID,type:"icons"},(i,r)=>{a||(a=i,h=r,I.call(this))},void 0,!1,v):h={};let E=Object.keys(y.patternDependencies);function I(){if(a)return s(a);if(l&&h&&c){let i=new l9(l),r=new ab(h,c);for(let o in m){let s=m[o];s instanceof lt?(ut(s.layers,this.zoom,n),function(i,r,n,o,s,a,l,h){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let c=i.layers[0].layout,f=i.layers[0]._unevaluatedLayout._values,d={};if("composite"===i.textSizeData.kind){let{minZoom:r,maxZoom:n}=i.textSizeData;d.compositeTextSizes=[f["text-size"].possiblyEvaluate(new r6(r),l),f["text-size"].possiblyEvaluate(new r6(n),l)]}if("composite"===i.iconSizeData.kind){let{minZoom:r,maxZoom:n}=i.iconSizeData;d.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new r6(r),l),f["icon-size"].possiblyEvaluate(new r6(n),l)]}d.layoutTextSize=f["text-size"].possiblyEvaluate(new r6(h+1),l),d.layoutIconSize=f["icon-size"].possiblyEvaluate(new r6(h+1),l),d.textMaxSize=f["text-size"].possiblyEvaluate(new r6(18),l);let m="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),g=c.get("text-keep-upright"),y=c.get("text-size");for(let a of i.features){let h=c.get("text-font").evaluate(a,{},l).join(","),f=y.evaluate(a,{},l),_=d.layoutTextSize.evaluate(a,{},l),v=(d.layoutIconSize.evaluate(a,{},l),{horizontal:{},vertical:void 0}),x=a.text,b,w=[0,0];if(x){let o=x.toString(),u=24*c.get("text-letter-spacing").evaluate(a,{},l),p=24*c.get("text-line-height").evaluate(a,{},l),d=!function(i){for(let n of i){var r;if(ry(r=n.charCodeAt(0))||r_(r)||rv(r)||rF(r)||rV(r))return!1}return!0}(o)?0:u,y=c.get("text-anchor").evaluate(a,{},l),b=c.get("text-variable-anchor");if(!b){let i=c.get("text-radial-offset").evaluate(a,{},l);w=i?aJ(y,[24*i,aK]):c.get("text-offset").evaluate(a,{},l).map(i=>24*i)}let E=m?"center":c.get("text-justify").evaluate(a,{},l),I=c.get("symbol-placement"),S="point"===I?24*c.get("text-max-width").evaluate(a,{},l):0,M=()=>{i.allowVerticalPlacement&&rj(o)&&(v.vertical=aS(x,r,n,s,h,S,p,y,"left",d,w,aw.vertical,!0,I,_,f))};if(!m&&b){let i="auto"===E?b.map(i=>aQ(i)):[E],o=!1;for(let a=0;a<i.length;a++){let l=i[a];if(!v.horizontal[l]){if(o)v.horizontal[l]=v.horizontal[0];else{let i=aS(x,r,n,s,h,S,p,"center",l,d,w,aw.horizontal,!1,I,_,f);i&&(v.horizontal[l]=i,o=1===i.positionedLines.length)}}}M()}else{"auto"===E&&(E=aQ(y));let i=aS(x,r,n,s,h,S,p,y,E,d,w,aw.horizontal,!1,I,_,f);i&&(v.horizontal[E]=i),M(),rj(o)&&m&&g&&(v.vertical=aS(x,r,n,s,h,S,p,y,E,d,w,aw.vertical,!1,I,_,f))}}let E=!1;if(a.icon&&a.icon.name){let r=o[a.icon.name];r&&(b=function(i,r,n){let{horizontalAlign:o,verticalAlign:s}=ak(n),a=r[0]-i.displaySize[0]*o,l=r[1]-i.displaySize[1]*s;return{image:i,top:l,bottom:l+i.displaySize[1],left:a,right:a+i.displaySize[0]}}(s[a.icon.name],c.get("icon-offset").evaluate(a,{},l),c.get("icon-anchor").evaluate(a,{},l)),E=r.sdf,void 0===i.sdfIcons?i.sdfIcons=r.sdf:i.sdfIcons!==r.sdf&&D("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(r.pixelRatio!==i.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}let I=a1(v.horizontal)||v.vertical;i.iconsInText||(i.iconsInText=!!I&&I.iconsInText),(I||b)&&function(i,r,n,o,s,a,l,h,c,f,d){let m,g=a.textMaxSize.evaluate(r,{},d);void 0===g&&(g=l);let y=i.layers[0].layout,_=y.get("icon-offset").evaluate(r,{},d),v=a1(n.horizontal),x=l/24,b=i.tilePixelRatio*g/24,w=i.tilePixelRatio*y.get("symbol-spacing"),E=y.get("text-padding")*i.tilePixelRatio,I=y.get("icon-padding")*i.tilePixelRatio,S=y.get("text-max-angle")*p,M="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement"),T="map"===y.get("icon-rotation-alignment")&&"point"!==y.get("symbol-placement"),C=y.get("symbol-placement"),P=w/2,A=y.get("icon-text-fit");o&&"none"!==A&&(i.allowVerticalPlacement&&n.vertical&&(m=aR(o,n.vertical,A,y.get("icon-text-fit-padding"),_,x)),v&&(o=aR(o,v,A,y.get("icon-text-fit-padding"),_,x)));let L=(u,h)=>{h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v,x,b,w,E,I,S){let M=i.addToLineVertexArray(r,n),T,C,P,A,L,k,R,N=0,O=0,z=0,F=0,B=-1,U=-1,G={},V=nQ(""),q=0,j=0;if(void 0===u._unevaluatedLayout.getValue("text-radial-offset")?[q,j]=u.layout.get("text-offset").evaluate(b,{},I).map(i=>24*i):(q=24*u.layout.get("text-radial-offset").evaluate(b,{},I),j=aK),i.allowVerticalPlacement&&o.vertical){let i=o.vertical;if(m)k=a3(i),l&&(R=a3(l));else{let n=u.layout.get("text-rotate").evaluate(b,{},I)+90;P=a2(h,r,c,p,f,i,d,n),l&&(A=a2(h,r,c,p,f,l,_,n))}}if(s){let n=u.layout.get("icon-rotate").evaluate(b,{},I),o="none"!==u.layout.get("icon-text-fit"),a=aj(s,n,E,o),d=l?aj(l,n,E,o):void 0;C=a2(h,r,c,p,f,s,_,n),N=4*a.length;let m=i.iconSizeData,g=null;"source"===m.kind?(g=[128*u.layout.get("icon-size").evaluate(b,{},I)])[0]>32640&&D(`${i.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===m.kind&&((g=[128*w.compositeIconSizes[0].evaluate(b,{},I),128*w.compositeIconSizes[1].evaluate(b,{},I)])[0]>32640||g[1]>32640)&&D(`${i.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),i.addSymbols(i.icon,a,g,x,v,b,!1,r,M.lineStartIndex,M.lineLength,-1,I),B=i.icon.placedSymbolArray.length-1,d&&(O=4*d.length,i.addSymbols(i.icon,d,g,x,v,b,aw.vertical,r,M.lineStartIndex,M.lineLength,-1,I),U=i.icon.placedSymbolArray.length-1)}for(let n in o.horizontal){let s=o.horizontal[n];T||(V=nQ(s.text),m?L=a3(s):T=a2(h,r,c,p,f,s,d,u.layout.get("text-rotate").evaluate(b,{},I)));let l=1===s.positionedLines.length;if(z+=a0(i,r,s,a,u,m,b,g,M,o.vertical?aw.horizontal:aw.horizontalOnly,l?Object.keys(o.horizontal):[n],G,B,w,I),l)break}o.vertical&&(F+=a0(i,r,o.vertical,a,u,m,b,g,M,aw.vertical,["vertical"],G,U,w,I));let Z=-1,X=(i,r)=>i?Math.max(i,r):r;Z=X(L,-1),Z=X(k,Z);let $=+((Z=X(R,Z))>-1);$&&(Z*=S/24),i.glyphOffsetArray.length>=lt.MAX_GLYPHS&&D("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&i.addToSortKeyRanges(i.symbolInstances.length,b.sortKey),i.symbolInstances.emplaceBack(r.x,r.y,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical||-1,B,U,V,void 0!==T?T:i.collisionBoxArray.length,void 0!==T?T+1:i.collisionBoxArray.length,void 0!==P?P:i.collisionBoxArray.length,void 0!==P?P+1:i.collisionBoxArray.length,void 0!==C?C:i.collisionBoxArray.length,void 0!==C?C+1:i.collisionBoxArray.length,A||i.collisionBoxArray.length,A?A+1:i.collisionBoxArray.length,c,z,F,N,O,$,0,q,j,Z)}(i,h,u,n,o,s,m,i.layers[0],i.collisionBoxArray,r.index,r.sourceLayerIndex,i.index,E,M,c,0,I,T,_,r,a,f,d,l)};if("line"===C)for(let s of aF(r.geometry,0,0,8192,8192))for(let r of function(i,r,n,o,s,a,l,u,h){let c=o?.6*24*l:0,p=az(o,s),f=p*l,d=0===i[0].x||8192===i[0].x||0===i[0].y||8192===i[0].y;return r-f<r/4&&(r=f+r/4),function i(r,n,o,s,a,l,u,h,c){let p=l/2,f=aO(r),d=0,m=n-o,g=[];for(let i=0;i<r.length-1;i++){let n=r[i],u=r[i+1],h=n.dist(u),y=u.angleTo(n);for(;m+o<d+h;){let _=((m+=o)-d)/h,v=eO(n.x,u.x,_),x=eO(n.y,u.y,_);if(v>=0&&v<c&&x>=0&&x<c&&m-p>=0&&m+p<=f){let n=new aD(v,x,y,i);n._round(),s&&!aN(r,n,l,s,a)||g.push(n)}}d+=h}return h||g.length||u||(g=i(r,d/2,o,s,a,l,u,!0,c)),g}(i,d?r/2*u%r:(p/2+48)*l*u%r,r,c,n,f,d,!1,8192)}(s,w,S,n.vertical||v,o,0,b,i.overscaling,8192))v&&function(i,r,n,o){let s=i.compareText;if(r in s){let i=s[r];for(let r=i.length-1;r>=0;r--)if(o.dist(i[r])<n)return!0}else s[r]=[];return s[r].push(o),!1}(i,v.text,P,r)||L(s,r);else if("line-center"===C){for(let i of r.geometry)if(i.length>1){let r=function(i,r,n,o,s,a){let l=n?.6*24*a:0,u=az(n,o)*a,h=0,c=aO(i)/2;for(let n=0;n<i.length-1;n++){let o=i[n],s=i[n+1],a=o.dist(s);if(h+a>c){let p=(c-h)/a,f=new aD(eO(o.x,s.x,p),eO(o.y,s.y,p),s.angleTo(o),n);return f._round(),!l||aN(i,f,u,l,r)?f:void 0}h+=a}}(i,S,n.vertical||v,o,0,b);r&&L(i,r)}}else if("Polygon"===r.type)for(let i of sv(r.geometry,0)){let r=function(i,r=1,n=!1){let o=1/0,s=1/0,a=-1/0,l=-1/0,h=i[0];for(let i=0;i<h.length;i++){let r=h[i];(!i||r.x<o)&&(o=r.x),(!i||r.y<s)&&(s=r.y),(!i||r.x>a)&&(a=r.x),(!i||r.y>l)&&(l=r.y)}let c=Math.min(a-o,l-s),p=c/2,f=new a$([],aH);if(0===c)return new u(o,s);for(let r=o;r<a;r+=c)for(let n=s;n<l;n+=c)f.push(new aY(r+p,n+p,p,i));let d=function(i){let r=0,n=0,o=0,s=i[0];for(let i=0,a=s.length,l=a-1;i<a;l=i++){let a=s[i],u=s[l],h=a.x*u.y-u.x*a.y;n+=(a.x+u.x)*h,o+=(a.y+u.y)*h,r+=3*h}return new aY(n/r,o/r,0,i)}(i),m=f.length;for(;f.length;){let o=f.pop();(o.d>d.d||!d.d)&&(d=o,n&&console.log("found best %d after %d probes",Math.round(1e4*o.d)/1e4,m)),o.max-d.d<=r||(p=o.h/2,f.push(new aY(o.p.x-p,o.p.y-p,p,i)),f.push(new aY(o.p.x+p,o.p.y-p,p,i)),f.push(new aY(o.p.x-p,o.p.y+p,p,i)),f.push(new aY(o.p.x+p,o.p.y+p,p,i)),m+=4)}return n&&(console.log(`num probes: ${m}`),console.log(`best distance: ${d.d}`)),d.p}(i,16);L(i[0],new aD(r.x,r.y,0))}else if("LineString"===r.type)for(let i of r.geometry)L(i,new aD(i[0].x,i[0].y,0));else if("Point"===r.type)for(let i of r.geometry)for(let r of i)L([r],new aD(r.x,r.y,0))}(i,a,v,b,o,d,_,0,w,E,l)}a&&i.generateCollisionDebugBuffers(h,i.collisionBoxArray)}(s,l,i.positions,h,r.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):s.hasPattern&&(s instanceof s$||s instanceof sE||s instanceof sF)&&(ut(s.layers,this.zoom,n),s.addFeatures(y,this.tileID.canonical,r.patternPositions))}this.status="done",s(null,{buckets:b(m).filter(i=>!i.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:i.image,lineAtlas:g,imageAtlas:r,glyphMap:this.returnDependencies?l:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?i.positions:null})}}E.length?o.send("getImages",{icons:E,source:this.source,tileID:this.tileID,type:"patterns"},(i,r)=>{a||(a=i,c=r,I.call(this))},void 0,!1,v):c={},I.call(this)}}function ut(i,r,n){let o=new r6(r);for(let r of i)r.recalculate(o,n)}class ue{constructor(i){this.entries={},this.scheduler=i}request(i,r,n,o){let s=this.entries[i]=this.entries[i]||{callbacks:[]};if(s.result){let[i,n]=s.result;return this.scheduler?this.scheduler.add(()=>{o(i,n)},r):o(i,n),()=>{}}return s.callbacks.push(o),s.cancel||(s.cancel=n((n,o)=>{for(let i of(s.result=[n,o],s.callbacks))this.scheduler?this.scheduler.add(()=>{i(n,o)},r):i(n,o);setTimeout(()=>delete this.entries[i],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(i=>i!==o),s.callbacks.length||(s.cancel(),delete this.entries[i]))}}}function ui(i,r,n){let o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},r=>{let o=tS(i.request,(i,o,s,a)=>{i?r(i):o&&r(null,{vectorTile:n?void 0:new sD.VectorTile(new at(o)),rawData:o,cacheControl:s,expires:a})});return()=>{o.cancel(),r()}},r)}i.ARRAY_TYPE=oN,i.AUTH_ERR_MSG=J,i.Actor=class{constructor(i,r,n){this.target=i,this.parent=r,this.mapId=n,this.callbacks={},this.cancelCallbacks={},C(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=O()?i:c,this.scheduler=new lA}send(i,r,n,o,s=!1,a){let l=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=a,this.callbacks[l]=n);let u=V(this.globalScope)?void 0:[];return this.target.postMessage({id:l,type:i,hasCallback:!!n,targetMapId:o,mustQueue:s,sourceMapId:this.mapId,data:rd(r,u)},u),{cancel:()=>{n&&delete this.callbacks[l],this.target.postMessage({id:l,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){let r=i.data,n=r.id;if(n&&(!r.targetMapId||this.mapId===r.targetMapId)){if("<cancel>"===r.type){let i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i.cancel()}else if(r.mustQueue||O()){let i=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,r),i&&i.metadata||{type:"message"})}else this.processTask(n,r)}}processTask(i,r){if("<response>"===r.type){let n=this.callbacks[i];delete this.callbacks[i],n&&(r.error?n(rm(r.error)):n(null,rm(r.data)))}else{let n=V(this.globalScope)?void 0:[],o=r.hasCallback?(r,o)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:r?rd(r):null,data:rd(o,n)},n)}:i=>{},s=rm(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,s,o);else if(this.parent.getWorkerSource){let i=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,i[0],s.source)[i[1]](s,o)}else o(Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=lk,i.Color=t8,i.ColorMode=lQ,i.CullFaceMode=l0,i.DEMData=lH,i.DataConstantProperty=no,i.DedupedRequest=ue,i.DepthMode=lK,i.EXTENT=8192,i.Elevation=class{getAtPointOrZero(i,r=0){return this.getAtPoint(i,r)||0}getAtPoint(i,r,n=!0){null==r&&(r=null);let o=this._source();if(!o||i.y<0||i.y>1)return r;let s=o.getSource().maxzoom,a=1<<s,l=Math.floor(i.x),u=i.x-l,h=new lD(s,l,s,Math.floor(u*a),Math.floor(i.y*a)),c=this.findDEMTileFor(h);if(!c||!c.dem)return r;let p=c.dem,f=1<<c.tileID.canonical.z,d=(u*f-c.tileID.canonical.x)*p.dim,m=(i.y*f-c.tileID.canonical.y)*p.dim,g=Math.floor(d),y=Math.floor(m);return(n?this.exaggeration():1)*eO(eO(p.get(g,y),p.get(g,y+1),m-y),eO(p.get(g+1,y),p.get(g+1,y+1),m-y),d-g)}getAtTileOffset(i,r,n){let o=1<<i.canonical.z;return this.getAtPointOrZero(new lS(i.wrap+(i.canonical.x+r/8192)/o,(i.canonical.y+n/8192)/o))}getForTilePoints(i,r,n,o){let s=l5.create(this,i,o);return!!s&&(r.forEach(i=>{i[2]=this.exaggeration()*s.getElevationAt(i[0],i[1],n)}),!0)}getMinMaxForTile(i){let r=this.findDEMTileFor(i);if(!r||!r.dem)return null;let n=r.dem.tree,o=r.tileID,s=1<<i.canonical.z-o.canonical.z,a=i.canonical.x/s-o.canonical.x,l=i.canonical.y/s-o.canonical.y,u=0;for(let r=0;r<i.canonical.z-o.canonical.z&&!n.leaves[u];r++){let i=2*Math.floor(l*=2)+Math.floor(a*=2);u=n.childOffsets[u]+i,a%=1,l%=1}return{min:this.exaggeration()*n.minimums[u],max:this.exaggeration()*n.maximums[u]}}getMinElevationBelowMSL(){throw Error("Pure virtual method called.")}raycast(i,r,n){throw Error("Pure virtual method called.")}pointCoordinate(i){throw Error("Pure virtual method called.")}_source(){throw Error("Pure virtual method called.")}exaggeration(){throw Error("Pure virtual method called.")}findDEMTileFor(i){throw Error("Pure virtual method called.")}get visibleDemTiles(){throw Error("Getter must be implemented in subclass.")}},i.ErrorEvent=tR,i.EvaluationParameters=r6,i.Event=tk,i.Evented=tD,i.GlyphManager=aq,i.ImagePosition=ax,i.LineAtlas=lM,i.LngLat=l_,i.LngLatBounds=ly,i.LocalGlyphMode=aV,i.MAX_SAFE_INTEGER=0x1fffffffffffff,i.MercatorCoordinate=lS,i.ONE_EM=24,i.OverscaledTileID=lD,i.Properties=nh,i.RGBAImage=o5,i.RequestManager=class{constructor(i,r,n){this._transformRequestFn=i,this._customAccessToken=r,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let i=function(){let i="";for(let r=0;r<10;r++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,r){return this._transformRequestFn&&this._transformRequestFn(i,r)||{url:i}}normalizeStyleURL(i,r){if(!Q(i))return i;let n=ti(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!Q(i))return i;let n=ti(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeSourceURL(i,r){if(!Q(i))return i;let n=ti(i);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||r)}normalizeSpriteURL(i,r,n,o){let s=ti(i);return Q(i)?(s.path=`/styles/v1${s.path}/sprite${r}${n}`,this._makeAPIURL(s,this._customAccessToken||o)):(s.path+=`${r}${n}`,tr(s))}normalizeTileURL(i,r,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Q(i))return i;let o=ti(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||n&&"raster"!==o.authority&&512===n?"@2x":""}${X.supported?".webp":"$1"}`),"raster"===o.authority?o.path=`/${Z.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Z.TILE_URL_VERSION}${o.path}`);let s=this._customAccessToken||function(i){for(let r of i){let i=r.match(/^access_token=(.*)$/);if(i)return i[1]}return null}(o.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,s)}canonicalizeTileURL(i,r){let n=ti(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let s=n.params;return r&&(s=s.filter(i=>!i.match(/^access_token=/))),s.length&&(o+=`?${s.join("&")}`),o}canonicalizeTileset(i,r){let n=!!r&&Q(r),o=[];for(let r of i.tiles||[])tt(r)?o.push(this.canonicalizeTileURL(r,n)):o.push(r);return o}_makeAPIURL(i,r){let n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=ti(Z.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,"http"===i.protocol){let r=i.params.indexOf("secure");r>=0&&i.params.splice(r,1)}if("/"!==o.path&&(i.path=`${o.path}${i.path}`),!Z.REQUIRE_ACCESS_TOKEN)return tr(i);if(r=r||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===r[0])throw Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(i=>-1===i.indexOf("access_token")),i.params.push(`access_token=${r||""}`),tr(i)}},i.ResourceType=tb,i.SegmentVector=om,i.SourceCache=l1,i.StencilMode=lJ,i.StructArrayLayout1ui2=nz,i.StructArrayLayout2f1f2i16=nC,i.StructArrayLayout2i4=ny,i.StructArrayLayout2ui4=nO,i.StructArrayLayout3f12=nI,i.StructArrayLayout3ui6=nA,i.StructArrayLayout4i8=n_,i.Texture=lg,i.Tile=lB,i.Transitionable=r7,i.Uniform1f=n4,i.Uniform1i=class extends n5{constructor(i,r){super(i,r),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},i.Uniform2f=class extends n5{constructor(i,r){super(i,r),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},i.Uniform3f=class extends n5{constructor(i,r){super(i,r),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},i.Uniform4f=n6,i.UniformColor=n8,i.UniformMatrix3f=class extends n5{constructor(i,r){super(i,r),this.current=n7}set(i){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},i.UniformMatrix4f=class extends n5{constructor(i,r){super(i,r),this.current=n9}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},i.UnwrappedTileID=lR,i.ValidationError=tO,i.VectorTileWorkerSource=class extends tD{constructor(i,r,n,o,s){super(),this.actor=i,this.layerIndex=r,this.availableImages=n,this.loadVectorData=s||ui,this.loading={},this.loaded={},this.deduped=new ue(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,r){let n=i.uid,o=i&&i.request,s=o&&o.collectResourceTiming,a=this.loading[n]=new l7(i);a.abort=this.loadVectorData(i,(l,u)=>{let h=!this.loading[n];if(delete this.loading[n],h||l||!u)return a.status="done",h||(this.loaded[n]=a),r(l);let c=u.rawData,p={};u.expires&&(p.expires=u.expires),u.cacheControl&&(p.cacheControl=u.cacheControl),a.vectorTile=u.vectorTile||new sD.VectorTile(new at(c));let f=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,(i,n)=>{if(i||!n)return r(i);let a={};if(s){let i=lP(o);i.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(i)))}r(null,w({rawTileData:c.slice(0)},n,p,a))})};this.isSpriteLoaded?f():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):f()}),this.loaded=this.loaded||{},this.loaded[n]=a})}reloadTile(i,r){let n=this.loaded,o=i.uid,s=this;if(n&&n[o]){let a=n[o];a.showCollisionBoxes=i.showCollisionBoxes,a.enableTerrain=!!i.enableTerrain;let l=(i,n)=>{let o=a.reloadCallback;o&&(delete a.reloadCallback,a.parse(a.vectorTile,s.layerIndex,this.availableImages,s.actor,o)),r(i,n)};"parsing"===a.status?a.reloadCallback=l:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,l):l())}}abortTile(i,r){let n=i.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),r()}removeTile(i,r){let n=this.loaded,o=i.uid;n&&n[o]&&delete n[o],r()}},i.WritingMode=aw,i.ZoomHistory=rg,i.add=function(i,r,n){return i[0]=r[0]+n[0],i[1]=r[1]+n[1],i[2]=r[2]+n[2],i},i.addDynamicAttributes=a8,i.altitudeFromMercatorZ=lI,i.asyncAll=x,i.bezier=g,i.bindAll=C,i.bufferConvexPolygon=function(i,r){let n=[];for(let o=0;o<i.length;o++){let s=v(o-1,-1,i.length-1),a=v(o+1,-1,i.length-1),l=i[o],u=i[a],h=i[s].sub(l).unit(),c=u.sub(l).unit(),p=c.angleWithSep(h.x,h.y),f=h.add(c).unit().mult(-1*r/Math.sin(p/2));n.push(l.add(f))}return n},i.cacheEntryPossiblyAdded=function(i){++tx>ty&&(i.getActor().send("enforceCacheSizeLimit",tg),tx=0)},i.clamp=_,i.clearTileCache=function(i){let r=c.caches.delete(tf);i&&r.catch(i).then(()=>i())},i.clipLine=aF,i.clone=function(i){var r=new oN(3);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r},i.clone$1=function(i){var r=new oN(16);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},i.clone$2=k,i.collisionCircleLayout=s2,i.config=Z,i.conjugate=function(i,r){return i[0]=-r[0],i[1]=-r[1],i[2]=-r[2],i[3]=r[3],i},i.copy=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i},i.create=oB,i.create$1=function(){var i=new oN(16);return oN!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},i.create$2=oO,i.createExpression=iA,i.createFilter=iq,i.createLayout=nm,i.createStyleLayer=function(i){return"custom"===i.type?new la(i):new lh[i.type](i)},i.cross=function(i,r,n){var o=r[0],s=r[1],a=r[2],l=n[0],u=n[1],h=n[2];return i[0]=s*h-a*u,i[1]=a*l-o*h,i[2]=o*u-s*l,i},i.degToRad=function(i){return i*p},i.div=function(i,r,n){return i[0]=r[0]/n[0],i[1]=r[1]/n[1],i[2]=r[2]/n[2],i},i.dot=function(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]},i.dot$1=function(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]+i[3]*r[3]},i.ease=y,i.easeCubicInOut=m,i.emitValidationErrors=rs,i.endsWith=P,i.enforceCacheSizeLimit=function(i){t_(),td&&td.then(r=>{r.keys().then(n=>{for(let o=0;o<n.length-i;o++)r.delete(n[o])})})},i.evaluateSizeForFeature=s5,i.evaluateSizeForZoom=s4,i.evaluateVariableOffset=aJ,i.evented=r2,i.exactEquals=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]},i.exactEquals$1=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]},i.exported=j,i.exported$1=X,i.extend=w,i.filterObject=L,i.fromMat4=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],i},i.fromQuat=function(i,r){var n=r[0],o=r[1],s=r[2],a=r[3],l=n+n,u=o+o,h=s+s,c=n*l,p=o*l,f=o*u,d=s*l,m=s*u,g=s*h,y=a*l,_=a*u,v=a*h;return i[0]=1-f-g,i[1]=p+v,i[2]=d-_,i[3]=0,i[4]=p-v,i[5]=1-c-g,i[6]=m+y,i[7]=0,i[8]=d+_,i[9]=m-y,i[10]=1-c-f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},i.fromRotation=function(i,r){var n=Math.sin(r),o=Math.cos(r);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},i.fromScaling=function(i,r){return i[0]=r[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},i.furthestTileCorner=function(i){return d[Math.round((i+45+360)%360/90)%4]},i.getAABBPointSquareDist=function(i,r,n){let o=0;for(let s=0;s<2;++s){let a=n?n[s]:0;i[s]>a&&(o+=(i[s]-a)*(i[s]-a)),r[s]<a&&(o+=(a-r[s])*(a-r[s]))}return o},i.getAnchorAlignment=ak,i.getAnchorJustification=aQ,i.getBounds=function(i){let r=1/0,n=1/0,o=-1/0,s=-1/0;for(let a of i)r=Math.min(r,a.x),n=Math.min(n,a.y),o=Math.max(o,a.x),s=Math.max(s,a.y);return{min:new u(r,n),max:new u(o,s)}},i.getImage=tP,i.getJSON=function(i,r){return tI(w(i,{type:"json"}),r)},i.getMapSessionAPI=tc,i.getPerformanceMeasurement=lP,i.getRTLTextPluginStatus=r3,i.getReferrer=tE,i.getVideo=function(i,r){let n=c.document.createElement("video");n.muted=!0,n.onloadstart=function(){r(null,n)};for(let r=0;r<i.length;r++){let o=c.document.createElement("source");(function(i){let r=c.document.createElement("a");return r.href=i,r.protocol===c.document.location.protocol&&r.host===c.document.location.host})(i[r])||(n.crossOrigin="Anonymous"),o.src=i[r],n.appendChild(o)}return{cancel:()=>{}}},i.identity=oz,i.identity$1=oH,i.invert=function(i,r){var n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],h=r[6],c=r[7],p=r[8],f=r[9],d=r[10],m=r[11],g=r[12],y=r[13],_=r[14],v=r[15],x=n*u-o*l,b=n*h-s*l,w=n*c-a*l,E=o*h-s*u,I=o*c-a*u,S=s*c-a*h,M=p*y-f*g,T=p*_-d*g,C=p*v-m*g,P=f*_-d*y,A=f*v-m*y,L=d*v-m*_,k=x*L-b*A+w*P+E*C-I*T+S*M;return k?(i[0]=(u*L-h*A+c*P)*(k=1/k),i[1]=(s*A-o*L-a*P)*k,i[2]=(y*S-_*I+v*E)*k,i[3]=(d*I-f*S-m*E)*k,i[4]=(h*C-l*L-c*T)*k,i[5]=(n*L-s*C+a*T)*k,i[6]=(_*w-g*S-v*b)*k,i[7]=(p*S-d*w+m*b)*k,i[8]=(l*A-u*C+c*M)*k,i[9]=(o*C-n*A-a*M)*k,i[10]=(g*I-y*w+v*x)*k,i[11]=(f*w-p*I-m*x)*k,i[12]=(u*T-l*P-h*M)*k,i[13]=(n*P-o*T+s*M)*k,i[14]=(y*b-g*E-_*x)*k,i[15]=(p*E-f*b+d*x)*k,i):null},i.isMapAuthenticated=function(i){return tp.has(i)},i.isMapboxURL=Q,i.latFromMercatorY=lE,i.len=oU,i.length=oU,i.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},i.loadVectorTile=ui,i.makeRequest=tI,i.mercatorXfromLng=lb,i.mercatorYfromLat=lw,i.mercatorZfromAltitude=function(i,r){return i/lx(r)},i.mul=function(i,r,n){return i[0]=r[0]*n[0],i[1]=r[1]*n[1],i[2]=r[2]*n[2],i[3]=r[3]*n[3],i},i.mul$1=oF,i.mul$2=oq,i.multiply=oF,i.multiply$1=oq,i.nextPowerOfTwo=M,i.normalize=oZ,i.normalize$1=function(i,r){var n=r[0],o=r[1],s=r[2],a=r[3],l=n*n+o*o+s*s+a*a;return l>0&&(l=1/Math.sqrt(l)),i[0]=n*l,i[1]=o*l,i[2]=s*l,i[3]=a*l,i},i.number=eO,i.ortho=function(i,r,n,o,s,a,l){var u=1/(r-n),h=1/(o-s),c=1/(a-l);return i[0]=-2*u,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*h,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*c,i[11]=0,i[12]=(r+n)*u,i[13]=(s+o)*h,i[14]=(l+a)*c,i[15]=1,i},i.pbf=at,i.perspective=function(i,r,n,o,s){var a,l=1/Math.tan(r/2);return i[0]=l/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=s&&s!==1/0?(i[10]=(s+o)*(a=1/(o-s)),i[14]=2*s*o*a):(i[10]=-1,i[14]=-2*o),i},i.pick=function(i,r){let n={};for(let o=0;o<r.length;o++){let s=r[o];s in i&&(n[s]=i[s])}return n},i.plugin=r4,i.pointGeometry=u,i.polygonIntersectsBox=oC,i.polygonIntersectsPolygon=ob,i.polygonizeBounds=function(i,r,n=0,o=!0){let s=new u(n,n),a=i.sub(s),l=r.add(s),h=[a,new u(l.x,a.y),l,new u(a.x,l.y)];return o&&h.push(a),h},i.posAttributes=lF,i.postMapLoadEvent=tu,i.postTurnstileEvent=ta,i.potpack=av,i.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},i.radToDeg=function(i){return i*f},i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(i){return i({pluginStatus:rJ,pluginURL:rQ}),r2.on("pluginStateChange",i),i},i.removeAuthState=function(i){tp.delete(i)},i.renderColorRamp=o6,i.rotateX=function(i,r,n){var o=Math.sin(n),s=Math.cos(n),a=r[4],l=r[5],u=r[6],h=r[7],c=r[8],p=r[9],f=r[10],d=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=a*s+c*o,i[5]=l*s+p*o,i[6]=u*s+f*o,i[7]=h*s+d*o,i[8]=c*s-a*o,i[9]=p*s-l*o,i[10]=f*s-u*o,i[11]=d*s-h*o,i},i.rotateX$1=oY,i.rotateY=function(i,r,n){var o=Math.sin(n),s=Math.cos(n),a=r[0],l=r[1],u=r[2],h=r[3],c=r[8],p=r[9],f=r[10],d=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=a*s-c*o,i[1]=l*s-p*o,i[2]=u*s-f*o,i[3]=h*s-d*o,i[8]=a*o+c*s,i[9]=l*o+p*s,i[10]=u*o+f*s,i[11]=h*o+d*s,i},i.rotateZ=function(i,r,n){var o=Math.sin(n),s=Math.cos(n),a=r[0],l=r[1],u=r[2],h=r[3],c=r[4],p=r[5],f=r[6],d=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=a*s+c*o,i[1]=l*s+p*o,i[2]=u*s+f*o,i[3]=h*s+d*o,i[4]=c*s-a*o,i[5]=p*s-l*o,i[6]=f*s-u*o,i[7]=d*s-h*o,i},i.rotateZ$1=function(i,r,n){n*=.5;var o=r[0],s=r[1],a=r[2],l=r[3],u=Math.sin(n),h=Math.cos(n);return i[0]=o*h+s*u,i[1]=s*h-o*u,i[2]=a*h+l*u,i[3]=l*h-a*u,i},i.scale=function(i,r,n){return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i},i.scale$1=function(i,r,n){var o=n[0],s=n[1],a=n[2];return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=r[3]*o,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=r[7]*s,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=r[11]*a,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i},i.scale$2=function(i,r,n){return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=r[3]*n,i},i.scaleAndAdd=oj,i.setCacheLimits=function(i,r){tg=i,ty=r},i.setRTLTextPlugin=function(i,r,n=!1){if(rJ===rW||rJ===rH||rJ===rY)throw Error("setRTLTextPlugin cannot be called multiple times.");rQ=j.resolveURL(i),rJ=rW,rK=r,r1(),n||r5()},i.smoothstep=function(i,r,n){return(n=_((n-i)/(r-i),0,1))*n*(3-2*n)},i.spec=tN,i.storeAuthState=function(i,r){r?tp.add(i):tp.delete(i)},i.sub=oV,i.subtract=oV,i.symbolSize=s6,i.transformMat3=function(i,r,n){var o=r[0],s=r[1],a=r[2];return i[0]=o*n[0]+s*n[3]+a*n[6],i[1]=o*n[1]+s*n[4]+a*n[7],i[2]=o*n[2]+s*n[5]+a*n[8],i},i.transformMat4=o$,i.transformMat4$1=function(i,r,n){var o=r[0],s=r[1],a=r[2],l=n[3]*o+n[7]*s+n[11]*a+n[15];return i[0]=(n[0]*o+n[4]*s+n[8]*a+n[12])/(l=l||1),i[1]=(n[1]*o+n[5]*s+n[9]*a+n[13])/l,i[2]=(n[2]*o+n[6]*s+n[10]*a+n[14])/l,i},i.transformQuat=oX,i.translate=function(i,r,n){var o,s,a,l,u,h,c,p,f,d,m,g,y=n[0],_=n[1],v=n[2];return r===i?(i[12]=r[0]*y+r[4]*_+r[8]*v+r[12],i[13]=r[1]*y+r[5]*_+r[9]*v+r[13],i[14]=r[2]*y+r[6]*_+r[10]*v+r[14],i[15]=r[3]*y+r[7]*_+r[11]*v+r[15]):(s=r[1],a=r[2],l=r[3],u=r[4],h=r[5],c=r[6],p=r[7],f=r[8],d=r[9],m=r[10],g=r[11],i[0]=o=r[0],i[1]=s,i[2]=a,i[3]=l,i[4]=u,i[5]=h,i[6]=c,i[7]=p,i[8]=f,i[9]=d,i[10]=m,i[11]=g,i[12]=o*y+u*_+f*v+r[12],i[13]=s*y+h*_+d*v+r[13],i[14]=a*y+c*_+m*v+r[14],i[15]=l*y+p*_+g*v+r[15]),i},i.triggerPluginCompletionEvent=r0,i.uniqueId=I,i.validateCustomStyleLayer=function(i){let r=[],n=i.id;return void 0===n&&r.push({message:`layers.${n}: missing required property "id"`}),void 0===i.render&&r.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&r.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),r},i.validateFog=rr,i.validateLight=ri,i.validateStyle=i7,i.values=b,i.vectorTile=sD,i.version=a,i.warnOnce=D,i.window=c,i.wrap=v}),o(["./shared"],function(i){class r{constructor(i){this.keyCache={},i&&this.replace(i)}replace(i){this._layerConfigs={},this._layers={},this.update(i,[])}update(r,n){for(let n of r){this._layerConfigs[n.id]=n;let r=this._layers[n.id]=i.createStyleLayer(n);r._featureFilter=i.createFilter(r.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(let i of n)delete this.keyCache[i],delete this._layerConfigs[i],delete this._layers[i];for(let r of(this.familiesBySource={},function(r,n){let o={};for(let s=0;s<r.length;s++){let a=n&&n[r[s].id]||function(r){let n="";for(let o of i.refProperties)n+=`/${function i(r){let n=typeof r;if("number"===n||"boolean"===n||"string"===n||null==r)return JSON.stringify(r);if(Array.isArray(r)){let n="[";for(let o of r)n+=`${i(o)},`;return`${n}]`}let o=Object.keys(r).sort(),s="{";for(let n=0;n<o.length;n++)s+=`${JSON.stringify(o[n])}:${i(r[o[n]])},`;return`${s}}`}(r[o])}`;return n}(r[s]);n&&(n[r[s].id]=a);let l=o[a];l||(l=o[a]=[]),l.push(r[s])}let s=[];for(let i in o)s.push(o[i]);return s}(i.values(this._layerConfigs),this.keyCache))){let i=r.map(i=>this._layers[i.id]),n=i[0];if("none"===n.visibility)continue;let o=n.source||"",s=this.familiesBySource[o];s||(s=this.familiesBySource[o]={});let a=n.sourceLayer||"_geojsonTileLayer",l=s[a];l||(l=s[a]=[]),l.push(i)}}}let{ImageBitmap:n}=i.window;class o{loadTile(r,o){let{uid:s,encoding:a,rawImageData:l,padding:u,buildQuadTree:h}=r,c=n&&l instanceof n?this.getImageData(l,u):l;o(null,new i.DEMData(s,c,a,u<1,h))}getImageData(r,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(r.width,r.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=r.width,this.offscreenCanvas.height=r.height,this.offscreenCanvasContext.drawImage(r,0,0,r.width,r.height);let o=this.offscreenCanvasContext.getImageData(-n,-n,r.width+2*n,r.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new i.RGBAImage({width:o.width,height:o.height},o.data)}}var s,a=function i(r,n){var o,s=r&&r.type;if("FeatureCollection"===s)for(o=0;o<r.features.length;o++)i(r.features[o],n);else if("GeometryCollection"===s)for(o=0;o<r.geometries.length;o++)i(r.geometries[o],n);else if("Feature"===s)i(r.geometry,n);else if("Polygon"===s)l(r.coordinates,n);else if("MultiPolygon"===s)for(o=0;o<r.coordinates.length;o++)l(r.coordinates[o],n);return r};function l(i,r){if(0!==i.length){u(i[0],r);for(var n=1;n<i.length;n++)u(i[n],!r)}}function u(i,r){for(var n=0,o=0,s=i.length,a=s-1;o<s;a=o++)n+=(i[o][0]-i[a][0])*(i[a][1]+i[o][1]);n>=0!=!!r&&i.reverse()}let h=i.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(r){this._feature=r,this.extent=i.EXTENT,this.type=r.type,this.properties=r.tags,"id"in r&&!isNaN(r.id)&&(this.id=parseInt(r.id,10))}loadGeometry(){if(1===this._feature.type){let r=[];for(let n of this._feature.geometry)r.push([new i.pointGeometry(n[0],n[1])]);return r}{let r=[];for(let n of this._feature.geometry){let o=[];for(let r of n)o.push(new i.pointGeometry(r[0],r[1]));r.push(o)}return r}}toGeoJSON(i,r,n){return h.call(this,i,r,n)}}class p{constructor(r){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=r.length,this._features=r}feature(i){return new c(this._features[i])}}var f=i.vectorTile.VectorTileFeature;function d(i,r){this.options=r||{},this.features=i,this.length=i.length}function m(i,r){this.id="number"==typeof i.id?i.id:void 0,this.type=i.type,this.rawGeometry=1===i.type?[i.geometry]:i.geometry,this.properties=i.tags,this.extent=r||4096}d.prototype.feature=function(i){return new m(this.features[i],this.options.extent)},m.prototype.loadGeometry=function(){var r=this.rawGeometry;this.geometry=[];for(var n=0;n<r.length;n++){for(var o=r[n],s=[],a=0;a<o.length;a++)s.push(new i.pointGeometry(o[a][0],o[a][1]));this.geometry.push(s)}return this.geometry},m.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var i=this.geometry,r=1/0,n=-1/0,o=1/0,s=-1/0,a=0;a<i.length;a++)for(var l=i[a],u=0;u<l.length;u++){var h=l[u];r=Math.min(r,h.x),n=Math.max(n,h.x),o=Math.min(o,h.y),s=Math.max(s,h.y)}return[r,o,n,s]},m.prototype.toGeoJSON=f.prototype.toGeoJSON;var g=y;function y(r){var n=new i.pbf;return function(i,r){for(var n in i.layers)r.writeMessage(3,_,i.layers[n])}(r,n),n.finish()}function _(i,r){r.writeVarintField(15,i.version||1),r.writeStringField(1,i.name||""),r.writeVarintField(5,i.extent||4096);var n,o={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<i.length;n++)o.feature=i.feature(n),r.writeMessage(2,v,o);var s=o.keys;for(n=0;n<s.length;n++)r.writeStringField(3,s[n]);var a=o.values;for(n=0;n<a.length;n++)r.writeMessage(4,w,a[n])}function v(i,r){var n=i.feature;void 0!==n.id&&r.writeVarintField(1,n.id),r.writeMessage(2,x,i),r.writeVarintField(3,n.type),r.writeMessage(4,b,n)}function x(i,r){var n=i.feature,o=i.keys,s=i.values,a=i.keycache,l=i.valuecache;for(var u in n.properties){var h=a[u];void 0===h&&(o.push(u),a[u]=h=o.length-1),r.writeVarint(h);var c=n.properties[u],p=typeof c;"string"!==p&&"boolean"!==p&&"number"!==p&&(c=JSON.stringify(c));var f=p+":"+c,d=l[f];void 0===d&&(s.push(c),l[f]=d=s.length-1),r.writeVarint(d)}}function b(i,r){for(var n=i.loadGeometry(),o=i.type,s=0,a=0,l=n.length,u=0;u<l;u++){var h=n[u],c=1;1===o&&(c=h.length),r.writeVarint((c<<3)+1);for(var p=3===o?h.length-1:h.length,f=0;f<p;f++){1===f&&1!==o&&r.writeVarint((p-1<<3)+2);var d=h[f].x-s,m=h[f].y-a;r.writeVarint(d<<1^d>>31),r.writeVarint(m<<1^m>>31),s+=d,a+=m}3===o&&r.writeVarint(15)}}function w(i,r){var n=typeof i;"string"===n?r.writeStringField(1,i):"boolean"===n?r.writeBooleanField(7,i):"number"===n&&(i%1!=0?r.writeDoubleField(3,i):i<0?r.writeSVarintField(6,i):r.writeVarintField(5,i))}function E(i,r,n,o){I(i,n,o),I(r,2*n,2*o),I(r,2*n+1,2*o+1)}function I(i,r,n){let o=i[r];i[r]=i[n],i[n]=o}function S(i,r,n,o){let s=i-n,a=r-o;return s*s+a*a}g.fromVectorTileJs=y,g.fromGeojsonVt=function(i,r){r=r||{};var n={};for(var o in i)n[o]=new d(i[o].features,r),n[o].name=o,n[o].version=r.version,n[o].extent=r.extent;return y({layers:n})},g.GeoJSONWrapper=d;let M=i=>i[0],T=i=>i[1];class C{constructor(i,r=M,n=T,o=64,s=Float64Array){this.nodeSize=o,this.points=i;let a=i.length<65536?Uint16Array:Uint32Array,l=this.ids=new a(i.length),u=this.coords=new s(2*i.length);for(let o=0;o<i.length;o++)l[o]=o,u[2*o]=r(i[o]),u[2*o+1]=n(i[o]);!function i(r,n,o,s,a,l){if(a-s<=o)return;let u=s+a>>1;(function i(r,n,o,s,a,l){for(;a>s;){if(a-s>600){let u=a-s+1,h=o-s+1,c=Math.log(u),p=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*p*(u-p)/u)*(h-u/2<0?-1:1);i(r,n,o,Math.max(s,Math.floor(o-h*p/u+f)),Math.min(a,Math.floor(o+(u-h)*p/u+f)),l)}let u=n[2*o+l],h=s,c=a;for(E(r,n,s,o),n[2*a+l]>u&&E(r,n,s,a);h<c;){for(E(r,n,h,c),h++,c--;n[2*h+l]<u;)h++;for(;n[2*c+l]>u;)c--}n[2*s+l]===u?E(r,n,s,c):E(r,n,++c,a),c<=o&&(s=c+1),o<=c&&(a=c-1)}})(r,n,u,s,a,l%2),i(r,n,o,s,u-1,l+1),i(r,n,o,u+1,a,l+1)}(l,u,o,0,l.length-1,0)}range(i,r,n,o){return function(i,r,n,o,s,a,l){let u,h;let c=[0,i.length-1,0],p=[];for(;c.length;){let f=c.pop(),d=c.pop(),m=c.pop();if(d-m<=l){for(let l=m;l<=d;l++)u=r[2*l],h=r[2*l+1],u>=n&&u<=s&&h>=o&&h<=a&&p.push(i[l]);continue}let g=Math.floor((m+d)/2);u=r[2*g],h=r[2*g+1],u>=n&&u<=s&&h>=o&&h<=a&&p.push(i[g]);let y=(f+1)%2;(0===f?n<=u:o<=h)&&(c.push(m),c.push(g-1),c.push(y)),(0===f?s>=u:a>=h)&&(c.push(g+1),c.push(d),c.push(y))}return p}(this.ids,this.coords,i,r,n,o,this.nodeSize)}within(i,r,n){return function(i,r,n,o,s,a){let l=[0,i.length-1,0],u=[],h=s*s;for(;l.length;){let c=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a){for(let s=f;s<=p;s++)S(r[2*s],r[2*s+1],n,o)<=h&&u.push(i[s]);continue}let d=Math.floor((f+p)/2),m=r[2*d],g=r[2*d+1];S(m,g,n,o)<=h&&u.push(i[d]);let y=(c+1)%2;(0===c?n-s<=m:o-s<=g)&&(l.push(f),l.push(d-1),l.push(y)),(0===c?n+s>=m:o+s>=g)&&(l.push(d+1),l.push(p),l.push(y))}return u}(this.ids,this.coords,i,r,n,this.nodeSize)}}let P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:i=>i},A=Math.fround||(s=new Float32Array(1),i=>(s[0]=+i,s[0]));class L{constructor(i){this.options=O(Object.create(P),i),this.trees=Array(this.options.maxZoom+1)}load(i){let{log:r,minZoom:n,maxZoom:o,nodeSize:s}=this.options;r&&console.time("total time");let a=`prepare ${i.length} points`;r&&console.time(a),this.points=i;let l=[];for(let r=0;r<i.length;r++)i[r].geometry&&l.push(function(i,r){let[n,o]=i.geometry.coordinates;return{x:A(D(n)),y:A(N(o)),zoom:1/0,index:r,parentId:-1}}(i[r],r));this.trees[o+1]=new C(l,z,F,s,Float32Array),r&&console.timeEnd(a);for(let i=o;i>=n;i--){let n=+Date.now();l=this._cluster(l,i),this.trees[i]=new C(l,z,F,s,Float32Array),r&&console.log("z%d: %d clusters in %dms",i,l.length,+Date.now()-n)}return r&&console.timeEnd("total time"),this}getClusters(i,r){let n=((i[0]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,i[1])),s=180===i[2]?180:((i[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,i[3]));if(i[2]-i[0]>=360)n=-180,s=180;else if(n>s){let i=this.getClusters([n,o,180,a],r),l=this.getClusters([-180,o,s,a],r);return i.concat(l)}let l=this.trees[this._limitZoom(r)],u=l.range(D(n),N(a),D(s),N(o)),h=[];for(let i of u){let r=l.points[i];h.push(r.numPoints?k(r):this.points[r.index])}return h}getChildren(i){let r=this._getOriginId(i),n=this._getOriginZoom(i),o="No cluster with the specified id.",s=this.trees[n];if(!s)throw Error(o);let a=s.points[r];if(!a)throw Error(o);let l=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=s.within(a.x,a.y,l),h=[];for(let r of u){let n=s.points[r];n.parentId===i&&h.push(n.numPoints?k(n):this.points[n.index])}if(0===h.length)throw Error(o);return h}getLeaves(i,r,n){let o=[];return this._appendLeaves(o,i,r=r||10,n=n||0,0),o}getTile(i,r,n){let o=this.trees[this._limitZoom(i)],s=Math.pow(2,i),{extent:a,radius:l}=this.options,u=l/a,h=(n-u)/s,c=(n+1+u)/s,p={features:[]};return this._addTileFeatures(o.range((r-u)/s,h,(r+1+u)/s,c),o.points,r,n,s,p),0===r&&this._addTileFeatures(o.range(1-u/s,h,1,c),o.points,s,n,s,p),r===s-1&&this._addTileFeatures(o.range(0,h,u/s,c),o.points,-1,n,s,p),p.features.length?p:null}getClusterExpansionZoom(i){let r=this._getOriginZoom(i)-1;for(;r<=this.options.maxZoom;){let n=this.getChildren(i);if(r++,1!==n.length)break;i=n[0].properties.cluster_id}return r}_appendLeaves(i,r,n,o,s){for(let a of this.getChildren(r)){let r=a.properties;if(r&&r.cluster?s+r.point_count<=o?s+=r.point_count:s=this._appendLeaves(i,r.cluster_id,n,o,s):s<o?s++:i.push(a),i.length===n)break}return s}_addTileFeatures(i,r,n,o,s,a){for(let l of i){let i,u,h,c;let p=r[l],f=p.numPoints;if(f)i=R(p),u=p.x,h=p.y;else{let r=this.points[p.index];i=r.properties,u=D(r.geometry.coordinates[0]),h=N(r.geometry.coordinates[1])}let d={type:1,geometry:[[Math.round(this.options.extent*(u*s-n)),Math.round(this.options.extent*(h*s-o))]],tags:i};f?c=p.id:this.options.generateId?c=p.index:this.points[p.index].id&&(c=this.points[p.index].id),void 0!==c&&(d.id=c),a.features.push(d)}}_limitZoom(i){return Math.max(this.options.minZoom,Math.min(+i,this.options.maxZoom+1))}_cluster(i,r){let n=[],{radius:o,extent:s,reduce:a,minPoints:l}=this.options,u=o/(s*Math.pow(2,r));for(let o=0;o<i.length;o++){let s=i[o];if(s.zoom<=r)continue;s.zoom=r;let d=this.trees[r+1],m=d.within(s.x,s.y,u),g=s.numPoints||1,y=g;for(let i of m){let n=d.points[i];n.zoom>r&&(y+=n.numPoints||1)}if(y>=l){var h,c,p,f;let i=s.x*g,l=s.y*g,u=a&&g>1?this._map(s,!0):null,_=(o<<5)+(r+1)+this.points.length;for(let n of m){let o=d.points[n];if(o.zoom<=r)continue;o.zoom=r;let h=o.numPoints||1;i+=o.x*h,l+=o.y*h,o.parentId=_,a&&(u||(u=this._map(s,!0)),a(u,this._map(o)))}s.parentId=_,n.push((h=i/y,c=l/y,p=y,f=u,{x:A(h),y:A(c),zoom:1/0,id:_,parentId:-1,numPoints:p,properties:f}))}else if(n.push(s),y>1)for(let i of m){let o=d.points[i];o.zoom<=r||(o.zoom=r,n.push(o))}}return n}_getOriginId(i){return i-this.points.length>>5}_getOriginZoom(i){return(i-this.points.length)%32}_map(i,r){if(i.numPoints)return r?O({},i.properties):i.properties;let n=this.points[i.index].properties,o=this.options.map(n);return r&&o===n?O({},o):o}}function k(i){return{type:"Feature",id:i.id,properties:R(i),geometry:{type:"Point",coordinates:[360*(i.x-.5),360*Math.atan(Math.exp((180-360*i.y)*Math.PI/180))/Math.PI-90]}}}function R(i){let r=i.numPoints,n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r;return O(O({},i.properties),{cluster:!0,cluster_id:i.id,point_count:r,point_count_abbreviated:n})}function D(i){return i/360+.5}function N(i){let r=Math.sin(i*Math.PI/180),n=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return n<0?0:n>1?1:n}function O(i,r){for(let n in r)i[n]=r[n];return i}function z(i){return i.x}function F(i){return i.y}function B(i,r,n,o){var s={id:void 0===i?null:i,type:r,geometry:n,tags:o,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(i){var r=i.geometry,n=i.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)U(i,r);else if("Polygon"===n||"MultiLineString"===n)for(var o=0;o<r.length;o++)U(i,r[o]);else if("MultiPolygon"===n)for(o=0;o<r.length;o++)for(var s=0;s<r[o].length;s++)U(i,r[o][s])}(s),s}function U(i,r){for(var n=0;n<r.length;n+=3)i.minX=Math.min(i.minX,r[n]),i.minY=Math.min(i.minY,r[n+1]),i.maxX=Math.max(i.maxX,r[n]),i.maxY=Math.max(i.maxY,r[n+1])}function G(i,r,n,o){if(r.geometry){var s=r.geometry.coordinates,a=r.geometry.type,l=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),u=[],h=r.id;if(n.promoteId?h=r.properties[n.promoteId]:n.generateId&&(h=o||0),"Point"===a)V(s,u);else if("MultiPoint"===a)for(var c=0;c<s.length;c++)V(s[c],u);else if("LineString"===a)q(s,u,l,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(c=0;c<s.length;c++)q(s[c],u=[],l,!1),i.push(B(h,"LineString",u,r.properties));return}j(s,u,l,!1)}else if("Polygon"===a)j(s,u,l,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<r.geometry.geometries.length;c++)G(i,{id:h,geometry:r.geometry.geometries[c],properties:r.properties},n,o);return}throw Error("Input data is not a valid GeoJSON object.")}for(c=0;c<s.length;c++){var p=[];j(s[c],p,l,!0),u.push(p)}}i.push(B(h,a,u,r.properties))}}function V(i,r){r.push(i[0]/360+.5),r.push(Z(i[1])),r.push(0)}function q(i,r,n,o){for(var s,a,l=0,u=0;u<i.length;u++){var h=i[u][0]/360+.5,c=Z(i[u][1]);r.push(h),r.push(c),r.push(0),u>0&&(l+=o?(s*c-h*a)/2:Math.sqrt(Math.pow(h-s,2)+Math.pow(c-a,2))),s=h,a=c}var p=r.length-3;r[2]=1,function i(r,n,o,s){for(var a,l=s,u=o-n>>1,h=o-n,c=r[n],p=r[n+1],f=r[o],d=r[o+1],m=n+3;m<o;m+=3){var g=function(i,r,n,o,s,a){var l=s-n,u=a-o;if(0!==l||0!==u){var h=((i-n)*l+(r-o)*u)/(l*l+u*u);h>1?(n=s,o=a):h>0&&(n+=l*h,o+=u*h)}return(l=i-n)*l+(u=r-o)*u}(r[m],r[m+1],c,p,f,d);if(g>l)a=m,l=g;else if(g===l){var y=Math.abs(m-u);y<h&&(a=m,h=y)}}l>s&&(a-n>3&&i(r,n,a,s),r[a+2]=l,o-a>3&&i(r,a,o,s))}(r,0,p,n),r[p+2]=1,r.size=Math.abs(l),r.start=0,r.end=r.size}function j(i,r,n,o){for(var s=0;s<i.length;s++){var a=[];q(i[s],a,n,o),r.push(a)}}function Z(i){var r=Math.sin(i*Math.PI/180),n=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return n<0?0:n>1?1:n}function X(i,r,n,o,s,a,l,u){if(o/=r,a>=(n/=r)&&l<o)return i;if(l<n||a>=o)return null;for(var h=[],c=0;c<i.length;c++){var p=i[c],f=p.geometry,d=p.type,m=0===s?p.minX:p.minY,g=0===s?p.maxX:p.maxY;if(m>=n&&g<o)h.push(p);else if(!(g<n||m>=o)){var y=[];if("Point"===d||"MultiPoint"===d)(function(i,r,n,o,s){for(var a=0;a<i.length;a+=3){var l=i[a+s];l>=n&&l<=o&&(r.push(i[a]),r.push(i[a+1]),r.push(i[a+2]))}})(f,y,n,o,s);else if("LineString"===d)$(f,y,n,o,s,!1,u.lineMetrics);else if("MultiLineString"===d)H(f,y,n,o,s,!1);else if("Polygon"===d)H(f,y,n,o,s,!0);else if("MultiPolygon"===d)for(var _=0;_<f.length;_++){var v=[];H(f[_],v,n,o,s,!0),v.length&&y.push(v)}if(y.length){if(u.lineMetrics&&"LineString"===d){for(_=0;_<y.length;_++)h.push(B(p.id,d,y[_],p.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===y.length?(d="LineString",y=y[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===y.length?"Point":"MultiPoint"),h.push(B(p.id,d,y,p.tags))}}}return h.length?h:null}function $(i,r,n,o,s,a,l){for(var u,h,c=W(i),p=0===s?K:J,f=i.start,d=0;d<i.length-3;d+=3){var m=i[d],g=i[d+1],y=i[d+2],_=i[d+3],v=i[d+4],x=0===s?m:g,b=0===s?_:v,w=!1;l&&(u=Math.sqrt(Math.pow(m-_,2)+Math.pow(g-v,2))),x<n?b>n&&(h=p(c,m,g,_,v,n),l&&(c.start=f+u*h)):x>o?b<o&&(h=p(c,m,g,_,v,o),l&&(c.start=f+u*h)):Y(c,m,g,y),b<n&&x>=n&&(h=p(c,m,g,_,v,n),w=!0),b>o&&x<=o&&(h=p(c,m,g,_,v,o),w=!0),!a&&w&&(l&&(c.end=f+u*h),r.push(c),c=W(i)),l&&(f+=u)}var E=i.length-3;m=i[E],g=i[E+1],y=i[E+2],(x=0===s?m:g)>=n&&x<=o&&Y(c,m,g,y),E=c.length-3,a&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&Y(c,c[0],c[1],c[2]),c.length&&r.push(c)}function W(i){var r=[];return r.size=i.size,r.start=i.start,r.end=i.end,r}function H(i,r,n,o,s,a){for(var l=0;l<i.length;l++)$(i[l],r,n,o,s,a,!1)}function Y(i,r,n,o){i.push(r),i.push(n),i.push(o)}function K(i,r,n,o,s,a){var l=(a-r)/(o-r);return i.push(a),i.push(n+(s-n)*l),i.push(1),l}function J(i,r,n,o,s,a){var l=(a-n)/(s-n);return i.push(r+(o-r)*l),i.push(a),i.push(1),l}function Q(i,r){for(var n=[],o=0;o<i.length;o++){var s,a=i[o],l=a.type;if("Point"===l||"MultiPoint"===l||"LineString"===l)s=tt(a.geometry,r);else if("MultiLineString"===l||"Polygon"===l){s=[];for(var u=0;u<a.geometry.length;u++)s.push(tt(a.geometry[u],r))}else if("MultiPolygon"===l)for(s=[],u=0;u<a.geometry.length;u++){for(var h=[],c=0;c<a.geometry[u].length;c++)h.push(tt(a.geometry[u][c],r));s.push(h)}n.push(B(a.id,l,s,a.tags))}return n}function tt(i,r){var n=[];n.size=i.size,void 0!==i.start&&(n.start=i.start,n.end=i.end);for(var o=0;o<i.length;o+=3)n.push(i[o]+r,i[o+1],i[o+2]);return n}function te(i,r){if(i.transformed)return i;var n,o,s,a=1<<i.z,l=i.x,u=i.y;for(n=0;n<i.features.length;n++){var h=i.features[n],c=h.geometry,p=h.type;if(h.geometry=[],1===p)for(o=0;o<c.length;o+=2)h.geometry.push(ti(c[o],c[o+1],r,a,l,u));else for(o=0;o<c.length;o++){var f=[];for(s=0;s<c[o].length;s+=2)f.push(ti(c[o][s],c[o][s+1],r,a,l,u));h.geometry.push(f)}}return i.transformed=!0,i}function ti(i,r,n,o,s,a){return[Math.round(n*(i*o-s)),Math.round(n*(r*o-a))]}function tr(i,r,n,o,s,a){var l=o*o;if(o>0&&r.size<(s?l:o))n.numPoints+=r.length/3;else{for(var u=[],h=0;h<r.length;h+=3)(0===o||r[h+2]>l)&&(n.numSimplified++,u.push(r[h]),u.push(r[h+1])),n.numPoints++;s&&function(i,r){for(var n=0,o=0,s=i.length,a=s-2;o<s;a=o,o+=2)n+=(i[o]-i[a])*(i[o+1]+i[a+1]);if(n>0===r)for(o=0,s=i.length;o<s/2;o+=2){var l=i[o],u=i[o+1];i[o]=i[s-2-o],i[o+1]=i[s-1-o],i[s-2-o]=l,i[s-1-o]=u}}(u,a),i.push(u)}}function tn(i,r){var n,o,s,a,l,u,h=(r=this.options=function(i,r){for(var n in r)i[n]=r[n];return i}(Object.create(this.options),r)).debug;if(h&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw Error("promoteId and generateId cannot be used together.");var c=function(i,r){var n=[];if("FeatureCollection"===i.type)for(var o=0;o<i.features.length;o++)G(n,i.features[o],r,o);else G(n,"Feature"===i.type?i:{geometry:i},r);return n}(i,r);this.tiles={},this.tileCoords=[],h&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=c,s=(o=r).buffer/o.extent,a=n,l=X(n,1,-1-s,s,0,-1,2,o),u=X(n,1,1-s,2+s,0,-1,2,o),(l||u)&&(a=X(n,1,-s,1+s,0,-1,2,o)||[],l&&(a=Q(l,1).concat(a)),u&&(a=a.concat(Q(u,-1)))),c=a).length&&this.splitTile(c,0,0,0),h&&(c.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function to(i,r,n){return 32*((1<<i)*n+r)+i}function ts(i,r){let n=i.tileID.canonical;if(!this._geoJSONIndex)return r(null,null);let o=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!o)return r(null,null);let s=new p(o.features),a=g(s);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),r(null,{vectorTile:s,rawData:a.buffer})}tn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tn.prototype.splitTile=function(i,r,n,o,s,a,l){for(var u=[i,r,n,o],h=this.options,c=h.debug;u.length;){o=u.pop(),n=u.pop(),r=u.pop(),i=u.pop();var p=1<<r,f=to(r,n,o),d=this.tiles[f];if(!d&&(c>1&&console.time("creation"),d=this.tiles[f]=function(i,r,n,o,s){for(var a=r===s.maxZoom?0:s.tolerance/((1<<r)*s.extent),l={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:o,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},u=0;u<i.length;u++){l.numFeatures++,function(i,r,n,o){var s=r.geometry,a=r.type,l=[];if("Point"===a||"MultiPoint"===a)for(var u=0;u<s.length;u+=3)l.push(s[u]),l.push(s[u+1]),i.numPoints++,i.numSimplified++;else if("LineString"===a)tr(l,s,i,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(u=0;u<s.length;u++)tr(l,s[u],i,n,"Polygon"===a,0===u);else if("MultiPolygon"===a)for(var h=0;h<s.length;h++){var c=s[h];for(u=0;u<c.length;u++)tr(l,c[u],i,n,!0,0===u)}if(l.length){var p=r.tags||null;if("LineString"===a&&o.lineMetrics){for(var f in p={},r.tags)p[f]=r.tags[f];p.mapbox_clip_start=s.start/s.size,p.mapbox_clip_end=s.end/s.size}var d={geometry:l,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:p};null!==r.id&&(d.id=r.id),i.features.push(d)}}(l,i[u],a,s);var h=i[u].minX,c=i[u].minY,p=i[u].maxX,f=i[u].maxY;h<l.minX&&(l.minX=h),c<l.minY&&(l.minY=c),p>l.maxX&&(l.maxX=p),f>l.maxY&&(l.maxY=f)}return l}(i,r,n,o,h),this.tileCoords.push({z:r,x:n,y:o}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,n,o,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var m="z"+r;this.stats[m]=(this.stats[m]||0)+1,this.total++}if(d.source=i,s){if(r===h.maxZoom||r===s)continue;var g=1<<s-r;if(n!==Math.floor(a/g)||o!==Math.floor(l/g))continue}else if(r===h.indexMaxZoom||d.numPoints<=h.indexMaxPoints)continue;if(d.source=null,0!==i.length){c>1&&console.time("clipping");var y,_,v,x,b,w,E=.5*h.buffer/h.extent,I=.5-E,S=.5+E,M=1+E;y=_=v=x=null,b=X(i,p,n-E,n+S,0,d.minX,d.maxX,h),w=X(i,p,n+I,n+M,0,d.minX,d.maxX,h),i=null,b&&(y=X(b,p,o-E,o+S,1,d.minY,d.maxY,h),_=X(b,p,o+I,o+M,1,d.minY,d.maxY,h),b=null),w&&(v=X(w,p,o-E,o+S,1,d.minY,d.maxY,h),x=X(w,p,o+I,o+M,1,d.minY,d.maxY,h),w=null),c>1&&console.timeEnd("clipping"),u.push(y||[],r+1,2*n,2*o),u.push(_||[],r+1,2*n,2*o+1),u.push(v||[],r+1,2*n+1,2*o),u.push(x||[],r+1,2*n+1,2*o+1)}}},tn.prototype.getTile=function(i,r,n){var o=this.options,s=o.extent,a=o.debug;if(i<0||i>24)return null;var l=1<<i,u=to(i,r=(r%l+l)%l,n);if(this.tiles[u])return te(this.tiles[u],s);a>1&&console.log("drilling down to z%d-%d-%d",i,r,n);for(var h,c=i,p=r,f=n;!h&&c>0;)c--,p=Math.floor(p/2),f=Math.floor(f/2),h=this.tiles[to(c,p,f)];return h&&h.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,p,f),a>1&&console.time("drilling down"),this.splitTile(h.source,c,p,f,i,r,n),a>1&&console.timeEnd("drilling down"),this.tiles[u]?te(this.tiles[u],s):null):null};class ta extends i.VectorTileWorkerSource{constructor(i,r,n,o,s){super(i,r,n,o,ts),s&&(this.loadGeoJSON=s)}loadData(r,n){let o=r&&r.request,s=o&&o.collectResourceTiming;this.loadGeoJSON(r,(l,u)=>{if(l||!u)return n(l);if("object"!=typeof u)return n(Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));{a(u,!0);try{var h,c;if(r.filter){let n=i.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw Error(n.value.map(i=>`${i.key}: ${i.message}`).join(", "));let o=u.features.filter(i=>n.value.evaluate({zoom:0},i));u={type:"FeatureCollection",features:o}}this._geoJSONIndex=r.cluster?new L(function({superclusterOptions:r,clusterProperties:n}){if(!n||!r)return r;let o={},s={},a={accumulated:null,zoom:0},l={properties:null},u=Object.keys(n);for(let r of u){let[a,l]=n[r],u=i.createExpression(l),h=i.createExpression("string"==typeof a?[a,["accumulated"],["get",r]]:a);o[r]=u.value,s[r]=h.value}return r.map=i=>{l.properties=i;let r={};for(let i of u)r[i]=o[i].evaluate(a,l);return r},r.reduce=(i,r)=>{for(let n of(l.properties=r,u))a.accumulated=i[n],i[n]=s[n].evaluate(a,l)},r}(r)).load(u.features):(h=u,c=r.geojsonVtOptions,new tn(h,c))}catch(i){return n(i)}this.loaded={};let l={};if(s){let n=i.getPerformanceMeasurement(o);n&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}})}reloadTile(i,r){let n=this.loaded;return n&&n[i.uid]?super.reloadTile(i,r):this.loadTile(i,r)}loadGeoJSON(r,n){if(r.request)i.getJSON(r.request,n);else{if("string"!=typeof r.data)return n(Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(r.data))}catch(i){return n(Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(i,r){try{r(null,this._geoJSONIndex.getClusterExpansionZoom(i.clusterId))}catch(i){r(i)}}getClusterChildren(i,r){try{r(null,this._geoJSONIndex.getChildren(i.clusterId))}catch(i){r(i)}}getClusterLeaves(i,r){try{r(null,this._geoJSONIndex.getLeaves(i.clusterId,i.limit,i.offset))}catch(i){r(i)}}}class tl{constructor(r){this.self=r,this.actor=new i.Actor(r,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:ta},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(i,r)=>{if(this.workerSourceTypes[i])throw Error(`Worker source with name "${i}" already registered.`);this.workerSourceTypes[i]=r},this.self.registerRTLTextPlugin=r=>{if(i.plugin.isParsed())throw Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=r.applyArabicShaping,i.plugin.processBidirectionalText=r.processBidirectionalText,i.plugin.processStyledBidirectionalText=r.processStyledBidirectionalText}}checkIfReady(i,r,n){n()}setReferrer(i,r){this.referrer=r}spriteLoaded(r,n){for(let o in this.isSpriteLoaded=n,this.workerSources[r]){let s=this.workerSources[r][o];for(let r in s)s[r]instanceof i.VectorTileWorkerSource&&(s[r].isSpriteLoaded=n,s[r].fire(new i.Event("isSpriteLoaded")))}}setImages(i,r,n){for(let n in this.availableImages[i]=r,this.workerSources[i]){let o=this.workerSources[i][n];for(let i in o)o[i].availableImages=r}n()}enableTerrain(i,r,n){this.terrain=r,n()}setLayers(i,r,n){this.getLayerIndex(i).replace(r),n()}updateLayers(i,r,n){this.getLayerIndex(i).update(r.layers,r.removedIds),n()}loadTile(r,n,o){let s=this.enableTerrain?i.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(r,n.type,n.source).loadTile(s,o)}loadDEMTile(r,n,o){let s=this.enableTerrain?i.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(r,n.source).loadTile(s,o)}reloadTile(r,n,o){let s=this.enableTerrain?i.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(r,n.type,n.source).reloadTile(s,o)}abortTile(i,r,n){this.getWorkerSource(i,r.type,r.source).abortTile(r,n)}removeTile(i,r,n){this.getWorkerSource(i,r.type,r.source).removeTile(r,n)}removeSource(i,r,n){if(!this.workerSources[i]||!this.workerSources[i][r.type]||!this.workerSources[i][r.type][r.source])return;let o=this.workerSources[i][r.type][r.source];delete this.workerSources[i][r.type][r.source],void 0!==o.removeSource?o.removeSource(r,n):n()}loadWorkerSource(i,r,n){try{this.self.importScripts(r.url),n()}catch(i){n(i.toString())}}syncRTLPluginState(r,n,o){try{i.plugin.setState(n);let r=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&null!=r){this.self.importScripts(r);let n=i.plugin.isParsed();o(n?void 0:Error(`RTL Text Plugin failed to import scripts from ${r}`),n)}}catch(i){o(i.toString())}}getAvailableImages(i){let r=this.availableImages[i];return r||(r=[]),r}getLayerIndex(i){let n=this.layerIndexes[i];return n||(n=this.layerIndexes[i]=new r),n}getWorkerSource(i,r,n){return this.workerSources[i]||(this.workerSources[i]={}),this.workerSources[i][r]||(this.workerSources[i][r]={}),this.workerSources[i][r][n]||(this.workerSources[i][r][n]=new this.workerSourceTypes[r]({send:(r,n,o,s,a,l)=>{this.actor.send(r,n,o,i,a,l)},scheduler:this.actor.scheduler},this.getLayerIndex(i),this.getAvailableImages(i),this.isSpriteLoaded)),this.workerSources[i][r][n]}getDEMWorkerSource(i,r){return this.demWorkerSources[i]||(this.demWorkerSources[i]={}),this.demWorkerSources[i][r]||(this.demWorkerSources[i][r]=new o),this.demWorkerSources[i][r]}enforceCacheSizeLimit(r,n){i.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(i,r,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new tl(self)),tl}),o(["./shared"],function(i){let r,n,o,s;function a(i){var r;return"undefined"!=typeof window&&"undefined"!=typeof document&&!!Array.prototype&&!!Array.prototype.every&&!!Array.prototype.filter&&!!Array.prototype.forEach&&!!Array.prototype.indexOf&&!!Array.prototype.lastIndexOf&&!!Array.prototype.map&&!!Array.prototype.some&&!!Array.prototype.reduce&&!!Array.prototype.reduceRight&&!!Array.isArray&&!!Function.prototype&&!!Function.prototype.bind&&!!Object.keys&&!!Object.create&&!!Object.getPrototypeOf&&!!Object.getOwnPropertyNames&&!!Object.isSealed&&!!Object.isFrozen&&!!Object.isExtensible&&!!Object.getOwnPropertyDescriptor&&!!Object.defineProperty&&!!Object.defineProperties&&!!Object.seal&&!!Object.freeze&&!!Object.preventExtensions&&!!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)&&!!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,r,n=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(n);try{r=new Worker(o),i=!0}catch(r){i=!1}return r&&r.terminate(),URL.revokeObjectURL(o),i}()&&"Uint8ClampedArray"in window&&!!ArrayBuffer.isView&&!!function(){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");if(!r)return!1;var n=r.getImageData(0,0,1,1);return n&&n.width===i.width}()&&(void 0===l[r=i&&i.failIfMajorPerformanceCaveat]&&(l[r]=function(i){var r,n,o,s=(r=document.createElement("canvas"),(n=Object.create(a.webGLContextAttributes)).failIfMajorPerformanceCaveat=i,r.getContext("webgl",n)||r.getContext("experimental-webgl",n));if(!s)return!1;try{o=s.createShader(s.VERTEX_SHADER)}catch(i){return!1}return!(!o||s.isContextLost())&&(s.shaderSource(o,"void main() {}"),s.compileShader(o),!0===s.getShaderParameter(o,s.COMPILE_STATUS))}(r)),!!l[r]&&!document.documentMode)}var l={};function u(i,r){if(Array.isArray(i)){if(!Array.isArray(r)||i.length!==r.length)return!1;for(let n=0;n<i.length;n++)if(!u(i[n],r[n]))return!1;return!0}if("object"==typeof i&&null!==i&&null!==r){if("object"!=typeof r||Object.keys(i).length!==Object.keys(r).length)return!1;for(let n in i)if(!u(i[n],r[n]))return!1;return!0}return i===r}a.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let h={create:function(r,n,o){let s=i.window.document.createElement(r);return void 0!==n&&(s.className=n),o&&o.appendChild(s),s},createNS:function(r,n){return i.window.document.createElementNS(r,n)}},c=i.window.document&&i.window.document.documentElement.style,p=c&&void 0!==c.userSelect?"userSelect":"WebkitUserSelect";h.disableDrag=function(){c&&p&&(r=c[p],c[p]="none")},h.enableDrag=function(){c&&p&&(c[p]=r)},h.setTransform=function(i,r){i.style.transform=r};let f=!1;try{let r=Object.defineProperty({},"passive",{get(){f=!0}});i.window.addEventListener("test",r,r),i.window.removeEventListener("test",r,r)}catch(i){f=!1}h.addEventListener=function(i,r,n,o={}){i.addEventListener(r,n,"passive"in o&&f?o:o.capture)},h.removeEventListener=function(i,r,n,o={}){i.removeEventListener(r,n,"passive"in o&&f?o:o.capture)};let d=function(r){r.preventDefault(),r.stopPropagation(),i.window.removeEventListener("click",d,!0)};function m(r,n,o){let s=r.offsetWidth===n.width?1:r.offsetWidth/n.width;return new i.pointGeometry((o.clientX-n.left)*s,(o.clientY-n.top)*s)}h.suppressClick=function(){i.window.addEventListener("click",d,!0),i.window.setTimeout(()=>{i.window.removeEventListener("click",d,!0)},0)},h.mousePos=function(i,r){let n=i.getBoundingClientRect();return m(i,n,r)},h.touchPos=function(i,r){let n=i.getBoundingClientRect(),o=[];for(let s=0;s<r.length;s++)o.push(m(i,n,r[s]));return o},h.mouseButton=function(r){return void 0!==i.window.InstallTrigger&&2===r.button&&r.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:r.button},h.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};class g{constructor(i,r){this.pos=i,this.dir=r}intersectsPlane(r,n,o){let s=i.dot(n,this.dir);if(1e-6>Math.abs(s))return!1;let a=i.dot(i.sub(i.create(),r,this.pos),n)/s,l=i.scaleAndAdd(i.create(),this.pos,this.dir,a);return i.copy(o,l),!0}}class y{constructor(i,r){this.points=i,this.planes=r}static fromInvProjectionMatrix(r,n,o){let s=Math.pow(2,o),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(o=>{let a=i.transformMat4([],o,r),l=1/a[3]/n*s;return i.mul(a,a,[l,l,1/a[3],l])}),l=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(r=>{let n=i.sub([],a[r[0]],a[r[1]]),o=i.sub([],a[r[2]],a[r[1]]),s=i.normalize([],i.cross([],n,o)),l=-i.dot(s,a[r[1]]);return s.concat(l)});return new y(a,l)}}class _{constructor(r,n){this.min=r,this.max=n,this.center=i.scale([],i.add([],this.min,this.max),.5)}quadrant(r){let n=[r%2==0,r<2],o=i.clone(this.min),s=i.clone(this.max);for(let i=0;i<n.length;i++)o[i]=n[i]?this.min[i]:this.center[i],s[i]=n[i]?this.center[i]:this.max[i];return s[2]=this.max[2],new _(o,s)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}intersects(r){let n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],o=!0;for(let s=0;s<r.planes.length;s++){let a=r.planes[s],l=0;for(let r=0;r<n.length;r++)l+=i.dot$1(a,n[r])>=0;if(0===l)return 0;l!==n.length&&(o=!1)}if(o)return 2;for(let i=0;i<3;i++){let n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let s=0;s<r.points.length;s++){let a=r.points[s][i]-this.min[i];n=Math.min(n,a),o=Math.max(o,a)}if(o<0||n>this.max[i]-this.min[i])return 0}return 1}}class v extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(let{ids:i,callback:r}of this.requestors)this._notify(i,r);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,r){this._validate(i,r)&&(this.images[i]=r)}_validate(r,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new i.ErrorEvent(Error(`Image "${r}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new i.ErrorEvent(Error(`Image "${r}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new i.ErrorEvent(Error(`Image "${r}" has invalid "content" value`))),o=!1),o}_validateStretch(i,r){if(!i)return!0;let n=0;for(let o of i){if(o[0]<n||o[1]<o[0]||r<o[1])return!1;n=o[1]}return!0}_validateContent(i,r){return!(i&&(4!==i.length||i[0]<0||r.data.width<i[0]||i[1]<0||r.data.height<i[1]||i[2]<0||r.data.width<i[2]||i[3]<0||r.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,r){r.version=this.images[i].version+1,this.images[i]=r,this.updatedImages[i]=!0}removeImage(i){let r=this.images[i];delete this.images[i],delete this.patterns[i],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,r){let n=!0;if(!this.isLoaded())for(let r of i)this.images[r]||(n=!1);this.isLoaded()||n?this._notify(i,r):this.requestors.push({ids:i,callback:r})}_notify(r,n){let o={};for(let n of r){this.images[n]||this.fire(new i.Event("styleimagemissing",{id:n}));let r=this.images[n];r?o[n]={data:r.data.clone(),pixelRatio:r.pixelRatio,sdf:r.sdf,version:r.version,stretchX:r.stretchX,stretchY:r.stretchY,content:r.content,hasRenderCallback:!!(r.userImage&&r.userImage.render)}:i.warnOnce(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){let{width:i,height:r}=this.atlasImage;return{width:i,height:r}}getPattern(r){let n=this.patterns[r],o=this.getImage(r);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{let n={w:o.data.width+2,h:o.data.height+2,x:0,y:0},s=new i.ImagePosition(n,o);this.patterns[r]={bin:n,position:s}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){let n=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(r,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){let r=[];for(let i in this.patterns)r.push(this.patterns[i].bin);let{w:n,h:o}=i.potpack(r),s=this.atlasImage;for(let r in s.resize({width:n||1,height:o||1}),this.patterns){let{bin:n}=this.patterns[r],o=n.x+1,a=n.y+1,l=this.images[r].data,u=l.width,h=l.height;i.RGBAImage.copy(l,s,{x:0,y:0},{x:o,y:a},{width:u,height:h}),i.RGBAImage.copy(l,s,{x:0,y:h-1},{x:o,y:a-1},{width:u,height:1}),i.RGBAImage.copy(l,s,{x:0,y:0},{x:o,y:a+h},{width:u,height:1}),i.RGBAImage.copy(l,s,{x:u-1,y:0},{x:o-1,y:a},{width:1,height:h}),i.RGBAImage.copy(l,s,{x:0,y:0},{x:o+u,y:a},{width:1,height:h})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(let r of i){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;let i=this.images[r];(function(i){let{userImage:r}=i;return!!(r&&r.render&&r.render())&&(i.data.replace(new Uint8Array(r.data.buffer)),!0)})(i)&&this.updateImage(r,i)}}}let x=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(r,n){return function([r,n,o]){let s=i.degToRad(n+90),a=i.degToRad(o);return{x:r*Math.cos(s)*Math.sin(a),y:r*Math.sin(s)*Math.sin(a),z:r*Math.cos(a),azimuthal:n,polar:o}}(r.expression.evaluate(n))}interpolate(r,n,o){return{x:i.number(r.x,n.x,o),y:i.number(r.y,n.y,o),z:i.number(r.z,n.z,o),azimuthal:i.number(r.azimuthal,n.azimuthal,o),polar:i.number(r.polar,n.polar,o)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)}),b="-transition";class w extends i.Evented{constructor(r){super(),this._transitionable=new i.Transitionable(x),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,n={}){if(!this._validate(i.validateLight,r,n))for(let n in r){let o=r[n];i.endsWith(n,b)?this._transitionable.setTransition(n.slice(0,-b.length),o):this._transitionable.setValue(n,o)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(r,n,o){return(!o||!1!==o.validate)&&i.emitValidationErrors(this,r.call(i.validateStyle,i.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}let E=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)}),I="-transition";class S extends i.Evented{constructor(r){super(),this._transitionable=new i.Transitionable(E),this.set(r),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(r){for(let n in r){let o=r[n];i.endsWith(n,I)?this._transitionable.setTransition(n.slice(0,-I.length),o):this._transitionable.setValue(n,o)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function M(r,n,o,s){let a=i.smoothstep(45,65,o),[l,u]=T(r,s),h=1-Math.min(1,Math.exp(-((i.length(n)-l)/(u-l)*6)));return h*=h*h,(h=Math.min(1,1.00747*h))*a*r.alpha}function T(i,r){let n=.5/Math.tan(.5*r);return[i.range[0]+n,i.range[1]+n]}let C=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"])}),P="-transition";class A extends i.Evented{constructor(r){super(),this._transitionable=new i.Transitionable(C),this.set(r),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r){if(!this._validate(i.validateFog,r))for(let n in r){let o=r[n];i.endsWith(n,P)?this._transitionable.setTransition(n.slice(0,-P.length),o):this._transitionable.setValue(n,o)}}getOpacity(r){let n=this.properties&&this.properties.get("color")||1;return i.smoothstep(45,65,r)*n.a}getOpacityAtLatLng(r,n){return function(r,n,o){let s=i.MercatorCoordinate.fromLngLat(n),a=o.elevation?o.elevation.getAtPointOrZero(s):0,l=[s.x,s.y,a];return i.transformMat4$1(l,l,o.mercatorFogMatrix),M(r,l,o.pitch,o._fov)}(this.state,r,n)}getFovAdjustedRange(i){return T(this.state,i)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(r,n,o){return(!o||!1!==o.validate)&&i.emitValidationErrors(this,r.call(i.validateStyle,i.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class L{constructor(r,n){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=i.uniqueId();let o=this.workerPool.acquire(this.id);for(let i=0;i<o.length;i++){let r=new L.Actor(o[i],n,this.id);r.name=`Worker ${i}`,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,n,o){i.asyncAll(this.actors,(i,o)=>{i.send(r,n,o)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function k(r,n,o){return n*(i.EXTENT/(r.tileSize*Math.pow(2,o-r.tileID.overscaledZ)))}L.Actor=i.Actor;class R{constructor(i,r,n,o){this.screenBounds=i,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(i=>o.pointCoordinate3D(i)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,n){let o,s;if(r instanceof i.pointGeometry||"number"==typeof r[0]){let a=i.pointGeometry.convert(r);o=[i.pointGeometry.convert(r)],s=n.isPointAboveHorizon(a)}else{let a=i.pointGeometry.convert(r[0]),l=i.pointGeometry.convert(r[1]);o=[a,l],s=i.polygonizeBounds(a,l).every(i=>n.isPointAboveHorizon(i))}return new R(o,n.getCameraPoint(),s,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return i.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let n=this.screenBounds[0],o=1===this.screenBounds.length?this.screenBounds[0].add(new i.pointGeometry(1,1)):this.screenBounds[1],s=i.polygonizeBounds(n,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<o.x?s.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?s[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(s[3]=this.cameraPoint)),i.bufferConvexPolygon(s,r)}containsTile(r,n,o){var s;let a=r.queryPadding+1,l=o?this._bufferedCameraMercator(a,n).map(i=>r.tileID.getTilePoint(i)):this._bufferedScreenMercator(a,n).map(i=>r.tileID.getTilePoint(i)),u=this.screenGeometryMercator.map(i=>r.tileID.getTileVec3(i)),h=u.map(r=>new i.pointGeometry(r[0],r[1])),c=n.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),p=r.tileID.getTileVec3(c),f=u.map(r=>{let n=i.sub(r,r,p);return i.normalize(n,n),new g(p,n)}),d=k(r,1,n.zoom);if(i.polygonIntersectsBox(l,0,0,i.EXTENT,i.EXTENT))return{queryGeometry:this,tilespaceGeometry:h,tilespaceRays:f,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:((s=i.getBounds(l)).min.x=i.clamp(s.min.x,0,i.EXTENT),s.min.y=i.clamp(s.min.y,0,i.EXTENT),s.max.x=i.clamp(s.max.x,0,i.EXTENT),s.max.y=i.clamp(s.max.y,0,i.EXTENT),s),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:d}}_bufferedScreenMercator(i,r){let n=100*i|0;if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let o=this.bufferedScreenGeometry(i).map(i=>r.pointCoordinate3D(i));return this._screenRaycastCache[n]=o,o}}_bufferedCameraMercator(i,r){let n=100*i|0;if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let o=this.bufferedCameraGeometry(i).map(i=>r.pointCoordinate3D(i));return this._cameraRaycastCache[n]=o,o}}}function D(r,n,o){let s=function(s,a){if(s)return o(s);if(a){let s=i.pick(i.extend(a,r),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(s.vectorLayers=a.vector_layers,s.vectorLayerIds=s.vectorLayers.map(i=>i.id)),s.tiles=n.canonicalizeTileset(s,r.url),o(null,s)}};return r.url?i.getJSON(n.transformRequest(n.normalizeSourceURL(r.url),i.ResourceType.Source),s):i.exported.frame(()=>s(null,r))}class N{constructor(r,n,o){this.bounds=i.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(r){let n=Math.pow(2,r.z),o=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*n),s=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*n),l=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*n);return r.x>=o&&r.x<a&&r.y>=s&&r.y<l}}class O{constructor(i,r,n){this.context=i;let o=i.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){let r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let z={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class F{constructor(i,r,n,o){this.length=r.length,this.attributes=n,this.itemSize=r.bytesPerElement,this.dynamicDraw=o,this.context=i;let s=i.gl;this.buffer=s.createBuffer(),i.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){let r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,r){for(let n=0;n<this.attributes.length;n++){let o=r.attributes[this.attributes[n].name];void 0!==o&&i.enableVertexAttribArray(o)}}setVertexAttribPointers(i,r,n){for(let o=0;o<this.attributes.length;o++){let s=this.attributes[o],a=r.attributes[s.name];void 0!==a&&i.vertexAttribPointer(a,s.components,i[z[s.type]],!1,this.itemSize,s.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class B{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class U extends B{getDefault(){return i.Color.transparent}set(i){let r=this.current;(i.r!==r.r||i.g!==r.g||i.b!==r.b||i.a!==r.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class G extends B{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class V extends B{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class q extends B{getDefault(){return[!0,!0,!0,!0]}set(i){let r=this.current;(i[0]!==r[0]||i[1]!==r[1]||i[2]!==r[2]||i[3]!==r[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class j extends B{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Z extends B{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class X extends B{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){let r=this.current;(i.func!==r.func||i.ref!==r.ref||i.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class $ extends B{getDefault(){let i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){let r=this.current;(i[0]!==r[0]||i[1]!==r[1]||i[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class W extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;i?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=i,this.dirty=!1}}class H extends B{getDefault(){return[0,1]}set(i){let r=this.current;(i[0]!==r[0]||i[1]!==r[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Y extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;i?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=i,this.dirty=!1}}class K extends B{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class J extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;i?r.enable(r.BLEND):r.disable(r.BLEND),this.current=i,this.dirty=!1}}class Q extends B{getDefault(){let i=this.gl;return[i.ONE,i.ZERO]}set(i){let r=this.current;(i[0]!==r[0]||i[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class tt extends B{getDefault(){return i.Color.transparent}set(i){let r=this.current;(i.r!==r.r||i.g!==r.g||i.b!==r.b||i.a!==r.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class te extends B{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ti extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;i?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=i,this.dirty=!1}}class tr extends B{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class tn extends B{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class to extends B{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class ts extends B{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ta extends B{getDefault(){let i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){let r=this.current;(i[0]!==r[0]||i[1]!==r[1]||i[2]!==r[2]||i[3]!==r[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class tl extends B{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class tu extends B{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class th extends B{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.bindTexture(r.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class tc extends B{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class tp extends B{getDefault(){return null}set(i){let r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class tf extends B{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class td extends B{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class tm extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class tg extends B{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ty extends B{constructor(i,r){super(i),this.context=i,this.parent=r}getDefault(){return null}}class t_ extends ty{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class tv extends ty{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class tx extends tv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tb{constructor(i,r,n,o){this.context=i,this.width=r,this.height=n;let s=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new t_(i,s),o&&(this.depthAttachment=new tv(i,s))}destroy(){let i=this.context.gl,r=this.colorAttachment.get();if(r&&i.deleteTexture(r),this.depthAttachment){let r=this.depthAttachment.get();r&&i.deleteRenderbuffer(r)}i.deleteFramebuffer(this.framebuffer)}}class tw{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new U(this),this.clearDepth=new G(this),this.clearStencil=new V(this),this.colorMask=new q(this),this.depthMask=new j(this),this.stencilMask=new Z(this),this.stencilFunc=new X(this),this.stencilOp=new $(this),this.stencilTest=new W(this),this.depthRange=new H(this),this.depthTest=new Y(this),this.depthFunc=new K(this),this.blend=new J(this),this.blendFunc=new Q(this),this.blendColor=new tt(this),this.blendEquation=new te(this),this.cullFace=new ti(this),this.cullFaceSide=new tr(this),this.frontFace=new tn(this),this.program=new to(this),this.activeTexture=new ts(this),this.viewport=new ta(this),this.bindFramebuffer=new tl(this),this.bindRenderbuffer=new tu(this),this.bindTexture=new th(this),this.bindVertexBuffer=new tc(this),this.bindElementBuffer=new tp(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new tf(this),this.pixelStoreUnpack=new td(this),this.pixelStoreUnpackPremultiplyAlpha=new tm(this),this.pixelStoreUnpackFlipY=new tg(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,r){return new O(this,i,r)}createVertexBuffer(i,r,n){return new F(this,i,r,n)}createRenderbuffer(i,r,n){let o=this.gl,s=o.createRenderbuffer();return this.bindRenderbuffer.set(s),o.renderbufferStorage(o.RENDERBUFFER,i,r,n),this.bindRenderbuffer.set(null),s}createFramebuffer(i,r,n){return new tb(this,i,r,n)}clear({color:i,depth:r,stencil:n}){let o=this.gl,s=0;i&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==n&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),o.clear(s)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(r){u(r.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class tE extends i.Evented{constructor(r,n,o,s){super(),this.id=r,this.dispatcher=o,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},n),i.extend(this,i.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new i.ErrorEvent(r)):n&&(i.extend(this,n),n.bounds&&(this.tileBounds=new N(n.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(n.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(r,n){let o=i.exported.devicePixelRatio>=2,s=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);r.request=i.getImage(this.map._requestManager.transformRequest(s,i.ResourceType.Tile),(o,s,a,l)=>{if(delete r.request,r.aborted)r.state="unloaded",n(null);else if(o)r.state="errored",n(o);else if(s){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:a,expires:l});let o=this.map.painter.context,u=o.gl;r.texture=this.map.painter.getTileTexture(s.width),r.texture?r.texture.update(s,{useMipmap:!0}):(r.texture=new i.Texture(o,s,u.RGBA,{useMipmap:!0}),r.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),r.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(i,r){i.request&&(i.request.cancel(),delete i.request),r()}unloadTile(i,r){i.texture&&this.map.painter.saveTileTexture(i.texture),r()}hasTransition(){return!1}}var tI=i.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class tS extends i.Evented{constructor(i,r,n,o){super(),this.id=i,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=r}load(r,n){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(o,s)=>{this._loaded=!0,o?this.fire(new i.ErrorEvent(o)):s&&(this.image=s,r&&(this.coordinates=r),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url&&(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(r){this.coordinates=r;let n=r.map(i.MercatorCoordinate.fromLngLat);this.tileID=function(r){let n=1/0,o=1/0,s=-1/0,a=-1/0;for(let i of r)n=Math.min(n,i.x),o=Math.min(o,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);let l=Math.max(0,Math.floor(-Math.log(Math.max(s-n,a-o))/Math.LN2)),u=Math.pow(2,l);return new i.CanonicalTileID(l,Math.floor((n+s)/2*u),Math.floor((o+a)/2*u))}(n),this.minzoom=this.maxzoom=this.tileID.z;let o=n.map(i=>this.tileID.getTilePoint(i)._round());return this._boundsArray=new i.StructArrayLayout4i8,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,i.EXTENT,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,i.EXTENT),this._boundsArray.emplaceBack(o[2].x,o[2].y,i.EXTENT,i.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let r=this.map.painter.context,n=r.gl;for(let o in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,tI.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new i.Texture(r,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){let i=this.tiles[o];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}loadTile(i,r){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored",r(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let tM={vector:class extends i.Evented{constructor(r,n,o,s){if(super(),this.id=r,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(n,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new i.ErrorEvent(r)):n&&(i.extend(this,n),n.bounds&&(this.tileBounds=new N(n.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){for(let r of(this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.map.style._getSourceCaches(this.id)))r.clearTiles();this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}loadTile(r,n){let o=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(o,i.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(s.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=n:r.request=r.actor.send("reloadTile",s,a.bind(this));else if(r.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",s,a.bind(this),void 0,!0);else{let n=i.loadVectorTile.call({deduped:this._deduped},s,(i,n)=>{i||!n?a.call(this,i):(s.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},r.actor&&r.actor.send("loadTile",s,a.bind(this),void 0,!0))},!0);r.request={cancel:n}}function a(o,s){return delete r.request,r.aborted?n(null):o&&404!==o.status?n(o):(s&&s.resourceTiming&&(r.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&s&&r.setExpiryData(s),r.loadVectorData(s,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:tE,"raster-dem":class extends tE{constructor(r,n,o,s){super(r,n,o,s),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(r,o){let s=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(i,n){i&&(r.state="errored",o(i)),n&&(r.dem=n,r.dem.onDeserialize(),r.needsHillshadePrepare=!0,r.needsDEMTextureUpload=!0,r.state="loaded",o(null))}r.request=i.getImage(this.map._requestManager.transformRequest(s,i.ResourceType.Tile),(function(s,l,u,h){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(s)r.state="errored",o(s);else if(l){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:u,expires:h});let o=i.window.ImageBitmap&&l instanceof i.window.ImageBitmap&&(null==n&&(n=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof i.window.createImageBitmap),n),s=1-(l.width-i.prevPowerOfTwo(l.width))/2;s<1||r.neighboringTiles||(r.neighboringTiles=this._getNeighboringTiles(r.tileID));let c=o?l:i.exported.getImageData(l,s),p={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:c,encoding:this.encoding,padding:s};r.actor&&"expired"!==r.state||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",p,a.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(r){let n=r.canonical,o=Math.pow(2,n.z),s=(n.x-1+o)%o,a=0===n.x?r.wrap-1:r.wrap,l=(n.x+1+o)%o,u=n.x+1===o?r.wrap+1:r.wrap,h={};return h[new i.OverscaledTileID(r.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},h[new i.OverscaledTileID(r.overscaledZ,u,n.z,l,n.y).key]={backfilled:!1},n.y>0&&(h[new i.OverscaledTileID(r.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1},h[new i.OverscaledTileID(r.overscaledZ,r.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},h[new i.OverscaledTileID(r.overscaledZ,u,n.z,l,n.y-1).key]={backfilled:!1}),n.y+1<o&&(h[new i.OverscaledTileID(r.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1},h[new i.OverscaledTileID(r.overscaledZ,r.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},h[new i.OverscaledTileID(r.overscaledZ,u,n.z,l,n.y+1).key]={backfilled:!1}),h}unloadTile(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded"}},geojson:class extends i.Evented{constructor(r,n,o,s){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(s),this._data=n.data,this._options=i.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let a=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:i.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*a,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(i){this.map=i,this.setData(this._data)}setData(i){return this._data=i,this._updateWorkerData(),this}getClusterExpansionZoom(i,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},r),this}getClusterChildren(i,r){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},r),this}getClusterLeaves(i,r,n,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:r,offset:n},o),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;let r=i.extend({},this.workerOptions),n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(i.exported.resolveURL(n),i.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(r,n)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new i.ErrorEvent(r));else{let r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(r.resourceTiming=n.resourceTiming[this.id]),this.fire(new i.Event("data",r)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(r,n){let o=r.actor?"reloadTile":"loadTile";r.actor=this.actor,r.request=this.actor.send(o,{type:this.type,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(i,s)=>(delete r.request,r.unloadVectorData(),r.aborted?n(null):i?n(i):(r.loadVectorData(s,this.map.painter,"reloadTile"===o),n(null))),void 0,"loadTile"===o)}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0}unloadTile(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends tS{constructor(i,r,n,o){super(i,r,n,o),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let r=this.options;for(let n of(this.urls=[],r.urls))this.urls.push(this.map._requestManager.transformRequest(n,i.ResourceType.Source).url);i.getVideo(this.urls,(r,n)=>{this._loaded=!0,r?this.fire(new i.ErrorEvent(r)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){let n=this.video.seekable;r<n.start(0)||r>n.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let r=this.map.painter.context,n=r.gl;for(let o in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,tI.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(r,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){let i=this.tiles[o];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:tS,canvas:class extends tS{constructor(r,n,o,s){super(r,n,o,s),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(i=>!Array.isArray(i)||2!==i.length||i.some(i=>"number"!=typeof i))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let n=this.map.painter.context,o=n.gl;for(let s in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,tI.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(n,this.canvas,o.RGBA,{premultiply:!0}),this.tiles){let i=this.tiles[s];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}},tT=function(r,n,o,s){let a=new tM[n.type](r,n,o,s);if(a.id!==r)throw Error(`Expected Source id to be ${r} instead of ${a.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],a),a};function tC(i,r){let n=i.tileID,o=r.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}function tP(){return null!=rF.workerClass?new rF.workerClass:new i.window.Worker(rF.workerUrl)}let tA="mapboxgl_preloaded_worker_pool";class tL{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<tL.workerCount;)this.workers.push(new tP);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tA]}numActive(){return Object.keys(this.active).length}}function tk(){return o||(o=new tL),o}function tR(r){r=r.slice();let n=Object.create(null);for(let i=0;i<r.length;i++)n[r[i].id]=r[i];for(let o=0;o<r.length;o++)"ref"in r[o]&&(r[o]=function(r,n){let o={};for(let i in r)"ref"!==i&&(o[i]=r[i]);return i.refProperties.forEach(i=>{i in n&&(o[i]=n[i])}),o}(r[o],n[r[o].ref]));return r}tL.workerCount=2;let tD={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function tN(i,r,n){n.push({command:tD.addSource,args:[i,r[i]]})}function tO(i,r,n){r.push({command:tD.removeSource,args:[i]}),n[i]=!0}function tz(i,r,n,o,s,a){let l;for(l in r=r||{},i=i||{})i.hasOwnProperty(l)&&(u(i[l],r[l])||n.push({command:a,args:[o,l,r[l],s]}));for(l in r)r.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(u(i[l],r[l])||n.push({command:a,args:[o,l,r[l],s]}))}function tF(i){return i.id}function tB(i,r){return i[r.id]=r,i}class tU{constructor(i,r){this.reset(i,r)}reset(i,r){this.points=i||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=i.clamp(r,0,1);let n=1,o=this._distances[n],s=r*this.paddedLength+this.padding;for(;o<s&&n<this._distances.length;)o=this._distances[++n];let a=n-1,l=this._distances[a],u=o-l,h=u>0?(s-l)/u:0;return this.points[a].mult(1-h).add(this.points[n].mult(h))}}class tG{constructor(i,r,n){let o=this.boxCells=[],s=this.circleCells=[];this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(let i=0;i<this.xCellCount*this.yCellCount;i++)o.push([]),s.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,r,n,o,s){this._forEachCell(r,n,o,s,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s)}insertCircle(i,r,n,o){this._forEachCell(r-o,n-o,r+o,n+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(r),this.circles.push(n),this.circles.push(o)}_insertBoxCell(i,r,n,o,s,a){this.boxCells[s].push(a)}_insertCircleCell(i,r,n,o,s,a){this.circleCells[s].push(a)}_query(i,r,n,o,s,a){if(n<0||i>this.width||o<0||r>this.height)return!s&&[];let l=[];if(i<=0&&r<=0&&this.width<=n&&this.height<=o){if(s)return!0;for(let i=0;i<this.boxKeys.length;i++)l.push({key:this.boxKeys[i],x1:this.bboxes[4*i],y1:this.bboxes[4*i+1],x2:this.bboxes[4*i+2],y2:this.bboxes[4*i+3]});for(let i=0;i<this.circleKeys.length;i++){let r=this.circles[3*i],n=this.circles[3*i+1],o=this.circles[3*i+2];l.push({key:this.circleKeys[i],x1:r-o,y1:n-o,x2:r+o,y2:n+o})}return a?l.filter(a):l}return this._forEachCell(i,r,n,o,this._queryCell,l,{hitTest:s,seenUids:{box:{},circle:{}}},a),s?l.length>0:l}_queryCircle(i,r,n,o,s){let a=i-n,l=i+n,u=r-n,h=r+n;if(l<0||a>this.width||h<0||u>this.height)return!o&&[];let c=[];return this._forEachCell(a,u,l,h,this._queryCellCircle,c,{hitTest:o,circle:{x:i,y:r,radius:n},seenUids:{box:{},circle:{}}},s),o?c.length>0:c}query(i,r,n,o,s){return this._query(i,r,n,o,!1,s)}hitTest(i,r,n,o,s){return this._query(i,r,n,o,!0,s)}hitTestCircle(i,r,n,o){return this._queryCircle(i,r,n,!0,o)}_queryCell(i,r,n,o,s,a,l,u){let h=l.seenUids,c=this.boxCells[s];if(null!==c){let s=this.bboxes;for(let p of c)if(!h.box[p]){h.box[p]=!0;let c=4*p;if(i<=s[c+2]&&r<=s[c+3]&&n>=s[c+0]&&o>=s[c+1]&&(!u||u(this.boxKeys[p]))){if(l.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:s[c],y1:s[c+1],x2:s[c+2],y2:s[c+3]})}}}let p=this.circleCells[s];if(null!==p){let s=this.circles;for(let c of p)if(!h.circle[c]){h.circle[c]=!0;let p=3*c;if(this._circleAndRectCollide(s[p],s[p+1],s[p+2],i,r,n,o)&&(!u||u(this.circleKeys[c]))){if(l.hitTest)return a.push(!0),!0;{let i=s[p],r=s[p+1],n=s[p+2];a.push({key:this.circleKeys[c],x1:i-n,y1:r-n,x2:i+n,y2:r+n})}}}}}_queryCellCircle(i,r,n,o,s,a,l,u){let h=l.circle,c=l.seenUids,p=this.boxCells[s];if(null!==p){let i=this.bboxes;for(let r of p)if(!c.box[r]){c.box[r]=!0;let n=4*r;if(this._circleAndRectCollide(h.x,h.y,h.radius,i[n+0],i[n+1],i[n+2],i[n+3])&&(!u||u(this.boxKeys[r])))return a.push(!0),!0}}let f=this.circleCells[s];if(null!==f){let i=this.circles;for(let r of f)if(!c.circle[r]){c.circle[r]=!0;let n=3*r;if(this._circlesCollide(i[n],i[n+1],i[n+2],h.x,h.y,h.radius)&&(!u||u(this.circleKeys[r])))return a.push(!0),!0}}}_forEachCell(i,r,n,o,s,a,l,u){let h=this._convertToXCellCoord(i),c=this._convertToYCellCoord(r),p=this._convertToXCellCoord(n),f=this._convertToYCellCoord(o);for(let d=h;d<=p;d++)for(let h=c;h<=f;h++)if(s.call(this,i,r,n,o,this.xCellCount*h+d,a,l,u))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,r,n,o,s,a){let l=o-i,u=s-r,h=n+a;return h*h>l*l+u*u}_circleAndRectCollide(i,r,n,o,s,a,l){let u=(a-o)/2,h=Math.abs(i-(o+u));if(h>u+n)return!1;let c=(l-s)/2,p=Math.abs(r-(s+c));if(p>c+n)return!1;if(h<=u||p<=c)return!0;let f=h-u,d=p-c;return f*f+d*d<=n*n}}function tV(r,n,o,s,a){let l=i.create$1();return n?(i.scale$1(l,l,[1/a,1/a,1]),o||i.rotateZ(l,l,s.angle)):i.multiply(l,s.labelPlaneMatrix,r),l}function tq(r,n,o,s,a){if(n){let n=i.clone$1(r);return i.scale$1(n,n,[a,a,1]),o||i.rotateZ(n,n,-s.angle),n}return s.glCoordMatrix}function tj(r,n,o=0){let s=[r.x,r.y,o,1];o?i.transformMat4(s,s,n):tQ(s,s,n);let a=s[3];return{point:new i.pointGeometry(s[0]/a,s[1]/a),signedDistanceFromCamera:a}}function tZ(i,r){return Math.min(.5+i/r*.5,1.5)}function tX(i,r,n,o,s,a,l,u,h,c,p,f,d){let m=u.glyphStartIndex+u.numGlyphs,g=u.lineStartIndex,y=u.lineStartIndex+u.lineLength,_=r.getoffsetX(u.glyphStartIndex),v=r.getoffsetX(m-1),x=tY(i*_,n,o,s,a,l,u.segment,g,y,h,c,p,f,d,!0);if(!x)return null;let b=tY(i*v,n,o,s,a,l,u.segment,g,y,h,c,p,f,d,!0);return b?{first:x,last:b}:null}function t$(r,n,o,s){return r===i.WritingMode.horizontal&&Math.abs(o.y-n.y)>Math.abs(o.x-n.x)*s?{useVertical:!0}:(r===i.WritingMode.vertical?n.y<o.y:n.x>o.x)?{needsFlipping:!0}:null}function tW(r,n,o,s,a,l,u,h,c,p,f,d,m,g,y){let _;let v=n/24,x=r.lineOffsetX*v,b=r.lineOffsetY*v;if(r.numGlyphs>1){let i=r.glyphStartIndex+r.numGlyphs,n=r.lineStartIndex,a=r.lineStartIndex+r.lineLength,p=tX(v,h,x,b,o,f,d,r,c,l,m,y);if(!p)return{notEnoughRoom:!0};let w=tj(p.first.point,u).point,E=tj(p.last.point,u).point;if(s&&!o){let i=t$(r.writingMode,w,E,g);if(i)return i}_=[p.first];for(let s=r.glyphStartIndex+1;s<i-1;s++)_.push(tY(v*h.getoffsetX(s),x,b,o,f,d,r.segment,n,a,c,l,m,y));_.push(p.last)}else{if(s&&!o){let n=tj(d,a).point,o=r.lineStartIndex+r.segment+1,s=new i.pointGeometry(c.getx(o),c.gety(o)),l=tj(s,a),u=l.signedDistanceFromCamera>0?l.point:tH(d,s,n,1,a),h=t$(r.writingMode,n,u,g);if(h)return h}let n=tY(v*h.getoffsetX(r.glyphStartIndex),x,b,o,f,d,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,c,l,m,y);if(!n)return{notEnoughRoom:!0};_=[n]}for(let r of _)i.addDynamicAttributes(p,r.point,r.angle);return{}}function tH(i,r,n,o,s,a){let l=i.add(i.sub(r)._unit()),u=tj(l,s,a?a(l):0).point,h=n.sub(u);return n.add(h._mult(o/h.mag()))}function tY(r,n,o,s,a,l,u,h,c,p,f,d,m,g,y){let _=s?r-n:r+n,v=_>0?1:-1,x=0;s&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let b=v>0?h+u:h+u+1,w=a,E=a,I=0,S=0,M=Math.abs(_),T=[],C=[],P=l,A=()=>{let r=b-v;return 0===I?l:new i.pointGeometry(p.getx(r),p.gety(r))},L=()=>tH(A(),P,E,M-I+1,f,m);for(;I+S<=M;){if((b+=v)<h||b>=c)return null;if(E=w,T.push(w),g&&C.push(P||A()),void 0===(w=d[b])){let r=tj(P=new i.pointGeometry(p.getx(b),p.gety(b)),f,m?m(P):0);w=r.signedDistanceFromCamera>0?d[b]=r.point:L()}else P=null;I+=S,S=E.dist(w)}y&&m&&(P=P||new i.pointGeometry(p.getx(b),p.gety(b)),d[b]=w=void 0===d[b]?w:L(),S=E.dist(w));let k=(M-I)/S,R=w.sub(E),D=R.mult(k)._add(E);o&&D._add(R._unit()._perp()._mult(o*v));let N=x+Math.atan2(w.y-E.y,w.x-E.x);return T.push(D),g&&(P=P||new i.pointGeometry(p.getx(b),p.gety(b)),C.push(function(r,n,o){let s=1-o;return new i.pointGeometry(r.x*s+n.x*o,r.y*s+n.y*o)}(C.length>0?C[C.length-1]:P,P,k))),{point:D,angle:N,path:T,tilePath:C}}let tK=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tJ(i,r){for(let n=0;n<i;n++){let i=r.length;r.resize(i+4),r.float32.set(tK,3*i)}}function tQ(i,r,n){let o=r[0],s=r[1];return i[0]=n[0]*o+n[4]*s+n[12],i[1]=n[1]*o+n[5]*s+n[13],i[3]=n[3]*o+n[7]*s+n[15],i}class t0{constructor(i,r,n=new tG(i.width+200,i.height+200,25),o=new tG(i.width+200,i.height+200,25)){this.transform=i,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=r}placeCollisionBox(i,r,n,o,s,a,l){let u=this.projectAndGetPerspectiveRatio(a,r.anchorPointX,r.anchorPointY,r.elevation,r.tileID),h=s*u.perspectiveRatio,c=(r.x1*i+n.x-r.padding)*h+u.point.x,p=(r.y1*i+n.y-r.padding)*h+u.point.y,f=(r.x2*i+n.x+r.padding)*h+u.point.x,d=(r.y2*i+n.y+r.padding)*h+u.point.y,m=u.perspectiveRatio<=.55||u.aboveHorizon;return!this.isInsideGrid(c,p,f,d)||!o&&this.grid.hitTest(c,p,f,d,l)||m?{box:[],offscreen:!1}:{box:[c,p,f,d],offscreen:this.isOffscreen(c,p,f,d)}}placeCollisionCircles(r,n,o,s,a,l,u,h,c,p,f,d,m,g){let y=[],_=this.transform.elevation,v=_?i=>_.getAtTileOffset(g,i.x,i.y):i=>0,x=new i.pointGeometry(n.anchorX,n.anchorY),b=v(x),w=this.projectAndGetPerspectiveRatio(l,x.x,x.y,b,g),{perspectiveRatio:E}=w,I=(p?a/E:a*E)/i.ONE_EM,S=tj(x,u,b).point,M=w.signedDistanceFromCamera>0?tX(I,s,n.lineOffsetX*I,n.lineOffsetY*I,!1,S,x,n,o,u,{},_&&!p?v:null,p&&!!_):null,T=!1,C=!1,P=!0;if(M&&!w.aboveHorizon){let n=.5*d*E+m,o=new i.pointGeometry(-100,-100),s=new i.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),a=new tU,l=M.first,u=M.last,p=[];for(let i=l.path.length-1;i>=1;i--)p.push(l.path[i]);for(let i=1;i<u.path.length;i++)p.push(u.path[i]);let g=2.5*n;if(h){let i=p.map(_?(i,r)=>tj(i,h,v(r<l.path.length-1?l.tilePath[l.path.length-1-r]:u.tilePath[r-l.path.length+2])):i=>tj(i,h));p=i.some(i=>i.signedDistanceFromCamera<=0)?[]:i.map(i=>i.point)}let x=[];if(p.length>0){let r=p[0].clone(),n=p[0].clone();for(let i=1;i<p.length;i++)r.x=Math.min(r.x,p[i].x),r.y=Math.min(r.y,p[i].y),n.x=Math.max(n.x,p[i].x),n.y=Math.max(n.y,p[i].y);x=r.x>=o.x&&n.x<=s.x&&r.y>=o.y&&n.y<=s.y?[p]:n.x<o.x||r.x>s.x||n.y<o.y||r.y>s.y?[]:i.clipLine([p],o.x,o.y,s.x,s.y)}for(let i of x){a.reset(i,.25*n);let o=0;o=a.length<=.5*n?1:Math.ceil(a.paddedLength/g)+1;for(let i=0;i<o;i++){let s=i/Math.max(o-1,1),l=a.lerp(s),u=l.x+100,h=l.y+100;y.push(u,h,n,0);let p=u-n,d=h-n,m=u+n,g=h+n;if(P=P&&this.isOffscreen(p,d,m,g),C=C||this.isInsideGrid(p,d,m,g),!r&&this.grid.hitTestCircle(u,h,n,f)&&(T=!0,!c))return{circles:[],offscreen:!1,collisionDetected:T}}}}return{circles:(c||!T)&&C?y:[],offscreen:P,collisionDetected:T}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let n=[],o=1/0,s=1/0,a=-1/0,l=-1/0;for(let u of r){let r=new i.pointGeometry(u.x+100,u.y+100);o=Math.min(o,r.x),s=Math.min(s,r.y),a=Math.max(a,r.x),l=Math.max(l,r.y),n.push(r)}let u=this.grid.query(o,s,a,l).concat(this.ignoredGrid.query(o,s,a,l)),h={},c={};for(let r of u){let o=r.key;if(void 0===h[o.bucketInstanceId]&&(h[o.bucketInstanceId]={}),h[o.bucketInstanceId][o.featureIndex])continue;let s=[new i.pointGeometry(r.x1,r.y1),new i.pointGeometry(r.x2,r.y1),new i.pointGeometry(r.x2,r.y2),new i.pointGeometry(r.x1,r.y2)];i.polygonIntersectsPolygon(n,s)&&(h[o.bucketInstanceId][o.featureIndex]=!0,void 0===c[o.bucketInstanceId]&&(c[o.bucketInstanceId]=[]),c[o.bucketInstanceId].push(o.featureIndex))}return c}insertCollisionBox(i,r,n,o,s){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:o,collisionGroupID:s},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,r,n,o,s){let a=r?this.ignoredGrid:this.grid,l={bucketInstanceId:n,featureIndex:o,collisionGroupID:s};for(let r=0;r<i.length;r+=4)a.insertCircle(l,i[r],i[r+1],i[r+2])}projectAndGetPerspectiveRatio(r,n,o,s,a){let l=[n,o,s||0,1],u=!1;if(s||this.transform.pitch>0){i.transformMat4(l,l,r);let h=!1;this.fogState&&a&&(h=function(r,n,o,s,a,l){let u=l.calculateFogTileMatrix(a),h=[n,o,s];return i.transformMat4$1(h,h,u),M(r,h,l.pitch,l._fov)}(this.fogState,n,o,s||0,a.toUnwrapped(),this.transform)>.9),u=l[2]>l[3]||h}else tQ(l,l,r);return{point:new i.pointGeometry((l[0]/l[3]+1)/2*this.transform.width+100,(-l[1]/l[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/l[3]*.5,1.5),signedDistanceFromCamera:l[3],aboveHorizon:u}}isOffscreen(i,r,n,o){return n<100||i>=this.screenRightBoundary||o<100||r>this.screenBottomBoundary}isInsideGrid(i,r,n,o){return n>=0&&i<this.gridRightBoundary&&o>=0&&r<this.gridBottomBoundary}getViewportMatrix(){let r=i.identity([]);return i.translate(r,r,[-100,-100,0]),r}}class t1{constructor(i,r,n,o){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?r:-r))):o&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class t2{constructor(i,r,n,o,s){this.text=new t1(i?i.text:null,r,n,s),this.icon=new t1(i?i.icon:null,r,o,s)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class t3{constructor(i,r,n){this.text=i,this.icon=r,this.skipFade=n}}class t5{constructor(){this.invProjMatrix=i.create$1(),this.viewportMatrix=i.create$1(),this.circles=[]}}class t4{constructor(i,r,n,o,s){this.bucketInstanceId=i,this.featureIndex=r,this.sourceLayerIndex=n,this.bucketIndex=o,this.tileID=s}}class t6{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){let r=++this.maxGroupID;this.collisionGroups[i]={ID:r,predicate:i=>i.collisionGroupID===r}}return this.collisionGroups[i]}}function t8(r,n,o,s,a){let{horizontalAlign:l,verticalAlign:u}=i.getAnchorAlignment(r),h=i.evaluateVariableOffset(r,s);return new i.pointGeometry(-(l-.5)*n+h[0]*a,-(u-.5)*o+h[1]*a)}function t9(r,n,o,s,a){let l=new i.pointGeometry(r,n);return o&&l._rotate(s?a:-a),l}class t7{constructor(i,r,n,o,s){this.transform=i.clone(),this.collisionIndex=new t0(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new t6(n),this.collisionCircleArrays={},this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,n,o,s){let a=o.getBucket(n),l=o.latestFeatureIndex;if(!a||!l||n.id!==a.layerIds[0])return;let u=o.collisionBoxArray,h=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),p=o.tileSize/i.EXTENT,f=this.transform.calculateProjMatrix(o.tileID.toUnwrapped()),d="map"===h.get("text-pitch-alignment"),m="map"===h.get("text-rotation-alignment"),g=k(o,1,this.transform.zoom),y=tV(f,d,m,this.transform,g),_=null;if(d){let r=tq(f,d,m,this.transform,g);_=i.multiply([],this.transform.labelPlaneMatrix,r)}this.retainedQueryData[a.bucketInstanceId]=new t4(a.bucketInstanceId,l,a.sourceLayerIndex,a.index,o.tileID);let v={bucket:a,layout:h,posMatrix:f,textLabelPlaneMatrix:y,labelToScreenMatrix:_,scale:c,textPixelRatio:p,holdingForFade:o.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(s)for(let i of a.sortKeyRanges){let{sortKey:n,symbolInstanceStart:o,symbolInstanceEnd:s}=i;r.push({sortKey:n,symbolInstanceStart:o,symbolInstanceEnd:s,parameters:v})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}attemptAnchorPlacement(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y,_,v){let x=[f.textOffset0,f.textOffset1],b=t8(i,n,o,x,s),w=this.collisionIndex.placeCollisionBox(s,r,t9(b.x,b.y,a,l,this.transform.angle),p,u,h,c.predicate);if((!y||0!==this.collisionIndex.placeCollisionBox(m.getSymbolInstanceIconSize(v,this.transform.zoom,d),y,t9(b.x,b.y,a,l,this.transform.angle),p,u,h,c.predicate).box.length)&&w.box.length>0){let r;return this.prevPlacement&&this.prevPlacement.variableOffsets[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID].text&&(r=this.prevPlacement.variableOffsets[f.crossTileID].anchor),this.variableOffsets[f.crossTileID]={textOffset:x,width:n,height:o,anchor:i,textScale:s,prevAnchor:r},this.markUsedJustification(m,i,f,g),m.allowVerticalPlacement&&(this.markUsedOrientation(m,g,f),this.placedOrientations[f.crossTileID]=g),{shift:b,placedGlyphBoxes:w}}}placeLayerBucketPart(r,n,o){let{bucket:s,layout:a,posMatrix:l,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:c,holdingForFade:p,collisionBoxArray:f,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:m,collisionGroup:g}=r.parameters,y=a.get("text-optional"),_=a.get("icon-optional"),v=a.get("text-allow-overlap"),x=a.get("icon-allow-overlap"),b="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),E="none"!==a.get("icon-text-fit"),I="viewport-y"===a.get("symbol-z-order"),S=v&&(x||!s.hasIconData()||_),M=x&&(v||!s.hasTextData()||y);!s.collisionArrays&&f&&s.deserializeCollisionBoxes(f),o&&s.updateCollisionDebugBuffers(this.transform.zoom,f);let T=(r,f,I)=>{if(n[r.crossTileID])return;if(p)return void(this.placements[r.crossTileID]=new t3(!1,!1,!1));let T=!1,C=!1,P=!0,A=null,L={box:null,offscreen:null},k={box:null,offscreen:null},R=null,D=null,N=null,O=0,z=0,F=0;I.textFeatureIndex?O=I.textFeatureIndex:r.useRuntimeCollisionCircles&&(O=r.featureIndex),I.verticalTextFeatureIndex&&(z=I.verticalTextFeatureIndex);let B=i=>{i.tileID=this.retainedQueryData[s.bucketInstanceId].tileID,(this.transform.elevation||i.elevation)&&(i.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[s.bucketInstanceId].tileID,i.anchorPointX,i.anchorPointY):0)},U=I.textBox;if(U){B(U);let n=n=>{let o=i.WritingMode.horizontal;if(s.allowVerticalPlacement&&!n&&this.prevPlacement){let i=this.prevPlacement.placedOrientations[r.crossTileID];i&&(this.placedOrientations[r.crossTileID]=i,o=i,this.markUsedOrientation(s,o,r))}return o},o=(n,o)=>{if(s.allowVerticalPlacement&&r.numVerticalGlyphVertices>0&&I.verticalTextBox){for(let r of s.writingModes)if(r===i.WritingMode.vertical?k=L=o():L=n(),L&&L.box&&L.box.length)break}else L=n()};if(a.get("text-variable-anchor")){let u=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[r.crossTileID]){let i=this.prevPlacement.variableOffsets[r.crossTileID];u.indexOf(i.anchor)>0&&(u=u.filter(r=>r!==i.anchor)).unshift(i.anchor)}let h=(i,n,o)=>{let a=s.getSymbolInstanceTextSize(d,r,this.transform.zoom,f),h=(i.x2-i.x1)*a+2*i.padding,p=(i.y2-i.y1)*a+2*i.padding,y=E&&!x?n:null;y&&B(y);let _={box:[],offscreen:!1},I=v?2*u.length:u.length;for(let n=0;n<I;++n){let v=this.attemptAnchorPlacement(u[n%u.length],i,h,p,a,b,w,c,l,g,n>=u.length,r,f,s,o,y,d,m);if(v&&(_=v.placedGlyphBoxes)&&_.box&&_.box.length){T=!0,A=v.shift;break}}return _};o(()=>h(U,I.iconBox,i.WritingMode.horizontal),()=>{let n=I.verticalTextBox;return n&&B(n),s.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&r.numVerticalGlyphVertices>0&&n?h(n,I.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null}}),L&&(T=L.box,P=L.offscreen);let p=n(L&&L.box);if(!T&&this.prevPlacement){let i=this.prevPlacement.variableOffsets[r.crossTileID];i&&(this.variableOffsets[r.crossTileID]=i,this.markUsedJustification(s,i.anchor,r,p))}}else{let a=(n,o)=>{let a=s.getSymbolInstanceTextSize(d,r,this.transform.zoom,f),u=this.collisionIndex.placeCollisionBox(a,n,new i.pointGeometry(0,0),v,c,l,g.predicate);return u&&u.box&&u.box.length&&(this.markUsedOrientation(s,o,r),this.placedOrientations[r.crossTileID]=o),u};o(()=>a(U,i.WritingMode.horizontal),()=>{let n=I.verticalTextBox;return s.allowVerticalPlacement&&r.numVerticalGlyphVertices>0&&n?(B(n),a(n,i.WritingMode.vertical)):{box:null,offscreen:null}}),n(L&&L.box&&L.box.length)}}if(T=(R=L)&&R.box&&R.box.length>0,P=R&&R.offscreen,r.useRuntimeCollisionCircles){let n=s.text.placedSymbolArray.get(r.centerJustifiedTextSymbolIndex),c=i.evaluateSizeForFeature(s.textSizeData,d,n),p=a.get("text-padding");D=this.collisionIndex.placeCollisionCircles(v,n,s.lineVertexArray,s.glyphOffsetArray,c,l,u,h,o,w,g.predicate,r.collisionCircleDiameter,p,this.retainedQueryData[s.bucketInstanceId].tileID),T=v||D.circles.length>0&&!D.collisionDetected,P=P&&D.offscreen}if(I.iconFeatureIndex&&(F=I.iconFeatureIndex),I.iconBox){let r=r=>{B(r);let n=E&&A?t9(A.x,A.y,b,w,this.transform.angle):new i.pointGeometry(0,0),o=s.getSymbolInstanceIconSize(m,this.transform.zoom,f);return this.collisionIndex.placeCollisionBox(o,r,n,x,c,l,g.predicate)};C=k&&k.box&&k.box.length&&I.verticalIconBox?(N=r(I.verticalIconBox)).box.length>0:(N=r(I.iconBox)).box.length>0,P=P&&N.offscreen}let G=y||0===r.numHorizontalGlyphVertices&&0===r.numVerticalGlyphVertices,V=_||0===r.numIconVertices;if(G||V?V?G||(C=C&&T):T=C&&T:C=T=C&&T,T&&R&&R.box&&this.collisionIndex.insertCollisionBox(R.box,a.get("text-ignore-placement"),s.bucketInstanceId,k&&k.box&&z?z:O,g.ID),C&&N&&this.collisionIndex.insertCollisionBox(N.box,a.get("icon-ignore-placement"),s.bucketInstanceId,F,g.ID),D&&(T&&this.collisionIndex.insertCollisionCircles(D.circles,a.get("text-ignore-placement"),s.bucketInstanceId,O,g.ID),o)){let i=s.bucketInstanceId,r=this.collisionCircleArrays[i];void 0===r&&(r=this.collisionCircleArrays[i]=new t5);for(let i=0;i<D.circles.length;i+=4)r.circles.push(D.circles[i+0]),r.circles.push(D.circles[i+1]),r.circles.push(D.circles[i+2]),r.circles.push(+!!D.collisionDetected)}this.placements[r.crossTileID]=new t3(T||S,C||M,P||s.justReloaded),n[r.crossTileID]=!0};if(I){let i=s.getSortedSymbolIndexes(this.transform.angle);for(let r=i.length-1;r>=0;--r){let n=i[r];T(s.symbolInstances.get(n),n,s.collisionArrays[n])}}else for(let i=r.symbolInstanceStart;i<r.symbolInstanceEnd;i++)T(s.symbolInstances.get(i),i,s.collisionArrays[i]);if(o&&s.bucketInstanceId in this.collisionCircleArrays){let r=this.collisionCircleArrays[s.bucketInstanceId];i.invert(r.invProjMatrix,l),r.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(r,n,o,s){let a;for(let l of(a=s===i.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:({left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex})[i.getAnchorJustification(n)],[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex]))l>=0&&(r.text.placedSymbolArray.get(l).crossTileID=a>=0&&l!==a?0:o.crossTileID)}markUsedOrientation(r,n,o){let s=n===i.WritingMode.horizontal||n===i.WritingMode.horizontalOnly?n:0,a=n===i.WritingMode.vertical?n:0;for(let i of[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex])r.text.placedSymbolArray.get(i).placedOrientation=s;o.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;let r=this.prevPlacement,n=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;let o=r?r.symbolFadeChange(i):1,s=r?r.opacities:{},a=r?r.variableOffsets:{},l=r?r.placedOrientations:{};for(let i in this.placements){let r=this.placements[i],a=s[i];a?(this.opacities[i]=new t2(a,o,r.text,r.icon),n=n||r.text!==a.text.placed||r.icon!==a.icon.placed):(this.opacities[i]=new t2(null,o,r.text,r.icon,r.skipFade),n=n||r.text||r.icon)}for(let i in s){let r=s[i];if(!this.opacities[i]){let s=new t2(r,o,!1,!1);s.isHidden()||(this.opacities[i]=s,n=n||r.text.placed||r.icon.placed)}}for(let i in a)this.variableOffsets[i]||!this.opacities[i]||this.opacities[i].isHidden()||(this.variableOffsets[i]=a[i]);for(let i in l)this.placedOrientations[i]||!this.opacities[i]||this.opacities[i].isHidden()||(this.placedOrientations[i]=l[i]);n?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:i)}updateLayerOpacities(i,r){let n={};for(let o of r){let r=o.getBucket(i);r&&o.latestFeatureIndex&&i.id===r.layerIds[0]&&this.updateBucketOpacities(r,n,o.collisionBoxArray)}}updateBucketOpacities(r,n,o){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let s=r.layers[0].layout,a=new t2(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),u=s.get("icon-allow-overlap"),h=s.get("text-variable-anchor"),c="map"===s.get("text-rotation-alignment"),p="map"===s.get("text-pitch-alignment"),f="none"!==s.get("icon-text-fit"),d=new t2(null,0,l&&(u||!r.hasIconData()||s.get("icon-optional")),u&&(l||!r.hasTextData()||s.get("text-optional")),!0);!r.collisionArrays&&o&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(o);let m=(i,r,n)=>{for(let o=0;o<r/4;o++)i.opacityVertexArray.emplaceBack(n)};for(let o=0;o<r.symbolInstances.length;o++){let s=r.symbolInstances.get(o),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:u,crossTileID:g}=s,y=this.opacities[g];n[g]?y=a:y||(y=d,this.opacities[g]=y),n[g]=!0;let _=s.numIconVertices>0,v=this.placedOrientations[s.crossTileID],x=v===i.WritingMode.vertical,b=v===i.WritingMode.horizontal||v===i.WritingMode.horizontalOnly;if(l>0||u>0){let i=ee(y.text);m(r.text,l,x?ei:i),m(r.text,u,b?ei:i);let n=y.text.isHidden();[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach(i=>{i>=0&&(r.text.placedSymbolArray.get(i).hidden=n||x?1:0)}),s.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).hidden=n||b?1:0);let o=this.variableOffsets[s.crossTileID];o&&this.markUsedJustification(r,o.anchor,s,v);let a=this.placedOrientations[s.crossTileID];a&&(this.markUsedJustification(r,"left",s,a),this.markUsedOrientation(r,a,s))}if(_){let i=ee(y.icon),n=!(f&&s.verticalPlacedIconSymbolIndex&&x);s.placedIconSymbolIndex>=0&&(m(r.icon,s.numIconVertices,n?i:ei),r.icon.placedSymbolArray.get(s.placedIconSymbolIndex).hidden=y.icon.isHidden()),s.verticalPlacedIconSymbolIndex>=0&&(m(r.icon,s.numVerticalIconVertices,n?ei:i),r.icon.placedSymbolArray.get(s.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let n=r.collisionArrays[o];if(n){let o=new i.pointGeometry(0,0);if(n.textBox||n.verticalTextBox){let i=!0;if(h){let r=this.variableOffsets[g];r?(o=t8(r.anchor,r.width,r.height,r.textOffset,r.textScale),c&&o._rotate(p?this.transform.angle:-this.transform.angle)):i=!1}n.textBox&&et(r.textCollisionBox.collisionVertexArray,y.text.placed,!i||x,o.x,o.y),n.verticalTextBox&&et(r.textCollisionBox.collisionVertexArray,y.text.placed,!i||b,o.x,o.y)}let s=!!(!b&&n.verticalIconBox);n.iconBox&&et(r.iconCollisionBox.collisionVertexArray,y.icon.placed,s,f?o.x:0,f?o.y:0),n.verticalIconBox&&et(r.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,f?o.x:0,f?o.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let i=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=i.invProjMatrix,r.placementViewportMatrix=i.viewportMatrix,r.collisionCircleArray=i.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,r){let n=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*n>i}setStale(){this.stale=!0}}function et(i,r,n,o,s){i.emplaceBack(+!!r,+!!n,o||0,s||0),i.emplaceBack(+!!r,+!!n,o||0,s||0),i.emplaceBack(+!!r,+!!n,o||0,s||0),i.emplaceBack(+!!r,+!!n,o||0,s||0)}function ee(i){if(0===i.opacity&&!i.placed)return 0;if(1===i.opacity&&i.placed)return 0xffffffff;let r=+!!i.placed,n=Math.floor(127*i.opacity);return 0x2000000*n+0x1000000*r+131072*n+65536*r+512*n+256*r+2*n+r}let ei=0;class er{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,r,n,o,s){let a=this._bucketParts;for(;this._currentTileIndex<i.length;)if(r.getBucketParts(a,o,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,s())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((i,r)=>i.sortKey-r.sortKey));this._currentPartIndex<a.length;)if(r.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,s())return!0;return!1}}class en{constructor(i,r,n,o,s,a,l,u){this.placement=new t7(i,s,a,l,u),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=o,this._done=!1}isDone(){return this._done}continuePlacement(r,n,o){let s=i.exported.now(),a=()=>{let r=i.exported.now()-s;return!this._forceFullPlacement&&r>2};for(;this._currentPlacementIndex>=0;){let i=n[r[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=s)&&(!i.maxzoom||i.maxzoom>s)){if(this._inProgressLayer||(this._inProgressLayer=new er(i)),this._inProgressLayer.continuePlacement(o[i.source],this.placement,this._showCollisionBoxes,i,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}let eo=512/i.EXTENT/2;class es{constructor(i,r,n){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let n=0;n<r.length;n++){let o=r.get(n),s=o.key;this.indexedSymbolInstances[s]||(this.indexedSymbolInstances[s]=[]),this.indexedSymbolInstances[s].push({crossTileID:o.crossTileID,coord:this.getScaledCoordinates(o,i)})}}getScaledCoordinates(r,n){let o=eo/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*i.EXTENT+r.anchorX)*o),y:Math.floor((n.canonical.y*i.EXTENT+r.anchorY)*o)}}findMatches(i,r,n){let o=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let s=0;s<i.length;s++){let a=i.get(s);if(a.crossTileID)continue;let l=this.indexedSymbolInstances[a.key];if(!l)continue;let u=this.getScaledCoordinates(a,r);for(let i of l)if(Math.abs(i.coord.x-u.x)<=o&&Math.abs(i.coord.y-u.y)<=o&&!n[i.crossTileID]){n[i.crossTileID]=!0,a.crossTileID=i.crossTileID;break}}}}class ea{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class el{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){let r=Math.round((i-this.lng)/360);if(0!==r)for(let i in this.indexes){let n=this.indexes[i],o={};for(let i in n){let s=n[i];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+r),o[s.tileID.key]=s}this.indexes[i]=o}this.lng=i}addBucket(i,r,n){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let i=0;i<r.symbolInstances.length;i++)r.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});let o=this.usedCrossTileIDs[i.overscaledZ];for(let n in this.indexes){let s=this.indexes[n];if(Number(n)>i.overscaledZ)for(let n in s){let a=s[n];a.tileID.isChildOf(i)&&a.findMatches(r.symbolInstances,i,o)}else{let a=s[i.scaledTo(Number(n)).key];a&&a.findMatches(r.symbolInstances,i,o)}}for(let i=0;i<r.symbolInstances.length;i++){let s=r.symbolInstances.get(i);s.crossTileID||(s.crossTileID=n.generate(),o[s.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new es(i,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(i,r){for(let n in r.indexedSymbolInstances)for(let o of r.indexedSymbolInstances[n])delete this.usedCrossTileIDs[i][o.crossTileID]}removeStaleBuckets(i){let r=!1;for(let n in this.indexes){let o=this.indexes[n];for(let s in o)i[o[s].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,o[s]),delete o[s],r=!0)}return r}}class eu{constructor(){this.layerIndexes={},this.crossTileIDs=new ea,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,r,n){let o=this.layerIndexes[i.id];void 0===o&&(o=this.layerIndexes[i.id]=new el);let s=!1,a={};for(let l of(o.handleWrapJump(n),r)){let r=l.getBucket(i);r&&i.id===r.layerIds[0]&&(r.bucketInstanceId||(r.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(l.tileID,r,this.crossTileIDs)&&(s=!0),a[r.bucketInstanceId]=!0)}return o.removeStaleBuckets(a)&&(s=!0),s}pruneUnusedLayers(i){let r={};for(let n in i.forEach(i=>{r[i]=!0}),this.layerIndexes)r[n]||delete this.layerIndexes[n]}}let eh=(r,n)=>i.emitValidationErrors(r,n&&n.filter(i=>"source.canvas"!==i.identifier)),ec=i.pick(tD,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),ep=i.pick(tD,["setCenter","setZoom","setBearing","setPitch"]),ef=function(){let r={},n=i.spec.$version;for(let o in i.spec.$root){let s=i.spec.$root[o];if(s.required){let i=null;null!=(i="version"===o?n:"array"===s.type?[]:{})&&(r[o]=i)}}return r}(),ed={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class em extends i.Evented{constructor(r,n={}){super(),this.map=r,this.dispatcher=new L(tk(),this),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(r._requestManager,n.localFontFamily?i.LocalGlyphMode.all:n.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,n.localFontFamily||n.localIdeographFontFamily),this.lineAtlas=new i.LineAtlas(256,512),this.crossTileSymbolIndex=new eu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new i.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());let o=this;this._rtlTextPluginCallback=em.registerForPluginStateChange(r=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:r.pluginStatus,pluginURL:r.pluginURL},(r,n)=>{if(i.triggerPluginCompletionEvent(r),n&&n.every(i=>i))for(let i in o._sourceCaches){let r=o._sourceCaches[i],n=r.getSource().type;"vector"!==n&&"geojson"!==n||r.reload()}})}),this.on("data",i=>{if("source"!==i.dataType||"metadata"!==i.sourceDataType)return;let r=this.getSource(i.sourceId);if(r&&r.vectorLayerIds)for(let i in this._layers){let n=this._layers[i];n.source===r.id&&this._validateLayer(n)}})}loadURL(r,n={}){this.fire(new i.Event("dataloading",{dataType:"style"}));let o="boolean"==typeof n.validate?n.validate:!i.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,n.accessToken);let s=this.map._requestManager.transformRequest(r,i.ResourceType.Style);this._request=i.getJSON(s,(r,n)=>{this._request=null,r?this.fire(new i.ErrorEvent(r)):n&&this._load(n,o)})}loadJSON(r,n={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(r,!1!==n.validate)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(ef,!1)}_updateLayerCount(i,r){let n=r?1:-1;i.is3D()&&(this._num3DLayers+=n),"circle"===i.type&&(this._numCircleLayers+=n),"symbol"===i.type&&(this._numSymbolLayers+=n)}_load(r,n){if(n&&eh(this,i.validateStyle(r)))return;for(let i in this._loaded=!0,this.stylesheet=r,r.sources)this.addSource(i,r.sources[i],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);let o=tR(this.stylesheet.layers);for(let r of(this._order=o.map(i=>i.id),this._layers={},this._serializedLayers={},o))(r=i.createStyleLayer(r)).setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(r,n,o){let s,a,l;let u=i.exported.devicePixelRatio>1?"@2x":"",h=i.getJSON(n.transformRequest(n.normalizeSpriteURL(r,u,".json"),i.ResourceType.SpriteJSON),(i,r)=>{h=null,l||(l=i,s=r,p())}),c=i.getImage(n.transformRequest(n.normalizeSpriteURL(r,u,".png"),i.ResourceType.SpriteImage),(i,r)=>{c=null,l||(l=i,a=r,p())});function p(){if(l)o(l);else if(s&&a){let r=i.exported.getImageData(a),n={};for(let o in s){let{width:a,height:l,x:u,y:h,sdf:c,pixelRatio:p,stretchX:f,stretchY:d,content:m}=s[o],g=new i.RGBAImage({width:a,height:l});i.RGBAImage.copy(r,g,{x:u,y:h},{x:0,y:0},{width:a,height:l}),n[o]={data:g,pixelRatio:p,sdf:c,stretchX:f,stretchY:d,content:m}}o(null,n)}}return{cancel(){h&&(h.cancel(),h=null),c&&(c.cancel(),c=null)}}}(r,this.map._requestManager,(r,n)=>{if(this._spriteRequest=null,r)this.fire(new i.ErrorEvent(r));else if(n)for(let i in n)this.imageManager.addImage(i,n[i]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(r){let n=this.getSource(r.source);if(!n)return;let o=r.sourceLayer;o&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(o))&&this.fire(new i.ErrorEvent(Error(`Source layer "${o}" does not exist on source "${n.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){let r=[];for(let n of i){let i=this._layers[n];"custom"!==i.type&&r.push(i.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(let i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&ed[i.type]}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading")}update(r){if(!this._loaded)return;let n=this._changed;if(this._changed){let i=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(let r in(i.length||n.length)&&this._updateWorkerLayers(i,n),this._updatedSources){let i=this._updatedSources[r];"reload"===i?this._reloadSource(r):"clear"===i&&this._clearSource(r)}for(let i in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[i].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}let o={};for(let i in this._sourceCaches){let r=this._sourceCaches[i];o[i]=r.used,r.used=!1}for(let i of this._order){let n=this._layers[i];if(n.recalculate(r,this._availableImages),!n.isHidden(r.zoom)){let i=this._getLayerSourceCache(n);i&&(i.used=!0)}let o=this.map.painter;if(o){let i=n.getProgramIds();if(!i)continue;let s=n.getProgramConfiguration(r.zoom);for(let r of i)o.useProgram(r,s)}}for(let r in o){let n=this._sourceCaches[r];o[r]!==n.used&&n.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:n.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let i=Object.keys(this._changedImages);if(i.length){for(let r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),eh(this,i.validateStyle(r)))return!1;(r=i.clone$2(r)).layers=tR(r.layers);let n=(function(i,r){if(!i)return[{command:tD.setStyle,args:[r]}];let n=[];try{if(!u(i.version,r.version))return[{command:tD.setStyle,args:[r]}];u(i.center,r.center)||n.push({command:tD.setCenter,args:[r.center]}),u(i.zoom,r.zoom)||n.push({command:tD.setZoom,args:[r.zoom]}),u(i.bearing,r.bearing)||n.push({command:tD.setBearing,args:[r.bearing]}),u(i.pitch,r.pitch)||n.push({command:tD.setPitch,args:[r.pitch]}),u(i.sprite,r.sprite)||n.push({command:tD.setSprite,args:[r.sprite]}),u(i.glyphs,r.glyphs)||n.push({command:tD.setGlyphs,args:[r.glyphs]}),u(i.transition,r.transition)||n.push({command:tD.setTransition,args:[r.transition]}),u(i.light,r.light)||n.push({command:tD.setLight,args:[r.light]}),u(i.fog,r.fog)||n.push({command:tD.setFog,args:[r.fog]});let o={},s=[];!function(i,r,n,o){let s;for(s in r=r||{},i=i||{})i.hasOwnProperty(s)&&(r.hasOwnProperty(s)||tO(s,n,o));for(s in r){var a;r.hasOwnProperty(s)&&(i.hasOwnProperty(s)?u(i[s],r[s])||("geojson"===i[s].type&&"geojson"===r[s].type&&function(i,r,n){let o;for(o in i[n])if(i[n].hasOwnProperty(o)&&"data"!==o&&!u(i[n][o],r[n][o]))return!1;for(o in r[n])if(r[n].hasOwnProperty(o)&&"data"!==o&&!u(i[n][o],r[n][o]))return!1;return!0}(i,r,s)?n.push({command:tD.setGeoJSONSourceData,args:[s,r[s].data]}):(a=r,tO(s,n,o),tN(s,a,n))):tN(s,r,n))}}(i.sources,r.sources,s,o);let a=[];i.layers&&i.layers.forEach(i=>{o[i.source]?n.push({command:tD.removeLayer,args:[i.id]}):a.push(i)});let l=i.terrain;l&&o[l.source]&&(n.push({command:tD.setTerrain,args:[void 0]}),l=void 0),n=n.concat(s),u(l,r.terrain)||n.push({command:tD.setTerrain,args:[r.terrain]}),function(i,r,n){let o,s,a,l,h,c,p;r=r||[];let f=(i=i||[]).map(tF),d=r.map(tF),m=i.reduce(tB,{}),g=r.reduce(tB,{}),y=f.slice(),_=Object.create(null);for(o=0,s=0;o<f.length;o++)a=f[o],g.hasOwnProperty(a)?s++:(n.push({command:tD.removeLayer,args:[a]}),y.splice(y.indexOf(a,s),1));for(o=0,s=0;o<d.length;o++)a=d[d.length-1-o],y[y.length-1-o]!==a&&(m.hasOwnProperty(a)?(n.push({command:tD.removeLayer,args:[a]}),y.splice(y.lastIndexOf(a,y.length-s),1)):s++,c=y[y.length-o],n.push({command:tD.addLayer,args:[g[a],c]}),y.splice(y.length-o,0,a),_[a]=!0);for(o=0;o<d.length;o++)if(l=m[a=d[o]],h=g[a],!_[a]&&!u(l,h)){if(u(l.source,h.source)&&u(l["source-layer"],h["source-layer"])&&u(l.type,h.type)){for(p in tz(l.layout,h.layout,n,a,null,tD.setLayoutProperty),tz(l.paint,h.paint,n,a,null,tD.setPaintProperty),u(l.filter,h.filter)||n.push({command:tD.setFilter,args:[a,h.filter]}),u(l.minzoom,h.minzoom)&&u(l.maxzoom,h.maxzoom)||n.push({command:tD.setLayerZoomRange,args:[a,h.minzoom,h.maxzoom]}),l)l.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?tz(l[p],h[p],n,a,p.slice(6),tD.setPaintProperty):u(l[p],h[p])||n.push({command:tD.setLayerProperty,args:[a,p,h[p]]}));for(p in h)h.hasOwnProperty(p)&&!l.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?tz(l[p],h[p],n,a,p.slice(6),tD.setPaintProperty):u(l[p],h[p])||n.push({command:tD.setLayerProperty,args:[a,p,h[p]]}))}else n.push({command:tD.removeLayer,args:[a]}),c=y[y.lastIndexOf(a)+1],n.push({command:tD.addLayer,args:[h,c]})}}(a,r.layers,n)}catch(i){console.warn("Unable to compute style diff:",i),n=[{command:tD.setStyle,args:[r]}]}return n})(this.serialize(),r).filter(i=>!(i.command in ep));if(0===n.length)return!1;let o=n.filter(i=>!(i.command in ec));if(o.length>0)throw Error(`Unimplemented: ${o.map(i=>i.command).join(", ")}.`);return n.forEach(i=>{"setTransition"!==i.command&&this[i.command].apply(this,i.args)}),this.stylesheet=r,!0}addImage(r,n){if(this.getImage(r))return this.fire(new i.ErrorEvent(Error("An image with this name already exists.")));this.imageManager.addImage(r,n),this._afterImageUpdated(r)}updateImage(i,r){this.imageManager.updateImage(i,r)}getImage(i){return this.imageManager.getImage(i)}removeImage(r){if(!this.getImage(r))return this.fire(new i.ErrorEvent(Error("No image with this name exists.")));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,n,o={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw Error("There is already a source with this ID");if(!n.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(i.validateStyle.source,`sources.${r}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let s=tT(r,n,this.dispatcher,this);s.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:s.serialize(),sourceId:r}));let a=n=>{let o=(n?"symbol:":"other:")+r,a=this._sourceCaches[o]=new i.SourceCache(o,s,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[r]=a,a.style=this,a.onAdd(this.map)};a(!1),"vector"!==n.type&&"geojson"!==n.type||a(!0),s.onAdd&&s.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();let n=this.getSource(r);if(void 0===n)throw Error("There is no source with this ID");for(let n in this._layers)if(this._layers[n].source===r)return this.fire(new i.ErrorEvent(Error(`Source "${r}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new i.ErrorEvent(Error(`Source "${r}" cannot be removed while terrain is using it.`)));for(let n of this._getSourceCaches(r))delete this._sourceCaches[n.id],delete this._updatedSources[n.id],n.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles();delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,r){this._checkLoaded(),this.getSource(i).setData(r),this._changed=!0}getSource(i){let r=this._getSourceCache(i);return r&&r.getSource()}addLayer(r,n,o={}){let s;this._checkLoaded();let a=r.id;if(this.getLayer(a))return void this.fire(new i.ErrorEvent(Error(`Layer with id "${a}" already exists on this map`)));if("custom"===r.type){if(eh(this,i.validateCustomStyleLayer(r)))return;s=i.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(a,r.source),r=i.clone$2(r),r=i.extend(r,{source:a})),this._validate(i.validateStyle.layer,`layers.${a}`,r,{arrayIndex:-1},o))return;s=i.createStyleLayer(r),this._validateLayer(s),s.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[s.id]=s.serialize(),this._updateLayerCount(s,!0)}let l=n?this._order.indexOf(n):this._order.length;if(n&&-1===l)return void this.fire(new i.ErrorEvent(Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(l,0,a),this._layerOrderChanged=!0,this._layers[a]=s;let u=this._getLayerSourceCache(s);if(this._removedLayers[a]&&s.source&&u&&"custom"!==s.type){let i=this._removedLayers[a];delete this._removedLayers[a],i.type!==s.type?this._updatedSources[s.source]="clear":(this._updatedSources[s.source]="reload",u.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,n){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===n)return;let o=this._order.indexOf(r);this._order.splice(o,1);let s=n?this._order.indexOf(n):this._order.length;n&&-1===s?this.fire(new i.ErrorEvent(Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(s,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();let n=this._layers[r];if(!n)return void this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),this._updateLayerCount(n,!1);let o=this._order.indexOf(r);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=n,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(let r in this._layers)if(this._layers[r].type===i)return!0;return!1}setLayerZoomRange(r,n,o){this._checkLoaded();let s=this.getLayer(r);s?s.minzoom===n&&s.maxzoom===o||(null!=n&&(s.minzoom=n),null!=o&&(s.maxzoom=o),this._updateLayer(s)):this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,n,o={}){this._checkLoaded();let s=this.getLayer(r);if(s){if(!u(s.filter,n))return null==n?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(i.validateStyle.filter,`layers.${s.id}.filter`,n,null,o)||(s.filter=i.clone$2(n),this._updateLayer(s)))}else this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){return i.clone$2(this.getLayer(r).filter)}setLayoutProperty(r,n,o,s={}){this._checkLoaded();let a=this.getLayer(r);a?u(a.getLayoutProperty(n),o)||(a.setLayoutProperty(n,o,s),this._updateLayer(a)):this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,n){let o=this.getLayer(r);if(o)return o.getLayoutProperty(n);this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,n,o,s={}){this._checkLoaded();let a=this.getLayer(r);a?u(a.getPaintProperty(n),o)||(a.setPaintProperty(n,o,s)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,r){return this.getLayer(i).getPaintProperty(r)}setFeatureState(r,n){this._checkLoaded();let o=r.source,s=r.sourceLayer,a=this.getSource(o);if(void 0===a)return void this.fire(new i.ErrorEvent(Error(`The source '${o}' does not exist in the map's style.`)));let l=a.type;if("geojson"===l&&s)return void this.fire(new i.ErrorEvent(Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===l&&!s)return void this.fire(new i.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));for(let a of(void 0===r.id&&this.fire(new i.ErrorEvent(Error("The feature id parameter must be provided."))),this._getSourceCaches(o)))a.setFeatureState(s,r.id,n)}removeFeatureState(r,n){this._checkLoaded();let o=r.source,s=this.getSource(o);if(void 0===s)return void this.fire(new i.ErrorEvent(Error(`The source '${o}' does not exist in the map's style.`)));let a=s.type,l="vector"===a?r.sourceLayer:void 0;if("vector"===a&&!l)return void this.fire(new i.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new i.ErrorEvent(Error("A feature id is required to remove its specific state property.")));for(let i of this._getSourceCaches(o))i.removeFeatureState(l,r.id,n)}getFeatureState(r){this._checkLoaded();let n=r.source,o=r.sourceLayer,s=this.getSource(n);if(void 0!==s){if("vector"!==s.type||o)return void 0===r.id&&this.fire(new i.ErrorEvent(Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(o,r.id);this.fire(new i.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let r={};for(let i in this._sourceCaches){let n=this._sourceCaches[i].getSource();r[n.id]||(r[n.id]=n.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:r,layers:this._serializeLayers(this._order)},i=>void 0!==i)}_updateLayer(i){this._updatedLayers[i.id]=!0;let r=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&r&&"raster"!==r.getSource().type&&(this._updatedSources[i.source]="reload",r.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(i){let r=i=>"fill-extrusion"===this._layers[i].type,n={},o=[];for(let s=this._order.length-1;s>=0;s--){let a=this._order[s];if(r(a))for(let r of(n[a]=s,i)){let i=r[a];if(i)for(let r of i)o.push(r)}}o.sort((i,r)=>r.intersectionZ-i.intersectionZ);let s=[];for(let a=this._order.length-1;a>=0;a--){let l=this._order[a];if(r(l))for(let i=o.length-1;i>=0;i--){let r=o[i].feature;if(n[r.layer.id]<a)break;s.push(r),o.pop()}else for(let r of i){let i=r[l];if(i)for(let r of i)s.push(r.feature)}}return s}queryRenderedFeatures(r,n,o){n&&n.filter&&this._validate(i.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);let s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new i.ErrorEvent(Error("parameters.layers must be an Array."))),[];for(let r of n.layers){let n=this._layers[r];if(!n)return this.fire(new i.ErrorEvent(Error(`The layer '${r}' does not exist in the map's style and cannot be queried for features.`))),[];s[n.source]=!0}}let a=[];n.availableImages=this._availableImages;let l=n&&n.layers?n.layers.some(i=>{let r=this.getLayer(i);return r&&r.is3D()}):this.has3DLayers(),u=R.createFromScreenPoints(r,o);for(let r in this._sourceCaches){let h=this._sourceCaches[r].getSource().id;n.layers&&!s[h]||a.push(function(r,n,o,s,a,l,u,h=!1){let c=r.tilesIn(s,u,h);c.sort(tC);let p=[];for(let s of c)p.push({wrappedTileID:s.tile.tileID.wrapped().key,queryResults:s.tile.queryRenderedFeatures(n,o,r._state,s,a,l,function(r,n){let o=i.identity([]);return i.scale$1(o,o,[.5*r.width,-(.5*r.height),1]),i.translate(o,o,[1,-1,0]),i.multiply(o,o,r.calculateProjMatrix(n.toUnwrapped()))}(r.transform,s.tile.tileID),h)});let f=function(i){let r={},n={};for(let o of i){let i=o.queryResults,s=o.wrappedTileID,a=n[s]=n[s]||{};for(let n in i){let o=i[n],s=a[n]=a[n]||{},l=r[n]=r[n]||[];for(let i of o)s[i.featureIndex]||(s[i.featureIndex]=!0,l.push(i))}}return r}(p);for(let i in f)f[i].forEach(i=>{let n=i.feature,o=r.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o});return f}(this._sourceCaches[r],this._layers,this._serializedLayers,u,n,o,l,!!this.map._showQueryGeometry))}return this.placement&&a.push(function(i,r,n,o,s,a,l){let u={},h=a.queryRenderedSymbols(o),c=[];for(let i of Object.keys(h).map(Number))c.push(l[i]);for(let n of(c.sort(tC),c)){let o=n.featureIndex.lookupSymbolFeatures(h[n.bucketInstanceId],r,n.bucketIndex,n.sourceLayerIndex,s.filter,s.layers,s.availableImages,i);for(let i in o){let r=u[i]=u[i]||[],s=o[i];for(let i of(s.sort((i,r)=>{let o=n.featureSortOrder;if(o){let n=o.indexOf(i.featureIndex);return o.indexOf(r.featureIndex)-n}return r.featureIndex-i.featureIndex}),s))r.push(i)}}for(let r in u)u[r].forEach(o=>{let s=o.feature,a=n(i[r]).getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=a});return u}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),u.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(r,n){n&&n.filter&&this._validate(i.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);let o=this._getSourceCaches(r),s=[];for(let i of o)s=s.concat(function(i,r){let n=i.getRenderableIds().map(r=>i.getTileByID(r)),o=[],s={};for(let i=0;i<n.length;i++){let a=n[i],l=a.tileID.canonical.key;s[l]||(s[l]=!0,a.querySourceFeatures(o,r))}return o}(i,n));return s}addSourceType(i,r,n){return em.getSourceType(i)?n(Error(`A source type called "${i}" already exists.`)):(em.setSourceType(i,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:r.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(r,n={}){this._checkLoaded();let o=this.light.getLight(),s=!1;for(let i in r)if(!u(r[i],o[i])){s=!0;break}if(!s)return;let a={now:i.exported.now(),transition:i.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,n),this.light.updateTransitions(a)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(r){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof r.source){let n="terrain-dem-src";this.addSource(n,r.source),r=i.clone$2(r),r=i.extend(r,{source:n})}if(!this._validate(i.validateStyle.terrain,"terrain",r)){if(this.terrain){let n=this.terrain,o=n.get();for(let s in r)if(!u(r[s],o[s])){n.set(r),this.stylesheet.terrain=r;let o={now:i.exported.now(),transition:i.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(o);break}}else this._createTerrain(r);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(r){let n=this.fog=new A(r);this.stylesheet.fog=r;let o={now:i.exported.now(),transition:i.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(o)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(let i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let n=this.fog,o=n.get();for(let s in r)if(!u(r[s],o[s])){n.set(r),this.stylesheet.fog=r;let o={now:i.exported.now(),transition:i.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(o);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let i=this._order.filter(i=>this.isLayerDraped(this._layers[i])),r=this._order.filter(i=>!this.isLayerDraped(this._layers[i]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...r)}_createTerrain(r){let n=this.terrain=new S(r);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();let o={now:i.exported.now(),transition:i.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(o)}_force3DLayerUpdate(){for(let i in this._layers){let r=this._layers[i];"fill-extrusion"===r.type&&this._updateLayer(r)}}_validate(r,n,o,s,a={}){return(!a||!1!==a.validate)&&eh(this,r.call(i.validateStyle,i.extend({key:n,style:this.serialize(),value:o,styleSpec:i.spec},s)))}_remove(){for(let r in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[r].setEventedParent(null);for(let i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){for(let r of this._getSourceCaches(i))r.clearTiles()}_reloadSource(i){for(let r of this._getSourceCaches(i))r.resume(),r.reload()}_updateSources(i){for(let r in this._sourceCaches)this._sourceCaches[r].update(i)}_generateCollisionBoxes(){for(let i in this._sourceCaches){let r=this._sourceCaches[i];r.resume(),r.reload()}}_updatePlacement(r,n,o,s,a=!1){let l=!1,u=!1,h={};for(let i of this._order){let n=this._layers[i];if("symbol"!==n.type)continue;if(!h[n.source]){let i=this._getLayerSourceCache(n);if(!i)continue;h[n.source]=i.getRenderableIds(!0).map(r=>i.getTileByID(r)).sort((i,r)=>r.tileID.overscaledZ-i.tileID.overscaledZ||(i.tileID.isLessThan(r.tileID)?-1:1))}let o=this.crossTileSymbolIndex.addLayer(n,h[n.source],r.center.lng);l=l||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),a=a||this._layerOrderChanged||0===o,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),r.zoom))&&(this.pauseablePlacement=new en(r,this._order,a,n,o,s,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),u=!0),l&&this.pauseablePlacement.placement.setStale()),u||l)for(let i of this._order){let r=this._layers[i];"symbol"===r.type&&this.placement.updateLayerOpacities(r,h[r.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(let i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,r,n){this.imageManager.getImages(r.icons,n),this._updateTilesForChangedImages();let o=i=>{i&&i.setDependencies(r.tileID.key,r.type,r.icons)};o(this._otherSourceCaches[r.source]),o(this._symbolSourceCaches[r.source])}getGlyphs(i,r,n){this.glyphManager.getGlyphs(r.stacks,n)}getResource(r,n,o){return i.makeRequest(n,o)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){let r=[];return this._otherSourceCaches[i]&&r.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&r.push(this._symbolSourceCaches[i]),r}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}em.getSourceType=function(i){return tM[i]},em.setSourceType=function(i,r){tM[i]=r},em.registerForPluginStateChange=i.registerForPluginStateChange;var eg="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",ey="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let e_={},ev={};e_=ew("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ev=ew("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);let ex=ew("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.");var eb={background:ew("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ew("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ew("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ew("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ew("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ew("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ew("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ew("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ew("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:ew("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ew("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ew("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ew("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ew("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ew("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\n#else\nvec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ew("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ew("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ew("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineGradient:ew("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ew("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineSDF:ew("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float widthA=dash_from.z*fromScale;float widthB=dash_to.z*toScale;float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*(tileZoomRatio/widthA)/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*(tileZoomRatio/widthB)/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ew("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ew("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:ew("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:ew("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:ew("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ew("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ew("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ey),skyboxGradient:ew("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ey),skyboxCapture:ew("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function ew(i,r,n){let o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,a=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),l=i.match(s),u=r.match(s),h=eg.match(s),c=u?u.concat(l):l;n||(e_.staticUniforms&&(c=e_.staticUniforms.concat(c)),ev.staticUniforms&&(c=ev.staticUniforms.concat(c))),c&&(c=c.concat(h));let p={};return{fragmentSource:i=i.replace(o,(i,r,n,o,s)=>(p[s]=!0,"define"===r?`
#ifndef HAS_UNIFORM_u_${s}
varying ${n} ${o} ${s};
#else
uniform ${n} ${o} u_${s};
#endif
`:`
#ifdef HAS_UNIFORM_u_${s}
    ${n} ${o} ${s} = u_${s};
#endif
`)),vertexSource:r=r.replace(o,(i,r,n,o,s)=>{let a="float"===o?"vec2":"vec4",l=s.match(/color/)?"color":a;return p[s]?"define"===r?`
#ifndef HAS_UNIFORM_u_${s}
uniform lowp float u_${s}_t;
attribute ${n} ${a} a_${s};
varying ${n} ${o} ${s};
#else
uniform ${n} ${o} u_${s};
#endif
`:"vec4"===l?`
#ifndef HAS_UNIFORM_u_${s}
    ${s} = a_${s};
#else
    ${n} ${o} ${s} = u_${s};
#endif
`:`
#ifndef HAS_UNIFORM_u_${s}
    ${s} = unpack_mix_${l}(a_${s}, u_${s}_t);
#else
    ${n} ${o} ${s} = u_${s};
#endif
`:"define"===r?`
#ifndef HAS_UNIFORM_u_${s}
uniform lowp float u_${s}_t;
attribute ${n} ${a} a_${s};
#else
uniform ${n} ${o} u_${s};
#endif
`:"vec4"===l?`
#ifndef HAS_UNIFORM_u_${s}
    ${n} ${o} ${s} = a_${s};
#else
    ${n} ${o} ${s} = u_${s};
#endif
`:`
#ifndef HAS_UNIFORM_u_${s}
    ${n} ${o} ${s} = unpack_mix_${l}(a_${s}, u_${s}_t);
#else
    ${n} ${o} ${s} = u_${s};
#endif
`}),staticAttributes:a,staticUniforms:c}}class eE{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,r,n,o,s,a,l,u){this.context=i;let h=this.boundPaintVertexBuffers.length!==o.length;for(let i=0;!h&&i<o.length;i++)this.boundPaintVertexBuffers[i]!==o[i]&&(h=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===r&&this.boundLayoutVertexBuffer===n&&!h&&this.boundIndexBuffer===s&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===l&&this.boundDynamicVertexBuffer2===u?(i.bindVertexArrayOES.set(this.vao),l&&l.bind(),s&&s.dynamicDraw&&s.bind(),u&&u.bind()):this.freshBind(r,n,o,s,a,l,u)}freshBind(i,r,n,o,s,a,l){let u;let h=i.numAttributes,c=this.context,p=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),u=0,this.boundProgram=i,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=o,this.boundVertexOffset=s,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=l;else{u=c.currentNumAttributes||0;for(let i=h;i<u;i++)p.disableVertexAttribArray(i)}for(let o of(r.enableAttributes(p,i),n))o.enableAttributes(p,i);for(let o of(a&&a.enableAttributes(p,i),l&&l.enableAttributes(p,i),r.bind(),r.setVertexAttribPointers(p,i,s),n))o.bind(),o.setVertexAttribPointers(p,i,s);a&&(a.bind(),a.setVertexAttribPointers(p,i,s)),o&&o.bind(),l&&(l.bind(),l.setVertexAttribPointers(p,i,s)),c.currentNumAttributes=h}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function eI(r,n,o){if(!n.needsDEMTextureUpload)return;let s=r.context,a=s.gl;s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||r.getTileTexture(o.stride);let l=o.getPixels();n.demTexture?n.demTexture.update(l,{premultiply:!1}):n.demTexture=new i.Texture(s,l,a.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}let eS=(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_image0:new i.Uniform1i(r,n.u_image0),u_skirt_height:new i.Uniform1f(r,n.u_skirt_height)}),eM=(i,r)=>({u_matrix:i,u_image0:0,u_skirt_height:r}),eT=new class{constructor(){this.operations={}}newMorphing(i,r,n,o,s){if(i in this.operations){let r=this.operations[i];r.to.tileID.key!==n.tileID.key&&(r.queued=n)}else this.operations[i]={startTime:o,phase:0,duration:s,from:r,to:n,queued:null}}getMorphValuesForProxy(i){if(!(i in this.operations))return null;let r=this.operations[i];return{from:r.from,to:r.to,phase:r.phase}}update(i){for(let r in this.operations){let n=this.operations[r];for(n.phase=(i-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,i)){delete this.operations[r];break}}}_nextOp(i,r){return!!i.queued&&(i.from=i.to,i.to=i.queued,i.queued=null,i.phase=0,i.startTime=r,!0)}_validOp(i){return i.from.hasData()&&i.to.hasData()}},eC={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function eP(r,n,o,s,a){let l,u;let h=r.context,c=h.gl,p=2*!!r.options.showTerrainWireframe,f=(i,n)=>{if(u===i)return;let o=[eC[i]];n&&o.push(eC[p]),l=r.useProgram("terrainRaster",null,o),u=i},d=r.colorModeForRenderPass(),m=new i.DepthMode(c.LEQUAL,i.DepthMode.ReadWrite,r.depthRangeFor3D);eT.update(a);let g=r.transform,y=6*Math.pow(1.5,22-g.zoom)*n.exaggeration();(p?[!1,!0]:[!1]).forEach(p=>{u=-1;let _=p?c.LINES:c.TRIANGLES,[v,x]=p?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments];for(let u of s){let s;let b=o.getTile(u),w=i.StencilMode.disabled,E=n.prevTerrainTileForTile[u.key],I=n.terrainTileForTile[u.key];null!=E&&null!=I&&E.hasData()&&I.hasData()&&null!=E.demTexture&&null!=I.demTexture&&E.tileID.key!==I.tileID.key&&eT.newMorphing(u.key,E,I,a,250),h.activeTexture.set(c.TEXTURE0),b.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE,c.LINEAR_MIPMAP_NEAREST);let S=eT.getMorphValuesForProxy(u.key),M=+!!S;S&&(s={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:i.easeCubicInOut(S.phase)}});let T=eM(u.projMatrix,!function(i,r){let n=1<<i.z;return!r&&(0===i.x||i.x===n-1)||0===i.y||i.y===n-1}(u.canonical,g.renderWorldCopies)?y:y/10);f(M,p),n.setupElevationDraw(b,l,s),r.prepareDrawProgram(h,l,u.toUnwrapped()),l.draw(h,_,m,w,d,i.CullFaceMode.backCCW,T,"terrain_raster",n.gridBuffer,v,x)}})}let eA=i=>({u_matrix:i});function eL(r,n,o,s,a){if(a>0){let l=i.exported.now(),u=(l-r.timeAdded)/a,h=n?(l-n.timeAdded)/a:-1,c=o.getSource(),p=s.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),f=!n||Math.abs(n.tileID.overscaledZ-p)>Math.abs(r.tileID.overscaledZ-p),d=f&&r.refreshedUponExpiration?1:i.clamp(f?u:1-h,0,1);return r.refreshedUponExpiration&&u>=1&&(r.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class ek extends i.SourceCache{constructor(i){let r=tT("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new L(tk(),null),i.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,n,o){if(r.freezeTileCoverage)return;this.transform=r;let s=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((n,o)=>{if(n[o.key]="",!this._tiles[o.key]){let n=new i.Tile(o,this._source.tileSize*o.overscaleFactor(),r.tileZoom);n.state="loaded",this._tiles[o.key]=n}return n},{});for(let i in this._tiles)i in s||(this.freeFBO(i),this._tiles[i].state="unloaded",delete this._tiles[i])}freeFBO(i){let r=this.proxyCachedFBO[i];if(void 0!==r){let n=Object.values(r);this.renderCachePool.push(...n),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class eR extends i.OverscaledTileID{constructor(i,r,n){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=r,this.projMatrix=n}}class eD extends i.Elevation{constructor(r,n){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[o,s,a]=function(r){let n=new i.StructArrayLayout4i8,o=new i.StructArrayLayout3ui6;n.reserve(17161),o.reserve(33800);let s=i.EXTENT/128,a=i.EXTENT+s/2,l=a+s;for(let r=-s;r<l;r+=s)for(let o=-s;o<l;o+=s){let s=24575*(o<0||o>a||r<0||r>a),l=i.clamp(Math.round(o),0,i.EXTENT),u=i.clamp(Math.round(r),0,i.EXTENT);n.emplaceBack(l+s,u,l,u)}let u=(i,r)=>{let n=131*r+i;o.emplaceBack(n+1,n,n+131),o.emplaceBack(n+131,n+131+1,n+1)};for(let i=1;i<129;i++)for(let r=1;r<129;r++)u(r,i);return[0,129].forEach(i=>{for(let r=0;r<130;r++)u(r,i),u(i,r)}),[n,o,32768]}(),l=r.context;this.gridBuffer=l.createVertexBuffer(o,tI.members),this.gridIndexBuffer=l.createIndexBuffer(s),this.gridSegments=i.SegmentVector.simpleSegment(0,0,o.length,s.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,o.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ek(n.map),this.orthoMatrix=i.create$1(),i.ortho(this.orthoMatrix,0,i.EXTENT,0,i.EXTENT,0,1);let u=l.gl;this._overlapStencilMode=new i.StencilMode({func:u.GEQUAL,mask:255},0,255,u.KEEP,u.KEEP,u.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(r,n,o){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;let s=r.terrain.properties;this.sourceCache=r._getSourceCache(s.get("source")),this._exaggeration=s.get("exaggeration");let a=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let r=this.sourceCache.getSource().tileSize/128,o=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(n,r*o,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,a(),this._initializing=!0),a(),n.updateElevation(!o),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){let r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&i.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let n=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=0===o._centerAltitude&&-1===this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(o.center),-1),this._emptyDEMTextureDirty=!this._initializing);let s=this.proxyCoords=n.getIds().map(i=>{let r=n.getTileByID(i).tileID;return r.projMatrix=o.calculateProjMatrix(r.toUnwrapped()),r});(function(r,n){let o=n.transform.pointCoordinate(n.transform.getCameraPoint()),s=new i.pointGeometry(o.x,o.y);r.sort((r,n)=>{if(n.overscaledZ-r.overscaledZ)return n.overscaledZ-r.overscaledZ;let o=new i.pointGeometry(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),a=new i.pointGeometry(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),l=s.mult(1<<r.canonical.z);return l.x-=.5,l.y-=.5,l.distSqr(o)-l.distSqr(a)})})(s,this.painter),this._previousZoom=o.zoom;let a=this.proxyToSource||{};this.proxyToSource={},s.forEach(i=>{this.proxyToSource[i.key]={}}),this.terrainTileForTile={};let l=this._style._sourceCaches;for(let i in l){let n=l[i];if(!n.used||(n!==this.sourceCache&&(this._findCoveringTileCache[n.id]={}),this._setupProxiedCoordsForOrtho(n,r[i],a),n.usedForTerrain))continue;let o=r[i];n.getSource().reparseOverscaled&&this._assignTerrainTiles(o)}this.proxiedCoords[n.id]=s.map(i=>new eR(i,i.key,this.orthoMatrix)),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(a),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();let u={};for(let i of(this._visibleDemTiles=[],this.proxyCoords)){let r=this.terrainTileForTile[i.key];if(!r)continue;let n=r.tileID.key;n in u||(this._visibleDemTiles.push(r),u[n]=n)}}_assignTerrainTiles(i){this._initializing||i.forEach(i=>{if(this.terrainTileForTile[i.key])return;let r=this._findTileCoveringTileID(i,this.sourceCache);r&&(this.terrainTileForTile[i.key]=r)})}_prepareDEMTextures(){let i=this.painter.context,r=i.gl;for(let n in this.terrainTileForTile){let o=this.terrainTileForTile[n],s=o.dem;s&&(!o.demTexture||o.needsDEMTextureUpload)&&(i.activeTexture.set(r.TEXTURE1),eI(this.painter,o,s))}}_prepareDemTileUniforms(i,r,n,o){if(!r||null==r.demTexture)return!1;let s=i.tileID.canonical,a=Math.pow(2,r.tileID.canonical.z-s.z),l=o||"";return n[`u_dem_tl${l}`]=[s.x*a%1,s.y*a%1],n[`u_dem_scale${l}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let i=0,r=this._visibleDemTiles.reduce((r,n)=>{if(!n.dem)return r;let o=n.dem.tree.minimums[0];return o>0&&i++,r+o},0);return i?r/i:0}_updateEmptyDEMTexture(){let r=this.painter.context,n=r.gl;r.activeTexture.set(n.TEXTURE2);let o=this._getLoadedAreaMinimum(),s={width:1,height:1,data:new Uint8Array(i.DEMData.pack(o,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(s,{premultiply:!1}):a=this._emptyDEMTexture=new i.Texture(r,s,n.RGBA,{premultiply:!1}),a}setupElevationDraw(r,n,o){var s;let a=this.painter.context,l=a.gl,u=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});u.u_dem_size=this.sourceCache.getSource().tileSize,u.u_exaggeration=this.exaggeration();let h=null,c=null,p=1;if(o&&o.morphing&&this._useVertexMorphing){let i=o.morphing.srcDemTile,n=o.morphing.dstDemTile;p=o.morphing.phase,i&&n&&(this._prepareDemTileUniforms(r,i,u,"_prev")&&(c=i),this._prepareDemTileUniforms(r,n,u)&&(h=n))}if(c&&h?(a.activeTexture.set(l.TEXTURE2),h.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE,l.NEAREST),a.activeTexture.set(l.TEXTURE4),c.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE,l.NEAREST),u.u_dem_lerp=p):(h=this.terrainTileForTile[r.tileID.key],a.activeTexture.set(l.TEXTURE2),(this._prepareDemTileUniforms(r,h,u)?h.demTexture:this.emptyDEMTexture).bind(l.NEAREST,l.CLAMP_TO_EDGE,l.NEAREST)),o&&o.useDepthForOcclusion&&(a.activeTexture.set(l.TEXTURE3),this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE,l.NEAREST),u.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),o&&o.useMeterToDem&&h){let r=(1<<h.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;u.u_meter_to_dem=r}o&&o.labelPlaneMatrixInv&&(u.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),n.setTerrainUniformValues(a,u)}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;let n=this.painter,o=this.painter.context,s=this.proxySourceCache,a=this.proxiedCoords[s.id],l=()=>{o.bindFramebuffer.set(null),o.viewport.set([0,0,n.width,n.height]),this.renderingToTexture=!1},u=this._drapedRenderBatches.shift(),h=[],c=n.style.order,p=0;for(let f=0;f<a.length;f++){let d,m;let g=a[f],y=s.getTileByID(g.proxyTileKey),_=s.proxyCachedFBO[g.key]?s.proxyCachedFBO[g.key][r]:void 0;if(d=this.currentFBO=void 0!==_?s.renderCache[_]:this.pool[p++],y.texture=d.tex,void 0===_||d.dirty){o.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(o.clear({color:i.Color.transparent}),d.dirty=!1);for(let i=u.start;i<=u.end;++i){let r=n.style._layers[c[i]];if(r.isHidden(n.transform.zoom))continue;let s=n.style._getLayerSourceCache(r),a=s?this.proxyToSource[g.key][s.id]:[g];a&&(o.viewport.set([0,0,d.fb.width,d.fb.height]),m!==(s?s.id:null)&&(this._setupStencil(a,r,s),m=s?s.id:null),n.renderLayer(n,s,r,a))}d.dirty=this.renderedToTile,this.renderedToTile&&h.push(y.tileID),5===p&&(p=0,h.length>0&&(l(),eP(n,this,s,h,this._updateTimestamp),this.renderingToTexture=!0,h=[]))}else h.push(y.tileID)}return l(),h.length>0&&eP(n,this,s,h,this._updateTimestamp),u.end+1}postRender(){}renderCacheEfficiency(i){let r=i.order.length;if(0===r)return{efficiency:100};let n,o=0,s=0,a=!1;for(let l=0;l<r;++l){let r=i._layers[i.order[l]];this._style.isLayerDraped(r)?(a&&++o,++s):a||(a=!0,n=r.id)}return 0===s?{efficiency:100}:{efficiency:100*(1-o/s),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(r=>{i=Math.min(i,r.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,r,n){if(!this._visibleDemTiles)return null;let o=this._visibleDemTiles.filter(i=>i.dem).map(o=>{let s=o.tileID,a=Math.pow(2,s.overscaledZ),{x:l,y:u}=s.canonical,h=l/a,c=(l+1)/a,p=u/a,f=(u+1)/a;return{minx:h,miny:p,maxx:c,maxy:f,t:o.dem.tree.raycastRoot(h,p,c,f,i,r,n),tile:o}});for(let s of(o.sort((i,r)=>(null!==i.t?i.t:Number.MAX_VALUE)-(null!==r.t?r.t:Number.MAX_VALUE)),o)){if(null==s.t)break;let o=s.tile.dem.tree.raycast(s.minx,s.miny,s.maxx,s.maxy,i,r,n);if(null!=o)return o}return null}_createFBO(){let r=this.painter.context,n=r.gl,o=this.drapeBufferSize;r.activeTexture.set(n.TEXTURE0);let s=new i.Texture(r,{width:o[0],height:o[1],data:null},n.RGBA);s.bind(n.LINEAR,n.CLAMP_TO_EDGE);let a=r.createFramebuffer(o[0],o[1],!1);return a.colorAttachment.set(s.texture),a.depthAttachment=new tx(r,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:a,tex:s,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{let r=this._style._layers[i],n=r.isHidden(this.painter.transform.zoom),o=r.getCrossfadeParameters(),s=!!o&&1!==o.t,a=r.hasTransition();return"custom"!==r.type&&!n&&(s||a)})}_clearRasterFadeFromRenderCache(){let i=!1;for(let r in this._style._sourceCaches)if(this._style._sourceCaches[r]._source instanceof tE){i=!0;break}if(i)for(let i=0;i<this._style.order.length;++i){let r=this._style._layers[this._style.order[i]],n=r.isHidden(this.painter.transform.zoom),o=this._style._getLayerSourceCache(r);if("raster"!==r.type||n||!o)continue;let s=r.paint.get("raster-fade-duration");for(let i of this.proxyCoords){let r=this.proxyToSource[i.key][o.id];if(r)for(let i of r){let r=eL(o.getTile(i),o.findLoadedParent(i,0),o,this.painter.transform,s);(1!==r.opacity||0!==r.mix)&&this._clearRenderCacheForTile(o.id,i)}}}}_setupDrapedRenderBatches(){let i=this._style.order,r=i.length;if(0===r)return;let n=[],o,s=0,a=this._style._layers[i[s]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++s<r;)a=this._style._layers[i[s]];for(;s<r;++s){let r=this._style._layers[i[s]];r.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(r)?void 0===o&&(o=s):void 0!==o&&(n.push({start:o,end:s-1}),o=void 0))}void 0!==o&&n.push({start:o,end:s-1}),this._drapedRenderBatches=n}_setupRenderCache(i){let r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){let i=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let n=0;n<i.length;++n){let o=Object.values(i[n]);r.renderCachePool.push(...o)}}return}this._clearRasterFadeFromRenderCache();let n=this.proxyCoords,o=this._tilesDirty;for(let s=n.length-1;s>=0;s--){let a=n[s];if(r.getTileByID(a.key),void 0!==r.proxyCachedFBO[a.key]){let n=i[a.key],s=this.proxyToSource[a.key],l=0;for(let i in s){let r=s[i],a=n[i];if(!a||a.length!==r.length||r.some((r,n)=>r!==a[n]||o[i]&&o[i].hasOwnProperty(r.key))){l=-1;break}++l}for(let i in r.proxyCachedFBO[a.key])r.renderCache[r.proxyCachedFBO[a.key][i]].dirty=l<0||l!==Object.values(n).length}else for(let i=0;i<this._drapedRenderBatches.length;++i){let n=this._drapedRenderBatches[i],o=r.renderCachePool.pop();void 0===o&&r.renderCache.length<50&&(o=r.renderCache.length,r.renderCache.push(this._createFBO())),void 0!==o&&(void 0===r.proxyCachedFBO[a.key]&&(r.proxyCachedFBO[a.key]={}),r.proxyCachedFBO[a.key][n.start]=o,r.renderCache[o].dirty=!0)}}this._tilesDirty={}}_setupStencil(i,r,n){let o;if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let s=this.painter.context,a=s.gl;if(i.length<=1)return void(this._overlapStencilType=!1);if(r.isTileClipped())o=i.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(s.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(r,n){let o=this.painter,s=this.painter.context,a=s.gl;o._tileClippingMaskIDs={},s.setColorMode(i.ColorMode.disabled),s.setDepthMode(i.DepthMode.disabled);let l=o.useProgram("clippingMask");for(let u of r){let r=o._tileClippingMaskIDs[u.key]=--n;l.draw(s,a.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:a.ALWAYS,mask:0},r,255,a.KEEP,a.KEEP,a.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,eA(u.projMatrix),"$clipping",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments)}}pointCoordinate(r){let n=this.painter.transform;if(r.x<0||r.x>n.width||r.y<0||r.y>n.height)return null;let o=[r.x,r.y,1,1];i.transformMat4(o,o,n.pixelMatrixInverse),i.scale$2(o,o,1/o[3]),o[0]/=n.worldSize,o[1]/=n.worldSize;let s=n._camera.position,a=i.mercatorZfromAltitude(1,n.center.lat),l=[s[0],s[1],s[2]/a,0],u=i.subtract([],o.slice(0,3),l);i.normalize(u,u);let h=this.raycast(l,u,this._exaggeration);return null!==h&&h?(i.scaleAndAdd(l,l,u,h),l[3]=l[2],l[2]*=a,l):null}drawDepth(){let r=this.painter,n=r.context,o=this.proxySourceCache,s=Math.ceil(r.width),a=Math.ceil(r.height);if(this._depthFBO&&(this._depthFBO.width!==s||this._depthFBO.height!==a)&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){let r=n.gl,o=n.createFramebuffer(s,a,!0);n.activeTexture.set(r.TEXTURE0);let l=new i.Texture(n,{width:s,height:a,data:null},r.RGBA);l.bind(r.NEAREST,r.CLAMP_TO_EDGE),o.colorAttachment.set(l.texture);let u=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,s,a);o.depthAttachment.set(u),this._depthFBO=o,this._depthTexture=l}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,s,a]),function(r,n,o,s){let a=r.context,l=a.gl;a.clear({depth:1});let u=r.useProgram("terrainDepth"),h=new i.DepthMode(l.LESS,i.DepthMode.ReadWrite,r.depthRangeFor3D);for(let r of s){let s=o.getTile(r),c=eM(r.projMatrix,0);n.setupElevationDraw(s,u),u.draw(a,l.TRIANGLES,h,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,c,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(r,this,o,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,r,n){if(i.getSource()instanceof tS)return this._setupProxiedCoordsForImageSource(i,r,n);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};let o=this.proxiedCoords[i.id]=[],s=this.proxyCoords;for(let r=0;r<s.length;r++){let a=s[r],l=this._findTileCoveringTileID(a,i);if(l){let r=this._createProxiedId(a,l,n[a.key]&&n[a.key][i.id]);o.push(r),this.proxyToSource[a.key][i.id]=[r]}}let a=!1;for(let s=0;s<r.length;s++){let l=i.getTile(r[s]);if(!l||!l.hasData())continue;let u=this._findTileCoveringTileID(l.tileID,this.proxySourceCache);if(u&&u.tileID.canonical.z!==l.tileID.canonical.z){let r=this.proxyToSource[u.tileID.key][i.id],s=this._createProxiedId(u.tileID,l,n[u.tileID.key]&&n[u.tileID.key][i.id]);r?r.splice(r.length-1,0,s):this.proxyToSource[u.tileID.key][i.id]=[s],o.push(s),a=!0}}this._sourceTilesOverlap[i.id]=a}_setupProxiedCoordsForImageSource(r,n,o){if(!r.getSource().loaded())return;let s=this.proxiedCoords[r.id]=[],a=this.proxyCoords,l=r.getSource(),u=new i.pointGeometry(l.tileID.x,l.tileID.y)._div(1<<l.tileID.z),h=l.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce((i,r)=>(i.min.x=Math.min(i.min.x,r.x-u.x),i.min.y=Math.min(i.min.y,r.y-u.y),i.max.x=Math.max(i.max.x,r.x-u.x),i.max.y=Math.max(i.max.y,r.y-u.y),i),{min:new i.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(r,n)=>{let o=r.wrap+r.canonical.x/(1<<r.canonical.z),s=r.canonical.y/(1<<r.canonical.z),a=i.EXTENT/(1<<r.canonical.z),l=n.wrap+n.canonical.x/(1<<n.canonical.z),u=n.canonical.y/(1<<n.canonical.z);return o+a<l+h.min.x||o>l+h.max.x||s+a<u+h.min.y||s>u+h.max.y};for(let i=0;i<a.length;i++){let l=a[i];for(let i=0;i<n.length;i++){let a=r.getTile(n[i]);if(!a||!a.hasData()||c(l,a.tileID))continue;let u=this._createProxiedId(l,a,o[l.key]&&o[l.key][r.id]),h=this.proxyToSource[l.key][r.id];h?h.push(u):this.proxyToSource[l.key][r.id]=[u],s.push(u)}}}_createProxiedId(r,n,o){let s=this.orthoMatrix;if(o){let i=o.find(i=>i.key===n.tileID.key);if(i)return i}if(n.tileID.key!==r.key){let o,a,l;let u=r.canonical.z-n.tileID.canonical.z;s=i.create$1();let h=n.tileID.wrap-r.wrap<<r.overscaledZ;u>0?(a=(o=i.EXTENT>>u)*((n.tileID.canonical.x<<u)-r.canonical.x+h),l=o*((n.tileID.canonical.y<<u)-r.canonical.y)):(o=i.EXTENT<<-u,a=i.EXTENT*(n.tileID.canonical.x-(r.canonical.x+h<<-u)),l=i.EXTENT*(n.tileID.canonical.y-(r.canonical.y<<-u))),i.ortho(s,0,o,0,o,0,1),i.translate(s,s,[a,l,0])}return new eR(n.tileID,r.key,s)}_findTileCoveringTileID(r,n){let o=n.getTile(r);if(o&&o.hasData())return o;let s=this._findCoveringTileCache[n.id],a=s[r.key];if((o=a?n.getTileByID(a):null)&&o.hasData()||null===a)return o;let l=o?o.tileID:r,u=l.overscaledZ,h=n.getSource().minzoom,c=[];if(!a){let s=n.getSource().maxzoom;if(r.canonical.z>=s){let o=r.canonical.z-s;n.getSource().reparseOverscaled?(u=Math.max(r.canonical.z+2,n.transform.tileZoom),l=new i.OverscaledTileID(u,r.wrap,s,r.canonical.x>>o,r.canonical.y>>o)):0!==o&&(u=s,l=new i.OverscaledTileID(u,r.wrap,s,r.canonical.x>>o,r.canonical.y>>o))}l.key!==r.key&&(c.push(l.key),o=n.getTile(l))}let p=i=>{c.forEach(r=>{s[r]=i}),c.length=0};for(u-=1;u>=h&&(!o||!o.hasData());u--){o&&p(o.tileID.key);let i=l.calculateScaledKey(u);if((o=n.getTileByID(i))&&o.hasData())break;let r=s[i];if(null===r)break;void 0===r?c.push(i):o=n.getTileByID(r)}return p(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(i,r){let n=this._tilesDirty[i];n||(n=this._tilesDirty[i]={}),n[r.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let r=function(r){let n,o,s;let a=new i.StructArrayLayout2ui4;for(o=1;o<129;o++){for(n=1;n<129;n++)s=131*o+n,a.emplaceBack(s,s+1),a.emplaceBack(s,s+131),a.emplaceBack(s+1,s+131),128===o&&a.emplaceBack(s+131,s+131+1);a.emplaceBack(s+1,s+1+131)}return a}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function eN(i){let r=[];for(let n=0;n<i.length;n++){if(null===i[n])continue;let o=i[n].split(" ");r.push(o.pop())}return r}class eO{static cacheKey(i,r,n){let o=`${i}${n?n.cacheKey:""}`;for(let i of r)o+=`/${i}`;return o}constructor(r,n,o,s,a,l){let u=r.gl;this.program=u.createProgram();let h=eN(o.staticAttributes),c=s?s.getBinderAttributes():[],p=h.concat(c),f=o.staticUniforms?eN(o.staticUniforms):[],d=s?s.getBinderUniforms():[],m=f.concat(d),g=[];for(let i of m)0>g.indexOf(i)&&g.push(i);let y=s?s.defines():[],_=(y=y.concat(l.map(i=>`#define ${i}`))).concat(ex.fragmentSource,eg,ev.fragmentSource,o.fragmentSource).join("\n"),v=y.concat(ex.vertexSource,eg,ev.vertexSource,e_.vertexSource,o.vertexSource).join("\n"),x=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);u.shaderSource(x,_),u.compileShader(x),u.attachShader(this.program,x);let b=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);u.shaderSource(b,v),u.compileShader(b),u.attachShader(this.program,b),this.attributes={};let w={};this.numAttributes=p.length;for(let i=0;i<this.numAttributes;i++)p[i]&&(u.bindAttribLocation(this.program,i,p[i]),this.attributes[p[i]]=i);u.linkProgram(this.program),u.deleteShader(b),u.deleteShader(x);for(let i=0;i<g.length;i++){let r=g[i];if(r&&!w[r]){let i=u.getUniformLocation(this.program,r);i&&(w[r]=i)}}this.fixedUniforms=a(r,w),this.binderUniforms=s?s.getUniforms(r,w):[],-1!==l.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new i.Uniform1i(r,w.u_dem),u_dem_prev:new i.Uniform1i(r,w.u_dem_prev),u_dem_unpack:new i.Uniform4f(r,w.u_dem_unpack),u_dem_tl:new i.Uniform2f(r,w.u_dem_tl),u_dem_scale:new i.Uniform1f(r,w.u_dem_scale),u_dem_tl_prev:new i.Uniform2f(r,w.u_dem_tl_prev),u_dem_scale_prev:new i.Uniform1f(r,w.u_dem_scale_prev),u_dem_size:new i.Uniform1f(r,w.u_dem_size),u_dem_lerp:new i.Uniform1f(r,w.u_dem_lerp),u_exaggeration:new i.Uniform1f(r,w.u_exaggeration),u_depth:new i.Uniform1i(r,w.u_depth),u_depth_size_inv:new i.Uniform2f(r,w.u_depth_size_inv),u_meter_to_dem:new i.Uniform1f(r,w.u_meter_to_dem),u_label_plane_matrix_inv:new i.UniformMatrix4f(r,w.u_label_plane_matrix_inv)}),-1!==l.indexOf("FOG")&&(this.fogUniforms={u_fog_matrix:new i.UniformMatrix4f(r,w.u_fog_matrix),u_fog_range:new i.Uniform2f(r,w.u_fog_range),u_fog_color:new i.Uniform4f(r,w.u_fog_color),u_fog_horizon_blend:new i.Uniform1f(r,w.u_fog_horizon_blend),u_fog_temporal_offset:new i.Uniform1f(r,w.u_fog_temporal_offset)})}setTerrainUniformValues(i,r){if(!this.terrainUniforms)return;let n=this.terrainUniforms;if(!this.failedToCreate)for(let o in i.program.set(this.program),r)n[o].set(r[o])}setFogUniformValues(i,r){if(!this.fogUniforms)return;let n=this.fogUniforms;if(!this.failedToCreate)for(let o in i.program.set(this.program),r)n[o].location&&n[o].set(r[o])}draw(i,r,n,o,s,a,l,u,h,c,p,f,d,m,g,y){let _=i.gl;if(this.failedToCreate)return;for(let r in i.program.set(this.program),i.setDepthMode(n),i.setStencilMode(o),i.setColorMode(s),i.setCullFace(a),this.fixedUniforms)this.fixedUniforms[r].set(l[r]);m&&m.setUniforms(i,this.binderUniforms,f,{zoom:d});let v={[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[r];for(let n of p.get()){let o=n.vaos||(n.vaos={});(o[u]||(o[u]=new eE)).bind(i,this,h,m?m.getPaintVertexBuffers():[],c,n.vertexOffset,g,y),_.drawElements(r,n.primitiveLength*v,_.UNSIGNED_SHORT,n.primitiveOffset*v*2)}}}function ez(i,r,n){let o=1/k(n,1,r.transform.tileZoom),s=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,r.transform.tileZoom)/s,l=a*(n.tileID.canonical.x+n.tileID.wrap*s),u=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[l>>16,u>>16],u_pixel_coord_lower:[65535&l,65535&u]}}let eF=(r,n,o,s)=>{let a=n.style.light,l=a.properties.get("position"),u=[l.x,l.y,l.z],h=i.create$2();"viewport"===a.properties.get("anchor")&&(i.fromRotation(h,-n.transform.angle),i.transformMat3(u,u,h));let c=a.properties.get("color");return{u_matrix:r,u_lightpos:u,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+o,u_opacity:s}},eB=(r,n,o,s,a,l,u)=>i.extend(eF(r,n,o,s),ez(l,n,u),{u_height_factor:-Math.pow(2,a.overscaledZ)/u.tileSize/8}),eU=i=>({u_matrix:i}),eG=(r,n,o,s)=>i.extend(eU(r),ez(o,n,s)),eV=(i,r)=>({u_matrix:i,u_world:r}),eq=(r,n,o,s,a)=>i.extend(eG(r,n,o,s),{u_world:a}),ej=(r,n,o,s)=>{let a;let l=r.transform;if("map"===s.paint.get("circle-pitch-alignment")){let i=k(o,1,l.zoom);a=[i,i]}else a=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_matrix:r.translatePosMatrix(n.projMatrix,o,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:a}},eZ=i=>{let r=[];return"map"===i.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===i.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},eX=(r,n,o)=>{let s=i.EXTENT/o.tileSize;return{u_matrix:r,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/s,n.pixelsToGLUnits[1]/s]}},e$=(i,r,n=1)=>({u_matrix:i,u_color:r,u_overlay:0,u_overlay_scale:n}),eW=(i,r,n,o)=>({u_matrix:i,u_extrude_scale:k(r,1,n),u_intensity:o}),eH=(r,n,o,s)=>{let a=r.transform;return{u_matrix:e0(r,n,o,s),u_ratio:1/k(n,1,a.zoom),u_device_pixel_ratio:i.exported.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},eY=(r,n,o,s,a)=>i.extend(eH(r,n,o,s),{u_image:0,u_image_height:a}),eK=(r,n,o,s,a)=>{let l=r.transform,u=eQ(n,l);return{u_matrix:e0(r,n,o,a),u_texsize:n.imageAtlasTexture.size,u_ratio:1/k(n,1,l.zoom),u_device_pixel_ratio:i.exported.devicePixelRatio,u_image:0,u_scale:[u,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},eJ=(r,n,o,s,a)=>{let l=eQ(n,r.transform);return i.extend(eH(r,n,o,a),{u_texsize:n.lineAtlasTexture.size,u_scale:[l,s.fromScale,s.toScale],u_image:0,u_mix:s.t})};function eQ(i,r){return 1/k(i,1,r.tileZoom)}function e0(i,r,n,o){return i.translatePosMatrix(o||r.tileID.projMatrix,r,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let e1=(i,r,n,o,s)=>{var a,l;return{u_matrix:i,u_tl_parent:r,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(l=s.paint.get("raster-saturation"))>0?1-1/(1.001-l):-l,u_contrast_factor:(a=s.paint.get("raster-contrast"))>0?1/(1-a):1+a,u_spin_weights:function(i){let r=Math.sin(i*=Math.PI/180),n=Math.cos(i);return[(2*n+1)/3,(-Math.sqrt(3)*r-n+1)/3,(Math.sqrt(3)*r-n+1)/3]}(s.paint.get("raster-hue-rotate"))}},e2=(i,r,n,o,s,a,l,u,h,c)=>{let p=s.transform;return{u_is_size_zoom_constant:+("constant"===i||"source"===i),u_is_size_feature_constant:+("constant"===i||"camera"===i),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:l,u_coord_matrix:u,u_is_text:+h,u_pitch_with_map:+o,u_texsize:c,u_texture:0}},e3=(r,n,o,s,a,l,u,h,c,p,f)=>{let{cameraToCenterDistance:d,_pitch:m}=a.transform;return i.extend(e2(r,n,o,s,a,l,u,h,c,p),{u_gamma_scale:s?d*Math.cos(a.terrain?0:m):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:+f})},e5=(r,n,o,s,a,l,u,h,c,p)=>i.extend(e3(r,n,o,s,a,l,u,h,!0,c,!0),{u_texsize_icon:p,u_texture_icon:1}),e4=(i,r,n)=>({u_matrix:i,u_opacity:r,u_color:n}),e6=(r,n,o,s,a,l)=>i.extend(function(i,r,n,o){let s=n.imageManager.getPattern(i.from.toString()),a=n.imageManager.getPattern(i.to.toString()),{width:l,height:u}=n.imageManager.getPixelSize(),h=Math.pow(2,o.tileID.overscaledZ),c=o.tileSize*Math.pow(2,n.transform.tileZoom)/h,p=c*(o.tileID.canonical.x+o.tileID.wrap*h),f=c*o.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:s.tl,u_pattern_br_a:s.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[l,u],u_mix:r.t,u_pattern_size_a:s.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:r.fromScale,u_scale_b:r.toScale,u_tile_units_to_pixels:1/k(o,1,n.transform.tileZoom),u_pixel_coord_upper:[p>>16,f>>16],u_pixel_coord_lower:[65535&p,65535&f]}}(s,l,o,a),{u_matrix:r,u_opacity:n}),e8={fillExtrusion:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_lightpos:new i.Uniform3f(r,n.u_lightpos),u_lightintensity:new i.Uniform1f(r,n.u_lightintensity),u_lightcolor:new i.Uniform3f(r,n.u_lightcolor),u_vertical_gradient:new i.Uniform1f(r,n.u_vertical_gradient),u_opacity:new i.Uniform1f(r,n.u_opacity)}),fillExtrusionPattern:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_lightpos:new i.Uniform3f(r,n.u_lightpos),u_lightintensity:new i.Uniform1f(r,n.u_lightintensity),u_lightcolor:new i.Uniform3f(r,n.u_lightcolor),u_vertical_gradient:new i.Uniform1f(r,n.u_vertical_gradient),u_height_factor:new i.Uniform1f(r,n.u_height_factor),u_image:new i.Uniform1i(r,n.u_image),u_texsize:new i.Uniform2f(r,n.u_texsize),u_pixel_coord_upper:new i.Uniform2f(r,n.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(r,n.u_pixel_coord_lower),u_scale:new i.Uniform3f(r,n.u_scale),u_fade:new i.Uniform1f(r,n.u_fade),u_opacity:new i.Uniform1f(r,n.u_opacity)}),fill:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix)}),fillPattern:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_image:new i.Uniform1i(r,n.u_image),u_texsize:new i.Uniform2f(r,n.u_texsize),u_pixel_coord_upper:new i.Uniform2f(r,n.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(r,n.u_pixel_coord_lower),u_scale:new i.Uniform3f(r,n.u_scale),u_fade:new i.Uniform1f(r,n.u_fade)}),fillOutline:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_world:new i.Uniform2f(r,n.u_world)}),fillOutlinePattern:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_world:new i.Uniform2f(r,n.u_world),u_image:new i.Uniform1i(r,n.u_image),u_texsize:new i.Uniform2f(r,n.u_texsize),u_pixel_coord_upper:new i.Uniform2f(r,n.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(r,n.u_pixel_coord_lower),u_scale:new i.Uniform3f(r,n.u_scale),u_fade:new i.Uniform1f(r,n.u_fade)}),circle:(r,n)=>({u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_extrude_scale:new i.Uniform2f(r,n.u_extrude_scale),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_matrix:new i.UniformMatrix4f(r,n.u_matrix)}),collisionBox:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_extrude_scale:new i.Uniform2f(r,n.u_extrude_scale)}),collisionCircle:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_inv_matrix:new i.UniformMatrix4f(r,n.u_inv_matrix),u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_viewport_size:new i.Uniform2f(r,n.u_viewport_size)}),debug:(r,n)=>({u_color:new i.UniformColor(r,n.u_color),u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_overlay:new i.Uniform1i(r,n.u_overlay),u_overlay_scale:new i.Uniform1f(r,n.u_overlay_scale)}),clippingMask:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix)}),heatmap:(r,n)=>({u_extrude_scale:new i.Uniform1f(r,n.u_extrude_scale),u_intensity:new i.Uniform1f(r,n.u_intensity),u_matrix:new i.UniformMatrix4f(r,n.u_matrix)}),heatmapTexture:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_world:new i.Uniform2f(r,n.u_world),u_image:new i.Uniform1i(r,n.u_image),u_color_ramp:new i.Uniform1i(r,n.u_color_ramp),u_opacity:new i.Uniform1f(r,n.u_opacity)}),hillshade:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_image:new i.Uniform1i(r,n.u_image),u_latrange:new i.Uniform2f(r,n.u_latrange),u_light:new i.Uniform2f(r,n.u_light),u_shadow:new i.UniformColor(r,n.u_shadow),u_highlight:new i.UniformColor(r,n.u_highlight),u_accent:new i.UniformColor(r,n.u_accent)}),hillshadePrepare:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_image:new i.Uniform1i(r,n.u_image),u_dimension:new i.Uniform2f(r,n.u_dimension),u_zoom:new i.Uniform1f(r,n.u_zoom),u_unpack:new i.Uniform4f(r,n.u_unpack)}),line:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_ratio:new i.Uniform1f(r,n.u_ratio),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(r,n.u_units_to_pixels)}),lineGradient:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_ratio:new i.Uniform1f(r,n.u_ratio),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(r,n.u_units_to_pixels),u_image:new i.Uniform1i(r,n.u_image),u_image_height:new i.Uniform1f(r,n.u_image_height)}),linePattern:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_texsize:new i.Uniform2f(r,n.u_texsize),u_ratio:new i.Uniform1f(r,n.u_ratio),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_image:new i.Uniform1i(r,n.u_image),u_units_to_pixels:new i.Uniform2f(r,n.u_units_to_pixels),u_scale:new i.Uniform3f(r,n.u_scale),u_fade:new i.Uniform1f(r,n.u_fade)}),lineSDF:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_texsize:new i.Uniform2f(r,n.u_texsize),u_ratio:new i.Uniform1f(r,n.u_ratio),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(r,n.u_units_to_pixels),u_image:new i.Uniform1i(r,n.u_image),u_scale:new i.Uniform3f(r,n.u_scale),u_mix:new i.Uniform1f(r,n.u_mix)}),raster:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_tl_parent:new i.Uniform2f(r,n.u_tl_parent),u_scale_parent:new i.Uniform1f(r,n.u_scale_parent),u_buffer_scale:new i.Uniform1f(r,n.u_buffer_scale),u_fade_t:new i.Uniform1f(r,n.u_fade_t),u_opacity:new i.Uniform1f(r,n.u_opacity),u_image0:new i.Uniform1i(r,n.u_image0),u_image1:new i.Uniform1i(r,n.u_image1),u_brightness_low:new i.Uniform1f(r,n.u_brightness_low),u_brightness_high:new i.Uniform1f(r,n.u_brightness_high),u_saturation_factor:new i.Uniform1f(r,n.u_saturation_factor),u_contrast_factor:new i.Uniform1f(r,n.u_contrast_factor),u_spin_weights:new i.Uniform3f(r,n.u_spin_weights)}),symbolIcon:(r,n)=>({u_is_size_zoom_constant:new i.Uniform1i(r,n.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(r,n.u_is_size_feature_constant),u_size_t:new i.Uniform1f(r,n.u_size_t),u_size:new i.Uniform1f(r,n.u_size),u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_pitch:new i.Uniform1f(r,n.u_pitch),u_rotate_symbol:new i.Uniform1i(r,n.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(r,n.u_aspect_ratio),u_fade_change:new i.Uniform1f(r,n.u_fade_change),u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(r,n.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(r,n.u_coord_matrix),u_is_text:new i.Uniform1i(r,n.u_is_text),u_pitch_with_map:new i.Uniform1i(r,n.u_pitch_with_map),u_texsize:new i.Uniform2f(r,n.u_texsize),u_texture:new i.Uniform1i(r,n.u_texture)}),symbolSDF:(r,n)=>({u_is_size_zoom_constant:new i.Uniform1i(r,n.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(r,n.u_is_size_feature_constant),u_size_t:new i.Uniform1f(r,n.u_size_t),u_size:new i.Uniform1f(r,n.u_size),u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_pitch:new i.Uniform1f(r,n.u_pitch),u_rotate_symbol:new i.Uniform1i(r,n.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(r,n.u_aspect_ratio),u_fade_change:new i.Uniform1f(r,n.u_fade_change),u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(r,n.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(r,n.u_coord_matrix),u_is_text:new i.Uniform1i(r,n.u_is_text),u_pitch_with_map:new i.Uniform1i(r,n.u_pitch_with_map),u_texsize:new i.Uniform2f(r,n.u_texsize),u_texture:new i.Uniform1i(r,n.u_texture),u_gamma_scale:new i.Uniform1f(r,n.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(r,n.u_is_halo)}),symbolTextAndIcon:(r,n)=>({u_is_size_zoom_constant:new i.Uniform1i(r,n.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(r,n.u_is_size_feature_constant),u_size_t:new i.Uniform1f(r,n.u_size_t),u_size:new i.Uniform1f(r,n.u_size),u_camera_to_center_distance:new i.Uniform1f(r,n.u_camera_to_center_distance),u_pitch:new i.Uniform1f(r,n.u_pitch),u_rotate_symbol:new i.Uniform1i(r,n.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(r,n.u_aspect_ratio),u_fade_change:new i.Uniform1f(r,n.u_fade_change),u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(r,n.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(r,n.u_coord_matrix),u_is_text:new i.Uniform1i(r,n.u_is_text),u_pitch_with_map:new i.Uniform1i(r,n.u_pitch_with_map),u_texsize:new i.Uniform2f(r,n.u_texsize),u_texsize_icon:new i.Uniform2f(r,n.u_texsize_icon),u_texture:new i.Uniform1i(r,n.u_texture),u_texture_icon:new i.Uniform1i(r,n.u_texture_icon),u_gamma_scale:new i.Uniform1f(r,n.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(r,n.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(r,n.u_is_halo)}),background:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_opacity:new i.Uniform1f(r,n.u_opacity),u_color:new i.UniformColor(r,n.u_color)}),backgroundPattern:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_opacity:new i.Uniform1f(r,n.u_opacity),u_image:new i.Uniform1i(r,n.u_image),u_pattern_tl_a:new i.Uniform2f(r,n.u_pattern_tl_a),u_pattern_br_a:new i.Uniform2f(r,n.u_pattern_br_a),u_pattern_tl_b:new i.Uniform2f(r,n.u_pattern_tl_b),u_pattern_br_b:new i.Uniform2f(r,n.u_pattern_br_b),u_texsize:new i.Uniform2f(r,n.u_texsize),u_mix:new i.Uniform1f(r,n.u_mix),u_pattern_size_a:new i.Uniform2f(r,n.u_pattern_size_a),u_pattern_size_b:new i.Uniform2f(r,n.u_pattern_size_b),u_scale_a:new i.Uniform1f(r,n.u_scale_a),u_scale_b:new i.Uniform1f(r,n.u_scale_b),u_pixel_coord_upper:new i.Uniform2f(r,n.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(r,n.u_pixel_coord_lower),u_tile_units_to_pixels:new i.Uniform1f(r,n.u_tile_units_to_pixels)}),terrainRaster:eS,terrainDepth:eS,skybox:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_sun_direction:new i.Uniform3f(r,n.u_sun_direction),u_cubemap:new i.Uniform1i(r,n.u_cubemap),u_opacity:new i.Uniform1f(r,n.u_opacity),u_temporal_offset:new i.Uniform1f(r,n.u_temporal_offset)}),skyboxGradient:(r,n)=>({u_matrix:new i.UniformMatrix4f(r,n.u_matrix),u_color_ramp:new i.Uniform1i(r,n.u_color_ramp),u_center_direction:new i.Uniform3f(r,n.u_center_direction),u_radius:new i.Uniform1f(r,n.u_radius),u_opacity:new i.Uniform1f(r,n.u_opacity),u_temporal_offset:new i.Uniform1f(r,n.u_temporal_offset)}),skyboxCapture:(r,n)=>({u_matrix_3f:new i.UniformMatrix3f(r,n.u_matrix_3f),u_sun_direction:new i.Uniform3f(r,n.u_sun_direction),u_sun_intensity:new i.Uniform1f(r,n.u_sun_intensity),u_color_tint_r:new i.Uniform4f(r,n.u_color_tint_r),u_color_tint_m:new i.Uniform4f(r,n.u_color_tint_m),u_luminance:new i.Uniform1f(r,n.u_luminance)})};function e9(r,n,o,a,l,u,h){var c;let p=r.context,f=p.gl,d=r.useProgram("collisionBox"),m=[],g=0,y=0;for(let s=0;s<a.length;s++){let c=a[s],_=n.getTile(c),v=_.getBucket(o);if(!v)continue;let x=c.projMatrix;0===l[0]&&0===l[1]||(x=r.translatePosMatrix(c.projMatrix,_,l,u));let b=h?v.textCollisionBox:v.iconCollisionBox,w=v.collisionCircleArray;if(w.length>0){let n=i.create$1(),o=x;i.mul$1(n,v.placementInvProjMatrix,r.transform.glCoordMatrix),i.mul$1(n,n,v.placementViewportMatrix),m.push({circleArray:w,circleOffset:y,transform:o,invTransform:n}),g+=w.length/4,y=g}b&&(r.terrain&&r.terrain.setupElevationDraw(_,d),d.draw(p,f.LINES,i.DepthMode.disabled,i.StencilMode.disabled,r.colorModeForRenderPass(),i.CullFaceMode.disabled,eX(x,r.transform,_),o.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,r.transform.zoom,null,b.collisionVertexBuffer,b.collisionVertexBufferExt))}if(!h||!m.length)return;let _=r.useProgram("collisionCircle"),v=new i.StructArrayLayout2f1f2i16;v.resize(4*g),v._trim();let x=0;for(let i of m)for(let r=0;r<i.circleArray.length/4;r++){let n=4*r,o=i.circleArray[n+0],s=i.circleArray[n+1],a=i.circleArray[n+2],l=i.circleArray[n+3];v.emplace(x++,o,s,a,l,0),v.emplace(x++,o,s,a,l,1),v.emplace(x++,o,s,a,l,2),v.emplace(x++,o,s,a,l,3)}(!s||s.length<2*g)&&(s=function(r){let n=2*r,o=new i.StructArrayLayout3ui6;o.resize(n),o._trim();for(let i=0;i<n;i++){let r=6*i;o.uint16[r+0]=4*i+0,o.uint16[r+1]=4*i+1,o.uint16[r+2]=4*i+2,o.uint16[r+3]=4*i+2,o.uint16[r+4]=4*i+3,o.uint16[r+5]=4*i+0}return o}(g));let b=p.createIndexBuffer(s,!0),w=p.createVertexBuffer(v,i.collisionCircleLayout.members,!0);for(let n of m){let s={u_matrix:n.transform,u_inv_matrix:n.invTransform,u_camera_to_center_distance:(c=r.transform).cameraToCenterDistance,u_viewport_size:[c.width,c.height]};_.draw(p,f.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,r.colorModeForRenderPass(),i.CullFaceMode.disabled,s,o.id,w,b,i.SegmentVector.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,r.transform.zoom,null,null,null)}w.destroy(),b.destroy()}let e7=i.identity(new Float32Array(16));function it(r,n,o,s,a,l,u,h,c,p,f,d){let m=r.context,g=m.gl,y=r.transform,_="map"===h,v="map"===c,x=_&&"point"!==o.layout.get("symbol-placement"),b=_&&!v&&!x,w=void 0!==o.layout.get("symbol-sort-key").constantOr(1),E=!1,I=r.depthModeForSublayer(0,i.DepthMode.ReadOnly),S=o.layout.get("text-variable-anchor"),M=[],T=r.terrain&&v?["PITCH_WITH_MAP_TERRAIN"]:null;for(let h of s){let s=n.getTile(h),c=s.getBucket(o);if(!c)continue;let f=a?c.text:c.icon;if(!f||!f.segments.get().length)continue;let d=f.programConfigurations.get(o.id),m=a||c.sdfIcons,I=a?c.textSizeData:c.iconSizeData,C=v||0!==y.pitch,P=r.useProgram(c.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon",d,T),A=i.evaluateSizeForZoom(I,y.zoom),L,R,D,N,O=[0,0],z=null;if(a){if(R=s.glyphAtlasTexture,D=g.LINEAR,L=s.glyphAtlasTexture.size,c.iconsInText){O=s.imageAtlasTexture.size,z=s.imageAtlasTexture;let i="composite"===I.kind||"camera"===I.kind;N=C||r.options.rotating||r.options.zooming||i?g.LINEAR:g.NEAREST}}else{let i=1!==o.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;R=s.imageAtlasTexture,D=m||r.options.rotating||r.options.zooming||i||C?g.LINEAR:g.NEAREST,L=s.imageAtlasTexture.size}let F=k(s,1,r.transform.zoom),B=tV(h.projMatrix,v,_,r.transform,F),U=r.terrain&&v&&x?i.invert(new Float32Array(16),B):e7,G=tq(h.projMatrix,v,_,r.transform,F),V=S&&c.hasTextData(),q="none"!==o.layout.get("icon-text-fit")&&V&&c.hasIconData();if(x){let n=y.elevation;!function(r,n,o,s,a,l,u,h,c){let p=s?r.textSizeData:r.iconSizeData,f=i.evaluateSizeForZoom(p,o.transform.zoom),d=[256/o.width*2+1,256/o.height*2+1],m=s?r.text.dynamicLayoutVertexArray:r.icon.dynamicLayoutVertexArray;m.clear();let g=r.lineVertexArray,y=s?r.text.placedSymbolArray:r.icon.placedSymbolArray,_=o.transform.width/o.transform.height,v=!1;for(let s=0;s<y.length;s++){let x=y.get(s);if(x.hidden||x.writingMode===i.WritingMode.vertical&&!v){tJ(x.numGlyphs,m);continue}v=!1;let b=c?c({x:x.anchorX,y:x.anchorY}):0,w=[x.anchorX,x.anchorY,b,1];if(i.transformMat4(w,w,n),!function(i,r){let n=i[0]/i[3],o=i[1]/i[3];return n>=-r[0]&&n<=r[0]&&o>=-r[1]&&o<=r[1]}(w,d)){tJ(x.numGlyphs,m);continue}let E=tZ(o.transform.cameraToCenterDistance,w[3]),I=i.evaluateSizeForFeature(p,f,x),S=u?I/E:I*E,M=new i.pointGeometry(x.anchorX,x.anchorY),T=tj(M,a,b);if(T.signedDistanceFromCamera<=0){tJ(x.numGlyphs,m);continue}let C=T.point,P={},A=u?null:c,L=tW(x,S,!1,h,n,a,l,r.glyphOffsetArray,g,m,C,M,P,_,A);v=L.useVertical,A&&L.needsFlipping&&(P={}),(L.notEnoughRoom||v||L.needsFlipping&&tW(x,S,!0,h,n,a,l,r.glyphOffsetArray,g,m,C,M,P,_,A).notEnoughRoom)&&tJ(x.numGlyphs,m)}s?r.text.dynamicLayoutVertexBuffer.updateData(m):r.icon.dynamicLayoutVertexBuffer.updateData(m)}(c,h.projMatrix,r,a,B,G,v,p,n?i=>n.getAtTileOffset(h,i.x,i.y):null)}let j=r.translatePosMatrix(h.projMatrix,s,l,u),Z=x||a&&S||q?e7:B,X=r.translatePosMatrix(G,s,l,u,!0),$=m&&0!==o.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),W={program:P,buffers:f,uniformValues:m?c.iconsInText?e5(I.kind,A,b,v,r,j,Z,X,L,O):e3(I.kind,A,b,v,r,j,Z,X,a,L,!0):e2(I.kind,A,b,v,r,j,Z,X,a,L),atlasTexture:R,atlasTextureIcon:z,atlasInterpolation:D,atlasInterpolationIcon:N,isSDF:m,hasHalo:$,tile:s,labelPlaneMatrixInv:U};if(w&&c.canOverlap)for(let r of(E=!0,f.segments.get()))M.push({segments:new i.SegmentVector([r]),sortKey:r.sortKey,state:W});else M.push({segments:f.segments,sortKey:0,state:W})}for(let i of(E&&M.sort((i,r)=>i.sortKey-r.sortKey),M)){let n=i.state;if(r.terrain&&r.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),m.activeTexture.set(g.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,g.CLAMP_TO_EDGE),n.atlasTextureIcon&&(m.activeTexture.set(g.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,g.CLAMP_TO_EDGE)),n.isSDF){let s=n.uniformValues;n.hasHalo&&(s.u_is_halo=1,ie(n.buffers,i.segments,o,r,n.program,I,f,d,s)),s.u_is_halo=0}ie(n.buffers,i.segments,o,r,n.program,I,f,d,n.uniformValues)}}function ie(r,n,o,s,a,l,u,h,c){let p=s.context;a.draw(p,p.gl.TRIANGLES,l,u,h,i.CullFaceMode.disabled,c,o.id,r.layoutVertexBuffer,r.indexBuffer,n,o.paint,s.transform.zoom,r.programConfigurations.get(o.id),r.dynamicLayoutVertexBuffer,r.opacityVertexBuffer)}function ii(r,n,o,s,a,l,u){let h,c,p,f,d;let m=r.context.gl,g=o.paint.get("fill-pattern"),y=g&&g.constantOr(1),_=o.getCrossfadeParameters();for(let v of(u?(c=y&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=m.LINES):(c=y?"fillPattern":"fill",h=m.TRIANGLES),s)){let s=n.getTile(v);if(y&&!s.patternsLoaded())continue;let x=s.getBucket(o);if(!x)continue;r.prepareDrawTile(v);let b=x.programConfigurations.get(o.id),w=r.useProgram(c,b);y&&(r.context.activeTexture.set(m.TEXTURE0),s.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),b.updatePaintBuffers(_));let E=g.constantOr(null);if(E&&s.imageAtlas){let i=s.imageAtlas,r=i.patternPositions[E.to.toString()],n=i.patternPositions[E.from.toString()];r&&n&&b.setConstantPatternPositions(r,n)}let I=r.translatePosMatrix(v.projMatrix,s,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(u){f=x.indexBuffer2,d=x.segments2;let i=r.terrain&&r.terrain.renderingToTexture?r.terrain.drapeBufferSize:[m.drawingBufferWidth,m.drawingBufferHeight];p="fillOutlinePattern"===c&&y?eq(I,r,_,s,i):eV(I,i)}else f=x.indexBuffer,d=x.segments,p=y?eG(I,r,_,s):eU(I);r.prepareDrawProgram(r.context,w,v.toUnwrapped()),w.draw(r.context,h,a,r.stencilModeForClipping(v),l,i.CullFaceMode.disabled,p,o.id,x.layoutVertexBuffer,f,d,o.paint,r.transform.zoom,b)}}function ir(r,n,o,s,a,l,u){let h=r.context,c=h.gl,p=o.paint.get("fill-extrusion-pattern"),f=p.constantOr(1),d=o.getCrossfadeParameters(),m=o.paint.get("fill-extrusion-opacity");for(let g of s){let s=n.getTile(g),y=s.getBucket(o);if(!y)continue;let _=y.programConfigurations.get(o.id),v=r.useProgram(f?"fillExtrusionPattern":"fillExtrusion",_);if(r.terrain){let a=r.terrain;if(!y.enableTerrain)continue;if(a.setupElevationDraw(s,v,{useMeterToDem:!0}),function(r,n,o,s,a,l){let u,h,c;let p=[r=>{let n=r.canonical.x-1,o=r.wrap;return n<0&&(n=(1<<r.canonical.z)-1,o--),new i.OverscaledTileID(r.overscaledZ,o,r.canonical.z,n,r.canonical.y)},r=>{let n=r.canonical.x+1,o=r.wrap;return n===1<<r.canonical.z&&(n=0,o++),new i.OverscaledTileID(r.overscaledZ,o,r.canonical.z,n,r.canonical.y)},r=>new i.OverscaledTileID(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(0===r.canonical.y?1<<r.canonical.z:r.canonical.y)-1),r=>new i.OverscaledTileID(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)],f=i=>{let r,o,s;let l=n.getSource().maxzoom,u=i=>{let r=n.getTileByID(i);if(r&&r.hasData())return r.getBucket(a)};return(i.overscaledZ===i.canonical.z||i.overscaledZ>=l)&&(r=u(i.key)),i.overscaledZ>=l&&(o=u(i.calculateScaledKey(i.overscaledZ+1))),i.overscaledZ>l&&(s=u(i.calculateScaledKey(i.overscaledZ-1))),r||o||s},d=[0,0,0],m=(r,n)=>(d[0]=Math.min(r.min.y,n.min.y),d[1]=Math.max(r.max.y,n.max.y),d[2]=i.EXTENT-n.min.x>r.max.x?n.min.x-i.EXTENT:r.max.x,d),g=(r,n)=>(d[0]=Math.min(r.min.x,n.min.x),d[1]=Math.max(r.max.x,n.max.x),d[2]=i.EXTENT-n.min.y>r.max.y?n.min.y-i.EXTENT:r.max.y,d),y=[(i,r)=>m(i,r),(i,r)=>m(r,i),(i,r)=>g(i,r),(i,r)=>g(r,i)],_=new i.pointGeometry(0,0),v=(r,n,s,a,p)=>{let f=[[a?s:r,a?r:s,0],[a?s:n,a?n:s,0]],d=p<0?i.EXTENT+p:p,m=[a?d:(r+n)/2,a?(r+n)/2:d,0];return 0===s&&p<0||0!==s&&p>0?l.getForTilePoints(c,[m],!0,h):f.push(m),l.getForTilePoints(o,f,!0,u),Math.max(f[0][2],f[1][2],m[2])/l.exaggeration()};for(let r=0;r<4;r++){let n=s.borders[r];if(0===n.length&&(s.borderDone[r]=!0),s.borderDone[r])continue;let a=c=p[r](o),d=f(a);if(!d||!d.enableTerrain||!(h=l.findDEMTileFor(a))||!h.dem)continue;if(!u){let i=l.findDEMTileFor(o);if(!i||!i.dem)return;u=i}let m=(r<2?1:5)-r,g=d.borders[m],x=0;for(let o=0;o<n.length;o++){let a;let l=s.featuresOnBorder[n[o]],u=l.borders[r];for(;x<g.length&&!((a=d.featuresOnBorder[g[x]]).borders[m][1]>u[0]+3);)d.borderDone[m]||d.encodeCentroid(void 0,a,!1),x++;if(a&&x<g.length){let n=x,o=0;for(;!(a.borders[m][0]>u[1]-3)&&(o++,++x!==g.length);)a=d.featuresOnBorder[g[x]];if(a=d.featuresOnBorder[g[n]],l.intersectsCount()>1||a.intersectsCount()>1||1!==o){1!==o&&(x=n),s.encodeCentroid(void 0,l,!1),d.borderDone[m]||d.encodeCentroid(void 0,a,!1);continue}let h=y[r](l,a),c=r%2?i.EXTENT-1:0;_.x=v(h[0],Math.min(i.EXTENT-1,h[1]),c,r<2,h[2]),_.y=0,s.encodeCentroid(_,l,!1),d.borderDone[m]||d.encodeCentroid(_,a,!1)}else s.encodeCentroid(void 0,l,!1)}s.borderDone[r]=s.needsCentroidUpdate=!0,d.borderDone[m]||(d.borderDone[m]=d.needsCentroidUpdate=!0)}(s.needsCentroidUpdate||!s.centroidVertexBuffer&&0!==s.centroidVertexArray.length)&&s.uploadCentroid(r)}(h,n,g,y,o,a),!y.centroidVertexBuffer){let i=v.attributes.a_centroid_pos;void 0!==i&&c.vertexAttrib2f(i,0,0)}}f&&(r.context.activeTexture.set(c.TEXTURE0),s.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),_.updatePaintBuffers(d));let x=p.constantOr(null);if(x&&s.imageAtlas){let i=s.imageAtlas,r=i.patternPositions[x.to.toString()],n=i.patternPositions[x.from.toString()];r&&n&&_.setConstantPatternPositions(r,n)}let b=r.translatePosMatrix(g.projMatrix,s,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),w=o.paint.get("fill-extrusion-vertical-gradient"),E=f?eB(b,r,w,m,g,d,s):eF(b,r,w,m);r.prepareDrawProgram(h,v,g.toUnwrapped()),v.draw(h,h.gl.TRIANGLES,a,l,u,i.CullFaceMode.backCCW,E,o.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,o.paint,r.transform.zoom,_,r.terrain?y.centroidVertexBuffer:null)}}let io=new i.Color(1,0,0,1),is=new i.Color(0,1,0,1),ia=new i.Color(0,0,1,1),il=new i.Color(1,0,1,1),iu=new i.Color(0,1,1,1);function ih(i,r,n,o){ip(i,0,r+n/2,i.transform.width,n,o)}function ic(i,r,n,o){ip(i,r-n/2,0,n,i.transform.height,o)}function ip(r,n,o,s,a,l){let u=r.context,h=u.gl;h.enable(h.SCISSOR_TEST),h.scissor(n*i.exported.devicePixelRatio,o*i.exported.devicePixelRatio,s*i.exported.devicePixelRatio,a*i.exported.devicePixelRatio),u.clear({color:l}),h.disable(h.SCISSOR_TEST)}let{members:id}=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]);function im(i,r,n,o){i.emplaceBack(r,n,o)}class ig{constructor(r){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,im(this.vertexArray,-1,-1,1),im(this.vertexArray,1,-1,1),im(this.vertexArray,-1,1,1),im(this.vertexArray,1,1,1),im(this.vertexArray,-1,-1,-1),im(this.vertexArray,1,-1,-1),im(this.vertexArray,-1,1,-1),im(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,id),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function iy(r,n,o,s,a,l){let u=r.gl,h=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),p=n.paint.get("sky-atmosphere-sun-intensity"),f={u_matrix_3f:i.fromMat4([],s),u_sun_direction:a,u_sun_intensity:p,u_color_tint_r:[h.r,h.g,h.b,h.a],u_color_tint_m:[c.r,c.g,c.b,c.a],u_luminance:5e-5};u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+l,n.skyboxTexture,0),o.draw(r,u.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,f,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}let i_={symbol:function(r,n,o,s,a){if("translucent"!==r.renderPass)return;let l=i.StencilMode.disabled,u=r.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(r,n,o,s,a,l,u){let h=n.transform,c="map"===a,p="map"===l;for(let a of r){let r=s.getTile(a),l=r.getBucket(o);if(!l||!l.text||!l.text.segments.get().length)continue;let f=i.evaluateSizeForZoom(l.textSizeData,h.zoom),d=k(r,1,n.transform.zoom),m=tV(a.projMatrix,p,c,n.transform,d),g="none"!==o.layout.get("icon-text-fit")&&l.hasIconData();if(f){let n=Math.pow(2,h.zoom-r.tileID.overscaledZ),o=h.elevation;(function(r,n,o,s,a,l,u,h,c,p,f,d){let m=r.text.placedSymbolArray,g=r.text.dynamicLayoutVertexArray,y=r.icon.dynamicLayoutVertexArray,_={};g.clear();for(let y=0;y<m.length;y++){let v=m.get(y),x=r.allowVerticalPlacement&&!v.placedOrientation,b=v.hidden||!v.crossTileID||x?null:s[v.crossTileID];if(b){let s=new i.pointGeometry(v.anchorX,v.anchorY),m=d(s),y=tj(s,o?h:u,m),x=tZ(l.cameraToCenterDistance,y.signedDistanceFromCamera),w=a.evaluateSizeForFeature(r.textSizeData,p,v)*x/i.ONE_EM;o&&(w*=r.tilePixelRatio/c);let{width:E,height:I,anchor:S,textOffset:M,textScale:T}=b,C=function(r,n,o,s,a,l){let{horizontalAlign:u,verticalAlign:h}=i.getAnchorAlignment(r),c=i.evaluateVariableOffset(r,s);return new i.pointGeometry((-(u-.5)*n/a+c[0])*l,(-(h-.5)*o/a+c[1])*l)}(S,E,I,M,T,w),P=o?tj(s.add(C),u,m).point:y.point.add(n?C.rotate(-l.angle):C),A=r.allowVerticalPlacement&&v.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let r=0;r<v.numGlyphs;r++)i.addDynamicAttributes(g,P,A);f&&v.associatedIconIndex>=0&&(_[v.associatedIconIndex]={shiftedAnchor:P,angle:A})}else tJ(v.numGlyphs,g)}if(f){y.clear();let n=r.icon.placedSymbolArray;for(let r=0;r<n.length;r++){let o=n.get(r);if(o.hidden)tJ(o.numGlyphs,y);else{let n=_[r];if(n)for(let r=0;r<o.numGlyphs;r++)i.addDynamicAttributes(y,n.shiftedAnchor,n.angle);else tJ(o.numGlyphs,y)}}r.icon.dynamicLayoutVertexBuffer.updateData(y)}r.text.dynamicLayoutVertexBuffer.updateData(g)})(l,c,p,u,i.symbolSize,h,m,a.projMatrix,n,f,g,o?i=>o.getAtTileOffset(a,i.x,i.y):i=>0)}}}(s,r,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),a),0!==o.paint.get("icon-opacity").constantOr(1)&&it(r,n,o,s,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),l,u),0!==o.paint.get("text-opacity").constantOr(1)&&it(r,n,o,s,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),l,u),n.map.showCollisionBoxes&&(e9(r,n,o,s,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),e9(r,n,o,s,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(r,n,o,s){if("translucent"!==r.renderPass)return;let a=o.paint.get("circle-opacity"),l=o.paint.get("circle-stroke-width"),u=o.paint.get("circle-stroke-opacity"),h=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===u.constantOr(1)))return;let c=r.context,p=c.gl,f=r.depthModeForSublayer(0,i.DepthMode.ReadOnly),d=i.StencilMode.disabled,m=r.colorModeForRenderPass(),g=[];for(let a=0;a<s.length;a++){let l=s[a],u=n.getTile(l),c=u.getBucket(o);if(!c)continue;let p=c.programConfigurations.get(o.id),f=eZ(o),d={programConfiguration:p,program:r.useProgram("circle",p,f),layoutVertexBuffer:c.layoutVertexBuffer,indexBuffer:c.indexBuffer,uniformValues:ej(r,l,u,o),tile:u};if(h)for(let r of c.segments.get())g.push({segments:new i.SegmentVector([r]),sortKey:r.sortKey,state:d});else g.push({segments:c.segments,sortKey:0,state:d})}for(let n of(h&&g.sort((i,r)=>i.sortKey-r.sortKey),g)){let{programConfiguration:s,program:a,layoutVertexBuffer:l,indexBuffer:u,uniformValues:h,tile:g}=n.state,y=n.segments;r.terrain&&r.terrain.setupElevationDraw(g,a,{useDepthForOcclusion:!0}),r.prepareDrawProgram(c,a,g.tileID.toUnwrapped()),a.draw(c,p.TRIANGLES,f,d,m,i.CullFaceMode.disabled,h,o.id,l,u,y,o.paint,r.transform.zoom,s)}},heatmap:function(r,n,o,s){if(0!==o.paint.get("heatmap-opacity")){if("offscreen"===r.renderPass){let a=r.context,l=a.gl,u=i.StencilMode.disabled,h=new i.ColorMode([l.ONE,l.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(i,r,n){let o=i.gl;i.activeTexture.set(o.TEXTURE1),i.viewport.set([0,0,r.width/4,r.height/4]);let s=n.heatmapFbo;if(s)o.bindTexture(o.TEXTURE_2D,s.colorAttachment.get()),i.bindFramebuffer.set(s.framebuffer);else{let a=o.createTexture();o.bindTexture(o.TEXTURE_2D,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),s=n.heatmapFbo=i.createFramebuffer(r.width/4,r.height/4,!1),function(i,r,n,o){let s=i.gl;s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r.width/4,r.height/4,0,s.RGBA,i.extRenderToTextureHalfFloat?i.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),o.colorAttachment.set(n)}(i,r,a,s)}})(a,r,o),a.clear({color:i.Color.transparent});for(let c=0;c<s.length;c++){let p=s[c];if(n.hasRenderableParent(p))continue;let f=n.getTile(p),d=f.getBucket(o);if(!d)continue;let m=d.programConfigurations.get(o.id),g=r.useProgram("heatmap",m),{zoom:y}=r.transform;r.terrain&&r.terrain.setupElevationDraw(f,g),r.prepareDrawProgram(a,g,p.toUnwrapped()),g.draw(a,l.TRIANGLES,i.DepthMode.disabled,u,h,i.CullFaceMode.disabled,eW(p.projMatrix,f,y,o.paint.get("heatmap-intensity")),o.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,o.paint,r.transform.zoom,m)}a.viewport.set([0,0,r.width,r.height])}else"translucent"===r.renderPass&&(r.context.setColorMode(r.colorModeForRenderPass()),function(r,n){let o=r.context,s=o.gl,a=n.heatmapFbo;if(!a)return;o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,a.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1);let l=n.colorRampTexture;l||(l=n.colorRampTexture=new i.Texture(o,n.colorRamp,s.RGBA)),l.bind(s.LINEAR,s.CLAMP_TO_EDGE),r.useProgram("heatmapTexture").draw(o,s.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,r.colorModeForRenderPass(),i.CullFaceMode.disabled,((r,n,o,s)=>{let a=i.create$1();i.ortho(a,0,r.width,r.height,0,0,1);let l=r.context.gl;return{u_matrix:a,u_world:[l.drawingBufferWidth,l.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}})(r,n),n.id,r.viewportBuffer,r.quadTriangleIndexBuffer,r.viewportSegments,n.paint,r.transform.zoom)}(r,o))}},line:function(r,n,o,s){if("translucent"!==r.renderPass)return;let a=o.paint.get("line-opacity"),l=o.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;let u=r.depthModeForSublayer(0,i.DepthMode.ReadOnly),h=r.colorModeForRenderPass(),c=o.paint.get("line-dasharray"),p=c.constantOr(1),f=o.layout.get("line-cap"),d=o.paint.get("line-pattern"),m=d.constantOr(1),g=o.paint.get("line-gradient"),y=o.getCrossfadeParameters(),_=m?"linePattern":p?"lineSDF":g?"lineGradient":"line",v=r.context,x=v.gl;for(let a of s){let s=n.getTile(a);if(m&&!s.patternsLoaded())continue;let l=s.getBucket(o);if(!l)continue;r.prepareDrawTile(a);let b=l.programConfigurations.get(o.id),w=r.useProgram(_,b),E=d.constantOr(null);if(E&&s.imageAtlas){let i=s.imageAtlas,r=i.patternPositions[E.to.toString()],n=i.patternPositions[E.from.toString()];r&&n&&b.setConstantPatternPositions(r,n)}let I=c.constantOr(null),S=f.constantOr(null);if(!m&&I&&S&&s.lineAtlas){let i=s.lineAtlas,r=i.getDash(I.to,S),n=i.getDash(I.from,S);r&&n&&b.setConstantPatternPositions(r,n)}let M=r.terrain?a.projMatrix:null,T=m?eK(r,s,o,y,M):p?eJ(r,s,o,y,M):g?eY(r,s,o,M,l.lineClipsArray.length):eH(r,s,o,M);if(m)v.activeTexture.set(x.TEXTURE0),s.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),b.updatePaintBuffers(y);else if(p)v.activeTexture.set(x.TEXTURE0),s.lineAtlasTexture.bind(x.LINEAR,x.REPEAT),b.updatePaintBuffers(y);else if(g){let s=l.gradients[o.id],u=s.texture;if(o.gradientVersion!==s.version){let h=256;if(o.stepInterpolant){let o=n.getSource().maxzoom,s=a.canonical.z===o?Math.ceil(1<<r.transform.maxZoom-a.canonical.z):1;h=i.clamp(i.nextPowerOfTwo(l.maxLineLength/i.EXTENT*1024*s),256,v.maxTextureSize)}s.gradient=i.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:h,image:s.gradient||void 0,clips:l.lineClipsArray}),s.texture?s.texture.update(s.gradient):s.texture=new i.Texture(v,s.gradient,x.RGBA),s.version=o.gradientVersion,u=s.texture}v.activeTexture.set(x.TEXTURE0),u.bind(o.stepInterpolant?x.NEAREST:x.LINEAR,x.CLAMP_TO_EDGE)}r.prepareDrawProgram(v,w,a.toUnwrapped()),w.draw(v,x.TRIANGLES,u,r.stencilModeForClipping(a),h,i.CullFaceMode.disabled,T,o.id,l.layoutVertexBuffer,l.indexBuffer,l.segments,o.paint,r.transform.zoom,b,l.layoutVertexBuffer2)}},fill:function(r,n,o,s){let a=o.paint.get("fill-color"),l=o.paint.get("fill-opacity");if(0===l.constantOr(1))return;let u=r.colorModeForRenderPass(),h=o.paint.get("fill-pattern"),c=r.opaquePassEnabledForLayer()&&!h.constantOr(1)&&1===a.constantOr(i.Color.transparent).a&&1===l.constantOr(0)?"opaque":"translucent";if(r.renderPass===c){let a=r.depthModeForSublayer(1,"opaque"===r.renderPass?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);ii(r,n,o,s,a,u,!1)}if("translucent"===r.renderPass&&o.paint.get("fill-antialias")){let a=r.depthModeForSublayer(2*!!o.getPaintProperty("fill-outline-color"),i.DepthMode.ReadOnly);ii(r,n,o,s,a,u,!0)}},"fill-extrusion":function(r,n,o,s){let a=o.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===r.renderPass){let l=new i.DepthMode(r.context.gl.LEQUAL,i.DepthMode.ReadWrite,r.depthRangeFor3D);if(1!==a||o.paint.get("fill-extrusion-pattern").constantOr(1))ir(r,n,o,s,l,i.StencilMode.disabled,i.ColorMode.disabled),ir(r,n,o,s,l,r.stencilModeFor3D(),r.colorModeForRenderPass());else{let a=r.colorModeForRenderPass();ir(r,n,o,s,l,i.StencilMode.disabled,a)}}},hillshade:function(r,n,o,s){if("offscreen"!==r.renderPass&&"translucent"!==r.renderPass)return;let a=r.context,l=r.depthModeForSublayer(0,i.DepthMode.ReadOnly),u=r.colorModeForRenderPass(),h=r.terrain&&r.terrain.renderingToTexture,[c,p]="translucent"!==r.renderPass||h?[{},s]:r.stencilConfigForOverlap(s);for(let s of p){let a=n.getTile(s);if(a.needsHillshadePrepare&&"offscreen"===r.renderPass)!function(r,n,o,s,a,l){let u=r.context,h=u.gl;if(!n.dem)return;let c=n.dem;if(u.activeTexture.set(h.TEXTURE1),eI(r,n,c),!n.demTexture)return;n.demTexture.bind(h.NEAREST,h.CLAMP_TO_EDGE);let p=c.dim;u.activeTexture.set(h.TEXTURE0);let f=n.fbo;if(!f){let r=new i.Texture(u,{width:p,height:p,data:null},h.RGBA);r.bind(h.LINEAR,h.CLAMP_TO_EDGE),(f=n.fbo=u.createFramebuffer(p,p,!0)).colorAttachment.set(r.texture)}u.bindFramebuffer.set(f.framebuffer),u.viewport.set([0,0,p,p]),r.useProgram("hillshadePrepare").draw(u,h.TRIANGLES,s,a,l,i.CullFaceMode.disabled,((r,n)=>{let o=n.stride,s=i.create$1();return i.ortho(s,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(s,s,[0,-i.EXTENT,0]),{u_matrix:s,u_image:1,u_dimension:[o,o],u_zoom:r.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,c),o.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments),n.needsHillshadePrepare=!1}(r,a,o,l,i.StencilMode.disabled,u);else if("translucent"===r.renderPass){let n=h&&r.terrain?r.terrain.stencilModeForRTTOverlap(s):c[s.overscaledZ];!function(r,n,o,s,a,l,u){let h=r.context,c=h.gl,p=o.fbo;if(!p)return;r.prepareDrawTile(n);let f=r.useProgram("hillshade");h.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,p.colorAttachment.get());let d=((r,n,o,s)=>{let a=o.paint.get("hillshade-shadow-color"),l=o.paint.get("hillshade-highlight-color"),u=o.paint.get("hillshade-accent-color"),h=o.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===o.paint.get("hillshade-illumination-anchor")&&(h-=r.transform.angle);let c=!r.options.moving;return{u_matrix:s||r.transform.calculateProjMatrix(n.tileID.toUnwrapped(),c),u_image:0,u_latrange:function(r,n){let o=Math.pow(2,n.canonical.z),s=n.canonical.y;return[new i.MercatorCoordinate(0,s/o).toLngLat().lat,new i.MercatorCoordinate(0,(s+1)/o).toLngLat().lat]}(0,n.tileID),u_light:[o.paint.get("hillshade-exaggeration"),h],u_shadow:a,u_highlight:l,u_accent:u}})(r,o,s,r.terrain?n.projMatrix:null);r.prepareDrawProgram(h,f,n.toUnwrapped()),f.draw(h,c.TRIANGLES,a,l,u,i.CullFaceMode.disabled,d,s.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments)}(r,s,a,o,l,n,u)}}a.viewport.set([0,0,r.width,r.height])},raster:function(r,n,o,s,a,l){if("translucent"!==r.renderPass||0===o.paint.get("raster-opacity")||!s.length)return;let u=r.context,h=u.gl,c=n.getSource(),p=r.useProgram("raster"),f=r.colorModeForRenderPass(),d=r.terrain&&r.terrain.renderingToTexture,[m,g]=c instanceof tS||d?[{},s]:r.stencilConfigForOverlap(s),y=g[g.length-1].overscaledZ,_=!r.options.moving;for(let s of g){let a,g;let v=d?i.DepthMode.disabled:r.depthModeForSublayer(s.overscaledZ-y,1===o.paint.get("raster-opacity")?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,h.LESS),x=s.toUnwrapped(),b=n.getTile(s);if(d&&(!b||!b.hasData()))continue;let w=d?s.projMatrix:r.transform.calculateProjMatrix(x,_),E=r.terrain&&d?r.terrain.stencilModeForRTTOverlap(s):m[s.overscaledZ],I=l?0:o.paint.get("raster-fade-duration");b.registerFadeDuration(I);let S=n.findLoadedParent(s,0),M=eL(b,S,n,r.transform,I);r.terrain&&r.terrain.prepareDrawTile(s);let T="nearest"===o.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;u.activeTexture.set(h.TEXTURE0),b.texture.bind(T,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(h.TEXTURE1),S?(S.texture.bind(T,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST),a=Math.pow(2,S.tileID.overscaledZ-b.tileID.overscaledZ),g=[b.tileID.canonical.x*a%1,b.tileID.canonical.y*a%1]):b.texture.bind(T,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST);let C=e1(w,g||[0,0],a||1,M,o);r.prepareDrawProgram(u,p,x),c instanceof tS?p.draw(u,h.TRIANGLES,v,i.StencilMode.disabled,f,i.CullFaceMode.disabled,C,o.id,c.boundsBuffer,r.quadTriangleIndexBuffer,c.boundsSegments):p.draw(u,h.TRIANGLES,v,E,f,i.CullFaceMode.disabled,C,o.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments)}},background:function(r,n,o,s){let a=o.paint.get("background-color"),l=o.paint.get("background-opacity");if(0===l)return;let u=r.context,h=u.gl,c=r.transform,p=c.tileSize,f=o.paint.get("background-pattern");if(r.isPatternMissing(f))return;let d=!f&&1===a.a&&1===l&&r.opaquePassEnabledForLayer()?"opaque":"translucent";if(r.renderPass!==d)return;let m=i.StencilMode.disabled,g=r.depthModeForSublayer(0,"opaque"===d?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),y=r.colorModeForRenderPass(),_=r.useProgram(f?"backgroundPattern":"background"),v=s||c.coveringTiles({tileSize:p});f&&(u.activeTexture.set(h.TEXTURE0),r.imageManager.bind(r.context));let x=o.getCrossfadeParameters();for(let n of v){let c=n.toUnwrapped(),d=s?n.projMatrix:r.transform.calculateProjMatrix(c);r.prepareDrawTile(n);let v=f?e6(d,l,r,f,{tileID:n,tileSize:p},x):e4(d,l,a);r.prepareDrawProgram(u,_,c),_.draw(u,h.TRIANGLES,g,m,y,i.CullFaceMode.disabled,v,o.id,r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}},sky:function(r,n,o){let s=o.paint.get("sky-opacity");if(0===s)return;let a=r.context,l=o.paint.get("sky-type"),u=new i.DepthMode(a.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),h=r.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===r.renderPass?o.needsSkyboxCapture(r)&&(function(r,n,o,s){let a=r.context,l=a.gl,u=n.skyboxFbo;if(!u){u=n.skyboxFbo=a.createFramebuffer(32,32,!1),n.skyboxGeometry=new ig(a),n.skyboxTexture=a.gl.createTexture(),l.bindTexture(l.TEXTURE_CUBE_MAP,n.skyboxTexture),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR);for(let i=0;i<6;++i)l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,l.RGBA,32,32,0,l.RGBA,l.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(u.framebuffer),a.viewport.set([0,0,32,32]);let h=n.getCenter(r,!0),c=r.useProgram("skyboxCapture"),p=new Float64Array(16);i.identity(p),i.rotateY(p,p,-(.5*Math.PI)),iy(a,n,c,p,h,0),i.identity(p),i.rotateY(p,p,.5*Math.PI),iy(a,n,c,p,h,1),i.identity(p),i.rotateX(p,p,-(.5*Math.PI)),iy(a,n,c,p,h,2),i.identity(p),i.rotateX(p,p,.5*Math.PI),iy(a,n,c,p,h,3),i.identity(p),iy(a,n,c,p,h,4),i.identity(p),i.rotateY(p,p,Math.PI),iy(a,n,c,p,h,5),a.viewport.set([0,0,r.width,r.height])}(r,o),o.markSkyboxValid(r)):"sky"===r.renderPass&&function(r,n,o,s,a){let l=r.context,u=l.gl,h=r.transform,c=r.useProgram("skybox");l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_CUBE_MAP,n.skyboxTexture);let p={u_matrix:h.skyboxMatrix,u_sun_direction:n.getCenter(r,!1),u_cubemap:0,u_opacity:s,u_temporal_offset:a};r.prepareDrawProgram(l,c),c.draw(l,u.TRIANGLES,o,i.StencilMode.disabled,r.colorModeForRenderPass(),i.CullFaceMode.backCW,p,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(r,o,u,s,h):"gradient"===l&&"sky"===r.renderPass&&function(r,n,o,s,a){let l,u,h;let c=r.context,p=c.gl,f=r.transform,d=r.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new ig(c)),c.activeTexture.set(p.TEXTURE0);let m=n.colorRampTexture;m||(m=n.colorRampTexture=new i.Texture(c,n.colorRamp,p.RGBA)),m.bind(p.LINEAR,p.CLAMP_TO_EDGE);let g=(l=f.skyboxMatrix,u=n.getCenter(r,!1),h=n.paint.get("sky-gradient-radius"),{u_matrix:l,u_color_ramp:0,u_center_direction:u,u_radius:i.degToRad(h),u_opacity:s,u_temporal_offset:a});r.prepareDrawProgram(c,d),d.draw(c,p.TRIANGLES,o,i.StencilMode.disabled,r.colorModeForRenderPass(),i.CullFaceMode.backCW,g,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(r,o,u,s,h)},debug:function(r,n,o){for(let s=0;s<o.length;s++)!function(r,n,o){let s=r.context,a=s.gl,l=o.projMatrix,u=r.useProgram("debug"),h=n.getTileByID(o.key);r.terrain&&r.terrain.setupElevationDraw(h,u);let c=i.DepthMode.disabled,p=i.StencilMode.disabled,f=r.colorModeForRenderPass(),d="$debug";s.activeTexture.set(a.TEXTURE0),r.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),u.draw(s,a.LINE_STRIP,c,p,f,i.CullFaceMode.disabled,e$(l,i.Color.red),d,r.debugBuffer,r.tileBorderIndexBuffer,r.debugSegments);let m=h.latestRawTileData,g=Math.floor((m&&m.byteLength||0)/1024),y=512/Math.min(n.getTile(o).tileSize,512)*(o.overscaledZ/r.transform.zoom)*.5,_=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(_+=` => ${o.overscaledZ}`),function(i,r){i.initDebugOverlayCanvas();let n=i.debugOverlayCanvas,o=i.context.gl,s=i.debugOverlayCanvas.getContext("2d");s.clearRect(0,0,n.width,n.height),s.shadowColor="white",s.shadowBlur=2,s.lineWidth=1.5,s.strokeStyle="white",s.textBaseline="top",s.font="bold 36px Open Sans, sans-serif",s.fillText(r,5,5),s.strokeText(r,5,5),i.debugOverlayTexture.update(n),i.debugOverlayTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}(r,`${_} ${g}kb`),u.draw(s,a.TRIANGLES,c,p,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,e$(l,i.Color.transparent,y),d,r.debugBuffer,r.quadTriangleIndexBuffer,r.debugSegments)}(r,n,o[s])},custom:function(r,n,o){let s=r.context,a=o.implementation;if("offscreen"===r.renderPass){let i=a.prerender;i&&(r.setCustomLayerDefaults(),s.setColorMode(r.colorModeForRenderPass()),i.call(a,s.gl,r.transform.customLayerMatrix()),s.setDirty(),r.setBaseState())}else if("translucent"===r.renderPass){r.setCustomLayerDefaults(),s.setColorMode(r.colorModeForRenderPass()),s.setStencilMode(i.StencilMode.disabled);let n="3d"===a.renderingMode?new i.DepthMode(r.context.gl.LEQUAL,i.DepthMode.ReadWrite,r.depthRangeFor3D):r.depthModeForSublayer(0,i.DepthMode.ReadOnly);s.setDepthMode(n),a.render(s.gl,r.transform.customLayerMatrix()),s.setDirty(),r.setBaseState(),s.bindFramebuffer.set(null)}}};class iv{constructor(r,n){this.context=new tw(r),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new eu,this.gpuTimers={},this.frameCounter=0}updateTerrain(i,r){let n=!!i&&!!i.terrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new eD(this,i));let o=this._terrain;this.transform.elevation=n?o:null,o.update(i,this.transform,r)}_updateFog(i){let r=i.fog;if(!r||1>r.getOpacity(this.transform.pitch)||.03>r.properties.get("horizon-blend"))return void(this.transform.fogCullDistSq=null);let[n,o]=r.getFovAdjustedRange(this.transform._fov);if(n>o)return void(this.transform.fogCullDistSq=null);let s=n+.78*(o-n);this.transform.fogCullDistSq=s*s}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,n){if(this.width=r*i.exported.devicePixelRatio,this.height=n*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let i of this.style.order)this.style._layers[i].resize()}setup(){let r=this.context,n=new i.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(i.EXTENT,0),n.emplaceBack(0,i.EXTENT),n.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(n,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);let o=new i.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(i.EXTENT,0),o.emplaceBack(0,i.EXTENT),o.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=r.createVertexBuffer(o,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);let s=new i.StructArrayLayout4i8;s.emplaceBack(0,0,0,0),s.emplaceBack(i.EXTENT,0,i.EXTENT,0),s.emplaceBack(0,i.EXTENT,0,i.EXTENT),s.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(s,tI.members),this.rasterBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);let a=new i.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(a,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);let l=new i.StructArrayLayout1ui2;l.emplaceBack(0),l.emplaceBack(1),l.emplaceBack(3),l.emplaceBack(2),l.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(l);let u=new i.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(u),this.emptyTexture=new i.Texture(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA),this.identityMat=i.create$1();let h=this.context.gl;this.stencilClearMode=new i.StencilMode({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO),this.loadTimeStamps.push(i.window.performance.now())}clearStencil(){let r=this.context,n=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let o=i.create$1();i.ortho(o,0,this.width,this.height,0,0,1),i.scale$1(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,n.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,eA(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,n,o){if(!(n&&this.currentStencilSource!==n.id&&r.isTileClipped()&&o&&o.length))return;this.currentStencilSource=n.id;let s=this.context,a=s.gl;this.nextStencilID+o.length>256&&this.clearStencil(),s.setColorMode(i.ColorMode.disabled),s.setDepthMode(i.DepthMode.disabled);let l=this.useProgram("clippingMask");for(let r of(this._tileClippingMaskIDs={},o)){let n=this._tileClippingMaskIDs[r.key]=this.nextStencilID++;l.draw(s,a.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:a.ALWAYS,mask:0},n,255,a.KEEP,a.KEEP,a.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,eA(r.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,n=this.context.gl;return new i.StencilMode({func:n.NOTEQUAL,mask:255},r,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let n=this.context.gl;return new i.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(r){let n=this.context.gl,o=r.sort((i,r)=>r.overscaledZ-i.overscaledZ),s=o[o.length-1].overscaledZ,a=o[0].overscaledZ-s+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();let r={};for(let o=0;o<a;o++)r[o+s]=new i.StencilMode({func:n.GEQUAL,mask:255},o+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=a,[r,o]}return[{[s]:i.StencilMode.disabled},o]}colorModeForRenderPass(){let r=this.context.gl;if(this._showOverdrawInspector){let n=1/8;return new i.ColorMode([r.CONSTANT_COLOR,r.ONE],new i.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(r,n,o){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;let s=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new i.DepthMode(o||this.context.gl.LEQUAL,n,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,n){this.style=r,this.options=n,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();let o=this.style.order,s=this.style._sourceCaches;for(let i in s){let r=s[i];r.used&&r.prepare(this.context)}let a={},l={},u={};for(let i in s){let r=s[i];a[i]=r.getVisibleCoordinates(),l[i]=a[i].slice().reverse(),u[i]=r.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let i=0;i<o.length;i++)if(this.style._layers[o[i]].is3D()){this.opaquePassCutoff=i;break}if(this.terrain&&(this.terrain.updateTileBinding(u),this.opaquePassCutoff=0),!i.isMapAuthenticated(this.context.gl))return;for(let i of(this.renderPass="offscreen",o)){let n=this.style._layers[i],o=r._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;let s=o?l[o.id]:void 0;("custom"===n.type||n.isSky()||s&&s.length)&&this.renderLayer(this,o,n,s)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let h=i.Color.transparent;if(this.style.fog&&(h=this.style.fog.properties.get("color")),this.context.clear({color:n.showOverdrawInspector?i.Color.black:h,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){let i=this.style._layers[o[this.currentLayer]],n=r._getLayerSourceCache(i);if(i.isSky())continue;let s=n?l[n.id]:void 0;this._renderTileClippingMasks(i,n,s),this.renderLayer(this,n,i,s)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){let i=this.style._layers[o[this.currentLayer]],n=r._getLayerSourceCache(i);i.isSky()&&this.renderLayer(this,n,i,n?l[n.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;){let i=this.style._layers[o[this.currentLayer]],n=r._getLayerSourceCache(i);if(i.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(i)){if(i.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let s=n?("symbol"===i.type?u:l)[n.id]:void 0;this._renderTileClippingMasks(i,n,n?a[n.id]:void 0),this.renderLayer(this,n,i,s),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;i.values(this.style._layers).forEach(i=>{let o=r._getLayerSourceCache(i);o&&!i.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<o.getSource().maxzoom)&&(n=o)}),n&&this.options.showTileBoundaries&&i_.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(i){var r,n;let o=i.transform.padding;ih(i,i.transform.height-(o.top||0),3,io),ih(i,o.bottom||0,3,is),ic(i,o.left||0,3,ia),ic(i,i.transform.width-(o.right||0),3,il);let s=i.transform.centerPoint;r=s.x,n=i.transform.height-s.y,ip(i,r-1,n-10,2,20,iu),ip(i,r-10,n-1,20,2,iu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%i.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,r,n,o){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||o&&o.length)&&(this.id=n.id,this.gpuTimingStart(n),i_[n.type](i,r,n,o,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;let r=this.context.extTimerQuery,n=this.gpuTimers[i.id];n||(n=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:r.createQueryEXT()}),n.calls++,r.beginQueryEXT(r.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){let i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){let r={};for(let n in i){let o=i[n],s=this.context.extTimerQuery,a=s.getQueryObjectEXT(o.query,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(o.query),r[n]=a}return r}translatePosMatrix(r,n,o,s,a){if(!o[0]&&!o[1])return r;let l=a?"map"===s?this.transform.angle:0:"viewport"===s?-this.transform.angle:0;if(l){let i=Math.sin(l),r=Math.cos(l);o=[o[0]*r-o[1]*i,o[0]*i+o[1]*r]}let u=[a?o[0]:k(n,o[0],this.transform.zoom),a?o[1]:k(n,o[1],this.transform.zoom),0],h=new Float32Array(16);return i.translate(h,r,u),h}saveTileTexture(i){let r=this._tileTextures[i.size[0]];r?r.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){let r=this._tileTextures[i];return r&&r.length>0?r.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;let r=this.imageManager.getPattern(i.from.toString()),n=this.imageManager.getPattern(i.to.toString());return!r||!n}currentGlobalDefines(){let i=this.terrain&&this.terrain.renderingToTexture,r=this.style&&this.style.fog,n=[];return this.terrain&&!this.terrain.renderingToTexture&&n.push("TERRAIN"),r&&!i&&0!==r.getOpacity(this.transform.pitch)&&n.push("FOG"),i&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(i,r,n){this.cache=this.cache||{};let o=this.currentGlobalDefines().concat(n||[]),s=eO.cacheKey(i,o,r);return this.cache[s]||(this.cache[s]=new eO(this.context,i,eb[i],r,e8[i],o)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,r,n){if(this.terrain&&this.terrain.renderingToTexture)return;let o=this.style.fog;if(o){let s=o.getOpacity(this.transform.pitch);0!==s&&r.setFogUniformValues(i,((i,r,n,o)=>{let s=r.properties.get("color"),a=i.frameCounter/1e3%1,l=[s.r/s.a,s.g/s.a,s.b/s.a,o];return{u_fog_matrix:n?i.transform.calculateFogTileMatrix(n):i.identityMat,u_fog_range:r.getFovAdjustedRange(i.transform._fov),u_fog_color:l,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_temporal_offset:a}})(this,o,n,s))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){let i=this.context.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}}class ix{constructor(i=0,r=0,n=0,o=0){if(isNaN(i)||i<0||isNaN(r)||r<0||isNaN(n)||n<0||isNaN(o)||o<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=r,this.left=n,this.right=o}interpolate(r,n,o){return null!=n.top&&null!=r.top&&(this.top=i.number(r.top,n.top,o)),null!=n.bottom&&null!=r.bottom&&(this.bottom=i.number(r.bottom,n.bottom,o)),null!=n.left&&null!=r.left&&(this.left=i.number(r.left,n.left,o)),null!=n.right&&null!=r.right&&(this.right=i.number(r.right,n.right,o)),this}getCenter(r,n){let o=i.clamp((this.left+r-this.right)/2,0,r),s=i.clamp((this.top+n-this.bottom)/2,0,n);return new i.pointGeometry(o,s)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ix(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ib(i,r){return[i[4*r],i[4*r+1],i[4*r+2],i[4*r+3]]}function iw(i,r,n){i[4*r+0]=n[0],i[4*r+1]=n[1],i[4*r+2]=n[2],i[4*r+3]=n[3]}function iE(r,n){let o=ib(r,3);i.fromQuat(r,n),iw(r,3,o)}function iI(i,r){iw(i,3,[r[0],r[1],r[2],1])}function iS(r,n){let o=i.identity$1([]);return i.rotateZ$1(o,o,-n),i.rotateX$1(o,o,-r),o}function iM(r,n){let o=[r[0],r[1],0],s=[n[0],n[1],0];if(i.length(o)>=1e-15){let r=i.normalize([],o);i.scale(s,r,i.dot(s,r)),n[0]=s[0],n[1]=s[1]}let a=i.cross([],n,r);if(1e-15>i.len(a))return null;let l=Math.atan2(-a[1],a[0]);return iS(Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2]),l)}class iT{constructor(i,r){this.position=i,this.orientation=r}get position(){return this._position}set position(r){this._position=this._renderWorldCopies?function(r){if(!r)return;let n=Array.isArray(r)?new i.MercatorCoordinate(r[0],r[1],r[2]):r;return n.x=i.wrap(n.x,0,1),n}(r):r}lookAtPoint(r,n){if(this.orientation=null,!this.position)return;let o=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(r)):0,s=this.position,a=i.MercatorCoordinate.fromLngLat(r,o),l=[a.x-s.x,a.y-s.y,a.z-s.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=iM(l,n)}setPitchBearing(r,n){this.orientation=iS(i.degToRad(r),i.degToRad(-n))}}class iC{constructor(r,n){this._transform=i.identity([]),this._orientation=i.identity$1([]),n&&(this._orientation=n,iE(this._transform,this._orientation)),r&&iI(this._transform,r)}get mercatorPosition(){let r=this.position;return new i.MercatorCoordinate(r[0],r[1],r[2])}get position(){let i=ib(this._transform,3);return[i[0],i[1],i[2]]}set position(i){iI(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,iE(this._transform,this._orientation)}getPitchBearing(){let i=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,r){this._orientation=iS(i,r),iE(this._transform,this._orientation)}forward(){let i=ib(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){let i=ib(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){let i=ib(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(r,n){let o=new Float64Array(16);return i.invert(o,this.getWorldToCamera(r,n)),o}getWorldToCameraPosition(r,n,o){let s=this.position;i.scale(s,s,-r);let a=new Float64Array(16);return i.fromScaling(a,[o,o,o]),i.translate(a,a,s),a[10]*=n,a}getWorldToCamera(r,n){let o=new Float64Array(16),s=new Float64Array(4),a=this.position;return i.conjugate(s,this._orientation),i.scale(a,a,-r),i.fromQuat(o,s),i.translate(o,o,a),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=n,o[9]*=n,o[10]*=n,o[11]*=n,o}getCameraToClipPerspective(r,n,o,s){let a=new Float64Array(16);return i.perspective(a,r,n,o,s),a}getDistanceToElevation(r){let n=0===r?0:i.mercatorZfromAltitude(r,this.position[1]),o=this.forward();return(n-this.position[2])/o[2]}clone(){return new iC([...this.position],[...this.orientation])}}class iP{constructor(r,n,o,s,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=r||0,this._maxZoom=n||22,this._minPitch=null==o?0:o,this._maxPitch=null==s?60:s,this.setMaxBounds(),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ix,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new iC,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){let i=new iP(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return i.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){var n,o,s,a,l,u,h,c,p,f;let d=-i.wrap(r,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(n=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),o=this.rotationMatrix,s=this.rotationMatrix,a=this.angle,l=s[0],u=s[1],h=s[2],c=s[3],p=Math.sin(a),f=Math.cos(a),o[0]=l*f+h*p,o[1]=u*f+c*p,o[2]=-(l*p)+h*f,o[3]=-(u*p)+c*f)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let n=i.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){let r=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;let r=this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(this.center),-1);return -1===r?(this._cameraZoom=null,!1):(this._centerAltitude=r,!0)}_updateCameraOnTerrain(){let r=this.cameraToCenterDistance/this.worldSize,n=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+r)}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop(),s=0,a=0;for(let l=0;l<n.length;l++){let u=new i.pointGeometry(n[l][0]*this.width,o+n[l][1]*(this.height-o)),h=r.pointCoordinate(u);if(!h)continue;let c=1/Math.hypot(h[0]-this._camera.position[0],h[1]-this._camera.position[1]);s+=h[3]*c,a+=c}return 0===a?NaN:s/a}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;let r=this._cameraZoom,n=this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(this.center)),o=i.mercatorZfromAltitude(n,this.center.lat),s=Math.max(this._mercatorZfromZoom(r)-o,this._mercatorZfromZoom(this._maxZoom));this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(r){let n;let o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));n=r.z<this._camera.position[2]?[o.x,o.y,o.z]:[r.x,r.y,r.z];let s=i.length(i.sub([],this._camera.position,n));return i.clamp(this._zoomFromMercatorZ(s),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let n=!1;if(r.orientation&&!i.exactEquals(r.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(r.orientation)),r.position){let o=[r.position.x,r.position.y,r.position.z];i.exactEquals$1(o,this._camera.position)||(this._setCameraPosition(o),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,n=new iT;return n.position=new i.MercatorCoordinate(r[0],r[1],r[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}_setCameraOrientation(r){if(!i.length$1(r))return!1;i.normalize$1(r,r);let n=i.transformQuat([],[0,0,-1],r),o=i.transformQuat([],[0,-1,0],r);if(o[2]<0)return!1;let s=iM(n,o);return!!s&&(this._camera.orientation=s,!0)}_setCameraPosition(r){let n=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,s=this.cameraToCenterDistance;r[2]=i.clamp(r[2],s/o,s/n),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,r,n){this._unmodified=!1,this._edgeInsets.interpolate(i,r,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){return Math.max(0,(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize)))}getVisibleUnwrappedCoordinates(r){let n=[new i.UnwrappedTileID(0,r)];if(this._renderWorldCopies){let o=this.pointCoordinate(new i.pointGeometry(0,0)),s=this.pointCoordinate(new i.pointGeometry(this.width,0)),a=this.pointCoordinate(new i.pointGeometry(this.width,this.height)),l=this.pointCoordinate(new i.pointGeometry(0,this.height)),u=Math.floor(Math.min(o.x,s.x,a.x,l.x)),h=Math.floor(Math.max(o.x,s.x,a.x,l.x));for(let o=u-1;o<=h+1;o++)0!==o&&n.push(new i.UnwrappedTileID(o,r))}return n}coveringTiles(r){let n=this.coveringZoomLevel(r),o=n,s=this.elevation&&!r.isTerrainDEM;if(void 0!==r.minzoom&&n<r.minzoom)return[];void 0!==r.maxzoom&&n>r.maxzoom&&(n=r.maxzoom);let a=i.MercatorCoordinate.fromLngLat(this.center),l=1<<n,u=[l*a.x,l*a.y,0],h=y.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=this.pointCoordinate(this.getCameraPoint()),p=l*i.mercatorZfromAltitude(1,this.center.lat),f=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),d=[l*c.x,l*c.y,f],m=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),g=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?n:0,v=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=r.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=i=>({aabb:new _([i*l,0,x],[(i+1)*l,l,v]),zoom:0,x:0,y:0,wrap:i,fullyVisible:!1}),w=[],E=[],I=n,S=r.reparseOverscaled?o:n,M=i=>{if(!this._elevation||!i.tileID)return;let r=this._elevation.getMinMaxForTile(i.tileID),n=i.aabb;r?(n.min[2]=r.min,n.max[2]=r.max,n.center[2]=(n.min[2]+n.max[2])/2):(i.shouldSplit=P(i),i.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},T=i=>i*i,C=T((f-this._centerAltitude)*p),P=i=>{if(i.zoom<g)return!0;if(i.zoom===I)return!1;if(null!=i.shouldSplit)return i.shouldSplit;let r=i.aabb.distanceX(d),n=i.aabb.distanceY(d),o=C;s&&(o=T(i.aabb.distanceZ(d)*p));let a=r*r+n*n+o;return a<T((1<<I-i.zoom)*m*((i,r)=>{if(r*T(.707)<i)return 1;let n=Math.sqrt(r/i);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,C),a))};if(this._renderWorldCopies)for(let i=1;i<=3;i++)w.push(b(-i)),w.push(b(i));for(w.push(b(0));w.length>0;){let o=w.pop(),a=o.x,l=o.y,c=o.fullyVisible;if(!c){let i=o.aabb.intersects(h);if(0===i)continue;c=2===i}if(o.zoom!==I&&P(o))for(let r=0;r<4;r++){let n=(a<<1)+r%2,u=(l<<1)+(r>>1),h={aabb:o.aabb.quadrant(r),zoom:o.zoom+1,x:n,y:u,wrap:o.wrap,fullyVisible:c,tileID:void 0,shouldSplit:void 0};s&&(h.tileID=new i.OverscaledTileID(o.zoom+1===I?S:o.zoom+1,o.wrap,o.zoom+1,n,u),M(h)),w.push(h)}else{let s=o.zoom===I?S:o.zoom;if(r.minzoom&&r.minzoom>s)continue;let h=u[0]-(.5+a+(o.wrap<<o.zoom))*(1<<n-o.zoom),c=u[1]-.5-l,p=o.tileID?o.tileID:new i.OverscaledTileID(s,o.wrap,o.zoom,a,l);E.push({tileID:p,distanceSq:h*h+c*c})}}if(this.fogCullDistSq){let r=this.fogCullDistSq;E.splice(0,E.length,...E.filter(n=>{let o=[0,0,0,1],a=[i.EXTENT,i.EXTENT,0,1],l=this.calculateFogTileMatrix(n.tileID.toUnwrapped());i.transformMat4(o,o,l),i.transformMat4(a,a,l);let u=i.getAABBPointSquareDist(o,a);if(0===u)return!0;let h=!1,c=this.horizonLineFromTop();if(u>r&&0!==c){let r;let o=this.calculateProjMatrix(n.tileID.toUnwrapped());s&&this._elevation&&(r=this._elevation.getMinMaxForTile(n.tileID)),r||(r={min:x,max:v});let a=i.furthestTileCorner(this.bearing),l=[a[0]*i.EXTENT,a[1]*i.EXTENT,r.max];i.transformMat4$1(l,l,o),h=(1-l[1])*this.height*.5<c}return u<r||h}))}return E.sort((i,r)=>i.distanceSq-r.distanceSq).map(i=>i.tileID)}resize(i,r){this.width=i,this.height=r,this.pixelsToGLUnits=[2/i,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(r){let n=i.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new i.pointGeometry(i.mercatorXfromLng(r.lng)*this.worldSize,i.mercatorYfromLat(n)*this.worldSize)}unproject(r){return new i.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(r,n){let o=this.pointCoordinate(n),s=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(r),l=new i.MercatorCoordinate(a.x-(o.x-s.x),a.y-(o.y-s.y));this.center=this.coordinateLocation(l),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(i){this.center=this.coordinateLocation(i),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i){return this._coordinatePoint(this.locationCoordinate(i),!1)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(r){return i.MercatorCoordinate.fromLngLat(r)}coordinateLocation(i){return i.toLngLat()}pointRayIntersection(r,n){let o=null!=n?n:this._centerAltitude,s=[r.x,r.y,0,1],a=[r.x,r.y,1,1];i.transformMat4(s,s,this.pixelMatrixInverse),i.transformMat4(a,a,this.pixelMatrixInverse);let l=a[3];i.scale$2(s,s,1/s[3]),i.scale$2(a,a,1/l);let u=s[2],h=a[2];return{p0:s,p1:a,t:u===h?0:(o-u)/(h-u)}}screenPointToMercatorRay(r){let n=[r.x,r.y,0,1],o=[r.x,r.y,1,1];return i.transformMat4(n,n,this.pixelMatrixInverse),i.transformMat4(o,o,this.pixelMatrixInverse),i.scale$2(n,n,1/n[3]),i.scale$2(o,o,1/o[3]),n[2]=i.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,o[2]=i.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,i.scale$2(n,n,1/this.worldSize),i.scale$2(o,o,1/this.worldSize),new g([n[0],n[1],n[2]],i.normalize([],i.sub([],o,n)))}rayIntersectionCoordinate(r){let{p0:n,p1:o,t:s}=r,a=i.mercatorZfromAltitude(n[2],this._center.lat),l=i.mercatorZfromAltitude(o[2],this._center.lat);return new i.MercatorCoordinate(i.number(n[0],o[0],s)/this.worldSize,i.number(n[1],o[1],s)/this.worldSize,i.number(a,l,s))}pointCoordinate(r){let n=this.horizonLineFromTop(!1),o=new i.pointGeometry(r.x,Math.max(n,r.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(o))}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let n=this.elevation,o=this.elevation.pointCoordinate(r);if(o)return new i.MercatorCoordinate(o[0],o[1],o[2]);let s=0,a=this.horizonLineFromTop();if(r.y>a)return this.pointCoordinate(r);let l=.02*a,u=r.clone();for(let r=0;r<10&&a-s>l;r++){u.y=i.number(s,a,.66);let r=n.pointCoordinate(u);r?(a=u.y,o=r):s=u.y}return o?new i.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(r)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{let r=this.horizonLineFromTop();return i.y<r}}_coordinatePoint(r,n){let o=n&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,s=[r.x*this.worldSize,r.y*this.worldSize,o+r.toAltitude(),1];return i.transformMat4(s,s,this.pixelMatrix),s[3]>0?new i.pointGeometry(s[0]/s[3],s[1]/s[3]):new i.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new i.LngLatBounds).extend(this.pointLocation(new i.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new i.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new i.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new i.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){let r=this.elevation,n=r.visibleDemTiles.reduce((i,r)=>{if(r.dem){let n=r.dem.tree;i.min=Math.min(i.min,n.minimums[0]),i.max=Math.max(i.max,n.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});n.min*=r.exaggeration(),n.max*=r.exaggeration();let o=this.horizonLineFromTop();return[new i.pointGeometry(0,o),new i.pointGeometry(this.width,o),new i.pointGeometry(this.width,this.height),new i.pointGeometry(0,this.height)].reduce((i,r)=>i.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(r,n.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(r,n.max)))),new i.LngLatBounds)}horizonLineFromTop(i=!0){let r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-.97*r;return i?Math.max(0,n):n}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new i.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,n){let o=r.canonical,s=n/this.zoomScale(o.z),a=o.x+Math.pow(2,o.z)*r.wrap,l=i.identity(new Float64Array(16));return i.translate(l,l,[a*s,o.y*s,0]),i.scale$1(l,l,[s/i.EXTENT,s/i.EXTENT,1]),l}calculateFogTileMatrix(r){let n=r.key,o=this._fogTileMatrixCache;if(o[n])return o[n];let s=this.calculatePosMatrix(r,this.cameraWorldSize);return i.multiply(s,this.worldToFogMatrix,s),o[n]=new Float32Array(s),o[n]}calculateProjMatrix(r,n=!1){let o=r.key,s=n?this._alignedProjMatrixCache:this._projMatrixCache;if(s[o])return s[o];let a=this.calculatePosMatrix(r,this.worldSize);return i.multiply(a,n?this.alignedProjMatrix:this.projMatrix,a),s[o]=new Float32Array(a),s[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;let r=this._elevation;this._updateCameraState();let n=this._camera.position,o=this._camera.forward();if(n[2]<=0||o[2]>=0)return;let s=i.mercatorZfromAltitude(1,this._center.lat);n[2]/=s,o[2]/=s,i.normalize(o,o);let a=r.raycast(n,o,r.exaggeration());if(a){let r=i.scaleAndAdd([],n,o,a),s=new i.MercatorCoordinate(r[0],r[1],i.mercatorZfromAltitude(r[2],i.latFromMercatorY(r[1]))),l=this._camera.position,u=s.z+i.length([s.x-l[0],s.y-l[1],s.z-l[2]]);this._cameraZoom=this._zoomFromMercatorZ(u),this._centerAltitude=s.toAltitude(),this._center=s.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;let r=this._elevation;this._updateCameraState();let n=r.getAtPointOrZero(this._camera.mercatorPosition),o=this._minimumHeightOverTerrain()*Math.cos(i.degToRad(this._maxPitch)),s=i.mercatorZfromAltitude(n,this._center.lat),a=this._camera.position[2]-s;if(a<o){let r=i.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),n=this._camera.mercatorPosition,s=[r.x-n.x,r.y-n.y,r.z-n.z],l=i.length(s);s[2]-=o-a;let u=i.length(s);if(0===u)return;i.scale(s,s,l/u),this._camera.position=[r.x-s[0],r.y-s[1],r.z-s[2]],this._camera.orientation=iM(s,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,n,o,s,a=-90,l=90,u=-180,h=180,c=this.size,p=this._unmodified;if(this.latRange){let n=this.latRange;a=i.mercatorYfromLat(n[1])*this.worldSize,r=(l=i.mercatorYfromLat(n[0])*this.worldSize)-a<c.y?c.y/(l-a):0}if(this.lngRange){let r=this.lngRange;u=i.mercatorXfromLng(r[0])*this.worldSize,n=(h=i.mercatorXfromLng(r[1])*this.worldSize)-u<c.x?c.x/(h-u):0}let f=this.point,d=Math.max(n||0,r||0);if(d)return this.center=this.unproject(new i.pointGeometry(n?(h+u)/2:f.x,r?(l+a)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=p,void(this._constraining=!1);if(this.latRange){let i=f.y,r=c.y/2;i-r<a&&(s=a+r),i+r>l&&(s=l-r)}if(this.lngRange){let i=f.x,r=c.x/2;i-r<u&&(o=u+r),i+r>h&&(o=h-r)}void 0===o&&void 0===s||(this.center=this.unproject(new i.pointGeometry(void 0!==o?o:f.x,void 0!==s?s:f.y))),this._constrainCameraAltitude(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let r=(i,r)=>Math.log2(i/(this.tileSize*Math.abs(r[1]-r[0]))),n=0;if(this.latRange){let o=this.latRange;n=r(this.height,[i.mercatorYfromLat(o[0]),i.mercatorYfromLat(o[1])])}let o=0;if(this.lngRange){let n=this.lngRange;o=r(this.width,[i.mercatorXfromLng(n[0]),i.mercatorXfromLng(n[1])])}return Math.max(n,o)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;let n=this.pixelsPerMeter;this._updateCameraState();let o=Math.PI/2+this._pitch,s=this.fovAboveCenter,a=this.elevation?this.elevation.getMinElevationBelowMSL()*n:0,l=(this._camera.position[2]*this.worldSize-a)/Math.cos(this._pitch),u=Math.sin(s)*l/Math.sin(i.clamp(Math.PI-o-s,.01,Math.PI-.01)),h=this.point,c=h.x,p=h.y,f=Math.min(1.01*(Math.cos(Math.PI/2-this._pitch)*u+l),l*(1/this._horizonShift)),d=this.height/50,m=this._camera.getWorldToCamera(this.worldSize,n),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,d,f);g[8]=-(2*r.x)/this.width,g[9]=2*r.y/this.height;let y=i.mul$1([],g,m);this.mercatorMatrix=i.scale$1([],y,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=y,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);let _=new Float32Array(16);i.identity(_),i.scale$1(_,_,[1,-1,1]),i.rotateX(_,_,this._pitch),i.rotateZ(_,_,this.angle);let v=i.perspective(new Float32Array(16),this._fov,this.width/this.height,d,f),x=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;v[8]=-(2*r.x)/this.width,v[9]=2*(r.y+x)/this.height,this.skyboxMatrix=i.multiply(_,v,_);let b=this.width%2/2,w=this.height%2/2,E=Math.cos(this.angle),I=Math.sin(this.angle),S=c-Math.round(c)+E*b+I*w,M=p-Math.round(p)+E*w+I*b,T=new Float64Array(y);if(i.translate(T,T,[S>.5?S-1:S,M>.5?M-1:M,0]),this.alignedProjMatrix=T,y=i.create$1(),i.scale$1(y,y,[this.width/2,-this.height/2,1]),i.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=i.create$1(),i.scale$1(y,y,[1,-1,1]),i.translate(y,y,[-1,-1,0]),i.scale$1(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),!(y=i.invert(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");this.pixelMatrixInverse=y,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSize,n=this.cameraPixelsPerMeter,o=this._camera.position,s=1/this.height,a=[r,r,n];i.scale(a,a,s),i.scale(o,o,-1),i.multiply$1(o,o,a);let l=i.create$1();i.translate(l,l,o),i.scale$1(l,l,a),this.mercatorFogMatrix=l,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,n,s)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);let r=this._camera.forward(),n=this.cameraToCenterDistance,o=this.point,s=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-i.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this.cameraToCenterDistance/s;this._camera.position=[o.x/this.worldSize-r[0]*n/a,o.y/this.worldSize-r[1]*n/a,i.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-r[2]*n/a]}_translateCameraConstrained(r){let n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=r[2],s=1;o>0&&(s=Math.min((n-this._camera.position[2])/o,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,r,s),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,n=this._camera.forward(),{pitch:o,bearing:s}=this._camera.getPitchBearing(),a=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat),l=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),u=Math.max((r[2]-a)/Math.cos(o),l),h=this._zoomFromMercatorZ(u);i.scaleAndAdd(r,r,n,u),this._pitch=i.clamp(o,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(s,-Math.PI,Math.PI),this._setZoom(i.clamp(h,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new i.MercatorCoordinate(r[0],r[1],r[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){let i=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(r,n){let o=Math.min(r.x,n.x),s=Math.max(r.x,n.x),a=Math.min(r.y,n.y),l=Math.max(r.y,n.y),u=[new i.pointGeometry(o,a),new i.pointGeometry(s,l),new i.pointGeometry(o,l),new i.pointGeometry(s,a)],h=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(let i of u){let r=this.pointRayIntersection(i);if(r.t<0)return!0;let n=this.rayIntersectionCoordinate(r);if(n.x<h||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new i.pointGeometry(0,0),new i.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,n){let o=i.length(i.sub([],this._camera.position,r)),s=this._zoomFromMercatorZ(o)+n;return o-this._mercatorZfromZoom(s)}getCameraPoint(){let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.pointGeometry(0,r))}}class iA{constructor(r){this._hashName=r&&encodeURIComponent(r),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(i,r){let n=!1,o=null,s=()=>{o=null,n&&(i(),o=setTimeout(s,300),n=!1)};return()=>(n=!0,o||s(),o)}(this._updateHashUnthrottled.bind(this))}addTo(r){return this._map=r,i.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return i.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){let n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,s=Math.pow(10,Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10)),a=Math.round(n.lng*s)/s,l=Math.round(n.lat*s)/s,u=this._map.getBearing(),h=this._map.getPitch(),c="";if(c+=r?`/${a}/${l}/${o}`:`${o}/${l}/${a}`,(u||h)&&(c+="/"+Math.round(10*u)/10),h&&(c+=`/${Math.round(h)}`),this._hashName){let r=this._hashName,n=!1,o=i.window.location.hash.slice(1).split("&").map(i=>{let o=i.split("=")[0];return o===r?(n=!0,`${o}=${c}`):i}).filter(i=>i);return n||o.push(`${r}=${c}`),`#${o.join("&")}`}return`#${c}`}_getCurrentHash(){let r=i.window.location.hash.replace("#","");if(this._hashName){let i;return r.split("&").map(i=>i.split("=")).forEach(r=>{r[0]===this._hashName&&(i=r)}),(i&&i[1]||"").split("/")}return r.split("/")}_onHashChange(){let i=this._getCurrentHash();if(i.length>=3&&!i.some(i=>isNaN(i))){let r=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:r,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){let r=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,r)}}let iL={linearity:.3,easing:i.bezier(0,0,.3,1)},ik=i.extend({deceleration:2500,maxSpeed:1400},iL),iR=i.extend({deceleration:20,maxSpeed:1400},iL),iD=i.extend({deceleration:1e3,maxSpeed:360},iL),iN=i.extend({deceleration:1e3,maxSpeed:90},iL);class iO{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,n=i.exported.now();for(;r.length>0&&n-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,pan:new i.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:i}of this._inertiaBuffer)n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){let a=iF(n.pan.mag(),o,i.extend({},ik,r||{}));s.offset=n.pan.mult(a.amount/n.pan.mag()),s.center=this._map.transform.center,iz(s,a)}if(n.zoom){let i=iF(n.zoom,o,iR);s.zoom=this._map.transform.zoom+i.amount,iz(s,i)}if(n.bearing){let r=iF(n.bearing,o,iD);s.bearing=this._map.transform.bearing+i.clamp(r.amount,-179,179),iz(s,r)}if(n.pitch){let i=iF(n.pitch,o,iN);s.pitch=this._map.transform.pitch+i.amount,iz(s,i)}if(s.zoom||s.bearing){let i=void 0===n.pinchAround?n.around:n.pinchAround;s.around=i?this._map.unproject(i):this._map.getCenter()}return this.clear(),i.extend(s,{noMoveStart:!0})}}function iz(i,r){(!i.duration||i.duration<r.duration)&&(i.duration=r.duration,i.easing=r.easing)}function iF(r,n,o){let{maxSpeed:s,linearity:a,deceleration:l}=o,u=i.clamp(r*a/(n/1e3),-s,s),h=Math.abs(u)/(l*a);return{easing:o.easing,duration:1e3*h,amount:h/2*u}}class iB extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,n,o,s={}){let a=h.mousePos(n.getCanvasContainer(),o);super(r,i.extend({point:a,lngLat:n.unproject(a),originalEvent:o},s)),this._defaultPrevented=!1,this.target=n}}class iU extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,n,o){let s="touchend"===r?o.changedTouches:o.touches,a=h.touchPos(n.getCanvasContainer(),s),l=a.map(i=>n.unproject(i)),u=a.reduce((i,r,n,o)=>i.add(r.div(o.length)),new i.pointGeometry(0,0));super(r,{points:a,point:u,lngLats:l,lngLat:n.unproject(u),originalEvent:o}),this._defaultPrevented=!1}}class iG extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,r,n){super(i,{originalEvent:n}),this._defaultPrevented=!1}}class iV{constructor(i,r){this._map=i,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new iG(i.type,this._map,i))}mousedown(i,r){return this._mousedownPos=r,this._firePreventable(new iB(i.type,this._map,i))}mouseup(i){this._map.fire(new iB(i.type,this._map,i))}click(i,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new iB(i.type,this._map,i))}dblclick(i){return this._firePreventable(new iB(i.type,this._map,i))}mouseover(i){this._map.fire(new iB(i.type,this._map,i))}mouseout(i){this._map.fire(new iB(i.type,this._map,i))}touchstart(i){return this._firePreventable(new iU(i.type,this._map,i))}touchmove(i){this._map.fire(new iU(i.type,this._map,i))}touchend(i){this._map.fire(new iU(i.type,this._map,i))}touchcancel(i){this._map.fire(new iU(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class iq{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new iB(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new iB("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new iB(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ij{constructor(i,r){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,r){this.isEnabled()&&i.shiftKey&&0===i.button&&(h.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(i,r){if(!this._active||this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;let n=this._startPos;this._lastPos=r,this._box||(this._box=h.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));let o=Math.min(n.x,r.x),s=Math.max(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(h.setTransform(this._box,`translate(${o}px,${a}px)`),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")})}mouseupWindow(r,n){if(!this._active||0!==r.button)return;let o=this._startPos;if(this.reset(),h.suppressClick(),o.x!==n.x||o.y!==n.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:i=>i.fitScreenCoordinates(o,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(h.remove(this._box),this._box=null),h.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,n){return this._map.fire(new i.Event(r,{originalEvent:n}))}}function iZ(i,r){let n={};for(let o=0;o<i.length;o++)n[i[o].identifier]=r[o];return n}class iX{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=r.timeStamp),o.length===this.numTouches&&(this.centroid=function(r){let n=new i.pointGeometry(0,0);for(let i of r)n._add(i);return n.div(r.length)}(n),this.touches=iZ(o,n)))}touchmove(i,r,n){if(this.aborted||!this.centroid)return;let o=iZ(n,r);for(let i in this.touches){let r=this.touches[i],n=o[i];(!n||n.dist(r)>30)&&(this.aborted=!0)}}touchend(i,r,n){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){let i=!this.aborted&&this.centroid;if(this.reset(),i)return i}}}class i${constructor(i){this.singleTap=new iX(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,r,n){this.singleTap.touchstart(i,r,n)}touchmove(i,r,n){this.singleTap.touchmove(i,r,n)}touchend(i,r,n){let o=this.singleTap.touchend(i,r,n);if(o){let r=i.timeStamp-this.lastTime<500,n=!this.lastTap||30>this.lastTap.dist(o);if(r&&n||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class iW{constructor(){this._zoomIn=new i$({numTouches:1,numTaps:2}),this._zoomOut=new i$({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,r,n){this._zoomIn.touchstart(i,r,n),this._zoomOut.touchstart(i,r,n)}touchmove(i,r,n){this._zoomIn.touchmove(i,r,n),this._zoomOut.touchmove(i,r,n)}touchend(i,r,n){let o=this._zoomIn.touchend(i,r,n),s=this._zoomOut.touchend(i,r,n);return o?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:r=>r.easeTo({duration:300,zoom:r.getZoom()+1,around:r.unproject(o)},{originalEvent:i})}):s?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:r=>r.easeTo({duration:300,zoom:r.getZoom()-1,around:r.unproject(s)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let iH={0:1,2:2};class iY{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,r){return!1}_move(i,r){return{}}mousedown(i,r){if(this._lastPoint)return;let n=h.mouseButton(i);this._correctButton(i,n)&&(this._lastPoint=r,this._eventButton=n)}mousemoveWindow(i,r){let n=this._lastPoint;if(n){if(i.preventDefault(),function(i,r){let n=iH[r];return void 0===i.buttons||(i.buttons&n)!==n}(i,this._eventButton))this.reset();else if(this._moved||!(r.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(n,r)}}mouseupWindow(i){this._lastPoint&&h.mouseButton(i)===this._eventButton&&(this._moved&&h.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iK extends iY{mousedown(i,r){super.mousedown(i,r),this._lastPoint&&(this._active=!0)}_correctButton(i,r){return 0===r&&!i.ctrlKey}_move(i,r){return{around:r,panDelta:r.sub(i)}}}class iJ extends iY{_correctButton(i,r){return 0===r&&i.ctrlKey||2===r}_move(i,r){let n=.8*(r.x-i.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(i){i.preventDefault()}}class iQ extends iY{_correctButton(i,r){return 0===r&&i.ctrlKey||2===r}_move(i,r){let n=-.5*(r.y-i.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(i){i.preventDefault()}}class i0{constructor(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new i.pointGeometry(0,0)}touchstart(i,r,n){return this._calculateTransform(i,r,n)}touchmove(i,r,n){if(this._active&&!(n.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,r,n)}touchend(i,r,n){this._calculateTransform(i,r,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,n,o){o.length>0&&(this._active=!0);let s=iZ(o,n),a=new i.pointGeometry(0,0),l=new i.pointGeometry(0,0),u=0;for(let i in s){let r=s[i],n=this._touches[i];n&&(a._add(r),l._add(r.sub(n)),u++,s[i]=r)}if(this._touches=s,u<this._minTouches||!l.mag())return;let h=l.div(u);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(u),panDelta:h}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class i1{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,r,n){return{}}touchstart(i,r,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([r[0],r[1]]))}touchmove(i,r,n){if(!this._firstTwoTouches)return;i.preventDefault();let[o,s]=this._firstTwoTouches,a=i2(n,r,o),l=i2(n,r,s);if(!a||!l)return;let u=this._aroundCenter?null:a.add(l).div(2);return this._move([a,l],u,i)}touchend(i,r,n){if(!this._firstTwoTouches)return;let[o,s]=this._firstTwoTouches,a=i2(n,r,o),l=i2(n,r,s);a&&l||(this._active&&h.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function i2(i,r,n){for(let o=0;o<i.length;o++)if(i[o].identifier===n)return r[o]}function i3(i,r){return Math.log(i/r)/Math.LN2}class i5 extends i1{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,r){let n=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(.1>Math.abs(i3(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:i3(this._distance,n),pinchAround:r}}}function i4(i,r){return 180*i.angleWith(r)/Math.PI}class i6 extends i1{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,r){let n=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:i4(this._vector,n),pinchAround:r}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());let r=25/(Math.PI*this._minDiameter)*360;return Math.abs(i4(i,this._startVector))<r}}function i8(i){return Math.abs(i.y)>Math.abs(i.x)}class i9 extends i1{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,i8(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,r,n){let o=i[0].sub(this._lastPoints[0]),s=i[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(o,s,n.timeStamp),this._valid)return this._lastPoints=i,this._active=!0,{pitchDelta:-((o.y+s.y)/2*.5)}}gestureBeginsVertically(i,r,n){if(void 0!==this._valid)return this._valid;let o=i.mag()>=2,s=r.mag()>=2;if(!o&&!s)return;if(!o||!s)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;let a=i.y>0==r.y>0;return i8(i)&&i8(r)&&a}}class i7{constructor(){this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let r=0,n=0,o=0,s=0,a=0;switch(i.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:i.shiftKey?n=-1:(i.preventDefault(),s=-1);break;case 39:i.shiftKey?n=1:(i.preventDefault(),s=1);break;case 38:i.shiftKey?o=1:(i.preventDefault(),a=-1);break;case 40:i.shiftKey?o=-1:(i.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,o=0),{cameraAnimation:l=>{let u=l.getZoom();l.easeTo({duration:300,easeId:"keyboardHandler",easing:rt,zoom:r?Math.round(u)+r*(i.shiftKey?2:1):u,bearing:l.getBearing()+n*this._bearingStep,pitch:l.getPitch()+o*this._pitchStep,offset:[-s*this._panStep,-a*this._panStep],center:l.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rt(i){return i*(2-i)}class re{constructor(r,n){this._map=r,this._el=r.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&"center"===i.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;let n=r.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,o=i.exported.now(),s=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&4>Math.abs(n)?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=200>Math.abs(s*n)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),r.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=r,this._delta-=n,this._active||this._start(r)),r.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let r=h.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform,n=()=>r._terrainEnabled()?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){let i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,o=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==o&&(o=1/o);let s=Math.pow(2,n()),a="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(a*o))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}let o="number"==typeof this._targetZoom?this._targetZoom:n(),s=this._startZoom,a=this._easing,l,u=!1;if("wheel"===this._type&&s&&a){let r=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),n=a(r);l=i.number(s,o,n),r<1?this._frameId||(this._frameId=!0):u=!0}else l=o,u=!0;return this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!u,zoomDelta:l-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let n=i.ease;if(this._prevEase){let r=this._prevEase,o=(i.exported.now()-r.start)/r.duration,s=r.easing(o+.01)-r.easing(o),a=.27/Math.sqrt(s*s+1e-4)*.01,l=Math.sqrt(.0729-a*a);n=i.bezier(a,l,.25,1)}return this._prevEase={start:i.exported.now(),duration:r,easing:n},n}reset(){this._active=!1}}class ri{constructor(i,r){this._clickZoom=i,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rr{constructor(){this.reset()}reset(){this._active=!1}dblclick(i,r){return i.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(i.shiftKey?-1:1),around:n.unproject(r)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rn{constructor(){this._tap=new i$({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,r,n){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=r[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(i,r,n))}touchmove(i,r,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;let o=r[0],s=o.y-this._swipePoint.y;return this._swipePoint=o,i.preventDefault(),this._active=!0,{zoomDelta:s/128}}}else this._tap.touchmove(i,r,n)}touchend(i,r,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(i,r,n)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro{constructor(i,r,n){this._el=i,this._mousePan=r,this._touchPan=n}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rs{constructor(i,r,n){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=r,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ra{constructor(i,r,n,o){this._el=i,this._touchZoom=r,this._touchRotate=n,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let rl=i=>i.zoom||i.drag||i.pitch||i.rotate;class ru extends i.Event{}class rh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,n){let o=i.sub([],n,r);this.radius=i.length(o[2]<0?i.div([],o,this.constants):[o[0],o[1],0])}projectRay(r){i.div(r,r,this.constants),i.normalize(r,r),i.mul$2(r,r,this.constants);let n=i.scale([],r,this.radius);if(n[2]>0){let r=i.scale([],[0,0,1],i.dot(n,[0,0,1])),o=i.scale([],i.normalize([],[n[0],n[1],0]),this.radius),s=i.add([],n,i.scale([],i.sub([],i.add([],o,r),n),2));n[0]=s[0],n[1]=s[1]}return n}}function rc(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}class rp{constructor(r,n){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new iO(r),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new rh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),i.bindAll(["handleEvent","handleWindowEvent"],this);let o=this._el;for(let[r,n,s]of(this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[i.window,"blur",void 0]],this._listeners))h.addEventListener(r,n,r===i.window.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(let[r,n,o]of this._listeners)h.removeEventListener(r,n,r===i.window.document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(i){let r=this._map,n=r.getCanvasContainer();this._add("mapEvent",new iV(r,i));let o=r.boxZoom=new ij(r,i);this._add("boxZoom",o);let s=new iW,a=new rr;r.doubleClickZoom=new ri(a,s),this._add("tapZoom",s),this._add("clickZoom",a);let l=new rn;this._add("tapDragZoom",l);let u=r.touchPitch=new i9;this._add("touchPitch",u);let h=new iJ(i),c=new iQ(i);r.dragRotate=new rs(i,h,c),this._add("mouseRotate",h,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);let p=new iK(i),f=new i0(i);r.dragPan=new ro(n,p,f),this._add("mousePan",p),this._add("touchPan",f,["touchZoom","touchRotate"]);let d=new i6,m=new i5;r.touchZoomRotate=new ra(n,m,d,l),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]),this._add("blockableMapEvent",new iq(r));let g=r.scrollZoom=new re(r,this);this._add("scrollZoom",g,["mousePan"]);let y=r.keyboard=new i7;for(let n of(this._add("keyboard",y),["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"]))i.interactive&&i[n]&&r[n].enable(i[n])}_add(i,r,n){this._handlers.push({handlerName:i,handler:r,allowed:n}),this._handlersById[i]=r}stop(i){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(let{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rl(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,r,n){for(let o in i)if(o!==n&&(!r||0>r.indexOf(o)))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){let r=[];for(let n of i)this._el.contains(n.target)&&r.push(n);return r}handleEvent(i,r){if("blur"===i.type)return void this.stop(!0);this._updatingCamera=!0;let n="renderFrame"===i.type,o=n?void 0:i,s={needsRenderFrame:!1},a={},l={},u=i.touches?this._getMapTouches(i.touches):void 0,c=u?h.touchPos(this._el,u):n?void 0:h.mousePos(this._el,i);for(let{handlerName:n,handler:h,allowed:p}of this._handlers){let f;h.isEnabled()&&(this._blockedByActive(l,p,n)?h.reset():h[r||i.type]&&(f=h[r||i.type](i,c,u),this.mergeHandlerResult(s,a,f,n,o),f&&f.needsRenderFrame&&this._triggerRenderFrame()),(f||h.isActive())&&(l[n]=h))}let p={};for(let i in this._previousActiveHandlers)l[i]||(p[i]=o);this._previousActiveHandlers=l,(Object.keys(p).length||rc(s))&&(this._changes.push([s,a,p]),this._triggerRenderFrame()),(Object.keys(l).length||rc(s))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:f}=s;f&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],f(this._map))}mergeHandlerResult(r,n,o,s,a){if(!o)return;i.extend(r,o);let l={handlerName:s,originalEvent:o.originalEvent||a};void 0!==o.zoomDelta&&(n.zoom=l),void 0!==o.panDelta&&(n.drag=l),void 0!==o.pitchDelta&&(n.pitch=l),void 0!==o.bearingDelta&&(n.rotate=l)}_applyChanges(){let r={},n={},o={};for(let[s,a,l]of this._changes)s.panDelta&&(r.panDelta=(r.panDelta||new i.pointGeometry(0,0))._add(s.panDelta)),s.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(r.around=s.around),void 0!==s.aroundCoord&&(r.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(r.pinchAround=s.pinchAround),s.noInertia&&(r.noInertia=s.noInertia),i.extend(n,a),i.extend(o,l);this._updateMapTransform(r,n,o),this._changes=[]}_updateMapTransform(r,n,o){let s=this._map,a=s.transform,l=i=>[i.x,i.y,i.z];if((i=>{let r=this._eventsInProgress.drag;return r&&!this._handlersById[r.handlerName].isActive()})()&&!rc(r)){let i=a.zoom;a.cameraElevationReference="sea",a.recenterOnTerrain(),a.cameraElevationReference="ground",i!==a.zoom&&this._map._update(!0)}if(!rc(r))return this._fireEvents(n,o,!0);let{panDelta:u,zoomDelta:h,bearingDelta:c,pitchDelta:p,around:f,aroundCoord:d,pinchAround:m}=r;void 0!==m&&(f=m),n.drag&&!this._eventsInProgress.drag&&f&&(this._dragOrigin=l(a.pointCoordinate3D(f)),this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),a.cameraElevationReference="sea",s._stop(!0),f=f||s.transform.centerPoint,c&&(a.bearing+=c),p&&(a.pitch+=p),a._updateCameraState();let g=[0,0,0];if(u){let i=a.screenPointToMercatorRay(f),r=a.screenPointToMercatorRay(f.sub(u)),n=this._trackingEllipsoid.projectRay(i.dir),o=this._trackingEllipsoid.projectRay(r.dir);g[0]=o[0]-n[0],g[1]=o[1]-n[1]}let y=a.zoom,_=[0,0,0];if(h){let r=l(d||a.pointCoordinate3D(f)),n={dir:i.normalize([],i.sub([],r,a._camera.position))},o=a.screenPointToMercatorRay(a.centerPoint);if(n.dir[2]<0){let s=i.altitudeFromMercatorZ(r[2],r[1]),u=a.rayIntersectionCoordinate(a.pointRayIntersection(a.centerPoint,s)),c=a.zoomDeltaToMovement(l(u),h)*(o.dir[2]/n.dir[2]);i.scale(_,n.dir,c)}else if(a._terrainEnabled()){let o=a.zoomDeltaToMovement(r,h);i.scale(_,n.dir,o)}}let v=i.add(g,g,_);a._translateCameraConstrained(v),h&&Math.abs(a.zoom-y)>1e-4&&a.recenterOnTerrain(),a.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(n,o,!0)}_fireEvents(r,n,o){let s;let a=rl(this._eventsInProgress),l=rl(r),u={};for(let i in r){let{originalEvent:n}=r[i];this._eventsInProgress[i]||(u[`${i}start`]=n),this._eventsInProgress[i]=r[i]}for(let i in!a&&l&&this._fireEvent("movestart",l.originalEvent),u)this._fireEvent(i,u[i]);for(let i in l&&this._fireEvent("move",l.originalEvent),r){let{originalEvent:n}=r[i];this._fireEvent(i,n)}let h={};for(let i in this._eventsInProgress){let{handlerName:r,originalEvent:o}=this._eventsInProgress[i];this._handlersById[r].isActive()||(delete this._eventsInProgress[i],s=n[r]||o,h[`${i}end`]=s)}for(let i in h)this._fireEvent(i,h[i]);let c=rl(this._eventsInProgress);if(o&&(a||l)&&!c){let r,n;this._updatingCamera=!0;let o=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions);o?(0!==(r=o.bearing||this._map.getBearing())&&-this._bearingSnap<r&&r<this._bearingSnap&&(o.bearing=0),this._map.easeTo(o,{originalEvent:s})):(this._map.fire(new i.Event("moveend",{originalEvent:s})),0!==(n=this._map.getBearing())&&-this._bearingSnap<n&&n<this._bearingSnap&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,n){this._map.fire(new i.Event(r,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new ru("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class rf extends i.Evented{constructor(r,n){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,r){return this.jumpTo({center:i},r)}panBy(r,n,o){return r=i.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,i.extend({offset:r},n),o)}panTo(r,n,o){return this.easeTo(i.extend({center:r},n),o)}getZoom(){return this.transform.zoom}setZoom(i,r){return this.jumpTo({zoom:i},r),this}zoomTo(r,n,o){return this.easeTo(i.extend({zoom:r},n),o)}zoomIn(i,r){return this.zoomTo(this.getZoom()+1,i,r),this}zoomOut(i,r){return this.zoomTo(this.getZoom()-1,i,r),this}getBearing(){return this.transform.bearing}setBearing(i,r){return this.jumpTo({bearing:i},r),this}getPadding(){return this.transform.padding}setPadding(i,r){return this.jumpTo({padding:i},r),this}rotateTo(r,n,o){return this.easeTo(i.extend({bearing:r},n),o)}resetNorth(r,n){return this.rotateTo(0,i.extend({duration:1e3},r),n),this}resetNorthPitch(r,n){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},r),n),this}snapToNorth(i,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,r):this}getPitch(){return this.transform.pitch}setPitch(i,r){return this.jumpTo({pitch:i},r),this}cameraForBounds(r,n){r=i.LngLatBounds.convert(r);let o=n&&n.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),o,n)}_extendCameraOptions(r){let n={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=i.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){let i=r.padding;r.padding={top:i,bottom:i,right:i,left:i}}return r.padding=i.extend(n,r.padding),r}_cameraForBoxAndBearing(r,n,o,s){let a=this._extendCameraOptions(s),l=this.transform,u=l.padding,h=l.project(i.LngLat.convert(r)),c=l.project(i.LngLat.convert(n)),p=h.rotate(-i.degToRad(o)),f=c.rotate(-i.degToRad(o)),d=new i.pointGeometry(Math.max(p.x,f.x),Math.max(p.y,f.y)),m=new i.pointGeometry(Math.min(p.x,f.x),Math.min(p.y,f.y)),g=d.sub(m),y=(l.width-(u.left+u.right+a.padding.left+a.padding.right))/g.x,_=(l.height-(u.top+u.bottom+a.padding.top+a.padding.bottom))/g.y;if(_<0||y<0)return void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let v=Math.min(l.scaleZoom(l.scale*Math.min(y,_)),a.maxZoom),x="number"==typeof a.offset.x?new i.pointGeometry(a.offset.x,a.offset.y):i.pointGeometry.convert(a.offset),b=new i.pointGeometry((a.padding.left-a.padding.right)/2,(a.padding.top-a.padding.bottom)/2).rotate(o*Math.PI/180),w=x.add(b).mult(l.scale/l.zoomScale(v));return{center:l.unproject(h.add(c).div(2).sub(w)),zoom:v,bearing:o}}_cameraForBox(r,n,o,s,a){var l;let u=this._extendCameraOptions(a);o=o||0,s=s||0,r=i.LngLat.convert(r),n=i.LngLat.convert(n);let h=this.transform.clone();h.padding=u.padding;let c=this.getFreeCameraOptions(),p=new i.LngLat(.5*(r.lng+n.lng),.5*(r.lat+n.lat)),f=.5*(o+s);if(h._camera.position[2]<i.mercatorZfromAltitude(f,p.lat))return void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");c.lookAtPoint(p),h.setFreeCameraOptions(c);let d=i.MercatorCoordinate.fromLngLat(r),m=i.MercatorCoordinate.fromLngLat(n),g=h.pointRayIntersection(h.centerPoint,f),v=[(l=h.rayIntersectionCoordinate(g)).x,l.y,l.z],x=h.screenPointToMercatorRay(h.centerPoint),b,w=0;do{let r=Math.floor(h.zoom),n=1<<r,a=Math.min(n*d.x,n*m.x),l=Math.min(n*d.y,n*m.y),u=Math.max(n*d.x,n*m.x),c=Math.max(n*d.y,n*m.y),p=new _([a,l,o],[u,c,s]),f=y.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,r);if(2!==p.intersects(f)){b&&(h._camera.position=i.scaleAndAdd([],h._camera.position,x.dir,-b),h._updateStateFromCamera());break}let g=i.sub([],h._camera.position,v);b=.5*i.length(g),h._camera.position=i.scaleAndAdd([],h._camera.position,x.dir,b);try{h._updateStateFromCamera()}catch(r){return void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++w<10)return{center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}}fitBounds(i,r,n){return this._fitInternal(this.cameraForBounds(i,r),r,n)}_raycastElevationBox(r,n){let o=this.transform.elevation;if(!o)return;let s=new i.pointGeometry(r.x,n.y),a=new i.pointGeometry(n.x,r.y),l=o.pointCoordinate(r);if(!l)return;let u=o.pointCoordinate(n);if(!u)return;let h=o.pointCoordinate(s);if(!h)return;let c=o.pointCoordinate(a);if(!c)return;let p=new i.MercatorCoordinate(l[0],l[1]).toLngLat(),f=new i.MercatorCoordinate(u[0],u[1]).toLngLat(),d=new i.MercatorCoordinate(h[0],h[1]).toLngLat(),m=new i.MercatorCoordinate(c[0],c[1]).toLngLat(),g=Math.min(p.lng,Math.min(f.lng,Math.min(d.lng,m.lng))),y=Math.min(p.lat,Math.min(f.lat,Math.min(d.lat,m.lat))),_=Math.max(p.lng,Math.max(f.lng,Math.max(d.lng,m.lng))),v=Math.max(p.lat,Math.max(f.lat,Math.max(d.lat,m.lat))),x=Math.min(l[3],Math.min(u[3],Math.min(h[3],c[3]))),b=Math.max(l[3],Math.max(u[3],Math.max(h[3],c[3])));return{minLngLat:new i.LngLat(g,y),maxLngLat:new i.LngLat(_,v),minAltitude:x,maxAltitude:b}}fitScreenCoordinates(r,n,o,s,a){let l,u,h,c;let p=i.pointGeometry.convert(r),f=i.pointGeometry.convert(n),d=this._raycastElevationBox(p,f);if(d)l=d.minLngLat,u=d.maxLngLat,h=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(p,f))return this;l=this.transform.pointLocation(p),u=this.transform.pointLocation(f)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(i.pointGeometry.convert(r)),this.transform.pointLocation(i.pointGeometry.convert(n)),o,s):this._cameraForBox(l,u,h,c,s),s,a)}_fitInternal(r,n,o){return r?(delete(n=i.extend(r,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(r,n){this.stop();let o=this.transform,s=!1,a=!1,l=!1;return"zoom"in r&&o.zoom!==+r.zoom&&(s=!0,o.zoom=+r.zoom),void 0!==r.center&&(o.center=i.LngLat.convert(r.center)),"bearing"in r&&o.bearing!==+r.bearing&&(a=!0,o.bearing=+r.bearing),"pitch"in r&&o.pitch!==+r.pitch&&(l=!0,o.pitch=+r.pitch),null==r.padding||o.isPaddingEqual(r.padding)||(o.padding=r.padding),this.fire(new i.Event("movestart",n)).fire(new i.Event("move",n)),s&&this.fire(new i.Event("zoomstart",n)).fire(new i.Event("zoom",n)).fire(new i.Event("zoomend",n)),a&&this.fire(new i.Event("rotatestart",n)).fire(new i.Event("rotate",n)).fire(new i.Event("rotateend",n)),l&&this.fire(new i.Event("pitchstart",n)).fire(new i.Event("pitch",n)).fire(new i.Event("pitchend",n)),this.fire(new i.Event("moveend",n))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,n){this.stop();let o=this.transform,s=o.zoom,a=o.pitch,l=o.bearing;o.setFreeCameraOptions(r);let u=s!==o.zoom,h=a!==o.pitch,c=l!==o.bearing;return this.fire(new i.Event("movestart",n)).fire(new i.Event("move",n)),u&&this.fire(new i.Event("zoomstart",n)).fire(new i.Event("zoom",n)).fire(new i.Event("zoomend",n)),c&&this.fire(new i.Event("rotatestart",n)).fire(new i.Event("rotate",n)).fire(new i.Event("rotateend",n)),h&&this.fire(new i.Event("pitchstart",n)).fire(new i.Event("pitch",n)).fire(new i.Event("pitchend",n)),this.fire(new i.Event("moveend",n)),this}easeTo(r,n){let o,s;this._stop(!1,r.easeId),(!1===(r=i.extend({offset:[0,0],duration:500,easing:i.ease},r)).animate||!r.essential&&i.exported.prefersReducedMotion)&&(r.duration=0);let a=this.transform,l=this.getZoom(),u=this.getBearing(),h=this.getPitch(),c=this.getPadding(),p="zoom"in r?+r.zoom:l,f="bearing"in r?this._normalizeBearing(r.bearing,u):u,d="pitch"in r?+r.pitch:h,m="padding"in r?r.padding:a.padding,g=i.pointGeometry.convert(r.offset),y=a.centerPoint.add(g),_=a.pointLocation(y),v=i.LngLat.convert(r.center||_);this._normalizeCenter(v);let x=a.project(_),b=a.project(v).sub(x),w=a.zoomScale(p-l);r.around&&(o=i.LngLat.convert(r.around),s=a.locationPoint(o));let E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||p!==l,this._rotating=this._rotating||u!==f,this._pitching=this._pitching||d!==h,this._padding=!a.isPaddingEqual(m),this._easeId=r.easeId,this._prepareEase(n,r.noMoveStart,E),this._ease(r=>{if(this._zooming&&(a.zoom=i.number(l,p,r)),this._rotating&&(a.bearing=i.number(u,f,r)),this._pitching&&(a.pitch=i.number(h,d,r)),this._padding&&(a.interpolatePadding(c,m,r),y=a.centerPoint.add(g)),o)a.setLocationAtPoint(o,s);else{let i=a.zoomScale(a.zoom-l),n=Math.pow(p>l?Math.min(2,w):Math.max(.5,w),1-r),o=a.unproject(x.add(b.mult(r*n)).mult(i));a.setLocationAtPoint(a.renderWorldCopies?o.wrap():o,y)}this._fireMoveEvents(n)},i=>{a.recenterOnTerrain(),this._afterEase(n,i)},r),this}_prepareEase(r,n,o={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||o.moving||this.fire(new i.Event("movestart",r)),this._zooming&&!o.zooming&&this.fire(new i.Event("zoomstart",r)),this._rotating&&!o.rotating&&this.fire(new i.Event("rotatestart",r)),this._pitching&&!o.pitching&&this.fire(new i.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.Event("move",r)),this._zooming&&this.fire(new i.Event("zoom",r)),this._rotating&&this.fire(new i.Event("rotate",r)),this._pitching&&this.fire(new i.Event("pitch",r))}_afterEase(r,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.transform.cameraElevationReference="ground";let o=this._zooming,s=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new i.Event("zoomend",r)),s&&this.fire(new i.Event("rotateend",r)),a&&this.fire(new i.Event("pitchend",r)),this.fire(new i.Event("moveend",r))}flyTo(r,n){if(!r.essential&&i.exported.prefersReducedMotion){let o=i.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(o,n)}this.stop(),r=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},r);let o=this.transform,s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),u=this.getPadding(),h="zoom"in r?i.clamp(+r.zoom,o.minZoom,o.maxZoom):s,c="bearing"in r?this._normalizeBearing(r.bearing,a):a,p="pitch"in r?+r.pitch:l,f="padding"in r?r.padding:o.padding,d=o.zoomScale(h-s),m=i.pointGeometry.convert(r.offset),g=o.centerPoint.add(m),y=o.pointLocation(g),_=i.LngLat.convert(r.center||y);this._normalizeCenter(_);let v=o.project(y),x=o.project(_).sub(v),b=r.curve,w=Math.max(o.width,o.height),E=w/d,I=x.mag();if("minZoom"in r){let n=i.clamp(Math.min(r.minZoom,s,h),o.minZoom,o.maxZoom);b=Math.sqrt(w/o.zoomScale(n-s)/I*2)}let S=b*b;function M(i){let r=(E*E-w*w+(i?-1:1)*S*S*I*I)/(2*(i?E:w)*S*I);return Math.log(Math.sqrt(r*r+1)-r)}function T(i){return(Math.exp(i)-Math.exp(-i))/2}function C(i){return(Math.exp(i)+Math.exp(-i))/2}let P=M(0),A=function(i){return C(P)/C(P+b*i)},L=function(i){var r;return w*((C(P)*(T(r=P+b*i)/C(r))-T(P))/S)/I},k=(M(1)-P)/b;if(1e-6>Math.abs(I)||!isFinite(k)){if(1e-6>Math.abs(w-E))return this.easeTo(r,n);let i=E<w?-1:1;k=Math.abs(Math.log(E/w))/b,L=function(){return 0},A=function(r){return Math.exp(i*b*r)}}return r.duration="duration"in r?+r.duration:1e3*k/("screenSpeed"in r?+r.screenSpeed/b:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=a!==c,this._pitching=p!==l,this._padding=!o.isPaddingEqual(f),this._prepareEase(n,!1),this._ease(r=>{let d=r*k,y=1/A(d);o.zoom=1===r?h:s+o.scaleZoom(y),this._rotating&&(o.bearing=i.number(a,c,r)),this._pitching&&(o.pitch=i.number(l,p,r)),this._padding&&(o.interpolatePadding(u,f,r),g=o.centerPoint.add(m));let b=1===r?_:o.unproject(v.add(x.mult(L(d))).mult(y));o.setLocationAtPoint(o.renderWorldCopies?b.wrap():b,g),o._updateCenterElevation(),this._fireMoveEvents(n)},()=>this._afterEase(n),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let i=this._onEaseEnd;delete this._onEaseEnd,i.call(this,r)}if(!i){let i=this.handlers;i&&i.stop(!1)}return this}_ease(r,n,o){!1===o.animate||0===o.duration?(r(1),n()):(this._easeStart=i.exported.now(),this._easeOptions=o,this._onEaseFrame=r,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,n){let o=Math.abs((r=i.wrap(r,-180,180))-n);return Math.abs(r-360-n)<o&&(r-=360),Math.abs(r+360-n)<o&&(r+=360),r}_normalizeCenter(i){let r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;let n=i.lng-r.center.lng;i.lng+=n>180?-360:360*(n<-180)}}class rd{constructor(r={}){this.options=r,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){let r=this.options&&this.options.compact;return this._map=i,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=h.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=h.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===r&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){h.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,r){let n=this._map._getUIString(`AttributionControl.${r}`);i.title=n,i.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(r){let o=n.reduce((i,r,o)=>(r.value&&(i+=`${r.key}=${r.value}${o<n.length-1?"&":""}`),i),"?");r.href=`${i.config.FEEDBACK_URL}/${o}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(i){i&&("metadata"===i.sourceDataType||"visibility"===i.sourceDataType||"style"===i.dataType)&&(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(i=>"string"!=typeof i?"":i)):"string"==typeof this.options.customAttribution&&i.push(this.options.customAttribution)),this._map.style.stylesheet){let i=this._map.style.stylesheet;this.styleOwner=i.owner,this.styleId=i.id}let r=this._map.style._sourceCaches;for(let n in r){let o=r[n];if(o.used){let r=o.getSource();r.attribution&&0>i.indexOf(r.attribution)&&i.push(r.attribution)}}i.sort((i,r)=>i.length-r.length);let n=(i=i.filter((r,n)=>{for(let o=n+1;o<i.length;o++)if(i[o].indexOf(r)>=0)return!1;return!0})).join(" | ");n!==this._attribHTML&&(this._attribHTML=n,i.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rm{constructor(){i.bindAll(["_updateLogo"],this),i.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=h.create("div","mapboxgl-ctrl");let r=h.create("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){h.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(let r in i){let n=i[r].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){let i=this._container.children;if(i.length){let r=i[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class rg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){let r=++this._id;return this._queue.push({callback:i,id:r,cancelled:!1}),r}remove(i){let r=this._currentlyRunning;for(let n of r?this._queue.concat(r):this._queue)if(n.id===i)return void(n.cancelled=!0)}run(i=0){let r=this._currentlyRunning=this._queue;for(let n of(this._queue=[],r))if(!n.cancelled&&(n.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ry(r,n,o){if(r=new i.LngLat(r.lng,r.lat),n){let s=new i.LngLat(r.lng-360,r.lat),a=new i.LngLat(r.lng+360,r.lat),l=360*Math.ceil(Math.abs(r.lng-o.center.lng)/360),u=o.locationPoint(r).distSqr(n),h=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(s).distSqr(n)<u&&(h||Math.abs(s.lng-o.center.lng)<l)?r=s:o.locationPoint(a).distSqr(n)<u&&(h||Math.abs(a.lng-o.center.lng)<l)&&(r=a)}for(;Math.abs(r.lng-o.center.lng)>180;){let i=o.locationPoint(r);if(i.x>=0&&i.y>=0&&i.x<=o.width&&i.y<=o.height)break;r.lng>o.center.lng?r.lng-=360:r.lng+=360}return r}let r_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rv(i,r,n){let o=i.classList;for(let i in r_)o.remove(`mapboxgl-${n}-anchor-${i}`);o.add(`mapboxgl-${n}-anchor-${r}`)}class rx extends i.Evented{constructor(r,n){if(super(),(r instanceof i.window.HTMLElement||n)&&(r=i.extend({element:r},n)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=i.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=h.create("div"),this._element.setAttribute("aria-label","Map marker");let n=h.createNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","41px"),n.setAttributeNS(null,"width","27px"),n.setAttributeNS(null,"viewBox","0 0 27 41");let o=h.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");let s=h.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");let a=h.createNS("http://www.w3.org/2000/svg","g");for(let i of(a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}])){let r=h.createNS("http://www.w3.org/2000/svg","ellipse");r.setAttributeNS(null,"opacity","0.04"),r.setAttributeNS(null,"cx","10.5"),r.setAttributeNS(null,"cy","5.80029008"),r.setAttributeNS(null,"rx",i.rx),r.setAttributeNS(null,"ry",i.ry),a.appendChild(r)}let l=h.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"fill",this._color);let u=h.createNS("http://www.w3.org/2000/svg","path");u.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),l.appendChild(u);let c=h.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"opacity","0.25"),c.setAttributeNS(null,"fill","#000000");let p=h.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),c.appendChild(p);let f=h.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");let d=h.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(8.0, 8.0)");let m=h.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");let g=h.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),d.appendChild(m),d.appendChild(g),s.appendChild(a),s.appendChild(l),s.appendChild(c),s.appendChild(f),s.appendChild(d),n.appendChild(s),n.setAttributeNS(null,"height",41*this._scale+"px"),n.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(n),this._offset=i.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),rv(this._element,this._anchor,"marker"),this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),h.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){let r=Math.sqrt(91.125);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[r,-1*(24.6+r)],"bottom-right":[-r,-1*(24.6+r)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(i){let r=i.code,n=i.charCode||i.keyCode;"Space"!==r&&"Enter"!==r&&32!==n&&13!==n||this.togglePopup()}_onMapClick(i){let r=i.originalEvent.target,n=this._element;this._popup&&(r===n||n.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let i=this._popup;return i&&(i.isOpen()?i.remove():i.addTo(this._map)),this}_evaluateOpacity(){let i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();let r=this._map.unproject(i),n=!1;if(this._map.getTerrain()){let i=this._map.getFreeCameraOptions();if(i.position){let o=i.position.toLngLat();n=o.distanceTo(r)<.9*o.distanceTo(this._lngLat)}}let o=(1-this._map._queryFogOpacity(r))*(n?.2:1);this._element.style.opacity=`${o}`,this._popup&&this._popup._setOpacity(`${o}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){let r=this._map.transform;return!!i&&i.x>=0&&i.x<r.width&&i.y>=0&&i.y<r.height}_update(i){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ry(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let r="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?r=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),i&&"moveend"!==i.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&h.setTransform(this._element,`${r_[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${r}`),(this._map.getTerrain()||this._map.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;let i=this._map.transform,r=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&r._rotate(i.angle),"map"===this._pitchAlignment&&(r.y*=Math.cos(i._pitch)),r}getOffset(){return this._offset}setOffset(r){return this._offset=i.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){let i=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=i}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class rb{constructor(i){this.jumpTo(i)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let n=i.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,r,n){this._start=this.getValue(r),this._end=i,this._startTime=r,this._endTime=r+n}}let rw={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:rE,HTMLElement:rI,ImageBitmap:rS}=i.window,rM={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function rT(i){i.parentNode&&i.parentNode.removeChild(i)}let rC={showCompass:!0,showZoom:!0,visualizePitch:!1};class rP{constructor(r,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new iJ({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,o&&(this.mousePitch=new iQ({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener(n,"mousedown",this.mousedown),h.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),h.addEventListener(n,"touchmove",this.touchmove),h.addEventListener(n,"touchend",this.touchend),h.addEventListener(n,"touchcancel",this.reset)}down(i,r){this.mouseRotate.mousedown(i,r),this.mousePitch&&this.mousePitch.mousedown(i,r),h.disableDrag()}move(i,r){let n=this.map,o=this.mouseRotate.mousemoveWindow(i,r);if(o&&o.bearingDelta&&n.setBearing(n.getBearing()+o.bearingDelta),this.mousePitch){let o=this.mousePitch.mousemoveWindow(i,r);o&&o.pitchDelta&&n.setPitch(n.getPitch()+o.pitchDelta)}}off(){let i=this.element;h.removeEventListener(i,"mousedown",this.mousedown),h.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),h.removeEventListener(i,"touchmove",this.touchmove),h.removeEventListener(i,"touchend",this.touchend),h.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){h.enableDrag(),h.removeEventListener(i.window,"mousemove",this.mousemove),h.removeEventListener(i.window,"mouseup",this.mouseup)}mousedown(r){this.down(i.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),h.mousePos(this.element,r)),h.addEventListener(i.window,"mousemove",this.mousemove),h.addEventListener(i.window,"mouseup",this.mouseup)}mousemove(i){this.move(i,h.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=h.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=h.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let rA={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},rL,rk=0,rR=!1,rD={maxWidth:100,unit:"metric"};function rN(i,r,n){let o=n&&n.maxWidth||100,s=i._container.clientHeight/2,a=i.unproject([0,s]),l=i.unproject([o,s]),u=a.distanceTo(l);if(n&&"imperial"===n.unit){let n=3.2808*u;n>5280?rO(r,o,n/5280,i._getUIString("ScaleControl.Miles"),i):rO(r,o,n,i._getUIString("ScaleControl.Feet"),i)}else n&&"nautical"===n.unit?rO(r,o,u/1852,i._getUIString("ScaleControl.NauticalMiles"),i):u>=1e3?rO(r,o,u/1e3,i._getUIString("ScaleControl.Kilometers"),i):rO(r,o,u,i._getUIString("ScaleControl.Meters"),i)}function rO(i,r,n,o,s){let a=function(i){let r=Math.pow(10,`${Math.floor(i)}`.length-1),n=i/r;return r*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(i){let r=Math.pow(10,Math.ceil(-Math.log(i)/Math.LN10));return Math.round(i*r)/r}(n))}(n),l=a/n;s._requestDomTask(()=>{i.style.width=r*l+"px",i.innerHTML=`${a}&nbsp;${o}`})}let rz={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rF={version:i.version,supported:a,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends rf{constructor(r){if(null!=(r=i.extend({},rM,r)).minZoom&&null!=r.maxZoom&&r.minZoom>r.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=r.minPitch&&null!=r.maxPitch&&r.minPitch>r.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=r.minPitch&&r.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=r.maxPitch&&r.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(super(new iP(r.minZoom,r.maxZoom,r.minPitch,r.maxPitch,r.renderWorldCopies),r),this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._failIfMajorPerformanceCaveat=r.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=r.preserveDrawingBuffer,this._antialias=r.antialias,this._trackResize=r.trackResize,this._bearingSnap=r.bearingSnap,this._refreshExpiredTiles=r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=r.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=r.collectResourceTiming,this._optimizeForTerrain=r.optimizeForTerrain,this._renderTaskQueue=new rg,this._domRenderTaskQueue=new rg,this._controls=[],this._markers=[],this._mapId=i.uniqueId(),this._locale=i.extend({},rw,r.locale),this._clickTolerance=r.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new rb(0),this._requestManager=new i.RequestManager(r.transformRequest,r.accessToken,r.testMode),this._silenceAuthErrors=!!r.testMode,"string"==typeof r.container){if(this._container=i.window.document.getElementById(r.container),!this._container)throw Error(`Container '${r.container}' not found.`)}else{if(!(r.container instanceof rI))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==i.window&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new rp(this,r),this._hash=r.hash&&new iA("string"==typeof r.hash&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,i.extend({},r.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=r.localFontFamily,this._localIdeographFontFamily=r.localIdeographFontFamily,r.style&&this.setStyle(r.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),r.attributionControl&&this.addControl(new rd({customAttribution:r.customAttribution})),this._logoControl=new rm,this.addControl(this._logoControl,r.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new i.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new i.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(r,n){if(void 0===n&&(n=r.getDefaultPosition?r.getDefaultPosition():"top-right"),!r||!r.onAdd)return this.fire(new i.ErrorEvent(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=r.onAdd(this);this._controls.push(r);let s=this._controlPositions[n];return -1!==n.indexOf("bottom")?s.insertBefore(o,s.firstChild):s.appendChild(o),this}removeControl(r){if(!r||!r.onRemove)return this.fire(new i.ErrorEvent(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let n=this._controls.indexOf(r);return n>-1&&this._controls.splice(n,1),r.onRemove(this),this}hasControl(i){return this._controls.indexOf(i)>-1}resize(r){let n=this._containerDimensions(),o=n[0],s=n[1];this._resizeCanvas(o,s),this.transform.resize(o,s),this.painter.resize(o,s);let a=!this._moving;return a&&(this.stop(),this.fire(new i.Event("movestart",r)).fire(new i.Event("move",r))),this.fire(new i.Event("resize",r)),a&&this.fire(new i.Event("moveend",r)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(r){return this.transform.setMaxBounds(i.LngLatBounds.convert(r)),this._update()}setMinZoom(i){if((i=null==i?-2:i)>=-2&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this._update(),this.getZoom()<i&&this.setZoom(i),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(i){if((i=null==i?22:i)>=this.transform.minZoom)return this.transform.maxZoom=i,this._update(),this.getZoom()>i&&this.setZoom(i),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(i){if((i=null==i?0:i)<0)throw Error("minPitch must be greater than or equal to 0");if(i>=0&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this._update(),this.getPitch()<i&&this.setPitch(i),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(i){if((i=null==i?85:i)>85)throw Error("maxPitch must be less than or equal to 85");if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this._update(),this.getPitch()>i&&this.setPitch(i),this;throw Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(i){return this.transform.renderWorldCopies=i,this._update()}project(r){return this.transform.locationPoint3D(i.LngLat.convert(r))}unproject(r){return this.transform.pointLocation3D(i.pointGeometry.convert(r))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(i,r,n){if("mouseenter"===i||"mouseover"===i){let o=!1;return{layer:r,listener:n,delegates:{mousemove:s=>{let a=this.getLayer(r)?this.queryRenderedFeatures(s.point,{layers:[r]}):[];a.length?o||(o=!0,n.call(this,new iB(i,this,s.originalEvent,{features:a}))):o=!1},mouseout:()=>{o=!1}}}}if("mouseleave"===i||"mouseout"===i){let o=!1;return{layer:r,listener:n,delegates:{mousemove:s=>{(this.getLayer(r)?this.queryRenderedFeatures(s.point,{layers:[r]}):[]).length?o=!0:o&&(o=!1,n.call(this,new iB(i,this,s.originalEvent)))},mouseout:r=>{o&&(o=!1,n.call(this,new iB(i,this,r.originalEvent)))}}}}return{layer:r,listener:n,delegates:{[i]:i=>{let o=this.getLayer(r)?this.queryRenderedFeatures(i.point,{layers:[r]}):[];o.length&&(i.features=o,n.call(this,i),delete i.features)}}}}on(i,r,n){if(void 0===n)return super.on(i,r);let o=this._createDelegatedListener(i,r,n);for(let r in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[i]=this._delegatedListeners[i]||[],this._delegatedListeners[i].push(o),o.delegates)this.on(r,o.delegates[r]);return this}once(i,r,n){if(void 0===n)return super.once(i,r);let o=this._createDelegatedListener(i,r,n);for(let i in o.delegates)this.once(i,o.delegates[i]);return this}off(i,r,n){return void 0===n?super.off(i,r):(this._delegatedListeners&&this._delegatedListeners[i]&&(o=>{let s=this._delegatedListeners[i];for(let i=0;i<s.length;i++){let o=s[i];if(o.layer===r&&o.listener===n){for(let i in o.delegates)this.off(i,o.delegates[i]);return s.splice(i,1),this}}})(),this)}queryRenderedFeatures(r,n){return this.style?(void 0!==n||void 0===r||r instanceof i.pointGeometry||Array.isArray(r)||(n=r,r=void 0),this.style.queryRenderedFeatures(r=r||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(i,r){return this.style.querySourceFeatures(i,r)}setStyle(r,n){return!1!==(n=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&r?(this._diffStyle(r,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(r,n))}_getUIString(i){let r=this._locale[i];if(null==r)throw Error(`Missing UI string '${i}'`);return r}_updateStyle(i,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),i&&(this.style=new em(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof i?this.style.loadURL(i):this.style.loadJSON(i)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new em(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(r,n){if("string"==typeof r){let o=this._requestManager.normalizeStyleURL(r),s=this._requestManager.transformRequest(o,i.ResourceType.Style);i.getJSON(s,(r,o)=>{r?this.fire(new i.ErrorEvent(r)):o&&this._updateDiff(o,n)})}else"object"==typeof r&&this._updateDiff(r,n)}_updateDiff(r,n){try{this.style.setState(r)&&this._update(!0)}catch(o){i.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(r,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():i.warnOnce("There is no style added to the map.")}addSource(i,r){return this._lazyInitEmptyStyle(),this.style.addSource(i,r),this._update(!0)}isSourceLoaded(r){let n=this.style&&this.style._getSourceCaches(r);if(0!==n.length)return n.every(i=>i.loaded());this.fire(new i.ErrorEvent(Error(`There is no source with ID '${r}'`)))}areTilesLoaded(){let i=this.style&&this.style._sourceCaches;for(let r in i){let n=i[r]._tiles;for(let i in n){let r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0}addSourceType(i,r,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(i,r,n)}removeSource(i){return this.style.removeSource(i),this._updateTerrain(),this._update(!0)}getSource(i){return this.style.getSource(i)}addImage(r,n,{pixelRatio:o=1,sdf:s=!1,stretchX:a,stretchY:l,content:u}={}){if(this._lazyInitEmptyStyle(),n instanceof rE||rS&&n instanceof rS){let{width:h,height:c,data:p}=i.exported.getImageData(n);this.style.addImage(r,{data:new i.RGBAImage({width:h,height:c},p),pixelRatio:o,stretchX:a,stretchY:l,content:u,sdf:s,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new i.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:h,height:c,data:p}=n;this.style.addImage(r,{data:new i.RGBAImage({width:h,height:c},new Uint8Array(p)),pixelRatio:o,stretchX:a,stretchY:l,content:u,sdf:s,version:0,userImage:n}),n.onAdd&&n.onAdd(this,r)}}}updateImage(r,n){let o=this.style.getImage(r);if(!o)return this.fire(new i.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let{width:s,height:a,data:l}=n instanceof rE||rS&&n instanceof rS?i.exported.getImageData(n):n;return void 0===s||void 0===a?this.fire(new i.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):s!==o.data.width||a!==o.data.height?this.fire(new i.ErrorEvent(Error("The width and height of the updated image must be that same as the previous version of the image"))):(o.data.replace(l,!(n instanceof rE||rS&&n instanceof rS)),void this.style.updateImage(r,o))}hasImage(r){return r?!!this.style.getImage(r):(this.fire(new i.ErrorEvent(Error("Missing required image id"))),!1)}removeImage(i){this.style.removeImage(i)}loadImage(r,n){i.getImage(this._requestManager.transformRequest(r,i.ResourceType.Image),(r,o)=>{n(r,o instanceof rE?i.exported.getImageData(o):o)})}listImages(){return this.style.listImages()}addLayer(i,r){return this._lazyInitEmptyStyle(),this.style.addLayer(i,r),this._update(!0)}moveLayer(i,r){return this.style.moveLayer(i,r),this._update(!0)}removeLayer(i){return this.style.removeLayer(i),this._update(!0)}getLayer(i){return this.style.getLayer(i)}setLayerZoomRange(i,r,n){return this.style.setLayerZoomRange(i,r,n),this._update(!0)}setFilter(i,r,n={}){return this.style.setFilter(i,r,n),this._update(!0)}getFilter(i){return this.style.getFilter(i)}setPaintProperty(i,r,n,o={}){return this.style.setPaintProperty(i,r,n,o),this._update(!0)}getPaintProperty(i,r){return this.style.getPaintProperty(i,r)}setLayoutProperty(i,r,n,o={}){return this.style.setLayoutProperty(i,r,n,o),this._update(!0)}getLayoutProperty(i,r){return this.style.getLayoutProperty(i,r)}setLight(i,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(i,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(i){return this._lazyInitEmptyStyle(),this.style.setTerrain(i),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(i){return this._lazyInitEmptyStyle(),this.style.setFog(i),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(r){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(r),this.transform):0}queryTerrainElevation(r,n){let o=this.transform.elevation;return o?(n=i.extend({},{exaggerated:!0},n),o.getAtPoint(i.MercatorCoordinate.fromLngLat(r),null,n.exaggerated)):null}setFeatureState(i,r){return this.style.setFeatureState(i,r),this._update()}removeFeatureState(i,r){return this.style.removeFeatureState(i,r),this._update()}getFeatureState(i){return this.style.getFeatureState(i)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let i=0,r=0;return this._container&&(i=this._container.clientWidth||400,r=this._container.clientHeight||300),[i,r]}_detectMissingCSS(){"rgb(250, 128, 114)"!==i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let i=this._container;i.classList.add("mapboxgl-map"),(this._missingCSSCanary=h.create("div","mapboxgl-canary",i)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=h.create("div","mapboxgl-canvas-container",i);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=h.create("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);let o=this._controlContainer=h.create("div","mapboxgl-control-container",i),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(i=>{s[i]=h.create("div",`mapboxgl-ctrl-${i}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(r,n){let o=i.exported.devicePixelRatio||1;this._canvas.width=o*r,this._canvas.height=o*n,this._canvas.style.width=`${r}px`,this._canvas.style.height=`${n}px`}_addMarker(i){this._markers.push(i)}_removeMarker(i){let r=this._markers.indexOf(i);-1!==r&&this._markers.splice(r,1)}_setupPainter(){let r=i.extend({},a.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(i.storeAuthState(n,!0),this.painter=new iv(n,this.transform),this.on("data",i=>{"source"===i.dataType&&this.painter.setTileLoadedFlag(!0)}),i.exported$1.testSupport(n)):this.fire(new i.ErrorEvent(Error("Failed to initialize WebGL")))}_contextLost(r){r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:r}))}_contextRestored(r){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:r}))}_onMapScroll(i){if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(i){return this.style&&(this._styleDirty=this._styleDirty||i,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(i){return this._update(),this._renderTaskQueue.add(i)}_cancelRenderFrame(i){this._renderTaskQueue.remove(i)}_requestDomTask(i){!this.isMoving()&&this.loaded()?i():this._domRenderTaskQueue.add(i)}_render(r){let n;let o=this.painter.context.extTimerQuery,s=i.exported.now();this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n));let a=this._updateAverageElevation(s);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(r),this._domRenderTaskQueue.run(r),this._removed)return;let l=!1,u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let r=this.transform.zoom,n=i.exported.now();this.style.zoomHistory.update(r,n);let o=new i.EvaluationParameters(r,{now:n,fadeDuration:u,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=o.crossFadingFactor();1===s&&s===this._crossFadingFactor||(l=!0,this._crossFadingFactor=s),this.style.update(o)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&(this.style.hasTransitions()||l)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){let r=i.exported.now()-s;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout(()=>{let s=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),this.fire(new i.Event("gpu-timing-frame",{cpuTime:r,gpuTime:s}))},50)}if(this.listens("gpu-timing-layer")){let r=this.painter.collectGpuTimers();setTimeout(()=>{let n=this.painter.queryGpuTimers(r);this.fire(new i.Event("gpu-timing-layer",{layerTimes:n}))},50)}let h=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(h||this._repaint)this.triggerRepaint();else{let r=!this.isMoving()&&this.loaded();if(r&&(a=this._updateAverageElevation(s,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),r&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let r=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:r})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(i,r=!1){let n=i=>(this.transform.averageElevation=i,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);if((r||i-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(i)){let r=this.transform.averageElevation,o=this.transform.sampleAverageElevation();isNaN(o)?o=0:this._averageElevationLastSampledAt=i;let s=Math.abs(r-o);if(s>1)this._averageElevation.easeTo(o,i,300);else if(s>1e-4)return this._averageElevation.jumpTo(o),n(o)}return!!this._averageElevation.isEasing(i)&&n(this._averageElevation.getValue(i))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,r=>{if(r&&(r.message===i.AUTH_ERR_MSG||401===r.status)){let r=this.painter.context.gl;i.storeAuthState(r,!1),this._logoControl instanceof rm&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){let i=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let n=this.painter.context.gl,o=n.createFramebuffer();function s(i){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0);let r=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,r),r}return n.bindFramebuffer(n.FRAMEBUFFER,o),this._canvasPixelComparison(s(i),r.canvasCopies.map(s),r.timeStamps)}_canvasPixelComparison(i,r,n){let o=n[1]-n[0],s=i.length/4;for(let a=0;a<r.length;a++){let l=r[a],u=0;for(let r=0;r<l.length;r+=4)l[r]===i[r]&&l[r+1]===i[r+1]&&l[r+2]===i[r+2]&&l[r+3]===i[r+3]&&(u+=1);o+=(n[a+2]-n[a+1])*(1-u/s)}return o}remove(){for(let i of(this._hash&&this._hash.remove(),this._controls))i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==i.window&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1));let r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),rT(this._canvasContainer),rT(this._controlContainer),rT(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(r){this._renderNextFrame=this._renderNextFrame||r,this.style&&!this._frame&&(this._frame=i.exported.frame(i=>{let r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(i)}))}_onWindowOnline(){this._update()}_onWindowResize(i){this._trackResize&&this.resize({originalEvent:i})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(i){this._showTileBoundaries!==i&&(this._showTileBoundaries=i,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(i){this._showTerrainWireframe!==i&&(this._showTerrainWireframe=i,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(i){this._speedIndexTiming!==i&&(this._speedIndexTiming=i,this._update())}get showPadding(){return!!this._showPadding}set showPadding(i){this._showPadding!==i&&(this._showPadding=i,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(i){this._showCollisionBoxes!==i&&(this._showCollisionBoxes=i,i?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(i){this._showOverdrawInspector!==i&&(this._showOverdrawInspector=i,this._update())}get repaint(){return!!this._repaint}set repaint(i){this._repaint!==i&&(this._repaint=i,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(i){this._vertices=i,this._update()}_setCacheLimits(r,n){i.setCacheLimits(r,n)}get version(){return i.version}},NavigationControl:class{constructor(r){this.options=i.extend({},rC,r),this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),h.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),h.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=h.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){let i=this._map.getZoom(),r=i===this._map.getMaxZoom(),n=i===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){let i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rP(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){h.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(i,r){let n=h.create("button",i,this._container);return n.type="button",n.addEventListener("click",r),n}_setButtonTitle(i,r){let n=this._map._getUIString(`NavigationControl.${r}`);i.title=n,i.setAttribute("aria-label",n)}},GeolocateControl:class extends i.Evented{constructor(r){super(),this.options=i.extend({},rA,r),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(r){var n;return this._map=r,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==rL?n(rL):void 0!==i.window.navigator.permissions?i.window.navigator.permissions.query({name:"geolocation"}).then(i=>{n(rL="denied"!==i.state)}):n(rL=!!i.window.navigator.geolocation),this._container}onRemove(){void 0!==this._geolocationWatchID&&(i.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),h.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rk=0,rR=!1}_isOutOfMapMaxBounds(i){let r=this._map.getMaxBounds(),n=i.coords;return r&&(n.longitude<r.getWest()||n.longitude>r.getEast()||n.latitude<r.getSouth()||n.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(r){if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(r),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",r)),this._finish()}}_updateCamera(r){let n=new i.LngLat(r.coords.longitude,r.coords.latitude),o=r.coords.accuracy,s=this._map.getBearing(),a=i.extend({bearing:s},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),a,{geolocateSource:!0})}_updateMarker(r){if(r){let n=new i.LngLat(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let i=this._map._container.clientHeight/2,r=this._map.unproject([0,i]),n=this._map.unproject([100,i]),o=r.distanceTo(n)/100,s=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(r){if(this._map){if(this.options.trackUserLocation){if(1===r.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===r.code&&rR)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",r)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(r){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=h.create("button","mapboxgl-ctrl-geolocate",this._container),h.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===r){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new rx(this._dotElement),this._circleElement=h.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rk--,rR=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let r;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++rk>1?(r={maximumAge:6e5,timeout:0},rR=!0):(r=this.options.positionOptions,rR=!1),this._geolocationWatchID=i.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,r)}}else i.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){i.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rd,ScaleControl:class{constructor(r){this.options=i.extend({},rD,r),i.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){rN(this._map,this._container,this.options)}onAdd(i){return this._map=i,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){h.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(i){this.options.unit=i,rN(this._map,this._container,this.options)}},FullscreenControl:class{constructor(r){this._fullscreen=!1,r&&r.container&&(r.container instanceof i.window.HTMLElement?this._container=r.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(r){return this._map=r,this._container||(this._container=this._map.getContainer()),this._controlContainer=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){h.remove(this._controlContainer),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){let r=this._fullscreenButton=h.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);h.create("span","mapboxgl-ctrl-icon",r).setAttribute("aria-hidden",!0),r.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(r){super(),this.options=i.extend(Object.create(rz),r),i.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(r){return this._map&&this.remove(),this._map=r,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&h.remove(this._content),this._container&&(h.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.LngLat.convert(r),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(r){return this.setDOMContent(i.window.document.createTextNode(r))}setHTML(r){let n;let o=i.window.document.createDocumentFragment(),s=i.window.document.createElement("body");for(s.innerHTML=r;n=s.firstChild;)o.appendChild(n);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(i){return this.options.maxWidth=i,this._update(),this}setDOMContent(i){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=h.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(i),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(i){this._container&&this._container.classList.add(i)}removeClassName(i){this._container&&this._container.classList.remove(i)}setOffset(i){return this.options.offset=i,this._update(),this}toggleClassName(i){if(this._container)return this._container.classList.toggle(i)}_createCloseButton(){this.options.closeButton&&(this._closeButton=h.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(i){this._update(i.point)}_onMouseMove(i){this._update(i.point)}_onDrag(i){this._update(i.point)}_update(r){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=h.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=h.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(i=>this._container.classList.add(i)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ry(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r))return;let n=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat),o=this.options.anchor,s=function r(n){if(n){if("number"==typeof n){let r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new i.pointGeometry(0,0),top:new i.pointGeometry(0,n),"top-left":new i.pointGeometry(r,r),"top-right":new i.pointGeometry(-r,r),bottom:new i.pointGeometry(0,-n),"bottom-left":new i.pointGeometry(r,-r),"bottom-right":new i.pointGeometry(-r,-r),left:new i.pointGeometry(n,0),right:new i.pointGeometry(-n,0)}}if(n instanceof i.pointGeometry||Array.isArray(n)){let r=i.pointGeometry.convert(n);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:i.pointGeometry.convert(n.center||[0,0]),top:i.pointGeometry.convert(n.top||[0,0]),"top-left":i.pointGeometry.convert(n["top-left"]||[0,0]),"top-right":i.pointGeometry.convert(n["top-right"]||[0,0]),bottom:i.pointGeometry.convert(n.bottom||[0,0]),"bottom-left":i.pointGeometry.convert(n["bottom-left"]||[0,0]),"bottom-right":i.pointGeometry.convert(n["bottom-right"]||[0,0]),left:i.pointGeometry.convert(n.left||[0,0]),right:i.pointGeometry.convert(n.right||[0,0])}}return r(new i.pointGeometry(0,0))}(this.options.offset);if(!o){let i;let r=this._container.offsetWidth,a=this._container.offsetHeight;i=n.y+s.bottom.y<a?["top"]:n.y>this._map.transform.height-a?["bottom"]:[],n.x<r/2?i.push("left"):n.x>this._map.transform.width-r/2&&i.push("right"),o=0===i.length?"bottom":i.join("-")}let a=n.add(s[o]).round();this._map._requestDomTask(()=>{this._container&&o&&(h.setTransform(this._container,`${r_[o]} translate(${a.x}px,${a.y}px)`),rv(this._container,o,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let i=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");i&&i.focus()}_onClose(){this.remove()}_setOpacity(i){this._content&&(this._content.style.opacity=i),this._tip&&(this._tip.style.opacity=i)}},Marker:rx,Style:em,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.pointGeometry,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:iT,Evented:i.Evented,config:i.config,prewarm:function(){tk().acquire(tA)},clearPrewarmedResources:function(){let i=o;i&&(i.isPreloaded()&&1===i.numActive()?(i.release(tA),o=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(e){i.config.ACCESS_TOKEN=e},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(e){i.config.API_URL=e},get workerCount(){return tL.workerCount},set workerCount(t){tL.workerCount=t},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){i.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(r){i.clearTileCache(r)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return rF}),n}();let i_={padding:30,linear:!1,duration:1250,easing:i=>-(Math.cos(Math.PI*i)-1)/2};function iv(i){return i.bbox||(0,ig.bbox)(i)}function ix(i,r){for(let r of(window.geojson=i,document.querySelector("#intro-explainer").classList.add("hidden"),document.getElementsByClassName("mapboxgl-popup")))r.remove();r.getSource("user-geo").setData(i);let n=iv(i);n&&n.length&&n.length>0&&isFinite(n[0])&&(r.fitBounds(n,i_),function(i){let r=[];if(i.features&&i.features.length>0){let n=i.features[0].properties;r.push([""," -- none -- "]),Object.keys(n).forEach(i=>r.push([i,i]))}else r.push(["","No fields found"]);let n=document.querySelector("select#name_field");for(;n.hasChildNodes();)n.firstChild.remove();let o=document.querySelector("select#id_field");for(;o.hasChildNodes();)o.firstChild.remove();r.forEach(i=>{[n,o].forEach(r=>{let n=document.createElement("option");n.value=i[0],n.label=i[1],r.appendChild(n)})}),document.querySelector("#details").classList.remove("hidden")}(i))}function ib(i){let r=document.querySelector("#file-upload-message");r.textContent=i,r.classList.remove("hidden")}function iw(){document.querySelector("#file-upload-message").classList.add("hidden")}window.bboxWithFallback=iv;let iE=["dataset_name","source_url","name_field","id_field"];function iI(){iE.forEach(i=>{let r=document.getElementById(i);if("INPUT"==r.tagName)r.value="";else if("SELECT"==r.tagName)for(;r.options.length>1;)r.removeChild(r.options.item(1))})}function iS(){document.querySelector("#details").classList.add("hidden")}let iM="Uploaded map area is too large. (Maximum area 2500 sq. km/about 965 sq. mi.)";function iT(){return{type:"FeatureCollection",bbox:"",features:[]}}function iC(i){window.loading=i;var r=document.querySelector("#upload");i?spinner.spin(r):spinner.stop()}window.addEventListener("DOMContentLoaded",i=>{document.querySelectorAll(".import-geojson-button").forEach(i=>{i.addEventListener("click",()=>{if(!window.loading&&function(){if(iw(),!window.geojson)return ib("No map data found to upload."),!1;let i=!0;return iE.forEach(r=>{let n=document.getElementById(r);"function"==typeof n.checkValidity&&(i=i&&n.checkValidity())}),!!i||(ib("Please fix the errors on the form, or clear out values if you'd rather skip it."),!1)}()){var i,r,n;let s;let a={dataset_name:document.getElementById("dataset_name").value||null,source_url:document.getElementById("source_url").value||null,name_field:document.getElementById("name_field").value||null,id_field:document.getElementById("id_field").value||null,share_checked:document.getElementById("share_map").checked};i=o.getSource("user-geo")._data,(r=a)||(r={}),(n=new XMLHttpRequest).open("POST",`${CR_API_URL}/1.0/user_geo/import`,!0),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){console.log("------------------");let i=JSON.parse(this.response);i.ok&&i.hash_digest?i.existing?window.location.href+=`${i.hash_digest}?existing=true`:window.location.href+=i.hash_digest:(console.log("error importing"),console.log(i),iC(!1),ib(i.message))},n.onerror=function(i){console.log(`Error importing GeoJSON ${i}`),console.log(i),iC(!1),ib("An unexpected error occurred.")},s={geojson:i,dataset_name:r.dataset_name,source_url:r.source_url,name_field:r.name_field,id_field:r.id_field,share_checked:r.share_checked},iI(),iS(),iC(!0),n.send(JSON.stringify(s))}})});let n=document.getElementById("file-picker");if(n&&n.addEventListener("change",function(){if(iw(),ix(iT(),o),iI(),iS(),this.files.length>0){let i=this.files.item(0);if(i.type&&-1==["application/zip","application/json"].indexOf(i.type)){console.log(`Invalid upload type ${i.type}`),ib("Uploaded file must be either a ZIP file or GeoJSON.");return}"application/zip"==i.type?i.arrayBuffer().then(r(g).loadAsync).then(i=>{let r=function(i){let r=[],n=null;if(Object.keys(i).forEach(i=>{i.match(/^([a-zA-Z0-9]+.*)\.shp$/i)&&(r.push(i),n=i.match(/^([a-zA-Z0-9]+.*)\.shp$/i)[1])}),0==r.length)throw"Uploaded ZIP file does not contain any files with .shp extension.";if(r.length>1)throw"Uploaded ZIP file has multiple files with .shp extension.";let o={};return Object.keys(i).forEach(r=>{if(r.match(/^[a-zA-Z0-9]+.*\.(shp|dbf|prj)$/i)&&0==r.indexOf(n)){let n=r.match(/.*\.(.+)$/)[1].toLowerCase();if(i[n])throw`Uploaded ZIP file contains multiple entries with [${n}] extension. ZIPs should have only one set of shapefile files.`;o[n]=i[r]}}),o}(i.files);if(!r.shp)throw"Uploaded ZIP file must contain a file with .shp extension";r.prj?r.prj.async("string").then(i=>{s(r).then(r=>{if((r=(0,tU.toWgs84)(r,i)).features.length>0){if((0,ig.area)(r)>25e8)throw iM;ix(r,o)}else console.log(`no features, but prj ${i}`)}).catch(i=>ib(i))}):s(r).then(i=>{if(i.features.length>0){if((0,ig.area)(i)>25e8)throw iM;console.log("Adding to map in given projection"),ix(i,o)}else console.log("no features, and no prj")}).catch(i=>ib(i))}).catch(i=>ib(i)):function(i){if("application/json"==i.type)return!0;if(i.name.match(/.*\.(.+)$/)){let r=i.name.match(/.*\.(.+)$/)[1].toLowerCase();return"json"==r||"geojson"==r}return!1}(i)&&i.text().then(i=>{let r=JSON.parse(i);if((0,ig.area)(r)>25e8)throw iM;ix(r,o)}).catch(i=>ib(i))}},!1),r(iy).accessToken="pk.eyJ1IjoiY2Vuc3VzcmVwb3J0ZXIiLCJhIjoiQV9hS01rQSJ9.wtsn0FwmAdRV7cckopFKkA",document.getElementById("map")){var o=new(r(iy)).Map({container:"map",style:"mapbox://styles/censusreporter/ckfyfj0v707ob19qdo047ndoq",center:[-87.750691,41.976544],zoom:9});let i=null;if(document.getElementById("initial-geojson"))try{i=JSON.parse(document.getElementById("initial-geojson").textContent)}catch(i){console.log(`Error parsing json: ${i}`)}o.on("style.load",()=>{var n,s;let a;return n=o,a=(s=i)||iT(),void(n.addSource("user-geo",{type:"geojson",data:a}),s&&n.fitBounds(iv(s),{duration:0}),n.addLayer({id:"user-geo-fill",type:"fill",source:"user-geo",paint:{"fill-color":"#333","fill-opacity":.3}}),n.addLayer({id:"user-geo-line",type:"line",source:"user-geo",paint:{"line-color":"#333","line-opacity":1,"line-width":1}}),n.on("click","user-geo-fill",function(i){let o=i.features||n.queryRenderedFeatures(i.point,{layers:["user-geo-fill"]});if(o&&o[0].properties){let s=Object.entries(o[0].properties).map(([i,r])=>`<b>${i}:</b> ${r}`);new(r(iy)).Popup().setLngLat(i.lngLat).setHTML(s.join("<br>")).addTo(n)}}),n.on("mouseenter","user-geo-fill",function(){n.getCanvas().style.cursor="pointer"}),n.on("mouseleave","user-geo-fill",function(){n.getCanvas().style.cursor=""}))}),window.map=o}async function s(i){let r=iT(),n=(r.type="FeatureCollection",r.features=[],async function(i){return r.bbox=i.bbox,i.read().then(function(n){return n.done?r:(r.features.push(n.value),i.read().then(function n(o){return o.done?r:(r.features.push(o.value),i.read().then(n))}))})});return Promise.all([i.shp.async("arrayBuffer"),i.dbf.async("arrayBuffer")]).then(i=>(function(i,r,n){return"string"==typeof r?(/\.dbf$/.test(r)||(r+=".dbf"),r=tv(r,n)):r instanceof ArrayBuffer||r instanceof Uint8Array?r=ty(r):null!=r&&(r=tx(r)),"string"==typeof i?(/\.shp$/.test(i)||(i+=".shp"),void 0===r&&(r=tv(i.substring(0,i.length-4)+".dbf",n).catch(function(){})),i=tv(i,n)):i instanceof ArrayBuffer||i instanceof Uint8Array?i=ty(i):i=tx(i),Promise.all([i,r]).then(function(i){var r,o,s,a=i[0],l=i[1],u="windows-1252";return n&&null!=n.encoding&&(u=n.encoding),r=l&&new TextDecoder(u),Promise.all([(o=tw(o=a)).slice(100).then(function(i){return new tN(o,tM(i))}),l&&(s=tw(s=l)).slice(32).then(function(i){var n=tM(i);return s.slice(n.getUint16(8,!0)-32).then(function(i){return new tT(s,r,n,tM(i))})})]).then(function(i){return new tF(i[0],i[1])})})})(...i)).then(n).then(i=>r)}})}();
//# sourceMappingURL=aggregate.js.map
